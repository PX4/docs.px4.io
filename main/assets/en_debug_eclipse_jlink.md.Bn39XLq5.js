import{_ as t,a as i,b as a,c as o,d as n,e as l,f as s,g as r,h as g,i as p,j as c,k as h}from"./chunks/eclipse_svd_file_path.BH0tu80j.js";import{_ as u,c as d,a8 as m,o as b}from"./chunks/framework.BDnHobkS.js";const k="/main/assets/eclipse_packs_perspective.D8H-GboV.jpg",f="/main/assets/eclipse_settings_debug_config_gdb_segger_build_config.Z-MbQVk1.png",T=JSON.parse('{"title":"Debugging with Eclipse and J-Link","description":"","frontmatter":{},"headers":[],"relativePath":"en/debug/eclipse_jlink.md","filePath":"en/debug/eclipse_jlink.md"}'),w={name:"en/debug/eclipse_jlink.md"};function _(S,e,E,P,D,C){return b(),d("div",null,e[0]||(e[0]=[m('<h1 id="debugging-with-eclipse-and-j-link" tabindex="-1">Debugging with Eclipse and J-Link <a class="header-anchor" href="#debugging-with-eclipse-and-j-link" aria-label="Permalink to &quot;Debugging with Eclipse and J-Link&quot;">​</a></h1><p>This topic explains how to setup and use <a href="https://gnu-mcu-eclipse.github.io/" target="_blank" rel="noreferrer">MCU Eclipse</a> with a <em>Segger Jlink adapter</em> to debug PX4 running on NuttX (e.g. Pixhawk series boards).</p><h2 id="required-hardware" tabindex="-1">Required Hardware <a class="header-anchor" href="#required-hardware" aria-label="Permalink to &quot;Required Hardware&quot;">​</a></h2><ul><li><a href="https://www.segger.com/products/debug-probes/j-link/models/j-link-edu-mini/" target="_blank" rel="noreferrer">J-Link EDU Mini</a></li><li>Adapter to connect Segger JLink to Flight Controller <a href="./../debug/swd_debug.html">SWD Debug Port</a> (debug port).</li><li>Micro USB cable</li></ul><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><h3 id="px4" tabindex="-1">PX4 <a class="header-anchor" href="#px4" aria-label="Permalink to &quot;PX4&quot;">​</a></h3><p>Setup PX4 by following the normal guidelines:</p><ul><li><a href="./../dev_setup/dev_env.html">Setup the PX4 Developer Environment/Toolchain</a> for your platform (e.g. for Linux see: <a href="./../dev_setup/dev_env_linux_ubuntu.html">Development Environment on Ubuntu LTS / Debian Linux</a>).</li><li><a href="./../dev_setup/building_px4.html">Download PX4</a> and optionally build it on the command line.</li></ul><h3 id="eclipse" tabindex="-1">Eclipse <a class="header-anchor" href="#eclipse" aria-label="Permalink to &quot;Eclipse&quot;">​</a></h3><p>To install <em>Eclipse</em>:</p><ol><li>Download <a href="https://github.com/gnu-mcu-eclipse/org.eclipse.epp.packages/releases/" target="_blank" rel="noreferrer">Eclipse CDT for C/C++ Developers</a> (MCU GitHub).</li><li>Extract the Eclipse folder and copy it anywhere (there is no need to run any install scripts).</li><li>Run <em>Eclipse</em> and choose a location for your initial workbench.</li></ol><h3 id="segger-jlink-tools" tabindex="-1">Segger Jlink Tools <a class="header-anchor" href="#segger-jlink-tools" aria-label="Permalink to &quot;Segger Jlink Tools&quot;">​</a></h3><p>To install the <em>Segger Jlink</em> tools:</p><ol><li>Download and run the <a href="https://www.segger.com/downloads/jlink/#J-LinkSoftwareAndDocumentationPack" target="_blank" rel="noreferrer">J-Link Software and Documentation Pack</a> for your OS (Windows and Linux packages available). <ul><li>On Linux the tools are installed in <strong>/usr/bin</strong>.</li></ul></li></ol><p>For more information, see: <a href="https://gnu-mcu-eclipse.github.io/debug/jlink/install/" target="_blank" rel="noreferrer">https://gnu-mcu-eclipse.github.io/debug/jlink/install/</a>.</p><h2 id="first-use" tabindex="-1">First Use <a class="header-anchor" href="#first-use" aria-label="Permalink to &quot;First Use&quot;">​</a></h2><ol><li><p>Connect the <em>Segger JLink</em> to the host computer and the <a href="./../debug/swd_debug.html">flight controller debug port</a> (via an adapter).</p></li><li><p>Power the flight controller.</p></li><li><p>Run <em>Eclipse</em>.</p></li><li><p>Add a source by choosing <strong>File &gt; Import &gt; C/C++ &gt; Existing Code as Makefile Project</strong> and click <strong>Next</strong>.</p></li><li><p>Point it to the <strong>PX4-Autopilot</strong> folder and give it a name, then select <em>ARM Cross GCC</em> in the <em>Toolchain for Indexer Settings</em> and click <strong>Finish</strong>. Import takes a while, wait for it to complete.</p></li><li><p>Set the MCU settings: right-click on the top-level project in the Project Explorer, select <em>Properties</em> then under MCU choose <em>SEGGER J-Link Path</em>. Set it as shown in the screenshot below. <img src="'+t+'" alt="Eclipse: Segger J-Link Path"></p></li><li><p>Update packs:</p><ul><li><p>Click the small icon on the top right called <em>Open Perspective</em> and open the <em>Packs</em> perspective. <img src="'+i+'" alt="Eclipse: Workspace"></p></li><li><p>Click the <strong>update all</strong> button.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This takes a VERY LONG TIME (10 minutes). Ignore all the errors about missing packages that pop up.</p></div><p><img src="'+k+'" alt="Eclipse: Workspace Packs Perspective"></p></li><li><p>The STM32Fxx devices are found in the Keil folder, install by right-clicking and then selecting <strong>install</strong> on the according device for F4 and F7.</p></li></ul></li><li><p>Setup debug configuration for target:</p><ul><li>Right click project and open the <em>Settings</em> (menu: <strong>C/C++ Build &gt; Settings</strong>)</li><li>Choose the <em>Devices</em> Tab, <em>Devices</em> section (Not <em>Boards</em>).</li><li>Find the FMU chip you wish to debug.</li></ul><p><img src="'+a+'" alt="Eclipse: Select FMU in settings"></p></li><li><p>Select debug configurations with the small drop-down next to the bug symbol: <img src="'+o+'" alt="Eclipse: Debug config"></p></li><li><p>Then select <em>GDB SEGGER J-Link Debugging</em> and then the <strong>New config</strong> button on the top left. <img src="'+n+'" alt="Eclipse: GDB Segger Debug config"></p></li><li><p>Setup build config:</p><ul><li><p>Give it a name and set the <em>C/C++ Application</em> to the corresponding <strong>.elf</strong> file.</p></li><li><p>Choose <em>Disable Auto build</em></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Remember that you must build the target from the command line before starting a debug session.</p></div></li></ul><p><img src="'+f+'" alt="Eclipse: GDB Segger Debug config"></p></li><li><p>The <em>Debugger</em> and <em>Startup</em> tabs shouldn’t need any modifications (just verify your settings with the screenshots below)</p><p><img src="'+l+'" alt="Eclipse: GDB Segger Debug config: debugger tab"><img src="'+s+'" alt="Eclipse: GDB Segger Debug config: startup tab"></p></li></ol><h2 id="segger-task-aware-debugging" tabindex="-1">SEGGER Task-aware debugging <a class="header-anchor" href="#segger-task-aware-debugging" aria-label="Permalink to &quot;SEGGER Task-aware debugging&quot;">​</a></h2><p>Task-aware debugging (also known as <a href="https://www.segger.com/products/debug-probes/j-link/tools/j-link-gdb-server/thread-aware-debugging/" target="_blank" rel="noreferrer">thread-aware debugging</a>) allows you to show the context of all running threads/tasks instead of just the stack current task. This is quite useful since PX4 tends to run many different tasks.</p><p>To enable this feature for use in Eclipse:</p><ol><li><p>You first need to enable <code>CONFIG_DEBUG_TCBINFO</code> in the NuttX configuration for your build (to expose the TCB offsets).</p><ul><li><p>Open a terminal in the root of your PX4-Autopilot source code</p></li><li><p>In the terminal, open <code>menuconfig</code> using the appropriate make target for the build. This will be something like:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> px4_fmu-v5_default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> boardguiconfig</span></span></code></pre></div><p>(See <a href="./../hardware/porting_guide_config.html#px4-menuconfig-setup">PX4 Menuconfig Setup</a> for more information) on using the config tools).</p></li><li><p>Ensure that the <em>Enable TCBinfo struct for debug</em> is selected as shown: <img src="'+r+'" alt="NuttX: Menuconfig: CONFIG_DEBUG_TCBINFO"></p></li></ul></li><li><p>Compile the <strong>jlink-nuttx.so</strong> library in the terminal by running the following command in the terminal: <code>make jlink-nuttx</code></p></li><li><p>Modify Eclipse to use this libary. In the <em>J-Link GDB Server Setup</em> configuration, update <strong>Other options</strong> to include <code>-rtos /home/&lt;PX4 path&gt;/Tools/jlink-nuttx.so</code>, as shown in the image below.</p><p><img src="'+g+'" alt="Eclipse: GDB Segger Debug config RTOS aware: debugger tab"></p></li><li><p>When running the debugger you should see now multiple threads instead of just one:</p><p><img src="'+p+'" alt="Eclipse: GDB Segger Debug config RTOS aware: debug session"></p></li></ol><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="target-cpu-not-in-package-manager" tabindex="-1">Target CPU not in Package Manager <a class="header-anchor" href="#target-cpu-not-in-package-manager" aria-label="Permalink to &quot;Target CPU not in Package Manager&quot;">​</a></h3><p>If the target CPU does not appear in the package manager you may need these steps to get the register view working.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This should not generally happen (but anecdotally has been reported when connecting to an STM F7 controller).</p></div><p>Adding missing SVD files for the <em>Peripheral View</em>:</p><ol><li><p>Find out where MCU Eclipse stores its packages (<strong>Preferences &gt; C/C++ &gt; MCU Packages</strong>):</p><p><img src="'+c+'" alt="Eclipse: MCU Packages"></p></li><li><p>Download missing packages from: <a href="http://www.keil.com/dd2/Pack/" target="_blank" rel="noreferrer">http://www.keil.com/dd2/Pack/</a></p></li><li><p>Open downloaded pack with a decompression tool, and extract the <strong>.SVD</strong> files from: <strong>/CMSIS/SVD</strong>.</p></li><li><p>Select desired <strong>.SVD</strong> file in: <strong>Debug Options &gt; GDB SEGGER JLink Debugging &gt; SVD Path</strong></p><p><img src="'+h+'" alt="Eclipse: SVD File path"></p></li></ol>',27)]))}const y=u(w,[["render",_]]);export{T as __pageData,y as default};
