import{_ as i,c as a,a8 as e,o as n}from"./chunks/framework.BDnHobkS.js";const o=JSON.parse('{"title":"드라이버 개발","description":"","frontmatter":{},"headers":[],"relativePath":"ko/middleware/drivers.md","filePath":"ko/middleware/drivers.md"}'),p={name:"ko/middleware/drivers.md"};function t(l,s,h,d,k,r){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="드라이버-개발" tabindex="-1">드라이버 개발 <a class="header-anchor" href="#드라이버-개발" aria-label="Permalink to &quot;드라이버 개발&quot;">​</a></h1><p>PX4 device drivers are based on the <a href="https://github.com/PX4/PX4-Autopilot/tree/main/src/lib/drivers/device" target="_blank" rel="noreferrer">Device</a> framework.</p><h2 id="드라이버-생성" tabindex="-1">드라이버 생성 <a class="header-anchor" href="#드라이버-생성" aria-label="Permalink to &quot;드라이버 생성&quot;">​</a></h2><p>PX4 almost exclusively consumes data from <a href="./../middleware/uorb.html">uORB</a>. 일반적인 주변 장치 유형에 대한 드라이버는 올바른 uORB 메시지(예: 자이로, 가속도계, 압력 센서 등)를 게시하여야 합니다.</p><p>The best approach for creating a new driver is to start with a similar driver as a template (see <a href="https://github.com/PX4/PX4-Autopilot/tree/main/src/drivers" target="_blank" rel="noreferrer">src/drivers</a>).</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>More detailed information about working with specific I/O buses and sensors may be available in <a href="./../sensor_bus/">Sensor and Actuator Buses</a> section.</p></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Publishing the correct uORB topics is the only pattern that drivers <em>must</em> follow.</p></div><h2 id="핵심-아키텍처" tabindex="-1">핵심 아키텍처 <a class="header-anchor" href="#핵심-아키텍처" aria-label="Permalink to &quot;핵심 아키텍처&quot;">​</a></h2><p>PX4 is a <a href="./../concept/architecture.html">reactive system</a> and uses <a href="./../middleware/uorb.html">uORB</a> publish/subscribe to transport messages. 파일 핸들은 시스템의 핵심 작업에 필요하지 않거나 사용되지 않습니다. 두 가지 주요 API가 사용됩니다.</p><ul><li>PX4가 실행되는 시스템에 따라 파일, 네트워크 또는 공유 메모리 백엔드가 있는 게시/구독 시스템.</li><li>장치를 열거하고 구성을 가져오거나 설정할 수 있는 전역 장치 레지스트리. 이것은 연결 목록이나 파일 시스템에 대한 매핑처럼 간단할 수 있습니다.</li></ul><h2 id="장치-id" tabindex="-1">장치 ID <a class="header-anchor" href="#장치-id" aria-label="Permalink to &quot;장치 ID&quot;">​</a></h2><p>PX4는 장치 ID를 사용하여 시스템 전체에서 개별 센서를 일관되게 식별합니다. 이러한 ID는 구성 매개변수에 저장되며, 센서 보정 값을 일치시키고 어떤 센서가 어떤 로그 파일 항목에 기록되는 지 결정합니다.</p><p>The order of sensors (e.g. if there is a <code>/dev/mag0</code> and an alternate <code>/dev/mag1</code>) does not determine priority - the priority is instead stored as part of the published uORB topic.</p><h3 id="디코딩-예제" tabindex="-1">디코딩 예제 <a class="header-anchor" href="#디코딩-예제" aria-label="Permalink to &quot;디코딩 예제&quot;">​</a></h3><p>시스템에 3개의 자력계가 있는 경우에는 비행 로그(.px4log)를 사용하여 매개변수를 덤프합니다. The three parameters encode the sensor IDs and <code>MAG_PRIME</code> identifies which magnetometer is selected as the primary sensor. 각 MAGx_ID는 24비트 숫자이며, 수동 디코딩을 하가 위하여 왼쪽에 0을 채워야 합니다.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CAL_MAG0_ID = 73225.0</span></span>
<span class="line"><span>CAL_MAG1_ID = 66826.0</span></span>
<span class="line"><span>CAL_MAG2_ID = 263178.0</span></span>
<span class="line"><span>CAL_MAG_PRIME = 73225.0</span></span></code></pre></div><p>This is the external HMC5983 connected via I2C, bus 1 at address <code>0x1E</code>: It will show up in the log file as <code>IMU.MagX</code>.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># device ID 73225 in 24-bit binary:</span></span>
<span class="line"><span>00000001  00011110  00001 001</span></span>
<span class="line"><span></span></span>
<span class="line"><span># decodes to:</span></span>
<span class="line"><span>HMC5883   0x1E    bus 1 I2C</span></span></code></pre></div><p>이것은 SPI, 버스 1, 슬레이브 선택 슬롯 5를 통하여 연결된 내부 HMC5983입니다. It will show up in the log file as <code>IMU1.MagX</code>.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># device ID 66826 in 24-bit binary:</span></span>
<span class="line"><span>00000001  00000101  00001 010</span></span>
<span class="line"><span></span></span>
<span class="line"><span># decodes to:</span></span>
<span class="line"><span>HMC5883   dev 5   bus 1 SPI</span></span></code></pre></div><p>그리고 이것은 SPI, 버스 1, 슬레이브 선택 슬롯 4를 통하여 연결된 내부 MPU9250 자력계입니다. It will show up in the log file as <code>IMU2.MagX</code>.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># device ID 263178 in 24-bit binary:</span></span>
<span class="line"><span>00000100  00000100  00001 010</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#decodes to:</span></span>
<span class="line"><span>MPU9250   dev 4   bus 1 SPI</span></span></code></pre></div><h3 id="장치-id-인코딩" tabindex="-1">장치 ID 인코딩 <a class="header-anchor" href="#장치-id-인코딩" aria-label="Permalink to &quot;장치 ID 인코딩&quot;">​</a></h3><p>장치 ID는 이 형식에 따른 24비트 숫자입니다. 첫 번째 필드는 위의 디코딩 예에서 최하위 비트입니다.</p><div class="language-C vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DeviceStructure {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DeviceBusType bus_type : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bus: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // which instance of the bus type</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> address;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // address on the bus (eg. I2C address)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> devtype;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // device class specific device type</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>The <code>bus_type</code> is decoded according to:</p><div class="language-C vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DeviceBusType {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  DeviceBusType_UNKNOWN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  DeviceBusType_I2C     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  DeviceBusType_SPI     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  DeviceBusType_UAVCAN  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>and <code>devtype</code> is decoded according to:</p><div class="language-C vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_MAG_DEVTYPE_HMC5883</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">01</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_MAG_DEVTYPE_LSM303D</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">02</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_MAG_DEVTYPE_ACCELSIM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">03</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_MAG_DEVTYPE_MPU9250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">04</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_ACC_DEVTYPE_LSM303D</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_ACC_DEVTYPE_BMA180</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_ACC_DEVTYPE_MPU6000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_ACC_DEVTYPE_ACCELSIM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">14</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_ACC_DEVTYPE_GYROSIM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_ACC_DEVTYPE_MPU9250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_GYR_DEVTYPE_MPU6000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">21</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_GYR_DEVTYPE_L3GD20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">22</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_GYR_DEVTYPE_GYROSIM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">23</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_GYR_DEVTYPE_MPU9250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_RNG_DEVTYPE_MB12XX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">31</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DRV_RNG_DEVTYPE_LL40LS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span></span></code></pre></div><h2 id="디버깅" tabindex="-1">디버깅 <a class="header-anchor" href="#디버깅" aria-label="Permalink to &quot;디버깅&quot;">​</a></h2><p>For general debugging topics see: <a href="./../debug/">Debugging/Logging</a>.</p><h3 id="상세-로깅" tabindex="-1">상세 로깅 <a class="header-anchor" href="#상세-로깅" aria-label="Permalink to &quot;상세 로깅&quot;">​</a></h3><p>Drivers (and other modules) output minimally verbose logs strings by default (e.g. for <code>PX4_DEBUG</code>, <code>PX4_WARN</code>, <code>PX4_ERR</code>, etc.).</p><p>Log verbosity is defined at build time using the <code>RELEASE_BUILD</code> (default), <code>DEBUG_BUILD</code> (verbose) or <code>TRACE_BUILD</code> (extremely verbose) macros.</p><p>Change the logging level using <code>COMPILE_FLAGS</code> in the driver <code>px4_add_module</code> function (<strong>CMakeLists.txt</strong>). 아래 코드 조각은 단일 모듈 또는 드라이버에 대해 DEBUG_BUILD 수준 디버깅을 활성화하에 필요한 변경 사항을 나타냅니다.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>px4_add_module(</span></span>
<span class="line"><span>	MODULE templates__module</span></span>
<span class="line"><span>	MAIN module</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>	COMPILE_FLAGS</span></span>
<span class="line"><span>		-DDEBUG_BUILD</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>	SRCS</span></span>
<span class="line"><span>		module.cpp</span></span>
<span class="line"><span>	DEPENDS</span></span>
<span class="line"><span>		modules__uORB</span></span>
<span class="line"><span>	)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Verbose logging can also be enabled on a per-file basis, by adding <code>#define DEBUG_BUILD</code> at the very top of a .cpp file (before any includes).</p></div>`,39)]))}const g=i(p,[["render",t]]);export{o as __pageData,g as default};
