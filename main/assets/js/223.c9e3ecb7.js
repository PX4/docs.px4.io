(window.webpackJsonp=window.webpackJsonp||[]).push([[223],{1649:function(e,t,o){},1697:function(e,t,o){"use strict";o(1649)},1907:function(e,t,o){"use strict";o.r(t);o(1697);var r=o(19),a=Object(r.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"sapog-esc-firmware"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#sapog-esc-firmware"}},[e._v("#")]),e._v(" Sapog ESC Firmware")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://github.com/PX4/sapog#px4-sapog",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sapog"),r("OutboundLink")],1),e._v(" firmware is an advanced open source sensorless PMSM/BLDC motor controller firmware designed for use in propulsion systems of electric unmanned vehicles.")]),e._v(" "),r("p",[e._v("While it can be controlled using traditional PWM input, it is designed to operate over CAN bus using "),r("RouterLink",{attrs:{to:"/en/dronecan/"}},[e._v("DroneCAN")]),e._v(".")],1),e._v(" "),r("h2",{attrs:{id:"where-to-buy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#where-to-buy"}},[e._v("#")]),e._v(" Where to Buy")]),e._v(" "),r("p",[e._v("Multiple vendors sell ESC hardware that runs sapog firmware:")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://zubax.com/products/orel_20",target:"_blank",rel:"noopener noreferrer"}},[e._v("Zubax Orel 20"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://shop.holybro.com/kotleta20_p1156.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Holybro Kotleta20"),r("OutboundLink")],1)])]),e._v(" "),r("div",{attrs:{id:"image_container"}},[r("div",{staticClass:"image_column"},[r("img",{attrs:{src:o(442),alt:"Orel20 - Top"}}),r("br"),r("a",{attrs:{href:"https://zubax.com/products/orel_20"}},[e._v("Zubax Orel 20")])]),e._v(" "),r("div",{staticClass:"image_column"},[r("img",{attrs:{src:o(443),alt:"Holybro Kotleta20 top"}}),r("br"),r("a",{attrs:{href:"https://shop.holybro.com/kotleta20_p1156.html"}},[e._v("Holybro Kotleta20")])])]),e._v(" "),r("h2",{attrs:{id:"hardware-setup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#hardware-setup"}},[e._v("#")]),e._v(" Hardware Setup")]),e._v(" "),r("p",[e._v("ESCs are connected to the CAN bus using a Pixhawk standard 4 pin JST GH cable.\nFor more information, refer to the "),r("RouterLink",{attrs:{to:"/en/can/#wiring"}},[e._v("CAN Wiring")]),e._v(" instructions.\nESC order does not matter.")],1),e._v(" "),r("h2",{attrs:{id:"firmware-setup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#firmware-setup"}},[e._v("#")]),e._v(" Firmware Setup")]),e._v(" "),r("p",[e._v("ESCs come with an existing build of Sapog installed. If you want to update:")]),e._v(" "),r("p",[e._v("To build the firmware:")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("git clone --recursive https://github.com/PX4/sapog\ncd sapog/firmware\nmake RELEASE=1\n")])])]),r("p",[e._v("This will create a file "),r("code",[e._v("*.application.bin")]),e._v(". in "),r("code",[e._v("build/")]),e._v(".\nThis binary can be flashed through the autopilot over DroneCAN via the sapog bootloader.\nSee "),r("RouterLink",{attrs:{to:"/en/dronecan/#firmware-update"}},[e._v("DroneCAN Firmware Update")]),e._v(".")],1),e._v(" "),r("p",[e._v("Refer to the "),r("a",{attrs:{href:"https://github.com/PX4/sapog",target:"_blank",rel:"noopener noreferrer"}},[e._v("project page"),r("OutboundLink")],1),e._v(" to learn more, including how to flash without using the DroneCAN bootloader (i.e. on a not-yet-programmed device) or for development.")]),e._v(" "),r("h2",{attrs:{id:"flight-controller-setup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#flight-controller-setup"}},[e._v("#")]),e._v(" Flight Controller Setup")]),e._v(" "),r("h3",{attrs:{id:"enabling-dronecan"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#enabling-dronecan"}},[e._v("#")]),e._v(" Enabling DroneCAN")]),e._v(" "),r("p",[e._v("Connect the ESCs to the Pixhawk CAN bus. Power up the entire vehicle using a battery or power supply (not just the flight controller over USB) and enable the DroneCAN driver by setting the parameter "),r("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#UAVCAN_ENABLE"}},[e._v("UAVCAN_ENABLE")]),e._v(" to '3' to enable both dynamic node ID allocation and DroneCAN ESC output.")],1),e._v(" "),r("h3",{attrs:{id:"px4-configuration"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#px4-configuration"}},[e._v("#")]),e._v(" PX4 Configuration")]),e._v(" "),r("p",[e._v("(Optional) Set "),r("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#UAVCAN_ESC_IDLT"}},[e._v("UAVCAN_ESC_IDLT")]),e._v(" to 1 in order to ensure that the motors are always running at least at the idle throttle while the system is armed.")],1),e._v(" "),r("div",{staticClass:"custom-block note"},[r("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),r("p",[e._v("Some systems will not benefit from this behavior, e.g. glider drones).")])]),e._v(" "),r("h3",{attrs:{id:"automatic-esc-enumeration-using-qgroundcontrol"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#automatic-esc-enumeration-using-qgroundcontrol"}},[e._v("#")]),e._v(" Automatic ESC Enumeration using QGroundControl")]),e._v(" "),r("p",[e._v("This section shows how to enumerate any "),r("a",{attrs:{href:"https://github.com/PX4/sapog#px4-sapog",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sapog-based"),r("OutboundLink")],1),e._v('-based ESCs "automatically" using '),r("em",[e._v("QGroundControl")]),e._v(".")]),e._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),r("p",[e._v("You can skip this section if there is only one ESC in your setup, because the ESC index is already set to zero by default.")])]),e._v(" "),r("p",[e._v("To enumerate the ESC:")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("Power the vehicle with a battery and connect to "),r("em",[e._v("QGroundControl")])])]),e._v(" "),r("li",[r("p",[e._v("Navigate to "),r("strong",[e._v("Vehicle Setup > Power")]),e._v(" in QGC.")])]),e._v(" "),r("li",[r("p",[e._v("Start the process of ESC auto-enumeration by pressing the "),r("strong",[e._v("Start Assignment")]),e._v(" button, as shown on the screenshot below.")]),e._v(" "),r("p",[r("img",{attrs:{src:o(444),alt:"QGC - DroneCAN ESC auto-enumeration"}})]),e._v(" "),r("p",[e._v("You will hear a sound indicating that the flight controller has entered the ESC enumeration mode.")])]),e._v(" "),r("li",[r("p",[e._v("Manually turn each motor in the correct direction of its rotation (as specified in the "),r("RouterLink",{attrs:{to:"/en/airframes/airframe_reference.html"}},[e._v("Airframe Reference")]),e._v("), starting from the first motor and finishing with the last motor.\nEach time you turn a motor, you should hear a confirmation beep.")],1),e._v(" "),r("div",{staticClass:"custom-block note"},[r("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),r("p",[e._v("Make sure to turn each of the motors in the correct direction, as the ESC will automatically learn and remember the direction (i.e. motors that spin clockwise during normal operation must also be turned clockwise during enumeration).")])])]),e._v(" "),r("li",[r("p",[e._v("After the last motor is enumerated, the confirmation sound should change to indicate that the enumeration procedure is complete.")])]),e._v(" "),r("li",[r("p",[e._v("Reboot PX4 and the Sapog ESCs to apply the new enumeration IDs.")])])]),e._v(" "),r("p",[e._v("The following video demonstrates the process:")]),e._v(" "),r("p"),r("div",{staticClass:"embed-responsive embed-responsive-16by9"},[r("iframe",{staticClass:"embed-responsive-item youtube-player",attrs:{type:"text/html",width:"640",height:"390",src:"https://www.youtube.com/embed/4nSa8tvpbgQ",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),r("p"),e._v(" "),r("h3",{attrs:{id:"manual-esc-enumeration-using-sapog"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#manual-esc-enumeration-using-sapog"}},[e._v("#")]),e._v(" Manual ESC Enumeration using Sapog")]),e._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),r("p",[e._v("We recommend automated "),r("a",{attrs:{href:"#sapog-esc-enumeration-using-qgroundcontrol"}},[e._v("Sapog ESC Enumeration using QGroundControl")]),e._v(" shown above rather than manual enumeration (as it is easier and safer).")])]),e._v(" "),r("p",[e._v("You can manually configure the ESC index and direction using the "),r("a",{attrs:{href:"https://dronecan.github.io/GUI_Tool/Overview/",target:"_blank",rel:"noopener noreferrer"}},[e._v("DroneCAN GUI Tool"),r("OutboundLink")],1),e._v(".\nThis assigns the following Sapog configuration parameters for each enumerated ESC:")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("esc_index")])]),e._v(" "),r("li",[r("code",[e._v("ctl_dir")])])]),e._v(" "),r("div",{staticClass:"custom-block note"},[r("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),r("p",[e._v("See "),r("a",{attrs:{href:"https://files.zubax.com/products/io.px4.sapog/Sapog_v2_Reference_Manual.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sapog reference manual"),r("OutboundLink")],1),e._v(" for more information about the parameters.")])]),e._v(" "),r("h2",{attrs:{id:"troubleshooting"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting"}},[e._v("#")]),e._v(" Troubleshooting")]),e._v(" "),r("p",[e._v("See "),r("RouterLink",{attrs:{to:"/en/dronecan/#troubleshooting"}},[e._v("DroneCAN Troubleshooting")])],1),e._v(" "),r("h2",{attrs:{id:"further-information"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#further-information"}},[e._v("#")]),e._v(" Further Information")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/PX4/sapog#px4-sapog",target:"_blank",rel:"noopener noreferrer"}},[e._v("PX4/Sapog"),r("OutboundLink")],1),e._v(" (Github)")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://files.zubax.com/products/io.px4.sapog/Sapog_v2_Reference_Manual.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sapog v2 Reference Manual"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://kb.zubax.com/display/MAINKB/Using+Sapog-based+ESC+with+PX4",target:"_blank",rel:"noopener noreferrer"}},[e._v("Using Sapog based ESC with PX4"),r("OutboundLink")],1),e._v(" (Zubax KB)")])])])}),[],!1,null,null,null);t.default=a.exports},442:function(e,t,o){e.exports=o.p+"assets/img/orel20_top.d7a047d6.jpg"},443:function(e,t,o){e.exports=o.p+"assets/img/kotleta20_top.2488a779.jpg"},444:function(e,t,o){e.exports=o.p+"assets/img/qgc_uavcan_settings.d01d136d.jpg"}}]);