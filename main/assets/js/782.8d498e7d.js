(window.webpackJsonp=window.webpackJsonp||[]).push([[782],{2757:function(t,e,s){"use strict";s.r(e);var a=s(19),o=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"xrce-dds-px4-fastdds-bridge"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xrce-dds-px4-fastdds-bridge"}},[t._v("#")]),t._v(" XRCE-DDS (PX4-FastDDS Bridge)")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("XRCE-DDS replaces the "),a("a",{attrs:{href:"https://docs.px4.io/v1.13/en/middleware/micrortps.html#rtps-dds-interface-px4-fast-rtps-dds-bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("Fast-RTPS Bridge"),a("OutboundLink")],1),t._v(" used in PX4 v1.13.")])]),t._v(" "),a("p",[t._v("PX4 uses XRCE-DDS middleware to allow "),a("RouterLink",{attrs:{to:"/ko/middleware/uorb.html"}},[t._v("uORB messages")]),t._v(" to be published and subscribed on a companion computer as though they were "),a("RouterLink",{attrs:{to:"/ko/ros/ros2_comm.html"}},[t._v("ROS 2")]),t._v(" topics. This provides a fast and reliable integration between PX4 and ROS 2, and makes it much easier for ROS 2 applications to get vehicle information and send commands.")],1),t._v(" "),a("p",[t._v("PX4 uses an XRCE-DDS implementation that leverages "),a("a",{attrs:{href:"https://micro-xrce-dds.docs.eprosima.com/en/stable/introduction.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("eProsima Micro XRCE-DDS"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("The following guide describes the architecture and various options for setting up the client and agent. In particular it covers the options that are most important to PX4 users.")]),t._v(" "),a("h2",{attrs:{id:"architecture"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#architecture"}},[t._v("#")]),t._v(" Architecture")]),t._v(" "),a("p",[t._v("The XRCE-DDS middleware consists of a client running on PX4 and an agent running on the companion computer, with bi-directional data exchange between them over a serial or UDP link. The agent acts as a proxy for the client, enabling it to publish and subscribe to topics in the global DDS data space.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(414),alt:"Architecture XRCE-DDS with ROS 2"}})]),t._v(" "),a("p",[t._v("In order for PX4 uORB topics to be shared on the DDS network you will need "),a("em",[t._v("XRCE-DDS client")]),t._v(" running on PX4, connected to the "),a("em",[t._v("XRCE-DDS agent")]),t._v(" running on the companion.")]),t._v(" "),a("p",[t._v("The PX4 "),a("RouterLink",{attrs:{to:"/ko/modules/modules_system.html#microdds-client"}},[t._v("microdds-client")]),t._v(" publishes to/from a defined set of uORB topics to the global DDS data space.")],1),t._v(" "),a("p",[t._v("The "),a("a",{attrs:{href:"https://github.com/eProsima/Micro-XRCE-DDS-Agent",target:"_blank",rel:"noopener noreferrer"}},[t._v("eProsima XRCE-DDS "),a("em",[t._v("agent")]),a("OutboundLink")],1),t._v(" runs on the companion computer and acts as a proxy for the client in the DDS/ROS 2 network.")]),t._v(" "),a("p",[t._v("The agent itself has no dependency on client-side code and can be built and/or installed independent of PX4 or ROS.")]),t._v(" "),a("p",[t._v("Code that wants to subscribe/publish to PX4 does have a dependency on client-side code; it requires uORB message definitions that match those used to create the PX4 XRCE-DDS client so that it can interpret the messages.")]),t._v(" "),a("h2",{attrs:{id:"code-generation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#code-generation"}},[t._v("#")]),t._v(" Code Generation")]),t._v(" "),a("p",[t._v("The PX4 "),a("RouterLink",{attrs:{to:"/ko/modules/modules_system.html#microdds-client"}},[t._v("microdds-client")]),t._v(" is generated at build time and included in PX4 firmare by default. The agent has no dependency on client code. It can be built standalone or in a ROS 2 workspace, or installed as a snap package on Ubuntu.")],1),t._v(" "),a("p",[t._v("When PX4 is built, a code generator uses the uORB message definitions in the source tree ("),a("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/tree/main/msg",target:"_blank",rel:"noopener noreferrer"}},[t._v("PX4-Autopilot/msg"),a("OutboundLink")],1),t._v(") to compile support for the subset of uORB topics in "),a("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/src/modules/microdds_client/dds_topics.yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("PX4-Autopilot/src/modules/microdds_client/dds_topics.yaml"),a("OutboundLink")],1),t._v(" into "),a("RouterLink",{attrs:{to:"/ko/modules/modules_system.html#microdds-client"}},[t._v("microdds-client")]),t._v(".")],1),t._v(" "),a("p",[t._v("PX4 main or release builds automatically export the set of uORB messages definitions in the build to an associated branch in "),a("a",{attrs:{href:"https://github.com/PX4/px4_msgs",target:"_blank",rel:"noopener noreferrer"}},[t._v("PX4/px4_msgs"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("ROS 2 applications need to be built in a workspace that includes the "),a("em",[t._v("same")]),t._v(" message definitions that were used to create the XRCE-DDS client module in the PX4 Firmware. These can be included into a workspace by cloning the "),a("a",{attrs:{href:"https://github.com/PX4/px4_msgs",target:"_blank",rel:"noopener noreferrer"}},[t._v("PX4/px4_msgs"),a("OutboundLink")],1),t._v(" into your ROS 2 workspace and switching to the appropriate branch. Note that all code generation associated with the messages is handled by ROS 2.")]),t._v(" "),a("h2",{attrs:{id:"xrce-dds-agent-installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xrce-dds-agent-installation"}},[t._v("#")]),t._v(" XRCE-DDS Agent Installation")]),t._v(" "),a("p",[t._v("The XRCE-DDS Agent can be installed on the companion computer using a binary package, built and installed from source, or built and run from within a ROS 2 workspace. All of these methods fetch "),a("em",[t._v("all")]),t._v(" the dependencies needed to communicate with the client (such as FastCDR)")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("The official (and more complete) installation guide is the Eprosima: "),a("a",{attrs:{href:"https://micro-xrce-dds.docs.eprosima.com/en/latest/installation.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("micro XRCE-DDS Installation Guide"),a("OutboundLink")],1),t._v(" This section summarises the options that have been tested with PX4 during creation of these docs.")])]),t._v(" "),a("h3",{attrs:{id:"install-standalone-from-source"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-standalone-from-source"}},[t._v("#")]),t._v(" Install Standalone from Source")]),t._v(" "),a("p",[t._v("On Ubuntu you can build from source and install the Agent standalone using the following commands:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/eProsima/Micro-XRCE-DDS-Agent.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" Micro-XRCE-DDS-Agent\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" build\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" build\ncmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ldconfig /usr/local/lib/\n")])])]),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("There are various build configuration options linked from the corresponding topic in the "),a("a",{attrs:{href:"https://micro-xrce-dds.docs.eprosima.com/en/latest/installation.html#installing-the-agent-standalone",target:"_blank",rel:"noopener noreferrer"}},[t._v("official guide"),a("OutboundLink")],1),t._v(", but these have not been tested.")])]),t._v(" "),a("p",[t._v("To start the agent with settings for connecting to the XRCE-DDS client running on the simulator:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("MicroXRCEAgent udp4 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("\n")])])]),a("h3",{attrs:{id:"install-from-snap-package"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-from-snap-package"}},[t._v("#")]),t._v(" Install from Snap Package")]),t._v(" "),a("p",[t._v("Install from a snap package on Ubuntu using the following command:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" snap "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" micro-xrce-dds-agent --edge\n")])])]),a("p",[t._v("To start the agent with settings for connecting to the XRCE-DDS client running on the simulator (note that the command name is different than if you build the agent locally):")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("micro-xrce-dds-agent udp4 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("\n")])])]),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("At time of writing the stable of version installed from snap connects to PX4 but reports errors creating topics. The development version, fetched using "),a("code",[t._v("--edge")]),t._v(" above, does work.")])]),t._v(" "),a("h3",{attrs:{id:"build-run-within-ros-2-workspace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build-run-within-ros-2-workspace"}},[t._v("#")]),t._v(" Build/Run within ROS 2 Workspace")]),t._v(" "),a("p",[t._v("The agent can be built and launched within a ROS 2 workspace (or build standalone and launched from a workspace. You must already have installed ROS 2 following the instructions in: "),a("RouterLink",{attrs:{to:"/ko/ros/ros2_comm.html#install-ros-2"}},[t._v("ROS 2 User Guide > Install ROS 2")]),t._v(".")],1),t._v(" "),a("p",[t._v("To build the agent within ROS:")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Create a workspace directory for the agent:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/ws_xrce_dds_agent/src\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Clone the source code for the eProsima "),a("a",{attrs:{href:"https://github.com/eProsima/Micro-XRCE-DDS-Agent",target:"_blank",rel:"noopener noreferrer"}},[t._v("Micro-XRCE-DDS-Agent"),a("OutboundLink")],1),t._v(" to the "),a("code",[t._v("/src")]),t._v(" directory (the "),a("code",[t._v("main")]),t._v(" branch is cloned by default):")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_xrce_dds_ws/src\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/eProsima/Micro-XRCE-DDS-Agent.git\n")])])])]),t._v(" "),a("li",[a("p",[t._v('Source the ROS 2 development environment, in this case "ROS 2 Foxy", and compile the workspace using '),a("code",[t._v("colcon")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/foxy/setup.bash\ncolcon build\n")])])]),a("p",[t._v("This builds all the folders under "),a("code",[t._v("/src")]),t._v(" using the sourced toolchain.")])])]),t._v(" "),a("p",[t._v("To run the XRCE-DDS agent in the workspace:")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Source the "),a("code",[t._v("local_setup.bash")]),t._v(" to make the executables available in the terminal (also "),a("code",[t._v("setup.bash")]),t._v(" if using a new terminal).")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/foxy/setup.bash\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" install/local_setup.bash\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Start the agent with settings for connecting to the XRCE-DDS client running on the simulator:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("MicroXRCEAgent udp4 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"starting-xrce-dds"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#starting-xrce-dds"}},[t._v("#")]),t._v(" Starting XRCE-DDS")]),t._v(" "),a("h3",{attrs:{id:"starting-the-agent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#starting-the-agent"}},[t._v("#")]),t._v(" Starting the Agent")]),t._v(" "),a("p",[t._v("The agent is used to connect to the client over a particular channel, such as UDP or a serial connection. The channel settings are specified when the agent is started, using command line options. These are documented in the eProsima user guide: "),a("a",{attrs:{href:"https://micro-xrce-dds.docs.eprosima.com/en/latest/agent.html#agent-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("Micro XRCE-DDS Agent > Agent CLI"),a("OutboundLink")],1),t._v(". Note that the agent supports many channel options, but PX4 only supports UDP and serial connections.")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("You should create a single instance of the agent for each channel over which you need to connect.")])]),t._v(" "),a("p",[t._v("For example, the PX4 simulator runs the XRCE-DDS client over UDP on port 8888, so to connect to the simulator you would start the agent with the command:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("MicroXRCEAgent udp4 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("\n")])])]),a("p",[t._v("When working with real hardware, the setup depends on the hardware, OS, and channel. For example, if you're using the RasPi "),a("code",[t._v("UART0")]),t._v(" serial port, you might connect using this command (based on the information in "),a("a",{attrs:{href:"https://www.raspberrypi.com/documentation/computers/configuration.html#configuring-uarts",target:"_blank",rel:"noopener noreferrer"}},[t._v("Raspberry Pi Documentation > Configuring UARTS"),a("OutboundLink")],1),t._v("):")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" MicroXRCEAgent serial --dev /dev/AMA0 -b "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("921600")]),t._v("\n")])])]),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("For more information about setting up communications channels see "),a("RouterLink",{attrs:{to:"/ko/companion_computer/pixhawk_companion.html#serial-port-setup"}},[t._v("Pixhawk + Companion Setup > Serial Port setup")]),t._v(", and sub-documents.")],1)]),t._v(" "),a("h3",{attrs:{id:"starting-the-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#starting-the-client"}},[t._v("#")]),t._v(" Starting the Client")]),t._v(" "),a("p",[t._v("The XRCE-DDS client module ("),a("RouterLink",{attrs:{to:"/ko/modules/modules_system.html#microdds-client"}},[t._v("microdds-client")]),t._v(") is included by default in all firmware and the simulator. This must be started with appropriate settings for the communication channel that you wish to use to communicate with the agent.")],1),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("The simulator automatically starts the client on localhost UDP port "),a("code",[t._v("8888")]),t._v(" using the default microdds namespace.")])]),t._v(" "),a("p",[t._v("The configuration can be done using the "),a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#micro-xrce-dds"}},[t._v("Micro XRCE-DDS parameters")]),t._v(":")],1),t._v(" "),a("ul",[a("li",[a("p",[a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#XRCE_DDS_CFG"}},[t._v("XRCE_DDS_CFG")]),t._v(": Set the port to connect on, such as "),a("code",[t._v("TELEM2")]),t._v(", "),a("code",[t._v("Ethernet")]),t._v(", or "),a("code",[t._v("Wifi")]),t._v(".")],1)]),t._v(" "),a("li",[a("p",[t._v("If using an Ethernet connection:")]),t._v(" "),a("ul",[a("li",[a("p",[a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#XRCE_DDS_PRT"}},[t._v("XRCE_DDS_PRT")]),t._v(": Use this to specify the agent UDP listening port. The default value is "),a("code",[t._v("8888")]),t._v(".")],1)]),t._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#XRCE_DDS_AG_IP"}},[t._v("XRCE_DDS_AG_IP")]),t._v(": Use this to specify the IP address of the agent. The IP address must be provided in "),a("code",[t._v("int32")]),t._v(" format as PX4 does not support string parameters. The default value is "),a("code",[t._v("2130706433")]),t._v(" which corresponds to the "),a("em",[t._v("localhost")]),t._v(" "),a("code",[t._v("127.0.0.1")]),t._v(".")],1),t._v(" "),a("p",[t._v("You can use "),a("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/pr-micro-XRCE-DDS-allow-IP-parameter/Tools/convert_ip.py",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tools/convert_ip.py"),a("OutboundLink")],1),t._v(" to convert between the formats:")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("To obtain the "),a("code",[t._v("int32")]),t._v(" version of an IP in decimal dot notation the command is:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("python3 ./PX4-Autopilot/Tools/convert_ip.py "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("the IP address "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" decimal dot notation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("To get the IP address in decimal dot notation from the "),a("code",[t._v("int32")]),t._v(" version:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("python3 ./PX4-Autopilot/Tools/convert_ip.py -r "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("the IP address "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" int32 notation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])])])])])]),t._v(" "),a("li",[a("p",[t._v("If using a serial connection:")]),t._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#SER_TEL2_BAUD"}},[t._v("SER_TEL2_BAUD")]),t._v(", "),a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#SER_URT6_BAUD"}},[t._v("SER_URT6_BAUD")]),t._v(" (and so on): Use the "),a("code",[t._v("_BAUD")]),t._v(" parameter associated with the serial port to set the baud rate. For example, you'd set a value for "),a("code",[t._v("SER_TEL2_BAUD")]),t._v(" if you are connecting to the companion using "),a("code",[t._v("TELEM2")]),t._v(". For more information see "),a("RouterLink",{attrs:{to:"/ko/peripherals/serial_configuration.html#serial-port-configuration"}},[t._v("Serial port configuration")]),t._v(".")],1)])]),t._v(" "),a("li",[a("p",[t._v("Some setups might also need these parameters to be set:")]),t._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#XRCE_DDS_KEY"}},[t._v("XRCE_DDS_KEY")]),t._v(": The XRCE-DDS key. If you're working in a multi-client, single agent configuration, each client should have a unique non-zero key. This is primarily important for multi-vehicle simulations, where all clients are connected in UDP to the same agent. (See the "),a("a",{attrs:{href:"https://micro-xrce-dds.docs.eprosima.com/en/stable/client_api.html#session",target:"_blank",rel:"noopener noreferrer"}},[t._v("official eprosima documentation"),a("OutboundLink")],1),t._v(" , "),a("code",[t._v("uxr_init_session")]),t._v(".)")],1),t._v(" "),a("li",[a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#XRCE_DDS_DOM_ID"}},[t._v("XRCE_DDS_DOM_ID")]),t._v(": The DDS domain ID. This provides a logical separation between DDS networks, and can be used to separate clients on different networks. By default, ROS 2 operates on ID 0.")],1)])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("Many ports are already have a default configuration. To use these ports you must first disable the existing configuration:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("TELEM1")]),t._v(" and "),a("code",[t._v("TELEM2")]),t._v(" are set up by default to connect via MAVLink to a GCS and a companion computer (respectively). Disable by setting "),a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#MAV_0_CONFIG"}},[t._v("MAV_0_CONFIG=0")]),t._v(" or "),a("RouterLink",{attrs:{to:"/ko/advanced_config/parameter_reference.html#MAV_1_CONFIG"}},[t._v("MAV_1_CONFIG=0")]),t._v(" to zero. See "),a("RouterLink",{attrs:{to:"/ko/peripherals/mavlink_peripherals.html"}},[t._v("MAVLink Peripherals")]),t._v(" for more information.")],1),t._v(" "),a("li",[t._v("Other ports can similarly be configured. See "),a("RouterLink",{attrs:{to:"/ko/peripherals/serial_configuration.html#serial-port-configuration"}},[t._v("Serial port configuration")]),t._v(".")],1)])]),t._v(" "),a("p",[t._v("Once set, you may need to reboot PX4 for the parameters to take effect. They will then persist through subsequent reboots.")]),t._v(" "),a("p",[t._v("You can also start the "),a("RouterLink",{attrs:{to:"/ko/modules/modules_system.html#microdds-client"}},[t._v("microdds-client")]),t._v(" using a command line. This can be called as part of "),a("RouterLink",{attrs:{to:"/ko/concept/system_startup.html"}},[t._v("System Startup")]),t._v(" or through the "),a("RouterLink",{attrs:{to:"/ko/debug/mavlink_shell.html"}},[t._v("MAVLink Shell")]),t._v(" (or a system console). This method is useful when you need to set a custom client namespace, as no parameter is provided for this purpose. For example, the following command can be used to connect via Ethernet to a remote host at "),a("code",[t._v("192.168.0.100:8888")]),t._v(" and to set the client namespace to "),a("code",[t._v("/drone/")]),t._v(".")],1),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("microdds_client start -t udp -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(" -h "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.100 -n drone\n")])])]),a("p",[t._v("Options "),a("code",[t._v("-p")]),t._v(" or "),a("code",[t._v("-h")]),t._v(" are used to bypass "),a("code",[t._v("XRCE_DDS_PRT")]),t._v(" and "),a("code",[t._v("XRCE_DDS_AG_IP")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"supported-uorb-messages"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#supported-uorb-messages"}},[t._v("#")]),t._v(" Supported uORB Messages")]),t._v(" "),a("p",[t._v("The set of "),a("RouterLink",{attrs:{to:"/ko/msg_docs/"}},[t._v("PX4 uORB topics")]),t._v(" that are exposed through the client are set in "),a("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/src/modules/microdds_client/dds_topics.yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("dds_topics.yaml"),a("OutboundLink")],1),t._v(".")],1),t._v(" "),a("p",[t._v("The topics are release specific (support is compiled into "),a("RouterLink",{attrs:{to:"/ko/modules/modules_system.html#microdds-client"}},[t._v("microdds-client")]),t._v(" at build time). While most releases should support a very similar set of messages, to be certain you would need to check the yaml file for your particular release.\n")],1),t._v(" "),a("p",[t._v("Note that ROS 2/DDS needs to have the "),a("em",[t._v("same")]),t._v(" message definitions that were used to create the XRCE-DDS client module in the PX4 Firmware in order to interpret the messages:")]),t._v(" "),a("ul",[a("li",[t._v("If you're using a main or release version of PX4 you can get these by cloning "),a("a",{attrs:{href:"https://github.com/PX4/px4_msgs",target:"_blank",rel:"noopener noreferrer"}},[t._v("PX4/px4_msgs"),a("OutboundLink")],1),t._v(" into your workspace (branches are provided for each release).")]),t._v(" "),a("li",[t._v("If you're creating your own new topic you will need to update "),a("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/src/modules/microdds_client/dds_topics.yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("dds_topics.yaml"),a("OutboundLink")],1),t._v(" and also copy the message definitions out of PX4 source tree into any ROS 2 workspace that needs them. The messages must be in a folder named "),a("code",[t._v("px4_msgs/msg/")]),t._v(".")])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("Technically the messages must be in a folder defined by the "),a("code",[t._v("type")]),t._v(" prefix in the yaml file: As you can see below, this is "),a("code",[t._v("px4_msgs::msg::")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /fmu/out/vehicle_odometry\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" px4_msgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("VehicleOdometry\n")])])])]),t._v(" "),a("h3",{attrs:{id:"px4-ros-2-qos-settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#px4-ros-2-qos-settings"}},[t._v("#")]),t._v(" PX4 ROS 2 QoS Settings")]),t._v(" "),a("p",[t._v("PX4 QoS settings for publishers are incompatible with the default QoS settings for ROS 2 subscribers. So if ROS 2 code needs to subscribe to a uORB topic, it will need to use compatible QoS settings. One example of which is shown in "),a("RouterLink",{attrs:{to:"/ko/ros/ros2_comm.html#ros2-subscriber-qos-settings"}},[t._v("ROS 2 User Guide > ROS 2 Subscriber QoS Settings")]),t._v(".")],1),t._v(" "),a("p",[t._v("PX4 uses the following QoS settings for publishers:")]),t._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[t._v("uxrQoS_t qos "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("durability "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UXR_DURABILITY_TRANSIENT_LOCAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reliability "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UXR_RELIABILITY_BEST_EFFORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UXR_HISTORY_KEEP_LAST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("depth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("PX4 uses the following QoS settings for subscribers:")]),t._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[t._v("uxrQoS_t qos "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("durability "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UXR_DURABILITY_VOLATILE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reliability "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UXR_RELIABILITY_BEST_EFFORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UXR_HISTORY_KEEP_LAST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("depth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue_depth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v('ROS 2 uses the following QoS settings (by default) for publishers and subscriptions: "keep last" for history with a queue size of 10, "reliable" for reliability, "volatile" for durability, and "system default" for liveliness. Deadline, lifespan, and lease durations are also all set to "default".\n')]),t._v(" "),a("h2",{attrs:{id:"helpful-resources"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#helpful-resources"}},[t._v("#")]),t._v(" Helpful Resources")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=F5oelooT67E",target:"_blank",rel:"noopener noreferrer"}},[t._v("ROS 2 in PX4: Technical Details of a Seamless Transition to XRCE-DDS"),a("OutboundLink")],1),t._v(" - Pablo Garrido & Nuno Marques (youtube)")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://gist.github.com/julianoes/adbf76408663829cd9aed8d14c88fa29",target:"_blank",rel:"noopener noreferrer"}},[t._v("PX4 ROS 2 offboard tutorial"),a("OutboundLink")],1),t._v(" (Github gist - JulianOes)")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/Jaeyoung-Lim/px4-offboard/blob/2d784532fd323505ac8a6e53bb70145600d367c4/doc/ROS2_PX4_Offboard_Tutorial.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("ROS 2 PX4 Offboard Tutorial"),a("OutboundLink")],1),t._v(" (Jaeyoung-Lim).\x3c!---\nSome of this might be useful.\nI'd like to see a real example first.")])]),t._v(" "),a("h2",{attrs:{id:"setting-up-the-bridge-with-real-hardware"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-the-bridge-with-real-hardware"}},[t._v("#")]),t._v(" Setting up the bridge with real hardware")]),t._v(" "),a("p",[t._v("This section is work-in-progress.")]),t._v(" "),a("h2",{attrs:{id:"troubleshooting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting"}},[t._v("#")]),t._v(" Troubleshooting")]),t._v(" "),a("h3",{attrs:{id:"client-reports-that-selected-uart-port-is-busy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#client-reports-that-selected-uart-port-is-busy"}},[t._v("#")]),t._v(" Client reports that selected UART port is busy")]),t._v(" "),a("p",[t._v("If the selected UART port is busy, it's possible that the MAVLink application is already being used.\nIf both MAVLink and RTPS connections are required you will have to either move the connection to use another port or using the available protocol splitter for PX4 and companion computers.")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("A quick/temporary fix to allow bridge testing during development is to stop MAVLink from "),a("em",[t._v("NuttShell")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("mavlink stop-all\n")])])])]),t._v(" "),a("h3",{attrs:{id:"enable-uart-on-a-companion-computer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enable-uart-on-a-companion-computer"}},[t._v("#")]),t._v(" Enable UART on a companion computer")]),t._v(" "),a("p",[t._v("For UART transport on a Raspberry Pi or any other companion computer you will have to enable the serial port:")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Make sure the "),a("code",[t._v("userid")]),t._v(" (default is pi on a Raspberry Pi) is a member of the "),a("code",[t._v("dialout")]),t._v(" group:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("groups")]),t._v(" pi\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("usermod")]),t._v(" -a -G dialout pi\n")])])])]),t._v(" "),a("li",[a("p",[t._v("For the Raspberry Pi in particular, you need to stop the GPIO serial console that is using the port:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" raspi-config\n")])])]),a("p",[t._v("In the menu showed go to "),a("strong",[t._v("Interfacing options > Serial")]),t._v(".\nSelect "),a("strong",[t._v("NO")]),t._v(" for "),a("em",[t._v("Would you like a login shell to be accessible over serial?")]),t._v(". Valid and reboot.")])]),t._v(" "),a("li",[a("p",[t._v("Check UART in kernel:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /boot/config.txt\n")])])]),a("p",[t._v("And make sure that the "),a("code",[t._v("enable_uart")]),t._v(" value is set to 1:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" enable_uart=1\n")])])])])]),t._v(" "),a("p",[t._v("--\x3e")])])}),[],!1,null,null,null);e.default=o.exports},414:function(t,e,s){t.exports=s.p+"assets/img/architecture_xrce-dds_ros2.fed61809.svg"}}]);