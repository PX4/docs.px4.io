(window.webpackJsonp=window.webpackJsonp||[]).push([[705],{2354:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"mavros-offboard-control-example-python"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mavros-offboard-control-example-python"}},[t._v("#")]),t._v(" MAVROS "),n("em",[t._v("Offboard")]),t._v(" control example (Python)")]),t._v(" "),n("p",[t._v("This tutorial shows the basics of "),n("em",[t._v("OFFBOARD")]),t._v(" control with MAVROS Python, using an Iris quadcopter simulated in "),n("RouterLink",{attrs:{to:"/en/sim_gazebo_classic/"}},[t._v("Gazebo Classic")]),t._v(".\nIt provides step-by-step instructions demonstrating how to start developing programs to control a vehicle and running the code in simulation.")],1),t._v(" "),n("p",[t._v("At the end of the tutorial, you should see the same behaviour as in the video below, i.e. a slow takeoff to an altitude of 2 meters.")]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),n("p",[n("em",[t._v("OFFBOARD")]),t._v(" control is dangerous.\nIf you are operating on a real vehicle be sure to have a way of gaining back manual control in case something goes wrong.")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("This example uses Python.\nOther examples in Python can be found here: "),n("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/tree/main/integrationtests/python_src/px4_it/mavros",target:"_blank",rel:"noopener noreferrer"}},[t._v("integrationtests/python_src/px4_it/mavros"),n("OutboundLink")],1),t._v(".")])]),t._v(" "),n("p",[n("a",{attrs:{id:"offb_video"}}),t._v(" "),n("video",{attrs:{width:"100%",autoplay:"true",controls:"true"}},[n("source",{attrs:{src:a(420),type:"video/webm"}})])]),t._v(" "),n("h2",{attrs:{id:"creating-the-ros-package"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#creating-the-ros-package"}},[t._v("#")]),t._v(" Creating the ROS Package")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("Open the terminal and go to "),n("code",[t._v("~/catkin_ws/src")]),t._v(" directory")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("roscd  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Should cd into ~/catkin_ws/devel")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" src\n")])])])]),t._v(" "),n("li",[n("p",[t._v("In the "),n("code",[t._v("~/catkin_ws/src")]),t._v(" directory create a new package named "),n("code",[t._v("offboard_py")]),t._v(" (in this case) with the "),n("code",[t._v("rospy")]),t._v(" dependency:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("catkin_create_pkg offboard_py rospy\n")])])])]),t._v(" "),n("li",[n("p",[t._v("Build the new package in the "),n("code",[t._v("~/catkin_ws/")]),t._v(" directory:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Assuming previous directory to be ~/catkin_ws/src")]),t._v("\ncatkin build\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" devel/setup.bash\n")])])])]),t._v(" "),n("li",[n("p",[t._v("You should now be able to cd into the package by using:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("roscd offboard_py\n")])])])]),t._v(" "),n("li",[n("p",[t._v("To store your Python files, create a new folder called "),n("code",[t._v("/scripts")]),t._v(" on the package:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" scripts\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" scripts\n")])])])])]),t._v(" "),n("h2",{attrs:{id:"code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#code"}},[t._v("#")]),t._v(" Code")]),t._v(" "),n("p",[t._v("After creating the ROS package and scripts folder you are ready to start your Python script.\nInside the scripts folder create the "),n("code",[t._v("offb_node.py")]),t._v(" file and give it executable permissions:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" offb_node.py\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x offb_node.py\n")])])]),n("p",[t._v("After that, open "),n("code",[t._v("offb_node.py")]),t._v(" file and paste the following code:")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n * File: offb_node.py\n * Stack and tested in Gazebo Classic 9 SITL\n"""')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#! /usr/bin/env python")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" rospy\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" geometry_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" PoseStamped\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mavros_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" State\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mavros_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("srv "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CommandBool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CommandBoolRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetModeRequest\n\ncurrent_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" State"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("state_cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" current_state\n    current_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("init_node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"offb_node_py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    state_sub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Subscriber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/state"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" State"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state_cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    local_pos_pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/setpoint_position/local"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PoseStamped"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" queue_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mavros/cmd/arming"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    arming_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceProxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/cmd/arming"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CommandBool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mavros/set_mode"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    set_mode_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceProxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/set_mode"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Setpoint publishing MUST be faster than 2Hz")]),t._v("\n    rate "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Wait for Flight Controller connection")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connected"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    pose "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" PoseStamped"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Send a few setpoints before starting")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\n        local_pos_pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    offb_set_mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SetModeRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    offb_set_mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("custom_mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OFFBOARD'")]),t._v("\n\n    arm_cmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CommandBoolRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    arm_cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n    last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OFFBOARD"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" last_req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("set_mode_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offb_set_mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode_sent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loginfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OFFBOARD enabled"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n            last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("armed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" last_req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arming_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arm_cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loginfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Vehicle armed"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n                last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        local_pos_pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"code-explanation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#code-explanation"}},[t._v("#")]),t._v(" Code explanation")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("mavros_msgs")]),t._v(" package contains all of the custom messages required to operate services and topics provided by the MAVROS package.\nAll services and topics as well as their corresponding message types are documented in the "),n("a",{attrs:{href:"http://wiki.ros.org/mavros",target:"_blank",rel:"noopener noreferrer"}},[t._v("mavros wiki"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" rospy\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" geometry_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" PoseStamped\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mavros_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" State\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mavros_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("srv "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CommandBool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CommandBoolRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetModeRequest\n")])])]),n("p",[t._v("We create a simple callback which will save the current state of the autopilot.\nThis will allow us to check connection, arming and "),n("em",[t._v("OFFBOARD")]),t._v(" flags.:")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("current_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" State"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("state_cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" current_state\n    current_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg\n")])])]),n("p",[t._v('We instantiate a publisher to publish the commanded local position and the appropriate clients to request arming and mode change.\nNote that for your own system, the "mavros" prefix might be different as it will depend on the name given to the node in it\'s launch file.')]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("state_sub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Subscriber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/state"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" State"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state_cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nlocal_pos_pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/setpoint_position/local"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PoseStamped"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" queue_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mavros/cmd/arming"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\narming_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceProxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/cmd/arming"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CommandBool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mavros/set_mode"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nset_mode_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceProxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/set_mode"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("PX4 has a timeout of 500ms between two "),n("em",[t._v("OFFBOARD")]),t._v(" commands.\nIf this timeout is exceeded, the commander will fall back to the last mode the vehicle was in before entering "),n("em",[t._v("OFFBOARD")]),t._v(" mode.\nThis is why the publishing rate "),n("strong",[t._v("must")]),t._v(" be faster than 2 Hz to also account for possible latencies.\nThis is also the same reason why it is "),n("strong",[t._v("recommended to enter "),n("em",[t._v("OFFBOARD")]),t._v(" mode from "),n("em",[t._v("Position")]),t._v(" mode")]),t._v(", this way if the vehicle drops out of "),n("em",[t._v("OFFBOARD")]),t._v(" mode it will stop in its tracks and hover.")]),t._v(" "),n("p",[t._v("Here we set the publishing rate appropriately:")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Setpoint publishing MUST be faster than 2Hz")]),t._v("\nrate "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("Before publishing anything, we wait for the connection to be established between MAVROS and the autopilot.\nThis loop should exit as soon as a heartbeat message is received.")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Wait for Flight Controller connection")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connected"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("Even though PX4 operates in the aerospace NED coordinate frame, MAVROS translates these coordinates to the standard ENU frame and vice-versa.\nThis is why we set "),n("code",[t._v("z")]),t._v(" to positive 2:")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("pose "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" PoseStamped"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\npose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\npose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\npose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])])]),n("p",[t._v("Before entering "),n("em",[t._v("OFFBOARD")]),t._v(" mode, you must have already started streaming setpoints.\nOtherwise the mode switch will be rejected.\nBelow, "),n("code",[t._v("100")]),t._v(" was chosen as an arbitrary amount.")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Send a few setpoints before starting")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\n    local_pos_pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("We prepare the message request used to set the custom mode to "),n("code",[t._v("OFFBOARD")]),t._v(".\nA list of "),n("a",{attrs:{href:"http://wiki.ros.org/mavros/CustomModes#PX4_native_flight_stack",target:"_blank",rel:"noopener noreferrer"}},[t._v("supported modes"),n("OutboundLink")],1),t._v(" is available for reference.")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("offb_set_mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SetModeRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\noffb_set_mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("custom_mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OFFBOARD'")]),t._v("\n")])])]),n("p",[t._v("The rest of the code is largely self explanatory.\nWe attempt to switch to "),n("em",[t._v("Offboard")]),t._v(" mode, after which we arm the quad to allow it to fly.\nWe space out the service calls by 5 seconds so to not flood the autopilot with the requests.\nIn the same loop, we continue sending the requested pose at the rate previously defined.")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("arm_cmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CommandBoolRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\narm_cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\nlast_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OFFBOARD"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" last_req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("set_mode_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offb_set_mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode_sent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loginfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OFFBOARD enabled"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("armed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" last_req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arming_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arm_cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loginfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Vehicle armed"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n            last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    local_pos_pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("This code has been simplified to the bare minimum for illustration purposes.\nIn larger systems, it is often useful to create a new thread which will be in charge of periodically publishing the setpoints.")])]),t._v(" "),n("h2",{attrs:{id:"creating-the-ros-launch-file"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#creating-the-ros-launch-file"}},[t._v("#")]),t._v(" Creating the ROS launch file")]),t._v(" "),n("p",[t._v("In your "),n("code",[t._v("offboard_py")]),t._v(" package, create another folder inside the "),n("code",[t._v("~/catkin_ws/src/offboard_py/src")]),t._v(" directory named "),n("code",[t._v("launch")]),t._v(".\nThis is where your launch files for the package will be stored.\nAfter that, create your first launch file, in this case we will call it "),n("code",[t._v("start_offb.launch")]),t._v(".")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("roscd offboard_py\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" launch\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" launch\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" start_offb.launch\n")])])]),n("p",[t._v("For the "),n("code",[t._v("start_offb.launch")]),t._v(" copy the following code:")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0"?>')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("launch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Include the MAVROS node with SITL and Gazebo --\x3e")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("$(find px4)/launch/mavros_posix_sitl.launch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("include")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Our node to control the drone --\x3e")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("node")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("pkg")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("offboard_py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("offb_node.py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("offb_node_py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("required")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("output")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("screen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("launch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("As you can see, the "),n("code",[t._v("mavros_posix_sitl.launch")]),t._v(" file is included.\nThis file is responsible for launching MAVROS, the PX4 SITL, the Gazebo Classic Environment and for spawning a vehicle in a given world (for further information see the file "),n("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/launch/mavros_posix_sitl.launch",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),n("OutboundLink")],1),t._v(").")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("mavros_posix_sitl.launch")]),t._v(" file takes several arguments that can be set according to your preferences such as the vehicle to spawn or the Gazebo Classic world (refer to "),n("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/launch/mavros_posix_sitl.launch",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),n("OutboundLink")],1),t._v(") for a complete list).")]),t._v(" "),n("p",[t._v("You can override the default value of these arguments defined in "),n("code",[t._v("mavros_posix_sitl.launch")]),t._v(" by declaring them inside the "),n("em",[t._v("include")]),t._v(" tags.\nAs an example, if you wanted to spawn the vehicle in the "),n("code",[t._v("warehouse.world")]),t._v(", you would write the following:")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Include the MAVROS node with SITL and Gazebo --\x3e")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("$(find px4)/launch/mavros_posix_sitl.launch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("arg")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("world"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("$(find mavlink_sitl_gazebo)/worlds/warehouse.world"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("include")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),n("h2",{attrs:{id:"launching-your-script"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#launching-your-script"}},[t._v("#")]),t._v(" Launching your script")]),t._v(" "),n("p",[t._v("If everything is done, you should now be able to launch and test your script.")]),t._v(" "),n("p",[t._v("In the terminal write:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("roslaunch offboard_py start_offb.launch\n")])])]),n("p",[t._v("You should now see the PX4 firmware initiating and the Gazebo Classic application running.\nAfter the "),n("em",[t._v("OFFBOARD")]),t._v(" mode is set and the vehicle is armed, the behavior shown in the "),n("a",{attrs:{href:"#offb_video"}},[t._v("video")]),t._v(" should be observed.")]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),n("p",[t._v("It is possible that when running the script an error appears saying:")]),t._v(" "),n("blockquote",[n("p",[t._v("Resource not found: px4\nROS path [0] = ...\n...")])]),t._v(" "),n("p",[t._v("This means that PX4 SITL was not included in the path.\nTo solve this add these lines at the end of the "),n("code",[t._v(".bashrc")]),t._v(" file:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/PX4-Autopilot/Tools/simulation/gazebo/setup_gazebo.bash ~/PX4-Autopilot ~/PX4-Autopilot/build/px4_sitl_default\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ROS_PACKAGE_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ROS_PACKAGE_PATH")]),t._v(":~/PX4-Autopilot\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ROS_PACKAGE_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ROS_PACKAGE_PATH")]),t._v(":~/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("GAZEBO_PLUGIN_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$GAZEBO_PLUGIN_PATH")]),t._v(":/usr/lib/x86_64-linux-gnu/gazebo-9/plugins\n")])])]),n("p",[t._v("Now in the terminal, go to the home directory and run the following command to apply the changes above to the current terminal:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" .bashrc\n")])])]),n("p",[t._v("After this step, every time you open a new terminal window you should not have to worry about this error anymore.\nIf it appears again, a simple "),n("code",[t._v("source .bashrc")]),t._v(" should fix it.\nThis solution was obtained from this "),n("a",{attrs:{href:"https://github.com/mzahana/px4_fast_planner/issues/4",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue"),n("OutboundLink")],1),t._v(" thread, where you can get more information about the problem.")])])])}),[],!1,null,null,null);s.default=e.exports},420:function(t,s,a){t.exports=a.p+"assets/media/gazebo_offboard.d8b1cf73.webm"}}]);