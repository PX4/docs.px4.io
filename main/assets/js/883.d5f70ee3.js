(window.webpackJsonp=window.webpackJsonp||[]).push([[883],{3745:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"mavros-offboard-控制示例-python"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mavros-offboard-控制示例-python"}},[t._v("#")]),t._v(" MAVROS "),n("em",[t._v("Offboard")]),t._v(" 控制示例 (Python)")]),t._v(" "),n("p",[t._v("本教程使用 "),n("RouterLink",{attrs:{to:"/zh/sim_gazebo_classic/"}},[t._v("Gazebo Classic")]),t._v(" 模拟的Iris四旋翼无人机，用MAVROS Python来展示 "),n("em",[t._v("OFFBOARD")]),t._v(" 控制的基础知识。 该教程提供分步指示，说明如何开始开发控制无人机以及在仿真环境中运行代码。")],1),t._v(" "),n("p",[t._v("在教程结束时, 你应该看到与下面的视频相同的行为, 即缓慢起飞到2米的高度。")]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),n("p",[n("em",[t._v("OFFBOARD")]),t._v(" 控制模式是危险的。 如果你是在一个真正的无人机平台上进行试验，请保证你已经设置了切换回手动的开关来防止紧急情况的发生。")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("该例程使用Python。 其他Python示例可以在这里找到： "),n("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/tree/main/integrationtests/python_src/px4_it/mavros",target:"_blank",rel:"noopener noreferrer"}},[t._v("integrationtests/python_src/px4_it/mavros"),n("OutboundLink")],1),t._v("。")])]),t._v(" "),n("p",[n("a",{attrs:{id:"offb_video"}}),t._v(" "),n("video",{attrs:{width:"100%",autoplay:"true",controls:"true"}},[n("source",{attrs:{src:a(420),type:"video/webm"}})])]),t._v(" "),n("h2",{attrs:{id:"创建ros包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建ros包"}},[t._v("#")]),t._v(" 创建ROS包")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("打开终端到 "),n("code",[t._v("~/catkin_ws/src")]),t._v(" 目录")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("roscd  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Should cd into ~/catkin_ws/devel")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" src\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在 "),n("code",[t._v("~/catkin_ws/src 中")]),t._v(" 目录创建一个新包，名为 "),n("code",[t._v("offboard_py")]),t._v(" (在这种情况下) 依赖 "),n("code",[t._v("rospy")]),t._v(" ：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("catalkin_create_pkg offboard_py rospy\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在 "),n("code",[t._v("~/catkin_ws/")]),t._v(" 目录中构建新的软件包：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Assuming previous directory to be ~/catkin_ws/src")]),t._v("\ncatkin build\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" devel/setup.bash\n")])])])]),t._v(" "),n("li",[n("p",[t._v("您现在应该能够通过使用以下方法切换至包目录：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("roscd offboard_py\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在包目录下创建一个新的文件夹 "),n("code",[t._v("/scripts")]),t._v("来存储Python文件：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" scripts\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" scripts\n")])])])])]),t._v(" "),n("h2",{attrs:{id:"代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[t._v("#")]),t._v(" 代码")]),t._v(" "),n("p",[t._v("创建ROS包和scripts文件夹后，可以开始编写Python脚本了。 在scripts文件夹中创建 "),n("code",[t._v("offb_node.py")]),t._v(" 文件，并赋予它可执行权限：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" offb_node.py\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x offb_node.py\n")])])]),n("p",[t._v("然后，打开 "),n("code",[t._v("offb_node.py")]),t._v(" 文件并粘贴以下代码：")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n * File: offb_node.py\n * Stack and tested in Gazebo Classic 9 SITL\n"""')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#! /usr/bin/env python")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" rospy\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" geometry_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" PoseStamped\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mavros_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" State\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mavros_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("srv "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CommandBool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CommandBoolRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetModeRequest\n\ncurrent_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" State"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("state_cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" current_state\n    current_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("init_node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"offb_node_py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    state_sub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Subscriber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/state"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" State"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state_cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    local_pos_pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/setpoint_position/local"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PoseStamped"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" queue_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mavros/cmd/arming"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    arming_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceProxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/cmd/arming"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CommandBool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mavros/set_mode"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    set_mode_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceProxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/set_mode"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Setpoint publishing MUST be faster than 2Hz")]),t._v("\n    rate "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Wait for Flight Controller connection")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connected"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    pose "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" PoseStamped"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Send a few setpoints before starting")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\n        local_pos_pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    offb_set_mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SetModeRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    offb_set_mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("custom_mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OFFBOARD'")]),t._v("\n\n    arm_cmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CommandBoolRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    arm_cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n    last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OFFBOARD"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" last_req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("set_mode_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offb_set_mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode_sent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loginfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OFFBOARD enabled"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n            last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("armed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" last_req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arming_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arm_cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loginfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Vehicle armed"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n                last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        local_pos_pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"代码解释"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码解释"}},[t._v("#")]),t._v(" 代码解释")]),t._v(" "),n("p",[n("code",[t._v("mavros_msgs")]),t._v(" 功能包中包含操作 mavros 包中服务和主题所需的全部自定义消息文件。 所有服务和主题及其相应的消息类型都可以在 "),n("a",{attrs:{href:"http://wiki.ros.org/mavros",target:"_blank",rel:"noopener noreferrer"}},[t._v(" mavros wiki "),n("OutboundLink")],1),t._v(" 中找到。")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" rospy\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" geometry_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" PoseStamped\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mavros_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" State\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mavros_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("srv "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CommandBool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CommandBoolRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetModeRequest\n")])])]),n("p",[t._v("我们创建了一个简单的回调函数来储存飞控当前的状态。 这将使得我们可以检查连接状态，加解锁状态以及"),n("em",[t._v("OFFBOARD")]),t._v(" 标志位。")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("current_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" State"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("state_cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" current_state\n    current_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg\n")])])]),n("p",[t._v('我们构建了一个发布者来发布本地位置指令并请求客户端进行加解锁状态及控制模式的切换。 请注意，对于您自己的系统，"mavros" 前缀可能不同，取决于节点启动文件中指定的名称。')]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("state_sub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Subscriber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/state"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" State"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state_cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nlocal_pos_pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/setpoint_position/local"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PoseStamped"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" queue_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mavros/cmd/arming"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\narming_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceProxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/cmd/arming"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CommandBool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mavros/set_mode"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nset_mode_client "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceProxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mavros/set_mode"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SetMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("PX4 在两个 "),n("em",[t._v("OFFBOARD")]),t._v(" 命令之间设置了500毫秒的超时检查。 一但发生超时，飞控组件中的commander模块会立即切换回进入 "),n("em",[t._v("OFFBOARD")]),t._v(" 模式之前的飞行模式。 这也是为什么发布频率 "),n("strong",[t._v("必须")]),t._v(" 大于2Hz的原因。 这也是我们"),n("strong",[t._v("推荐从 "),n("em",[t._v("Position")]),t._v(" 模式进入 "),n("em",[t._v("OFFBOARD")]),t._v(" 模式的原因，因为在这种情况下如果无人机退出 "),n("em",[t._v("OFFBOARD")]),t._v(" 模式")]),t._v("，它将会悬停于当前位置。")]),t._v(" "),n("p",[t._v("我们在这里设置发布速率：")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Setpoint publishing MUST be faster than 2Hz")]),t._v("\nrate "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("在发布任何消息之前，我们需要等待飞控和MAVROS建立连接。 在收到心跳包之后，代码便会跳出这个循环。")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Wait for Flight Controller connection")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connected"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("尽管PX4在航空航天常用的NED坐标系下操控飞机，但MAVROS将自动将该坐标系切换至常规的ENU坐标系下，反之亦然。 这也就是为什么我们设置"),n("code",[t._v("z")]),t._v("为+2。")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("pose "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" PoseStamped"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\npose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\npose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\npose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])])]),n("p",[t._v("在切换到"),n("em",[t._v("OFFBOARD")]),t._v("模式之前，你必须先发送一些设定值信息到飞控中。 否则，模式切换将被拒绝。 这里的"),n("code",[t._v("100")]),t._v(" 可以被设置为任意数。")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Send a few setpoints before starting")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\n    local_pos_pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("创建一个消息请求以用于将自定义模式设置为 "),n("code",[t._v("OFFBOARD")]),t._v(" 。 "),n("a",{attrs:{href:"http://wiki.ros.org/mavros/CustomModes#PX4_native_flight_stack",target:"_blank",rel:"noopener noreferrer"}},[t._v("支持模式"),n("OutboundLink")],1),t._v(" 列表可供参考。")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("offb_set_mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SetModeRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\noffb_set_mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("custom_mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OFFBOARD'")]),t._v("\n")])])]),n("p",[t._v("该代码的其余部分完全是自解释性的。 我们尝试切换到 "),n("em",[t._v("Offboard")]),t._v(" 模式，然后解锁四旋翼飞行器以允许其飞行。 我们每隔五秒去调用一次该服务，避免飞控被大量的请求阻塞。 在同一个循环中，我们按照前面定义的频率持续发送期望点设定值信息给飞控。")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[t._v("arm_cmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CommandBoolRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\narm_cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\nlast_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OFFBOARD"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" last_req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("set_mode_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offb_set_mode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode_sent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loginfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OFFBOARD enabled"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" current_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("armed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" last_req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arming_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arm_cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loginfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Vehicle armed"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n            last_req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    local_pos_pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    rate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("该示例代码非常简单仅为了说明使用方法。\n在一个复杂的系统中，通常需要创建新的进程来负责周期性的发送位置期望值给飞控。")])]),t._v(" "),n("h2",{attrs:{id:"创建ros启动文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建ros启动文件"}},[t._v("#")]),t._v(" 创建ROS启动文件")]),t._v(" "),n("p",[t._v("在您的 "),n("code",[t._v("offboard_py")]),t._v(" 软件包中，在 "),n("code",[t._v("~/catkin_ws/src/offboard_py/src")]),t._v(" 目录下创建名为 "),n("code",[t._v("launch")]),t._v(" 的文件夹。 包的启动文件将存储在这里。 然后创建您的第一个启动文件，在这种情况下我们以 "),n("code",[t._v("start_offb.launch")]),t._v("命名。")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("roscd offboard_py\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" launch\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" launch\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" start_offb.launch\n")])])]),n("p",[t._v("将以下代码复制到 "),n("code",[t._v("start_offb.launch")]),t._v(" 中：")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0"?>')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("launch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Include the MAVROS node with SITL and Gazebo --\x3e")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("$(find px4)/launch/mavros_posix_sitl.launch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("include")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Our node to control the drone --\x3e")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("node")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("pkg")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("offboard_py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("offb_node.py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("offb_node_py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("required")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("output")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("screen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("launch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("如你所见， "),n("code",[t._v("mavros_posix_sitl.launch")]),t._v(" 文件已被包含。 此文件负责启动 MAVROS、PX4 SITL、 Gazebo Classic 环境并在给定的世界中放置一架无人机(更多信息见文件 "),n("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/launch/mavros_posix_sitl.launch",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),n("OutboundLink")],1),t._v(")。")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[n("code",[t._v("mavros_posix_sitl.launch")]),t._v(" 文件拥有几个可以配置参数，如生成或Gazebo Classic 世界的无人机(参见 "),n("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/launch/mavros_posix_sitl.launch",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),n("OutboundLink")],1),t._v("以获取完整的列表)。")]),t._v(" "),n("p",[t._v("你可以通过在 "),n("em",[t._v("include")]),t._v("标签中声明这些参数以覆盖在 "),n("code",[t._v("mavros_posix_sitl.launch")]),t._v("定义的默认值。 例如，如果你想要在 "),n("code",[t._v("warehouse.world")]),t._v("放置无人机，你可以按如下方式声明：")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Include the MAVROS node with SITL and Gazebo --\x3e")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("$(find px4)/launch/mavros_posix_sitl.launch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("arg")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("world"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("default")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("$(find mavlink_sitl_gazebo)/worlds/warehouse.world"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("include")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),n("h2",{attrs:{id:"启动您的脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动您的脚本"}},[t._v("#")]),t._v(" 启动您的脚本")]),t._v(" "),n("p",[t._v("如果完成了一切，你现在应该能够启动和测试你的脚本。")]),t._v(" "),n("p",[t._v("在终端中输入：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("roslaunched offboard_py start_offb.launch\n")])])]),n("p",[t._v("您现在应该看到PX4固件启动和 Gazebo Classic 应用程序运行。 在 "),n("em",[t._v("OFFBOARD")]),t._v(" 模式设置后, 无人机将解锁, 无人机动作状态将如"),n("a",{attrs:{href:"#offb_video"}},[t._v("视频")]),t._v(" 中所示。")]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),n("p",[t._v("运行脚本时可能出现错误:")]),t._v(" "),n("blockquote",[n("p",[t._v("Resource not found: px4 ROS path [0] = ... ...")])]),t._v(" "),n("p",[t._v("这意味着PX4 SITL未包括在路径中。 若要解决这个问题，请在 "),n("code",[t._v(".bashrc")]),t._v(" 文件末尾添加这些行：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/PX4-Autopilot/Tools/simulation/gazebo/setup_gazebo.bash ~/PX4-Autopilot ~/PX4-Autopilot/build/px4_sitl_default\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ROS_PACKAGE_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ROS_PACKAGE_PATH")]),t._v(":~/PX4-Autopilot\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ROS_PACKAGE_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ROS_PACKAGE_PATH")]),t._v(":~/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("GAZEBO_PLUGIN_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$GAZEBO_PLUGIN_PATH")]),t._v(":/usr/lib/x86_64-linux-gnu/gazebo-9/plugins\n")])])]),n("p",[t._v("在终端中切换至home目录，运行下面的命令将上面的更改应用到当前终端：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" .bashrc\n")])])]),n("p",[t._v("在这个步骤之后，每次您打开一个新的终端窗口，您都不应该再担心这个错误。 如果再次出现，通过 "),n("code",[t._v("source .bashrc")]),t._v(" 修复。 这个解决方案在这个 "),n("a",{attrs:{href:"https://github.com/mzahana/px4_fast_planner/issues/4",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue"),n("OutboundLink")],1),t._v(" 提出，在这里你可以获得更多关于这个问题的信息。")])])])}),[],!1,null,null,null);s.default=e.exports},420:function(t,s,a){t.exports=a.p+"assets/media/gazebo_offboard.d8b1cf73.webm"}}]);