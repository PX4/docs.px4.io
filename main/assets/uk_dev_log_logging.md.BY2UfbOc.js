import{_ as a}from"./chunks/qgc-log-streaming.M4SGJhYF.js";import{_ as s,c as t,a8 as i,o as n}from"./chunks/framework.BDnHobkS.js";const u=JSON.parse('{"title":"Логування","description":"","frontmatter":{},"headers":[],"relativePath":"uk/dev_log/logging.md","filePath":"uk/dev_log/logging.md"}'),l={name:"uk/dev_log/logging.md"};function r(o,e,d,h,p,g){return n(),t("div",null,e[0]||(e[0]=[i(`<h1 id="логування" tabindex="-1">Логування <a class="header-anchor" href="#логування" aria-label="Permalink to &quot;Логування&quot;">​</a></h1><p>The <a href="./../modules/modules_system.html#logger">system logger</a> is able to log any ORB topic with all included fields. Everything necessary is generated from the <code>.msg</code> file, so that only the topic name needs to be specified. Необов&#39;язковий параметр інтервалу визначає максимальну швидкість ведення журналу певної теми. Усі існуючі екземпляри теми реєструються.</p><p>The output log format is <a href="./../dev_log/ulog_file_format.html">ULog</a>.</p><p><a href="./../dev_log/log_encryption.html">Encrypted logging</a> is also supported.</p><h2 id="використання" tabindex="-1">Використання <a class="header-anchor" href="#використання" aria-label="Permalink to &quot;Використання&quot;">​</a></h2><p>За замовчуванням, реєстрація автоматично починається при взбиранні на охорону, і зупиняється при знятті з охорони. Для кожної сесії готовності на SD-картці створюється новий файл журналу. To display the current state, use <code>logger status</code> on the console. If you want to start logging immediately, use <code>logger on</code>. Це скасовує стан готовності, якщо система була увімкнена. <code>logger off</code> undoes this.</p><p>If logging stops due to a write error, or reaching the <a href="#file-size-limitations">maximum file size</a>, PX4 will automatically restart logging in a new file.</p><p>Для отримання списку всіх підтримуваних команд та параметрів реєстратора використовуйте:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>logger help</span></span></code></pre></div><h2 id="налаштування" tabindex="-1">Налаштування <a class="header-anchor" href="#налаштування" aria-label="Permalink to &quot;Налаштування&quot;">​</a></h2><p>The logging system is configured by default to collect sensible logs for <a href="./../getting_started/flight_reporting.html">flight reporting</a> with <a href="http://logs.px4.io" target="_blank" rel="noreferrer">Flight Review</a>.</p><p>Logging may further be configured using the <a href="./../advanced_config/parameter_reference.html#sd-logging">SD Logging</a> parameters. Параметри, які ви найімовірніше зміните, перераховані нижче.</p><table tabindex="0"><thead><tr><th>Параметр</th><th>Опис</th></tr></thead><tbody><tr><td><a href="./../advanced_config/parameter_reference.html#SDLOG_MODE">SDLOG_MODE</a></td><td>Журналювання. Defines when logging starts and stops.<br>- <code>-1</code>: Logging disabled.<br>- <code>0</code>: Log when armed until disarm (default).<br>- <code>1</code>: Log from boot until disarm.<br>- <code>2</code>: Log from boot until shutdown.<br>- <code>3</code>: Log based on the <a href="./../advanced_config/parameter_reference.html#RC_MAP_AUX1">AUX1 RC channel</a>.<br>- <code>4</code>: Log from first armed until shutdown.</td></tr><tr><td><a href="./../advanced_config/parameter_reference.html#SDLOG_PROFILE">SDLOG_PROFILE</a></td><td>Профіль ведення журналу. Use this to enable less common logging/analysis (e.g. for EKF2 replay, high rate logging for PID &amp; filter tuning, thermal temperature calibration).</td></tr><tr><td><a href="./../advanced_config/parameter_reference.html#SDLOG_MISSION">SDLOG_MISSION</a></td><td>Create very small additional &quot;Mission Log&quot;.<br>This log can <em>not</em> be used with <a href="./../log/flight_log_analysis.html#flight-review-online-tool">Flight Review</a>, but is useful when you need a small log for geotagging or regulatory compliance.</td></tr></tbody></table><p>Корисні налаштування для конкретних випадків:</p><ul><li>Raw sensor data for comparison: <a href="./../advanced_config/parameter_reference.html#SDLOG_MODE">SDLOG_MODE=1</a> and <a href="./../advanced_config/parameter_reference.html#SDLOG_PROFILE">SDLOG_PROFILE=64</a>.</li><li>Disabling logging altogether: <a href="./../advanced_config/parameter_reference.html#SDLOG_MODE">SDLOG_MODE=<code>-1</code></a></li></ul><h3 id="модуль-реєстраціі" tabindex="-1">Модуль реєстрації <a class="header-anchor" href="#модуль-реєстраціі" aria-label="Permalink to &quot;Модуль реєстрації&quot;">​</a></h3><p><em>Developers</em> can further configure what information is logged via the <a href="./../modules/modules_system.html#logger">logger</a> module. Це дозволяє, наприклад, реєструвати ваші власні теми uORB.</p><h3 id="конфігурація-sd-карти" tabindex="-1">Конфігурація SD-карти <a class="header-anchor" href="#конфігурація-sd-карти" aria-label="Permalink to &quot;Конфігурація SD-карти&quot;">​</a></h3><p>Окремо, список зареєстрованих тем також може бути налаштований за допомогою файлу на картці SD. Create a file <code>etc/logging/logger_topics.txt</code> on the card with a list of topics (For SITL, it&#39;s <code>build/px4_sitl_default/rootfs/fs/microsd/etc/logging/logger_topics.txt</code>):</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;topic_name&gt; &lt;interval&gt; &lt;instance&gt;</span></span></code></pre></div><p>The <code>&lt;interval&gt;</code> is optional, and if specified, defines the minimum interval in ms between two logged messages of this topic. Якщо не вказано, тема реєструється з повною швидкістю.</p><p>The <code>&lt;instance&gt;</code> is optional, and if specified, defines the instance to log. Якщо не вказано, всі екземпляри теми реєструються. To specify <code>&lt;instance&gt;</code>, <code>&lt;interval&gt;</code> must be specified. Може бути встановлено на 0 для реєстрації з повною швидкістю</p><p>Теми в цьому файлі замінюють всі теми за замовчуванням, які були зареєстровані.</p><p>Приклади :</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sensor_accel 0 0</span></span>
<span class="line"><span>sensor_accel 100 1</span></span>
<span class="line"><span>sensor_gyro 200</span></span>
<span class="line"><span>sensor_mag 200 1</span></span></code></pre></div><p>Ця конфігурація буде реєструвати sensor_accel 0 з повною швидкістю, sensor_accel 1 з частотою 10 Гц, всі екземпляри sensor_gyro з частотою 5 Гц та sensor_mag 1 з частотою 5 Гц.</p><h2 id="скрипти" tabindex="-1">Скрипти <a class="header-anchor" href="#скрипти" aria-label="Permalink to &quot;Скрипти&quot;">​</a></h2><p>There are several scripts to analyze and convert logging files in the <a href="https://github.com/PX4/pyulog" target="_blank" rel="noreferrer">pyulog</a> repository.</p><h2 id="обмеження-розміру-фаилу" tabindex="-1">Обмеження розміру файлу <a class="header-anchor" href="#обмеження-розміру-фаилу" aria-label="Permalink to &quot;Обмеження розміру файлу&quot;">​</a></h2><p>Максимальний розмір файлу залежить від файлової системи та ОС. Розмір обмеження на NuttX наразі становить близько 2 ГБ.</p><h2 id="відключення" tabindex="-1">Відключення <a class="header-anchor" href="#відключення" aria-label="Permalink to &quot;Відключення&quot;">​</a></h2><p>Втрати логування небажані, і є кілька факторів, що впливають на кількість втрат:</p><ul><li>Більшість SD-карт, які ми тестували, проявляють кілька пауз кожну хвилину. Це проявляється як кілька 100 мс затримка під час команди запису. Це призводить до відключення, якщо буфер запису заповнюється протягом цього часу. Цей ефект залежить від SD-карти (див. нижче).</li><li>Форматування SD-карти може допомогти у запобіганні викидань.</li><li>Збільшення буфера журналу допомагає.</li><li>Decrease the logging rate of selected topics or remove unneeded topics from being logged (<code>info.py &lt;file&gt;</code> is useful for this).</li></ul><h2 id="sd-карти" tabindex="-1">SD-карти <a class="header-anchor" href="#sd-карти" aria-label="Permalink to &quot;SD-карти&quot;">​</a></h2><p>Максимальний підтримуваний розмір SD-карти для NuttX - 32 ГБ (Специфікація карт пам’яті SD, версія 2.0). The <strong>SanDisk Extreme U3 32GB</strong> and <strong>Samsung EVO Plus 32</strong> are known to be reliable cards (do not exhibit write-time spikes, and thus virtually no dropouts).</p><p>The table below shows the <strong>mean sequential write speed [KB/s]</strong> / <strong>maximum write time per block (average) [ms]</strong> for F4- (Pixracer), F7-, and H7-based flight controllers.</p><table tabindex="0"><thead><tr><th>SD-карта</th><th>F4</th><th>F7</th><th>H7</th></tr></thead><tbody><tr><td>SanDisk Extreme U3 32GB</td><td>1500 / <strong>15</strong></td><td>1800/10</td><td>2900/8</td></tr><tr><td>Samsung EVO Plus 32GB</td><td>1700/10-60</td><td>1800/10-60</td><td>1900/9-60</td></tr><tr><td>Sandisk Ultra Class 10 8GB</td><td>348 / 40</td><td>?/?</td><td>?/?</td></tr><tr><td>Sandisk Class 4 8GB</td><td>212 / 60</td><td>?/?</td><td>?/?</td></tr><tr><td>SanDisk Class 10 32 GB (High Endurance Video Monitoring Card)</td><td>331 / 220</td><td>?/?</td><td>?/?</td></tr><tr><td>Lexar U1 (Class 10), 16GB High-Performance</td><td>209 / 150</td><td>?/?</td><td>?/?</td></tr><tr><td>Sandisk Ultra PLUS Class 10 16GB</td><td>196 /500</td><td>?/?</td><td>?/?</td></tr><tr><td>Sandisk Pixtor Class 10 16GB</td><td>334 / 250</td><td>?/?</td><td>?/?</td></tr><tr><td>Sandisk Extreme PLUS Class 10 32GB</td><td>332 / 150</td><td>?/?</td><td>?/?</td></tr></tbody></table><p>Запис пропускної здатності зі стандартними темами становить близько 50 КБ/с, що задовольняє майже всі SD-карти у термінах їх середньої послідовної швидкості запису.</p><p>More important than the mean write speed is spikes (or generally high values) in the maximum write time per block (of 4 KB) or <code>fsync</code> times, as a long write time means a larger log buffer is needed to avoid dropouts.</p><p>PX4 використовує більші буфери на F7/H7 та кешування читання, що достатньо компенсує піки на багатьох поганих картках. That said, if your card has an <code>fsync</code> or write duration of several 100ms it is should not be preferred for use with PX4. You can check the value by running <a href="./../modules/modules_command.html#sd-bench">sd_bench</a> should be run with more iterations (around 100 should do).</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sd_bench</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span></code></pre></div><p>Це визначає мінімальний розмір буфера: чим більше це максимальне значення, тим більше потрібно мати розмір буфера журналу, щоб уникнути втрат даних. PX4 використовує більші буфери на F7/H7 та кешування читання, щоб компенсувати деякі з цих проблем.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>If you have concerns about a particular card you can run the above test and report the results to <a href="https://github.com/PX4/PX4-Autopilot/issues/4634" target="_blank" rel="noreferrer">https://github.com/PX4/PX4-Autopilot/issues/4634</a>.</p></div><h2 id="потокове-ведення-журналу" tabindex="-1">Потокове ведення журналу <a class="header-anchor" href="#потокове-ведення-журналу" aria-label="Permalink to &quot;Потокове ведення журналу&quot;">​</a></h2><p>Традиційний і все ще повністю підтримуваний спосіб ведення журналу - використання SD-карти на FMU. Однак є альтернатива, потокове ведення журналу, яке надсилає ті ж дані журналювання через MAVLink. Цей метод може бути використаний, наприклад, у випадках, коли FMU не має слоту для SD-карти (наприклад, Intel® Aero Ready to Fly Drone) або просто для уникнення проблем з SD-картами. Обидва методи можуть бути використані незалежно один від одного і одночасно.</p><p>Вимога полягає в тому, що посилання забезпечує принаймні ~50KB/s, наприклад, WiFi-посилання. І тільки один клієнт може запитати потік журналування одночасно. Підключення не потребує надійності, протокол розроблений для обробки втрат.</p><p>Існують різні клієнти, які підтримують потокову передачу ulog:</p><ul><li><code>mavlink_ulog_streaming.py</code> script in PX4-Autopilot/Tools.</li><li>QGroundControl: <img src="`+a+`" alt="QGC Log Streaming"></li><li><a href="https://github.com/ecmnet/MAVGCL" target="_blank" rel="noreferrer">MAVGCL</a></li></ul><h3 id="діагностика" tabindex="-1">Діагностика <a class="header-anchor" href="#діагностика" aria-label="Permalink to &quot;Діагностика&quot;">​</a></h3><ul><li><p>If log streaming does not start, make sure the <code>logger</code> is running (see above), and inspect the console output while starting.</p></li><li><p>Якщо це все ще не працює, переконайтеся, що використовується MAVLink 2. Enforce it by setting <code>MAV_PROTO_VER</code> to 2.</p></li><li><p>Log streaming uses a maximum of 70% of the configured MAVLink rate (<code>-r</code> parameter). Якщо потрібно більше, повідомлення видаляються. The currently used percentage can be inspected with <code>mavlink status</code> (1.8% is used in this example):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">instance</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #0:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        GCS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> heartbeat:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  160955</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> us</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ago</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        mavlink</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chan:</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           GENERIC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LINK</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> RADIO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        flow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> control:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   OFF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        rates:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        tx:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 95.781</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kB/s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        txerr:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kB/s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        rx:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.021</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kB/s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mult:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ULog</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1.8%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 70.0%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        accepting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commands:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> YES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        MAVLink</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        transport</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UDP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (14556)</span></span></code></pre></div><p>Also make sure <code>txerr</code> stays at 0. Якщо це піде вгору, або буфер відправлення NuttX занадто малий, або фізичний зв&#39;язок насичений, або апаратне забезпечення занадто повільне для обробки даних.</p></li></ul><h2 id="дивіться-також" tabindex="-1">Дивіться також <a class="header-anchor" href="#дивіться-також" aria-label="Permalink to &quot;Дивіться також&quot;">​</a></h2><ul><li><a href="./../dev_log/log_encryption.html">Encrypted logging</a></li></ul>`,52)]))}const m=s(l,[["render",r]]);export{u as __pageData,m as default};
