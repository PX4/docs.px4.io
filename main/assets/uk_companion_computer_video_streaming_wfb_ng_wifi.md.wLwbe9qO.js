import{_ as i,c as e,a8 as r,o as t}from"./chunks/framework.BDnHobkS.js";const g=JSON.parse(`{"title":"Потокова передача відео через канал зв'язку WiFi в режимі Raw (WFB-ng)","description":"","frontmatter":{},"headers":[],"relativePath":"uk/companion_computer/video_streaming_wfb_ng_wifi.md","filePath":"uk/companion_computer/video_streaming_wfb_ng_wifi.md"}`),s={name:"uk/companion_computer/video_streaming_wfb_ng_wifi.md"};function o(n,a,l,p,h,d){return t(),e("div",null,a[0]||(a[0]=[r(`<h1 id="потокова-передача-відео-через-канал-зв-язку-wifi-в-режимі-raw-wfb-ng" tabindex="-1">Потокова передача відео через канал зв&#39;язку WiFi в режимі Raw (WFB-ng) <a class="header-anchor" href="#потокова-передача-відео-через-канал-зв-язку-wifi-в-режимі-raw-wfb-ng" aria-label="Permalink to &quot;Потокова передача відео через канал зв&#39;язку WiFi в режимі Raw (WFB-ng)&quot;">​</a></h1><p>Цей посібник показує, як налаштувати <a href="./../companion_computer/README.html">супутній комп&#39;ютер</a> з камерою Logitech C920 або RaspberryPi так, щоб відеопотік передавався з БЛА на земний комп&#39;ютер і відображався в <em>QGroundControl</em>. Для налаштування використовується WiFi у режимі непідключеного (транслювання) та програмне забезпечення проекту <a href="https://github.com/svpcom/wfb-ng" target="_blank" rel="noreferrer">WFB-ng</a>.</p><p>Канал також може бути використаний як двосторонній <a href="./../telemetry/README.html">телеметричний</a> зв&#39;язок та тунель TCP/IP для керування дроном під час польоту. Якщо ви керуєте дроном вручну за допомогою джойстика з QGroundControl (яке використовує MAVLink), то ви можете використовувати WFB-ng як єдине з&#39;єднання для всіх комунікацій з дроном (відео, телеметрія MAVLink, дистанційне керування за допомогою джойстика).</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Перш ніж використовувати <em>WFB-ng</em>, перевірте, чи дозволяють регулятори такий тип використання WiFi в вашій країні.</p></div><h2 id="загальнии-огляд-wfb-ng" tabindex="-1">Загальний огляд WFB-ng <a class="header-anchor" href="#загальнии-огляд-wfb-ng" aria-label="Permalink to &quot;Загальний огляд WFB-ng&quot;">​</a></h2><p>Проект <em>WFB-ng</em> надає транспорт даних, який використовує низькорівневі пакети WiFi для уникнення обмежень відстані та затримки звичайного стеку IEEE 802.11.</p><p>Основні переваги <em>WFB-ng</em> включають:</p><ul><li>Низька затримка відеозв&#39;язку.</li><li>Двосторонній телеметричний зв&#39;язок (MAVLink).</li><li>TCP/IP тунель.</li><li>Автоматичне різноманіття передавача - використовуйте кілька карт на землі, щоб уникнути відслідковувача антен.</li><li>Повне шифрування та аутентифікація зв&#39;язку (з використанням <a href="https://download.libsodium.org/doc/" target="_blank" rel="noreferrer">libsodium</a>).</li><li>Агрегація пакетів MAVLink (упаковка невеликих пакетів у партії перед передачею).</li><li>Покращений <a href="https://github.com/svpcom/wfb-ng-osd" target="_blank" rel="noreferrer">OSD</a> для Raspberry PI або загального лінуксового робочого стола з gstreamer.</li></ul><p>Додаткова інформація наведена в <a href="#faq">FAQ</a> нижче.</p><h2 id="апаратне-забезпечення-hardware" tabindex="-1">Апаратне забезпечення(Hardware) <a class="header-anchor" href="#апаратне-забезпечення-hardware" aria-label="Permalink to &quot;Апаратне забезпечення(Hardware)&quot;">​</a></h2><h3 id="налаштування-транспорту" tabindex="-1">Налаштування транспорту <a class="header-anchor" href="#налаштування-транспорту" aria-label="Permalink to &quot;Налаштування транспорту&quot;">​</a></h3><p>Налаштування транспортного засобу складається з такого:</p><ul><li><p>Raspberry PI 3B/3B+/ZeroW</p></li><li><p>Камера. Були протестовані наступні варіанти:</p><ul><li><a href="https://www.raspberrypi.org/products/camera-module-v2/" target="_blank" rel="noreferrer">Камера Raspberry Pi</a>, підключена через CSI.</li><li><a href="https://www.logitech.com/en-us/product/hd-pro-webcam-c920?crid=34" target="_blank" rel="noreferrer">Камера Logitech C920</a>, підключена через USB</li></ul></li><li><p>Модуль WiFi <a href="https://www.alfa.com.tw/products_detail/1.htm" target="_blank" rel="noreferrer">ALPHA AWUS036ACH</a> або будь-яка інша карта на основі <strong>RTL8812au</strong>.</p></li></ul><h3 id="наземна-станція" tabindex="-1">Наземна станція <a class="header-anchor" href="#наземна-станція" aria-label="Permalink to &quot;Наземна станція&quot;">​</a></h3><ul><li><p>Наземний комп&#39;ютер на станції. Ці варіанти були перевірені:</p><ul><li>Будь-який Linux комп&#39;ютер з USB-портом (протестований на Ubuntu 18.04 x86-64)</li><li>Комп’ютер із будь-якою ОС із керуванням QGround та Raspberry PI, під’єднаний через Ethernet (RasPi забезпечує з’єднання Wi-Fi).</li></ul></li><li><p>Модуль WiFi <a href="https://www.alfa.com.tw/products_detail/1.htm" target="_blank" rel="noreferrer">ALPHA AWUS036ACH</a> або будь-яка інша карта на основі <strong>RTL8812au</strong>. Див. вікі <a href="https://github.com/svpcom/wfb-ng/wiki/WiFi-hardware" target="_blank" rel="noreferrer">WFB-ng &gt; апаратне забезпечення WiFi</a> для отримання додаткової інформації про підтримувані модулі.</p></li></ul><h2 id="модифікація-апаратного-забезпечення" tabindex="-1">Модифікація апаратного забезпечення <a class="header-anchor" href="#модифікація-апаратного-забезпечення" aria-label="Permalink to &quot;Модифікація апаратного забезпечення&quot;">​</a></h2><p>Alpha AWUS036ACH - це карта середньої потужності, яка використовує багато струму під час передачі. Якщо ви живите її від звичайного USB2, то на більшості <strong>ARM-плат</strong> вона скине порт. Якщо ви підключите її до порту <strong>USB3</strong> за допомогою <strong>нативного кабелю USB3</strong> до ноутбука на <strong>Linux</strong>, ви можете використовувати її без модифікацій.</p><p>Для <strong>Raspberry PI</strong> (UAV або земля) її необхідно підключити безпосередньо до 5V BEC (або адаптера високої потужності для земельного pi) одним із двох способів:</p><ul><li>Зробіть власний USB-кабель ([відірвіть провід <code>+5V</code> від USB-штепселя і підключіть його до BEC])(<a href="https://electronics.stackexchange.com/questions/218500/usb-charge-and-data-separate-cables" target="_blank" rel="noreferrer">https://electronics.stackexchange.com/questions/218500/usb-charge-and-data-separate-cables</a>)</li><li>Відірвіть провід <code>+5V</code> на платі поруч із USB-портом і підключіть його до BEC (не робіть цього, якщо сумніваєтеся - використовуйте власний кабель).</li></ul><p>Вам також потрібно додати <strong>конденсатор низького опору</strong> з ємністю 470 мкФ (як у ESC) між <strong>+5В карти та землею</strong>, щоб фільтрувати перепади напруги. Ви повинні інтегрувати конденсатор з власним USB-кабелем. Без конденсатора ви можете отримати втрату пакетів або їх порушення. Будьте обережні з петлею маси при використанні декількох земляних проводів. Будьте обережні з <a href="https://en.wikipedia.org/wiki/Ground_loop_%28electricity%29" target="_blank" rel="noreferrer">петлею маси</a> при використанні декількох земляних проводів.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Якщо ви використовуєте спеціальні &quot;дуже&quot; потужні карти з Taobao/Aliexpress, то ВИ МАЄТЕ живити їх так, як описано вище в БУДЬ-ЯКОМУ випадку.</p></div><h3 id="конфігурація-uav" tabindex="-1">Конфігурація UAV <a class="header-anchor" href="#конфігурація-uav" aria-label="Permalink to &quot;Конфігурація UAV&quot;">​</a></h3><ol><li>Завантажте образ Raspberry PI з <a href="https://github.com/svpcom/wfb-ng/releases/" target="_blank" rel="noreferrer">останнього випуску wfb-ng</a></li><li>Виконайте прошивку на Raspberry PI <strong>UAV</strong></li><li>Перезавантажте його і підключіться через ssh зі стандартними обліковими даними (pi/raspberry).</li><li>Виконайте дії для ролі <strong>повітря</strong>, як показано в motd.</li><li>Налаштуйте камерний канал. Відкрийте <code>/etc/systemd/system/fpv-camera.service</code> і розкоментуйте конвеєр відповідно до вашої камери (камера PI або камера Logitech)</li><li>Відкрийте <code>/etc/wifibroadcast.cfg</code> і налаштуйте канал WiFi відповідно до налаштувань вашої антени (або використовуйте замовчуваний #165 для 5.8GHz)</li><li>Налаштуйте PX4 на вивід потоку телеметрії зі швидкістю 1500 Кбіт/с (інші швидкості UART не добре відповідають дільникам частоти RPI). Підключіть UART Pixhawk до UART Raspberry PI. У розділі <code>/etc/wifibroadcast.cfg</code> файлу розкоментуйте <code>peer = &#39;serial:ttyS0:1500000&#39;</code> секцію.</li></ol><h3 id="використання-ноутбука-linux-як-gcs-важче-ніж-використання-raspi" tabindex="-1">Використання ноутбука Linux як GCS (важче, ніж використання RasPi) <a class="header-anchor" href="#використання-ноутбука-linux-як-gcs-важче-ніж-використання-raspi" aria-label="Permalink to &quot;Використання ноутбука Linux як GCS (важче, ніж використання RasPi)&quot;">​</a></h3><ol><li><p>На <strong>наземному</strong> Linux комп&#39;ютері розробки:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libpcap-dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libsodium-dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python3-all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python3-twisted</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/svpcom/wfb-ng.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wfb-ng</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./deb_dist/wfb-ng</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.deb</span></span></code></pre></div></li><li><p>Слідуйте інструкції з <a href="https://github.com/svpcom/wfb-ng/wiki/Setup-HOWTO" target="_blank" rel="noreferrer">Setup HOWTO</a> для завершення встановлення</p></li><li><p>Не забудьте скопіювати <code>/etc/gs.key</code> з боку <strong>UAV</strong> на <strong>бік землі</strong>, щоб зв&#39;язати два налаштування.</p></li><li><p>Також не забудьте використовувати той самий канал частоти, що й на боці UAV.</p></li></ol><h3 id="використання-raspberry-pi-як-бзк-легше" tabindex="-1">Використання Raspberry PI як БЗК (легше) <a class="header-anchor" href="#використання-raspberry-pi-як-бзк-легше" aria-label="Permalink to &quot;Використання Raspberry PI як БЗК (легше)&quot;">​</a></h3><p>Якщо у вас є Windows або OSX, або ви не хочете налаштовувати WFB-ng на свій ноутбук з Linux, тоді ви можете використовувати той самий готовий образ і ще один Raspberry Pi:</p><ol><li>Запишіть образ на <strong>ground</strong> Raspberry Pi.</li><li>Перезавантажте його і підключіться через SSH за стандартними обліковими даними (pi/raspberry).</li><li>Виконайте дії для ролі <strong>землі</strong>, як показано в motd, але пропустіть налаштування служби <code>fpv-video</code> та <code>osd</code>.</li><li>Підключіть ваш ноутбук та земельний RasPi через Ethernet та налаштуйте IP-адреси</li><li>Відредагуйте <code>/etc/wifibroadcast.cfg</code> і встановіть IP-адресу ноутбука в розділах <code>[gs_mavlink]</code> та <code>[gs_video]</code> (замінивши <code>127.0.0.1</code>).</li></ol><h3 id="налаштування-qgroundcontrol" tabindex="-1">Налаштування QGroundControl <a class="header-anchor" href="#налаштування-qgroundcontrol" aria-label="Permalink to &quot;Налаштування QGroundControl&quot;">​</a></h3><ol><li>Запустіть <em>QGroundControl</em> і встановіть <code>RTP h264</code> на порту 5600 як вихідне джерело відео</li><li>Використовуйте налаштування за замовчуванням (udp на порту 14550) як джерело mavlink</li></ol><h2 id="налаштування-радіо" tabindex="-1">Налаштування радіо <a class="header-anchor" href="#налаштування-радіо" aria-label="Permalink to &quot;Налаштування радіо&quot;">​</a></h2><p>З настройками WFB за замовчуванням використовуйте радіоканал 165 (5825 МГц), ширину 20 МГц, MCS #1 (QPSK 1/2) з довгим GI. Це забезпечує приблизно 7 мбіт/с <strong>ефективної</strong> швидкості (тобто використовуваної швидкості після FEC та кодування пакетів) в <strong>обох напрямках</strong> разом, оскільки WiFi є напівдуплексом. Таким чином, він підходить для потокового відео 720p@49fps (4 мбіт/с) + два потоки телеметрії з повною швидкістю (вгору та вниз). Якщо вам потрібна вища пропускна здатність, ви можете використовувати індекси MCS (наприклад, 2 або більше)</p><h2 id="антени-та-інше" tabindex="-1">Антени та інше <a class="header-anchor" href="#антени-та-інше" aria-label="Permalink to &quot;Антени та інше&quot;">​</a></h2><p>У простих випадках ви можете використовувати всенапрямлені антени з лінійною (які комплектуються з WiFi картами) або круговою листковою (<a href="http://www.antenna-theory.com/antennas/cloverleaf.php" target="_blank" rel="noreferrer">кругово-поляризована антена Coverleaf</a>) поляризацією. Якщо ви хочете налаштувати зв&#39;язок на велику відстань, ви можете використовувати кілька WiFi адаптерів з напрямними та всенапрямленими антенами. TX/RX Підтримується різноманіття передачі/прийому для кількох адаптерів з коробки (просто додайте кілька мережевих інтерфейсів до <code>/etc/default/wifibroadcast</code>). Якщо ваш WiFi адаптер має дві антени (наприклад, Alfa AWU036ACH), різноманіття передачі втілено через <a href="https://en.wikipedia.org/wiki/Space%E2%80%93time_block_code" target="_blank" rel="noreferrer">STBC</a>. Карти з 4 портами (наприклад, Alfa AWUS1900) наразі не підтримуються.</p><h2 id="часто-запитувані-питання" tabindex="-1">Часто Запитувані Питання <a class="header-anchor" href="#часто-запитувані-питання" aria-label="Permalink to &quot;Часто Запитувані Питання&quot;">​</a></h2><p><strong>З:</strong> <em>Який тип даних можна передавати за допомогою wfb-ng?</em></p><p><strong>A:</strong> Будь-який UDP з розміром пакета &lt;= 1445. Наприклад, x264 в середині RTP або MAVLink.</p><p><strong>Q:</strong> <em>Які гарантії передачі?</em></p><p><strong>A:</strong> Wifibroadcast використовує FEC (передню корекцію помилок). Ви можете налаштувати його як TX так і RX одночасно!), щоб відповідати вашим потребам to fit your needs.</p><p><strong>Q</strong> <em>Яка максимальна відстань, на яку я можу летіти і все ще зберігати зв&#39;язок?</em></p><p><strong>A</strong>Це залежить від ваших антен та WiFi карт. З Alfa AWU036ACH і направленою антеною 20dBi на землі можливий польот на відстань приблизно 20 км.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Не використовуйте діапазон, на якому працює RC TX! Або налаштуйте RTL належним чином, щоб уникнути втрати моделі.</p></div><p><strong>Q:</strong> <em>Чи підтримується лише Raspberry PI?</em></p><p><strong>A:</strong> WFB-ng не зв&#39;язаний з жодним GPU - він працює з UDP-пакетами. Але для отримання потоку RTP вам потрібен відеокодер (який кодує вихідні дані з камери у потік x264) або ви повинні використовувати камеру з апаратним відеокодеком, таку як Logitech C920 або камери спостереження з Ethernet.</p><h4 id="які-arm-плати-рекомендуються-для-бпла" tabindex="-1">Які ARM-плати рекомендуються для БПЛА? <a class="header-anchor" href="#які-arm-плати-рекомендуються-для-бпла" aria-label="Permalink to &quot;Які ARM-плати рекомендуються для БПЛА?&quot;">​</a></h4><ul><li>RPI3b/3b+/ZeroW. Існують готові образи, але вони підтримують лише відео h264 для камер CSI.</li><li>Jetson Nano. Він підтримує h264 і h265, але вам потрібно налаштувати його самостійно за <a href="https://github.com/svpcom/wfb-ng/wiki/Setup-HOWTO" target="_blank" rel="noreferrer">допомогою Setup HOWTO.</a></li></ul><p>Ви можете використовувати будь-яку іншу ARM-плату з Linux, але вам потрібно використовувати камеру Ethernet або USB з вбудованими апаратними відеокодеками (наприклад, Logitech C920).</p><h2 id="теорія" tabindex="-1">Теорія <a class="header-anchor" href="#теорія" aria-label="Permalink to &quot;Теорія&quot;">​</a></h2><p>WFB-ng переводить WiFi-карти у режим монітору. Цей режим дозволяє надсилати та отримувати довільні пакети без асоціації та очікування підтвердження (ACK). <a href="https://github.com/svpcom/wfb-ng/blob/master/doc/Analysis%20of%20Injection%20Capabilities%20and%20Media%20Access%20of%20IEEE%20802.11%20Hardware%20in%20Monitor%20Mode.pdf" target="_blank" rel="noreferrer">Аналіз можливостей ін&#39;єкції та доступу до медіа апаратного забезпечення IEEE 802.11 в режимі монітору</a> <a href="https://github.com/ewa/802.11-data" target="_blank" rel="noreferrer">802.11 часів</a></p>`,49)]))}const k=i(s,[["render",o]]);export{g as __pageData,k as default};
