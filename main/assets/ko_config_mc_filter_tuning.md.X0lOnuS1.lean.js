import{_ as t,a,b as r,c as o}from"./chunks/actuator_controls_fft_gyro_notch_32.DkA7UTgc.js";import{_ as i,c as n,a8 as l,o as s}from"./chunks/framework.BDnHobkS.js";const F=JSON.parse('{"title":"MC Filter Tuning & Control Latency","description":"","frontmatter":{},"headers":[],"relativePath":"ko/config_mc/filter_tuning.md","filePath":"ko/config_mc/filter_tuning.md"}'),c={name:"ko/config_mc/filter_tuning.md"};function h(d,e,f,p,_,m){return s(),n("div",null,e[0]||(e[0]=[l('<h1 id="mc-filter-tuning-control-latency" tabindex="-1">MC Filter Tuning &amp; Control Latency <a class="header-anchor" href="#mc-filter-tuning-control-latency" aria-label="Permalink to &quot;MC Filter Tuning &amp; Control Latency&quot;">​</a></h1><p>Filters can be used to trade off <a href="#control-latency">control latency</a>, which affects flight performance, and noise filtering, which impacts both flight performance and motor health.</p><p>제어 지연과 PX4 필터 튜닝에 관한 개요를 제공합니다.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Before filter tuning you should do a first pass at <a href="./../config_mc/pid_tuning_guide_multicopter_basic.html">Basic MC PID tuning</a>. The vehicle needs to be undertuned (the <strong>P</strong> and <strong>D</strong> gains should be set too low), such that there are no oscillations from the controller that could be interpreted as noise (the default gains might be good enough).</p></div><h2 id="제어-지연" tabindex="-1">제어 지연 <a class="header-anchor" href="#제어-지연" aria-label="Permalink to &quot;제어 지연&quot;">​</a></h2><p>The <em>control latency</em> is the delay from a physical disturbance of the vehicle until the motors react to the change.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Lowering latency allows you to increase the rate <strong>P</strong> gains, which results in better flight performance. 1/1000초의 지연 시간도 큰 영향을 미칠 수 있습니다.</p></div><p>다음의 요소들은 제어 지연에 영향을 끼칩니다.</p><ul><li>부드러운 기체 또는 부드러운 진동 장착은 대기 시간을 증가시킵니다 (필터 역할을 함).</li><li>소프트웨어 및 센서 칩의 저역 통과 필터는 대기 시간 증가분을 상쇄하여 노이즈 필터링을 원활하게합니다.</li><li>PX4 소프트웨어 내부 : 센서 신호를 드라이버에서 읽은 다음 컨트롤러를 통해 출력 드라이버로 전달하여야 합니다.</li><li>The maximum gyro publication rate (configured with <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_RATEMAX">IMU_GYRO_RATEMAX</a>). 속도가 높을수록 지연 시간이 줄어들지만 증간된 연산량으로 인하여 다른 프로세스를 방해할 수 있습니다. 4kHz 이상은 STM32H7 프로세서 이상의 컨트롤러에서만 권장됩니다 (2kHz 값은 성능이 낮은 프로세서의 최대치입니다).</li><li>The IO chip (MAIN pins) adds about 5.4 ms latency compared to using the AUX pins (this does not apply to a <em>Pixracer</em> or <em>Omnibus F4</em>, but does apply to a Pixhawk). To avoid the IO delay attach the motors to the AUX pins instead.</li><li>PWM output signal: enable <a href="./../peripherals/dshot.html">Dshot</a> by preference to reduce latency (or One-Shot if DShot is not supported). The protocol is selected for a group of outputs during <a href="./../config/actuators.html">Actuator Configuration</a>.</li></ul><p>아래에서는 저역 통과 필터의 효과에 대하여 설명합니다.</p><h2 id="필터" tabindex="-1">필터 <a class="header-anchor" href="#필터" aria-label="Permalink to &quot;필터&quot;">​</a></h2><p>The filtering pipeline for the controllers in PX4 is described below.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Sampling and filtering is always performed at the full raw sensor rate (commonly 8kHz, depending on the IMU).</p></div><h3 id="on-chip-dlpf-for-the-gyro-sensor" tabindex="-1">On-chip DLPF for the Gyro Sensor <a class="header-anchor" href="#on-chip-dlpf-for-the-gyro-sensor" aria-label="Permalink to &quot;On-chip DLPF for the Gyro Sensor&quot;">​</a></h3><p>This is disabled on all chips where it can be disabled (if not, cutoff frequency is set to the highest level of the chip).</p><h3 id="notch-filters" tabindex="-1">Notch Filters <a class="header-anchor" href="#notch-filters" aria-label="Permalink to &quot;Notch Filters&quot;">​</a></h3><p>상당한 저주파 노이즈 스파이크가있는 설정 (예 : 로터 블레이드 통과 주파수의 고조파로 인한)은 노치 필터를 사용하여 신호가 저역 통과 필터로 전달되기 전에 신호를 제거하는 것이 좋습니다 (이러한 고조파는 다른 소음원으로 모터에서 비슷한 해로운 영향을 미칩니다).</p><p>Without the notch filter you&#39;d have to set the low pass filter cutoff much lower (increasing the phase lag) in order to avoid passing this noise to the motors.</p><h4 id="static-notch-filters" tabindex="-1">Static Notch Filters <a class="header-anchor" href="#static-notch-filters" aria-label="Permalink to &quot;Static Notch Filters&quot;">​</a></h4><p>One or two static notch filters on the gyro sensor data that are used to filter out narrow band noise, for example a bending mode of the airframe.</p><p>The static notch filters can be configured using:</p><ul><li>First notch filter: <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_NF0_BW">IMU_GYRO_NF0_BW</a> and <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_NF0_FRQ">IMU_GYRO_NF0_FRQ</a>.</li><li>Second notch filter: <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_NF1_BW">IMU_GYRO_NF1_BW</a> and <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_NF1_FRQ">IMU_GYRO_NF1_FRQ</a>.</li></ul><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Only two notch filters are provided. Airframes with more than two frequency noise spikes typically clean the first two spikes with the notch filters, and subsequent spikes using the low pass filter.</p></div><h4 id="dynamic-notch-filters" tabindex="-1">Dynamic Notch Filters <a class="header-anchor" href="#dynamic-notch-filters" aria-label="Permalink to &quot;Dynamic Notch Filters&quot;">​</a></h4><p>Dynamic notch filters use ESC RPM feedback and/or the onboard FFT analysis. The ESC RPM feedback is used to track the rotor blade pass frequency and its harmonics, while the FFT analysis can be used to track a frequency of another vibration source, such a fuel engine.</p><p>ESC RPM feedback requires ESCs capable of providing RPM feedback such as <a href="./../peripherals/esc_motors.html#dshot">DShot</a> with telemetry connected, a bidirectional DShot set up (<a href="https://github.com/PX4/PX4-Autopilot/pull/23863" target="_blank" rel="noreferrer">work in progress</a>), or <a href="./../dronecan/escs.html">UAVCAN/DroneCAN ESCs</a>. Before enabling, make sure that the ESC RPM is correct. You might have to adjust the <a href="./../advanced_config/parameter_reference.html#MOT_POLE_COUNT">pole count of the motors</a>.</p><p>The following parameters should be set to enable and configure dynamic notch filters:</p><table tabindex="0"><thead><tr><th>매개변수</th><th>설명</th></tr></thead><tbody><tr><td><a href="IMU_GYRO_DNF_EN"></a><a href="./../advanced_config/parameter_reference.html#IMU_GYRO_DNF_EN">IMU_GYRO_DNF_EN</a></td><td>Enable IMU gyro dynamic notch filtering. <code>0</code>: ESK RPM, <code>1</code>: Onboard FFT.</td></tr><tr><td><a href="IMU_GYRO_FFT_EN"></a><a href="./../advanced_config/parameter_reference.html#IMU_GYRO_FFT_EN">IMU_GYRO_FFT_EN</a></td><td>Enable onboard FFT (required if <code>IMU_GYRO_DNF_EN</code> is set to <code>1</code>).</td></tr><tr><td><a href="IMU_GYRO_DNF_MIN"></a><a href="./../advanced_config/parameter_reference.html#IMU_GYRO_DNF_MIN">IMU_GYRO_DNF_MIN</a></td><td>Minimum dynamic notch frequency in Hz.</td></tr><tr><td><a href="IMU_GYRO_DNF_BW"></a><a href="./../advanced_config/parameter_reference.html#IMU_GYRO_DNF_BW">IMU_GYRO_DNF_BW</a></td><td>Bandwidth for each notch filter in Hz.</td></tr><tr><td><a href="IMU_GYRO_DNF_HMC"></a><a href="./../advanced_config/parameter_reference.html#IMU_GYRO_NF0_BW">IMU_GYRO_DNF_HMC</a></td><td>Number of harmonics to filter.</td></tr></tbody></table><h3 id="low-pass-filter" tabindex="-1">Low-pass Filter <a class="header-anchor" href="#low-pass-filter" aria-label="Permalink to &quot;Low-pass Filter&quot;">​</a></h3><p>A low pass filter on the gyro data can be configured with the <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_CUTOFF">IMU_GYRO_CUTOFF</a> parameter.</p><p>제어 지연을 줄이기 위해 저역 통과 필터의 차단 주파수를 높이려고 합니다. The effect on latency of increasing <code>IMU_GYRO_CUTOFF</code> is approximated below.</p><table tabindex="0"><thead><tr><th>컷오프 (Hz)</th><th>지연(대략). (ms)</th></tr></thead><tbody><tr><td>30</td><td>8</td></tr><tr><td>60</td><td>3.8</td></tr><tr><td>120</td><td>1.9</td></tr></tbody></table><p>However this is a trade-off as increasing <code>IMU_GYRO_CUTOFF</code> will also increase the noise of the signal that is fed to the motors. 모터 소음은 다음과 같은 결과를 가져옵니다.</p><ul><li>모터와 ESC는 손상될 정도로 뜨거워 질 수 있습니다.</li><li>모터가 계속 속도를 변경하므로 비행 시간이 단축됩니다.</li><li>가시적인 임의의 작은 트위치.</li></ul><h3 id="low-pass-filter-on-d-term" tabindex="-1">Low-pass Filter on D-term <a class="header-anchor" href="#low-pass-filter-on-d-term" aria-label="Permalink to &quot;Low-pass Filter on D-term&quot;">​</a></h3><p>D-term은 노이즈에 가장 취약하지만 대기 시간이 약간 증가해도 성능에 나쁜 영향을 주지 않습니다. For this reason the D-term has a separately-configurable low-pass filter, <a href="./../advanced_config/parameter_reference.html#IMU_DGYRO_CUTOFF">IMU_DGYRO_CUTOFF</a>.</p><h3 id="slew-rate-filter-on-motor-outputs" tabindex="-1">Slew-rate Filter on Motor Outputs <a class="header-anchor" href="#slew-rate-filter-on-motor-outputs" aria-label="Permalink to &quot;Slew-rate Filter on Motor Outputs&quot;">​</a></h3><p>An optional slew-rate filter on the motor outputs. This rate may be configured as part of the <a href="./../config/actuators.html#motor-geometry-multicopter">Multicopter Geometry</a> when configuring actuators (which in turn modifies the <a href="./../advanced_config/parameter_reference.html#CA_R0_SLEW">CA_Rn_SLEW</a> parameters for each motor <code>n</code>).</p><h2 id="필터-튜닝" tabindex="-1">필터 튜닝 <a class="header-anchor" href="#필터-튜닝" aria-label="Permalink to &quot;필터 튜닝&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">INFO</p><p>최적의 필터 설정은 기체에 따라 달라집니다. 기본값은 낮은 품질 설정에서도 작동하도록 보수적으로 설정됩니다.</p></div><p>First make sure to have the high-rate logging profile activated (<a href="./../advanced_config/parameter_reference.html#SDLOG_PROFILE">SDLOG_PROFILE</a> parameter). <a href="./../getting_started/flight_reporting.html">Flight Review</a> will then show an FFT plot for the roll, pitch and yaw controls.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><ul><li>기체의 심한 진동 문제를 필터 튜닝만으로 해결하는 것은 적절하지 않습니다. 기체의 하드웨어 설정을 수정하는 것이 바람직합니다.</li><li>PID 게인, 특히 D가 진동으로 나타날 수 있으므로 너무 높게 설정되지 않았는 지 확인하십시오.</li></ul></div><p>필터 튜닝은 비행 로그를 검토하는 것이 제일 좋은 방법입니다. 서로 다른 매개 변수를 사용하여 여러 차례 비행후 로그를 분석할 수 있지만, 별도의 로그 파일이 생성되도록 중간에 시동을 꺼야합니다.</p><p>The performed flight manoeuvre can simply be hovering in <a href="./../flight_modes_mc/manual_stabilized.html">Stabilized mode</a> with some rolling and pitching to all directions and some increased throttle periods. 전체 시간은 30초를 넘지 않아도 됩니다. In order to better compare, the manoeuvre should be similar in all tests.</p><p>First tune the gyro filter <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_CUTOFF">IMU_GYRO_CUTOFF</a> by increasing it in steps of 10 Hz while using a low D-term filter value (<a href="./../advanced_config/parameter_reference.html#IMU_DGYRO_CUTOFF">IMU_DGYRO_CUTOFF</a> = 30). Upload the logs to <a href="https://logs.px4.io" target="_blank" rel="noreferrer">Flight Review</a> and compare the <em>Actuator Controls FFT</em> plot. 노이즈가 눈에 띄게 증가하기 전에 차단 주파수를 설정하십시오 (60Hz 주변 및 그 이상의 주파수).</p><p>Then tune the D-term filter (<code>IMU_DGYRO_CUTOFF</code>) in the same way. Note that there can be negative impacts on performance if <code>IMU_GYRO_CUTOFF</code> and <code>IMU_DGYRO_CUTOFF</code> are set too far apart (the differences have to be significant though - e.g. D=15, gyro=80).</p><p>Below is an example for three different <code>IMU_DGYRO_CUTOFF</code> filter values (40Hz, 70Hz, 90Hz). 90Hz에서는 일반적인 소음이 증가하기 시작하므로 (특히 롤의 경우) 차단 주파수 70Hz가 안전합니다. <img src="'+t+'" alt="IMUDGYROCUTOFF=40"><img src="'+a+'" alt="IMUDGYROCUTOFF=70"><img src="'+r+'" alt="IMUDGYROCUTOFF=90"></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The plot cannot be compared between different vehicles, as the y axis scale can be different. 동일한 기체에서 일관적이며 비행 시간과는 무관합니다.</p></div><p>아래 다이어그램에 표시된 것과 같이 비행 플롯에 상당한 저주파 스파이크가 나타되는 경우에는 노치 필터를 사용하여 제거할 수 있습니다. In this case you might use the settings: <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_NF0_FRQ">IMU_GYRO_NF0_FRQ=32</a> and <a href="./../advanced_config/parameter_reference.html#IMU_GYRO_NF0_BW">IMU_GYRO_NF0_BW=5</a> (note, this spike is narrower than usual). 저역 통과 필터와 노치 필터는 독립적으로 조정할 수 있습니다 (즉, 저역 통과 필터를 조정하기 전에 노치 필터를 설정할 필요는 없습니다).</p><p><img src="'+o+'" alt="IMUGYRONF0FRQ=32 IMUGYRONF0BW=5"></p><h2 id="추가-팁" tabindex="-1">추가 팁 <a class="header-anchor" href="#추가-팁" aria-label="Permalink to &quot;추가 팁&quot;">​</a></h2><ol><li><p>허용 가능한 지연 시간은 기체 크기와 기대치에 따라 달라집니다. FPV racers typically tune for the absolute minimal latency (as a ballpark <code>IMU_GYRO_CUTOFF</code> around 120, <code>IMU_DGYRO_CUTOFF</code> of 50 to 80). For bigger vehicles latency is less critical and <code>IMU_GYRO_CUTOFF</code> of around 80 might be acceptable.</p></li><li><p>You can start tuning at higher <code>IMU_GYRO_CUTOFF</code> values (e.g. 100Hz), which might be desirable because the default tuning of <code>IMU_GYRO_CUTOFF</code> is set very low (30Hz). 유일한 주의 사항은 위험을 알고 있어야한다는 것입니다.</p><ul><li>20 ~ 30 초 이상 비행하지 마십시오</li><li>모터가 과열되지 않는 지 확인하십시오.</li><li>위의 설명처럼 이상한 소리와 과도한 소음을 체크하십시오.</li></ul></li></ol>',52)]))}const b=i(c,[["render",h]]);export{F as __pageData,b as default};
