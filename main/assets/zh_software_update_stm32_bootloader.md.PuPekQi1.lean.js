import{_ as i,c as a,a8 as e,o as t}from"./chunks/framework.BDnHobkS.js";const F=JSON.parse('{"title":"STM32 Bootloader","description":"","frontmatter":{},"headers":[],"relativePath":"zh/software_update/stm32_bootloader.md","filePath":"zh/software_update/stm32_bootloader.md"}'),l={name:"zh/software_update/stm32_bootloader.md"};function n(h,s,p,r,k,o){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="stm32-bootloader" tabindex="-1">STM32 Bootloader <a class="header-anchor" href="#stm32-bootloader" aria-label="Permalink to &quot;STM32 Bootloader&quot;">​</a></h1><p>The code for the PX4 bootloader is available from the Github <a href="https://github.com/px4/bootloader" target="_blank" rel="noreferrer">Bootloader</a> repository.</p><h2 id="支持的飞控板" tabindex="-1">支持的飞控板 <a class="header-anchor" href="#支持的飞控板" aria-label="Permalink to &quot;支持的飞控板&quot;">​</a></h2><ul><li>FMUv2 (Pixhawk 1, STM32F4)</li><li>FMUv3 (Pixhawk 2, STM32F4)</li><li>FMUv4 (Pixracer 3 and Pixhawk 3 Pro, STM32F4)</li><li>FMUv5 (Pixhawk 4, STM32F7)</li><li>TAPv1 (TBA, STM32F4)</li><li>ASCv1 (TBA, STM32F4)</li></ul><h2 id="构建-bootloader" tabindex="-1">构建 Bootloader <a class="header-anchor" href="#构建-bootloader" aria-label="Permalink to &quot;构建 Bootloader&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/PX4/Bootloader.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Bootloader</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> submodule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> submodule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span></code></pre></div><p>在此步骤之后，所有支持的主板的 elf 文件范围都出现在引导 Bootloader 目录中。</p><h2 id="刷写-bootloader" tabindex="-1">刷写 Bootloader <a class="header-anchor" href="#刷写-bootloader" aria-label="Permalink to &quot;刷写 Bootloader&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>The right power sequence is critical for some boards to allow JTAG / SWD access. 其他 JTAG 仿真器需要不同但相似的步骤。</p></div><p>The instructions below are valid for a Blackmagic / Dronecode probe. Other JTAG probes will need different but similar steps. Developers attempting to flash the bootloader should have the required knowledge. If you do not know how to do this you probably should reconsider if you really need to change anything about the bootloader.</p><p>这些指令适用于<a href="https://www.segger.com/jlink-gdb-server.html"> J-Link GDB server</a>。</p><ol><li>断开 JTAG 电缆的连接</li><li>连接 USB 电源线</li><li>连接 JTAG 电缆</li></ol><h3 id="黑魔法-无人机探测器" tabindex="-1">黑魔法/无人机探测器 <a class="header-anchor" href="#黑魔法-无人机探测器" aria-label="Permalink to &quot;黑魔法/无人机探测器&quot;">​</a></h3><h4 id="使用正确的串行端口" tabindex="-1">使用正确的串行端口 <a class="header-anchor" href="#使用正确的串行端口" aria-label="Permalink to &quot;使用正确的串行端口&quot;">​</a></h4><ul><li>On LINUX: <code>/dev/serial/by-id/usb-Black_Sphere_XXX-if00</code></li><li>On MAC OS: Make sure to use the cu.xxx port, not the tty.xxx port: <code>tar ext /dev/tty.usbmodemDDEasdf</code></li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arm-none-eabi-gdb</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ext</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/serial/by-id/usb-Black_Sphere_XXX-if00</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swdp_scan</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attach</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> option</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> erase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> erase_mass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tapv1_bl.elf</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Transfer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KB/sec,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 828</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes/write.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kill</span></span></code></pre></div><h3 id="j-link" tabindex="-1">J-Link <a class="header-anchor" href="#j-link" aria-label="Permalink to &quot;J-Link&quot;">​</a></h3><p>These instructions are for the <a href="https://www.segger.com/jlink-gdb-server.html" target="_blank" rel="noreferrer">J-Link GDB server</a>.</p><h4 id="系统必备组件" tabindex="-1">系统必备组件 <a class="header-anchor" href="#系统必备组件" aria-label="Permalink to &quot;系统必备组件&quot;">​</a></h4><p><a href="https://www.segger.com/downloads/jlink" target="_blank" rel="noreferrer">Download the J-Link software</a> from the Segger website and install it according to their instructions.</p><h4 id="运行-jlink-gdb-服务器" tabindex="-1">运行 JLink GDB 服务器 <a class="header-anchor" href="#运行-jlink-gdb-服务器" aria-label="Permalink to &quot;运行 JLink GDB 服务器&quot;">​</a></h4><p>常见目标的 <code>--device</code>/SoC是：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">JLinkGDBServer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -select</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> USB=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -device</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> STM32F427VI</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SWD-DP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -speed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20000</span></span></code></pre></div><p>The <code>--device</code>/SoC for common targets is:</p><ul><li><strong>FMUv2, FMUv3, FMUv4, aerofc-v1, mindpx-v2:</strong> STM32F427VI</li><li><strong>px4_fmu-v4pro:</strong> STM32F469II</li><li><strong>px4_fmu-v5:</strong> STM32F765II</li><li><strong>crazyflie:</strong> STM32F405RG</li></ul><h4 id="连接-gdb" tabindex="-1">连接 GDB <a class="header-anchor" href="#连接-gdb" aria-label="Permalink to &quot;连接 GDB&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arm-none-eabi-gdb</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ext</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :2331</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aerofcv1_bl.elf</span></span></code></pre></div><h3 id="故障处理" tabindex="-1">故障处理 <a class="header-anchor" href="#故障处理" aria-label="Permalink to &quot;故障处理&quot;">​</a></h3><p>If any of the commands above are not found, you are either not using a Blackmagic probe or its software is outdated. Upgrade the on-probe software first.</p><p>断开目标连接（同时保持 JTAG 连接）并运行</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Error erasing flash with vFlashErase packet</span></span></code></pre></div><p>这将禁用目标供电并尝试另一个闪光周期。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tpwr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">swdp_scan</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attach</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tapv1_bl.elf</span></span></code></pre></div><p>This will disable target powering and attempt another flash cycle.</p>`,34)]))}const g=i(l,[["render",n]]);export{F as __pageData,g as default};
