import{_ as a,a as t,b as i,c as o,d as n,e as r,f as s}from"./chunks/gnd_effect.BxqYXZzq.js";import{_ as l,c as h,a8 as d,o as c}from"./chunks/framework.BDnHobkS.js";const F=JSON.parse('{"title":"ECL EKF 사용","description":"","frontmatter":{},"headers":[],"relativePath":"ko/advanced_config/tuning_the_ecl_ekf.md","filePath":"ko/advanced_config/tuning_the_ecl_ekf.md"}'),m={name:"ko/advanced_config/tuning_the_ecl_ekf.md"};function p(f,e,u,g,_,b){return c(),h("div",null,e[0]||(e[0]=[d(`<h1 id="ecl-ekf-사용" tabindex="-1">ECL EKF 사용 <a class="header-anchor" href="#ecl-ekf-사용" aria-label="Permalink to &quot;ECL EKF 사용&quot;">​</a></h1><p>이 섹션은 ECL EKF 알고리즘에 관한 질문에 대한 답변들입니다.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The <a href="https://youtu.be/HkYRJJoyBwQ" target="_blank" rel="noreferrer">PX4 State Estimation Overview</a> video from the <em>PX4 Developer Summit 2019</em> (Dr. Paul Riseborough) provides an overview of the estimator, and additionally describes both the major changes from 2018/2019, and the expected improvements through 2020.</p></div><h2 id="ecl-ekf는-무엇입니까" tabindex="-1">ECL EKF는 무엇입니까? <a class="header-anchor" href="#ecl-ekf는-무엇입니까" aria-label="Permalink to &quot;ECL EKF는 무엇입니까?&quot;">​</a></h2><p>ECL(Estimation and Control Library)은 EKF(Extended Kalman Filter) 알고리즘으로 센서 측정 데이터를 처리하여 상태의 추정치를 제공합니다.</p><ul><li>북쪽, 동쪽, 아래쪽 지역 지구 프레임에서 X, Y, Z 본체의 회전을 정의하는 쿼터니언</li><li>IMU의 속도 - 북쪽, 동쪽, 아래쪽 (m/s)</li><li>IMU에서의 위치 - 북쪽, 동쪽, 아래쪽 (m)</li><li>IMU 델타 각도 편향 추정값 - X, Y, Z (rad)</li><li>IMU 델타 속도 바이어스 추정값 - X, Y, Z (m/s)</li><li>지구 자기장 요소 - 북쪽, 동쪽, 아래쪽 (gauss)</li><li>기체 프레임 자기장 바이어스 - X,Y,Z (gauss)</li><li>풍속 - 북쪽, 동쪽 (m/s)</li></ul><p>EKF는 IMU와 관련된 각 측정에서 다른 시간 지연을 허용하기 위하여, 지연된 &#39;융합 시간 지평&#39;에서 실행됩니다. 각 센서의 데이터는 FIFO 버퍼링되고, EKF에 의해 버퍼에서 검색되어 적절한 시간에 사용됩니다. The delay compensation for each sensor is controlled by the <a href="./../advanced_config/parameter_reference.html#ekf2">EKF2_*_DELAY</a> parameters.</p><p>보완 필터는 버퍼링 된 IMU 데이터를 사용하여 &#39;퓨전 시간 수평선&#39;에서 현재 시간으로 상태를 전달하는 데 사용됩니다. The time constant for this filter is controlled by the <a href="./../advanced_config/parameter_reference.html#EKF2_TAU_VEL">EKF2_TAU_VEL</a> and <a href="./../advanced_config/parameter_reference.html#EKF2_TAU_POS">EKF2_TAU_POS</a> parameters.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The &#39;fusion time horizon&#39; delay and length of the buffers is determined by the largest of the <code>EKF2_*_DELAY</code> parameters. 센서를 사용하지 않는 경우에는 시간 지연을 0으로 설정하는 것이 좋습니다. &#39;퓨전 시간 지평&#39; 지연을 줄이면 상태를 현재 시간으로 전달하는 데 사용되는 보완 필터의 오류가 줄어 듭니다.</p></div><p>위치와 속도 상태는 제어 루프로 출력되기 전에 IMU와 본체 프레임 간의 오프셋을 고려하여 조정됩니다. The position of the IMU relative to the body frame is set by the <code>EKF2_IMU_POS_X,Y,Z</code> parameters.</p><p>EKF는 상태 예측에만 IMU 데이터를 사용합니다. IMU 데이터는 EKF 유도에서 관측치로 사용되지 않습니다. The algebraic equations for the covariance prediction, state update and covariance update were derived using the Matlab symbolic toolbox and can be found here: <a href="https://github.com/PX4/PX4-ECL/blob/master/EKF/matlab/scripts/Terrain%20Estimator/GenerateEquationsTerrainEstimator.m" target="_blank" rel="noreferrer">Matlab Symbolic Derivation</a>.</p><h2 id="단일-ekf-인스턴스-실행" tabindex="-1">단일 EKF 인스턴스 실행 <a class="header-anchor" href="#단일-ekf-인스턴스-실행" aria-label="Permalink to &quot;단일 EKF 인스턴스 실행&quot;">​</a></h2><p>The <em>default behaviour</em> is to run a single instance of the EKF. 이 경우 센서 선택 및 페일 오버는 EKF에서 데이터를 수신하기 전에 수행됩니다. 이는 데이터 손실과 같은 제한된 수의 센서 오류에 대한 보호를 제공하지만, EKF 및 제어 루프의 보상 능력을 초과하는 부정확한 데이터를 제공하는 센서에 대해서는 보호하지 않습니다.</p><p>단일 EKF 인스턴스를 실행하기위한 매개 변수는 다음과 같습니다.</p><ul><li><a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_IMU">EKF2_MULTI_IMU</a> = 0</li><li><a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_MAG">EKF2_MULTI_MAG</a> = 0</li><li><a href="./../advanced_config/parameter_reference.html#SENS_IMU_MODE">SENS_IMU_MODE</a> = 1</li><li><a href="./../advanced_config/parameter_reference.html#SENS_MAG_MODE">SENS_MAG_MODE</a> = 1</li></ul><h2 id="다중-ekf-인스턴스-실행" tabindex="-1">다중 EKF 인스턴스 실행 <a class="header-anchor" href="#다중-ekf-인스턴스-실행" aria-label="Permalink to &quot;다중 EKF 인스턴스 실행&quot;">​</a></h2><p>IMU와 자력계의 갯수와 자동조종장치의 CPU 용량에 따라 EKF 다중 인스턴스를 실행이 가능합니다. 이는 광범위한 센서 오류에 대한 보호를 제공하며, 서로 다른 센서 조합을 사용하는 EKF 인스턴스에서 달성됩니다. EKF 인스턴스의 내부 일관성을 비교함으로써 EKF 선택기는 최상의 데이터 일관성으로 EKF와 센서 조합을 결정할 수 있습니다. 이를 통하여 IMU 바이어스의 갑작스런 변화, 포화 또는 고착된 데이터 등과 같은 오류를 감지하고 격리할 수 있습니다.</p><p>The total number of EKF instances is the product of the number of IMU&#39;s and number of magnetometers selected by <a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_IMU">EKF2_MULTI_IMU</a> and <a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_MAG">EKF2_MULTI_MAG</a> and is given by the following formula:</p><blockquote><p>N_instances = MAX(<a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_IMU">EKF2_MULTI_IMU</a> , 1) x MAX(<a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_MAG">EKF2_MULTI_MAG</a> , 1)</p></blockquote><p>예를 들어, 2 개의 IMU와 2 개의 자력계가 있는 자동조종장치는 각 인스턴스가 다음 센서 조합을 사용하는 총 4 개의 EKF 인스턴스에 대해 EKF2_MULTI_IMU = 2와 EKF2_MULTI_MAG = 2로 실행할 수 있습니다.</p><ul><li>EKF 인스턴스 1 : IMU 1, 자력계 1</li><li>EKF 인스턴스 2 : IMU 1, 자력계 2</li><li>EKF 인스턴스 3 : IMU 2, 자력계 1</li><li>EKF 인스턴스 4 : IMU 2, 자력계 2</li></ul><p>처리 가능한 IMU 또는 자력계 센서의 최대 갯수는 이론상 최대 4 x 4 = 16 EKF 인스턴스에 대해 각각 4 개입니다. 실제적으로는, 사용 가능한 컴퓨팅 리소스에 의해 제한됩니다. 이 기능을 개발하는 동안 STM32F7 CPU 기반 HW를 사용한 테스트에서 허용 가능한 처리로드 및 메모리 사용률을 가진 4 개의 EKF 인스턴스가 입증되었습니다.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Ground based testing to check CPU and memory utilisation should be performed before flying.</p></div><p>If <a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_IMU">EKF2_MULTI_IMU</a> &gt;= 3, then the failover time for large rate gyro errors is further reduced because the EKF selector is able to apply a median select strategy for faster isolation of the faulty IMU.</p><p>다중 EKF 인스턴스에 대한 설정은 다음 매개변수로 제어됩니다.</p><ul><li><p><a href="./../advanced_config/parameter_reference.html#SENS_IMU_MODE">SENS_IMU_MODE</a>: Set to 0 if running multiple EKF instances with IMU sensor diversity, ie <a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_IMU">EKF2_MULTI_IMU</a> &gt; 1.</p><p>1 (단일 EKF 작동의 기본값)로 설정하면 센서 모듈이 EKF에서 사용하는 IMU 데이터를 선택합니다. 이것은 센서의 데이터 손실에 대한 보호 기능를 제공하지만, 잘못된 센서 데이터에 대해서는 보호하지 않습니다. 0으로 설정하면 센서 모듈이 선택하지 않습니다.</p></li><li><p><a href="./../advanced_config/parameter_reference.html#SENS_MAG_MODE">SENS_MAG_MODE</a>: Set to 0 if running multiple EKF instances with magnetometer sensor diversity, ie <a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_MAG">EKF2_MULTI_MAG</a> &gt; 1.</p><p>1 (단일 EKF 작동의 기본값)로 설정하면 센서 모듈이 EKF에서 사용하는 자력계 데이터를 선택합니다. 이것은 센서의 데이터 손실에 대한 보호 기능를 제공하지만, 잘못된 센서 데이터에 대해서는 보호하지 않습니다. 0으로 설정하면 센서 모듈이 선택하지 않습니다.</p></li><li><p><a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_IMU">EKF2_MULTI_IMU</a>: This parameter specifies the number of IMU sensors used by the multiple EKF&#39;s. If <code>EKF2_MULTI_IMU</code> &lt;= 1, then only the first IMU sensor will be used. When <a href="./../advanced_config/parameter_reference.html#SENS_IMU_MODE">SENS_IMU_MODE</a> = 1, this will be the sensor selected by the sensor module. If <code>EKF2_MULTI_IMU</code> &gt;= 2, then a separate EKF instance will run for the specified number of IMU sensors up to the lesser of 4 or the number of IMU&#39;s present.</p></li><li><p><a href="./../advanced_config/parameter_reference.html#EKF2_MULTI_MAG">EKF2_MULTI_MAG</a>: This parameter specifies the number of magnetometer sensors used by the multiple EKF&#39;s If <code>EKF2_MULTI_MAG</code> &lt;= 1, then only the first magnetometer sensor will be used. When <a href="./../advanced_config/parameter_reference.html#SENS_MAG_MODE">SENS_MAG_MODE</a> = 1, this will be the sensor selected by the sensor module. If <code>EKF2_MULTI_MAG</code> &gt;= 2, then a separate EKF instance will run for the specified number of magnetometer sensors up to the lesser of 4 or the number of magnetometers present.</p></li></ul><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The recording and <a href="./../debug/system_wide_replay.html#ekf2-replay">EKF2 replay</a> of flight logs with multiple EKF instances is not supported. To enable recording for EKF replay you must set the parameters to enable a <a href="#running-a-single-ekf-instance">single EKF instance</a>.</p></div><h2 id="ekf는-어떤-센서-측정값을-사용하나요" tabindex="-1">EKF는 어떤 센서 측정값을 사용하나요? <a class="header-anchor" href="#ekf는-어떤-센서-측정값을-사용하나요" aria-label="Permalink to &quot;EKF는 어떤 센서 측정값을 사용하나요?&quot;">​</a></h2><p>EKF에는 다양한 센서 측정 조합으로 작동하는 여러가지 모드가 있습니다. 시작시 필터는 센서의 최소 가능한 조합을 확인하고 초기 기울기, 편 요각 및 높이 정렬이 완료된 후 회전, 수직 속도, 수직 위치, IMU 델타 각도 바이어스 및 IMU 델타 속도 바이어스 추정치를 제공하는 모드로 들어갑니다.</p><p>이 모드에는 IMU 데이터, 요(자기계 또는 외부 비전) 소스와 고도 데이터 소스가 필요합니다. 이 최소 데이터 세트는 모든 EKF 모드에 필요합니다. 그런 다음 다른 센서 데이터를 사용하여 추가 상태를 추정할 수 있습니다.</p><h3 id="관성-센서" tabindex="-1">관성 센서 <a class="header-anchor" href="#관성-센서" aria-label="Permalink to &quot;관성 센서&quot;">​</a></h3><ul><li>3축 본체 고정 관성 측정 장치 델타 각도와 최소 속도 100Hz의 델타 속도 데이터. Note: 원뿔 보정은 EKF에서 사용하기 전에 IMU 델타 각도 데이터에 적용되어야 합니다.</li></ul><h3 id="자기-센서" tabindex="-1">자기 센서 <a class="header-anchor" href="#자기-센서" aria-label="Permalink to &quot;자기 센서&quot;">​</a></h3><p>최소 5Hz 속도의 3축 본체 고정 자력계 데이터 (또는 외부 비전 시스템 포즈 데이터)가 필요합니다.</p><p>자력계 데이터는 두 가지 방법으로 사용할 수 있습니다.</p><ul><li>자력계는 기울기 추정과 자기 편각을 사용하여 요 각도를 측정합니다. The yaw angle is then used as an observation by the EKF. <ul><li>이 방법은 정확도가 떨어지고, 본체 필드 오프셋의 학습을 허용하지 않지만, 자기 이상과 대규모 스타트업 자이로 바이어스에 더 강력합니다.</li><li>지상에서 시동에 사용되는 기본 방법입니다.</li></ul></li><li>XYZ 자력계 판독 값은 별도의 관측치로 사용됩니다. <ul><li>This method is more accurate but requires that the magnetometer biases are correctly estimated. <ul><li>The biases are observable while the drone is rotating and the true heading is observable when the vehicle is accelerating (linear acceleration).</li><li>Since the biases can change and are only observable when moving, it is safer to switch back to heading fusion when not moving.</li></ul></li><li>It assumes the earth magnetic field environment only changes slowly and performs less well when there are significant external magnetic anomalies.</li><li>This is the default method used when the vehicle is moving.</li></ul></li></ul><p>The logic used to select these modes is set by the <a href="./../advanced_config/parameter_reference.html#EKF2_MAG_TYPE">EKF2_MAG_TYPE</a> parameter. The default &#39;Automatic&#39; mode (<code>EKF2_MAG_TYPE=0</code>) is recommended as it uses the more robust magnetometer yaw on the ground, and more accurate 3-axis magnetometer when moving. Setting &#39;3-axis&#39; mode all the time (<code>EKF2_MAG_TYPE=2</code>) is more error-prone, and requires that all the IMUs are well calibrated.</p><p>The option is available to operate without a magnetometer, either by replacing it using <a href="#yaw-measurements">yaw from a dual antenna GPS</a> or using the IMU measurements and GPS velocity data to <a href="#yaw-from-gps-velocity">estimate yaw from vehicle movement</a>.</p><h3 id="고도" tabindex="-1">고도 <a class="header-anchor" href="#고도" aria-label="Permalink to &quot;고도&quot;">​</a></h3><p>A source of height data - GPS, barometric pressure, range finder, external vision or a combination of those at a minimum rate of 5Hz is required.</p><p>If none of the selected measurements are present, the EKF will not start. 이러한 측정이 감지되면, EKF는 상태를 초기화하고 틸트와 요 정렬을 완료합니다. 틸트와 요 정렬이 완료되면 EKF는 추가 센서 데이터를 사용할 수 있는 모드로 전환할 수 있습니다.</p><p>Each height source can be enabled/disabled using its dedicated control parameter:</p><ul><li><a href="#gnss-gps">GNSS/GPS</a>: <a href="./../advanced_config/parameter_reference.html#EKF2_GPS_CTRL">EKF2_GPS_CTRL</a></li><li><a href="#barometer">Barometer</a>: <a href="./../advanced_config/parameter_reference.html#EKF2_BARO_CTRL">EKF2_BARO_CTRL</a></li><li><a href="#range-finder">Range finder</a>: <a href="./../advanced_config/parameter_reference.html#EKF2_RNG_CTRL">EKF2_RNG_CTRL</a></li><li><a href="#external-vision-system">External vision</a>: Enabled when <a href="./../advanced_config/parameter_reference.html#EKF2_HGT_REF">EKF2_HGT_REF</a> is set to &quot;Vision&quot;</li></ul><p>Over the long term the height estimate follows the &quot;reference source&quot; of height data. This reference is defined by the <a href="./../advanced_config/parameter_reference.html#EKF2_HGT_REF">EKF2_HGT_REF</a> parameter.</p><h4 id="typical-configurations" tabindex="-1">Typical configurations <a class="header-anchor" href="#typical-configurations" aria-label="Permalink to &quot;Typical configurations&quot;">​</a></h4><table tabindex="0"><thead><tr><th></th><th><a href="./../advanced_config/parameter_reference.html#EKF2_GPS_CTRL">EKF2_GPS_CTRL</a></th><th><a href="./../advanced_config/parameter_reference.html#EKF2_BARO_CTRL">EKF2_BARO_CTRL</a></th><th><a href="./../advanced_config/parameter_reference.html#EKF2_RNG_CTRL">EKF2_RNG_CTRL</a></th><th><a href="./../advanced_config/parameter_reference.html#EKF2_HGT_REF">EKF2_HGT_REF</a></th></tr></thead><tbody><tr><td>Outdoor (default)</td><td>7 (Lon/lat/alt/vel)</td><td>1 (enabled)</td><td>1 (<a href="#conditional-range-aiding">conditional</a>)</td><td>1 (GNSS)</td></tr><tr><td>Indoor (non-flat terrain)</td><td>0 (disabled)</td><td>1 (enabled)</td><td>1 (<a href="#conditional-range-aiding">conditional</a>)</td><td>2 (range)</td></tr><tr><td>Indoor (flat terrain)</td><td>0 (disabled)</td><td>1 (enabled)</td><td>2 (<a href="#range-height-fusion">always enabled</a>)</td><td>2 (range)</td></tr><tr><td>External vision</td><td>As required</td><td>As required</td><td>As required</td><td>3 (vision)</td></tr></tbody></table><h3 id="기압계" tabindex="-1">기압계 <a class="header-anchor" href="#기압계" aria-label="Permalink to &quot;기압계&quot;">​</a></h3><p>Enable/disable using <a href="./../advanced_config/parameter_reference.html#EKF2_BARO_CTRL">EKF2_BARO_CTRL</a> as a source for <a href="#height">Height</a> data.</p><p>Note that data from only one barometer is fused, even if multiple barometers are available. The barometer with the highest <a href="./../advanced_config/parameter_reference.html#CAL_BARO0_PRIO">CAL_BAROx_PRIO</a> priority value is selected first, falling back to the next highest priority barometer if a sensor fault is detected. If barometers have equal-highest priorities, the first detected is used. A barometer can be completely disabled as a possible source by setting its <code>CAL_BAROx_PRIO</code> value to <code>0</code> (disabled).</p><p>See <a href="#height">Height</a> more details about the configuration of height sources.</p><h4 id="정압-위치-오차-보정" tabindex="-1">정압 위치 오차 보정 <a class="header-anchor" href="#정압-위치-오차-보정" aria-label="Permalink to &quot;정압 위치 오차 보정&quot;">​</a></h4><p>기압 고도는 차량 풍속과 방향으로 인한 공기 역학적 장애로 인해 발생하는 오류가 존재합니다. This is known in aeronautics as <em>static pressure position error</em>. ECL/EKF2 추정기 라이브러리를 사용하는 EKF2 모듈은 풍속 상태 추정이 활성화된 경우, 오류 보상 방법을 제공합니다.</p><p>For vehicles operating in a fixed-wing mode, wind speed state estimation requires either <a href="#airspeed">Airspeed</a> and/or <a href="#synthetic-sideslip">Synthetic Sideslip</a> fusion to be enabled.</p><p>For multi-rotors, fusion of <a href="#mc_wind_estimation_using_drag">Drag Specific Forces</a> can be enabled and tuned to provide the required wind velocity state estimates.</p><p>The EKF2 module models the error as a body fixed ellipsoid that specifies the fraction of dynamic pressure that is added to/subtracted from the barometric pressure - before it is converted to a height estimate.</p><p>A good tuning is obtained as follows:</p><ol><li><p>Fly once in <a href="./../flight_modes_mc/position.html">Position mode</a> repeatedly forwards/backwards/left/right/up/down between rest and maximum speed (best results are obtained when this testing is conducted in still conditions).</p></li><li><p>Extract the <code>.ulg</code> log file using, for example, <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/analyze_view/log_download.html" target="_blank" rel="noreferrer">QGroundControl: Analyze &gt; Log Download</a></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The same log file can be used to tune the <a href="#mc_wind_estimation_using_drag">multirotor wind estimator</a>.</p></div></li></ol><p>:::</p><ol start="3"><li>Use the log with the <a href="https://github.com/PX4/PX4-Autopilot/tree/main/src/modules/ekf2/EKF/python/tuning_tools/baro_static_pressure_compensation" target="_blank" rel="noreferrer">baro_static_pressure_compensation_tuning.py</a> Python script to obtain the optimal set of parameters.</li></ol><p>Tuning parameters:</p><ul><li><a href="./../advanced_config/parameter_reference.html#EKF2_PCOEF_XP">EKF2_PCOEF_XP</a></li><li><a href="./../advanced_config/parameter_reference.html#EKF2_PCOEF_XN">EKF2_PCOEF_XN</a></li><li><a href="./../advanced_config/parameter_reference.html#EKF2_PCOEF_YP">EKF2_PCOEF_YP</a></li><li><a href="./../advanced_config/parameter_reference.html#EKF2_PCOEF_YN">EKF2_PCOEF_YN</a></li><li><a href="./../advanced_config/parameter_reference.html#EKF2_PCOEF_Z">EKF2_PCOEF_Z</a></li></ul><h4 id="barometer-bias-compensation" tabindex="-1">Barometer bias compensation <a class="header-anchor" href="#barometer-bias-compensation" aria-label="Permalink to &quot;Barometer bias compensation&quot;">​</a></h4><p>A barometer at a constant altitude is subject to drift in its measurements due to changes in the ambient pressure environment or variations of the sensor temperature. To compensate for this measurement error, EKF2 estimates the bias using GNSS height (if available) a &quot;non drifting&quot; reference. No tuning is required.</p><h3 id="gnss-gps" tabindex="-1">GNSS/GPS <a class="header-anchor" href="#gnss-gps" aria-label="Permalink to &quot;GNSS/GPS&quot;">​</a></h3><h4 id="위치-및-속도-측정" tabindex="-1">위치 및 속도 측정 <a class="header-anchor" href="#위치-및-속도-측정" aria-label="Permalink to &quot;위치 및 속도 측정&quot;">​</a></h4><p>GPS measurements will be used for position and velocity if the following conditions are met:</p><ul><li>GPS use is enabled via setting of the <a href="./../advanced_config/parameter_reference.html#EKF2_GPS_CTRL">EKF2_GPS_CTRL</a> parameter.</li><li>GPS 품질 검사를 통과하였습니다. These checks are controlled by the <a href="./../advanced_config/parameter_reference.html#EKF2_GPS_CHECK">EKF2_GPS_CHECK</a> and <code>EKF2_REQ_*</code> parameters.</li></ul><p>For more details about the configuration of height sources, <a href="#height">click here</a>.</p><h4 id="방향-yaw-측정" tabindex="-1">방향(Yaw) 측정 <a class="header-anchor" href="#방향-yaw-측정" aria-label="Permalink to &quot;방향(Yaw) 측정&quot;">​</a></h4><p>Some GPS receivers such as the <a href="https://www.trimble.com/Precision-GNSS/MB-Two-Board.aspx" target="_blank" rel="noreferrer">Trimble MB-Two RTK GPS receiver</a> can be used to provide a heading measurement that replaces the use of magnetometer data. This can be a significant advantage when operating in an environment where large magnetic anomalies are present, or at latitudes here the earth&#39;s magnetic field has a high inclination. Use of GPS yaw measurements is enabled by setting bit position 3 to 1 (adding 8) in the <a href="./../advanced_config/parameter_reference.html#EKF2_GPS_CTRL">EKF2_GPS_CTRL</a> parameter.</p><h4 id="gps-방향-측정" tabindex="-1">GPS 방향 측정 <a class="header-anchor" href="#gps-방향-측정" aria-label="Permalink to &quot;GPS 방향 측정&quot;">​</a></h4><p>The EKF runs an additional multi-hypothesis filter internally that uses multiple 3-state Extended Kalman Filters (EKF&#39;s) whose states are NE velocity and yaw angle. These individual yaw angle estimates are then combined using a Gaussian Sum Filter (GSF). The individual 3-state EKF&#39;s use IMU and GPS horizontal velocity data (plus optional airspeed data) and do not rely on any prior knowledge of the yaw angle or magnetometer measurements. This provides a backup to the yaw from the main filter and is used to reset the yaw for the main 24-state EKF when a post-takeoff loss of navigation indicates that the yaw estimate from the magnetometer is bad. This will result in an <code>Emergency yaw reset - magnetometer use stopped</code> message information message at the GCS.</p><p>Data from this estimator is logged when ekf2 replay logging is enabled and can be viewed in the <code>yaw_estimator_status</code> message. The individual yaw estimates from the individual 3-state EKF yaw estimators are in the <code>yaw</code> fields. The GSF combined yaw estimate is in the <code>yaw_composite</code> field. The variance for the GSF yaw estimate is in the <code>yaw_variance</code> field. All angles are in radians. Weightings applied by the GSF to the individual 3-state EKF outputs are in the<code>weight</code> fields.</p><p>This also makes it possible to operate without any magnetometer data or dual antenna GPS receiver for yaw provided some horizontal movement after takeoff can be performed to enable the yaw to become observable. To use this feature, set <a href="./../advanced_config/parameter_reference.html#EKF2_MAG_TYPE">EKF2_MAG_TYPE</a> to <code>none</code> (5) to disable magnetometer use. Once the vehicle has performed sufficient horizontal movement to make the yaw observable, the main 24-state EKF will align it&#39;s yaw to the GSF estimate and commence use of GPS.</p><h4 id="이중-수신기" tabindex="-1">이중 수신기 <a class="header-anchor" href="#이중-수신기" aria-label="Permalink to &quot;이중 수신기&quot;">​</a></h4><p>Data from GPS receivers can be blended using an algorithm that weights data based on reported accuracy (this works best if both receivers output data at the same rate and use the same accuracy). The mechanism also provides automatic failover if data from a receiver is lost (it allows, for example, a standard GPS to be used as a backup to a more accurate RTK receiver). This is controlled by the <a href="./../advanced_config/parameter_reference.html#SENS_GPS_MASK">SENS_GPS_MASK</a> parameter.</p><p>The <a href="./../advanced_config/parameter_reference.html#SENS_GPS_MASK">SENS_GPS_MASK</a> parameter is set by default to disable blending and always use the first receiver, so it will have to be set to select which receiver accuracy metrics are used to decide how much each receiver output contributes to the blended solution. Where different receiver models are used, it is important that the <a href="./../advanced_config/parameter_reference.html#SENS_GPS_MASK">SENS_GPS_MASK</a> parameter is set to a value that uses accuracy metrics that are supported by both receivers. For example do not set bit position 0 to <code>true</code> unless the drivers for both receivers publish values in the <code>s_variance_m_s</code> field of the <code>vehicle_gps_position</code> message that are comparable. This can be difficult with receivers from different manufacturers due to the different way that accuracy is defined, e.g. CEP vs 1-sigma, etc.</p><p>The following items should be checked during setup:</p><ul><li>두 번째 수신기의 데이터가 있는 지 확인합니다. This will be logged as <code>vehicle_gps_position_1</code> and can also be checked when connected via the <em>nsh console</em> using the command <code>listener vehicle_gps_position -i 1</code>. The <a href="./../advanced_config/parameter_reference.html#GPS_2_CONFIG">GPS_2_CONFIG</a> parameter will need to be set correctly.</li><li>Check the <code>s_variance_m_s</code>, <code>eph</code> and <code>epv</code> data from each receiver and decide which accuracy metrics can be used. If both receivers output sensible <code>s_variance_m_s</code> and <code>eph</code> data, and GPS vertical position is not being used directly for navigation, then setting <a href="./../advanced_config/parameter_reference.html#SENS_GPS_MASK">SENS_GPS_MASK</a> to 3 is recommended. Where only <code>eph</code> data is available and both receivers do not output <code>s_variance_m_s</code> data, set <a href="./../advanced_config/parameter_reference.html#SENS_GPS_MASK">SENS_GPS_MASK</a> to 2. Bit position 2 would only be set if the GPS had been selected as the reference height source with the <a href="./../advanced_config/parameter_reference.html#EKF2_HGT_REF">EKF2_HGT_REF</a> parameter and both receivers output sensible <code>epv</code> data.</li><li>The output from the blended receiver data is logged as <code>ekf_gps_position</code>, and can be checked whilst connect via the nsh terminal using the command <code>listener ekf_gps_position</code>.</li><li>수신기가 다른 속도로 출력하는 경우에는 혼합 출력은 더 느린 수신기의 속도로 결정됩니다. 가능한 경우 수신기는 동일한 속도로 출력하도록 설정하는 것이 바람직합니다.</li></ul><h4 id="gnss-성능-요구-사항" tabindex="-1">GNSS 성능 요구 사항 <a class="header-anchor" href="#gnss-성능-요구-사항" aria-label="Permalink to &quot;GNSS 성능 요구 사항&quot;">​</a></h4><p>For the ECL to accept GNSS data for navigation, certain minimum requirements need to be satisfied over a period of time, defined by <a href="./../advanced_config/parameter_reference.html#EKF2_REQ_GPS_H">EKF2_REQ_GPS_H</a> (10 seconds by default).</p><p>Minima are defined in the <a href="./../advanced_config/parameter_reference.html#EKF2_REQ_EPH">EKF2_REQ_*</a> parameters and each check can be enabled/disabled using the <a href="./../advanced_config/parameter_reference.html#EKF2_GPS_CHECK">EKF2_GPS_CHECK</a> parameter.</p><p>The table below shows the different metrics directly reported or calculated from the GNSS data, and the minimum required values for the data to be used by ECL. In addition, the <em>Average Value</em> column shows typical values that might reasonably be obtained from a standard GNSS module (e.g. u-blox M8 series) - i.e. values that are considered good/acceptable.</p><table tabindex="0"><thead><tr><th>메트릭</th><th>최소 요구 사항</th><th>평균</th><th>단위</th><th>참고</th></tr></thead><tbody><tr><td>eph</td><td>&lt;&amp;nbsp;3 (<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_EPH">EKF2_REQ_EPH</a>)</td><td>0.8</td><td>m</td><td>수평 위치의 표준 편차</td></tr><tr><td>epv</td><td>&lt;&amp;nbsp;5 (<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_EPV">EKF2_REQ_EPV</a>)</td><td>1.5</td><td>m</td><td>수직 위치의 표준 편차</td></tr><tr><td>위성 개수</td><td>≥6&amp;nbsp;(<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_NSATS">EKF2_REQ_NSATS</a>)</td><td>14</td><td>-</td><td></td></tr><tr><td>sacc</td><td>&lt;&amp;nbsp;0.5 (<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_SACC">EKF2_REQ_SACC</a>)</td><td>0.2</td><td>m/s</td><td>수평 속도의 표준 편차</td></tr><tr><td>fix type</td><td>≥&amp;nbsp;3</td><td>4</td><td>-</td><td>0-1: 수정 없음, 2: 2D 수정, 3: 3D 수정, 4: RTCM 차등 코드, 5: Real-Time Kinematic, float, 6: Real-Time Kinematic, 고정, 8: 외삽</td></tr><tr><td>PDOP</td><td>&lt;&amp;nbsp;2.5 (<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_PDOP">EKF2_REQ_PDOP</a>)</td><td>1.0</td><td>-</td><td>정밀도의 위치 희석</td></tr><tr><td>hpos drift rate</td><td>&lt;&amp;nbsp;0.1 (<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_HDRIFT">EKF2_REQ_HDRIFT</a>)</td><td>0.01</td><td>m/s</td><td>보고된 GNSS 위치에서 계산된 드리프트 율 (정지시).</td></tr><tr><td>vpos drift rate</td><td>&lt;&amp;nbsp;0.2 (<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_VDRIFT">EKF2_REQ_VDRIFT</a>)</td><td>0.02</td><td>m/s</td><td>보고된 GNSS 고도에서 계산된 드리프트 율 (정지시).</td></tr><tr><td>hspd</td><td>&lt;&amp;nbsp;0.1 (<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_HDRIFT">EKF2_REQ_HDRIFT</a>)</td><td>0.01</td><td>m/s</td><td>보고된 GNSS 수평 속도의 필터링 크기.</td></tr><tr><td>vspd</td><td>&lt;&amp;nbsp;0.2 (<a href="./../advanced_config/parameter_reference.html#EKF2_REQ_VDRIFT">EKF2_REQ_VDRIFT</a>)</td><td>0.02</td><td>m/s</td><td>보고된 GNSS 수직 속도의 필터링 크기.</td></tr></tbody></table><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The <code>hpos_drift_rate</code>, <code>vpos_drift_rate</code> and <code>hspd</code> are calculated over a period of 10 seconds and published in the <code>ekf2_gps_drift</code> topic. Note that <code>ekf2_gps_drift</code> is not logged!</p></div><h3 id="거리-측정기" tabindex="-1">거리 측정기 <a class="header-anchor" href="#거리-측정기" aria-label="Permalink to &quot;거리 측정기&quot;">​</a></h3><p><a href="./../sensor/rangefinders.html">Range finder</a> distance to ground is used by a single state filter to estimate the vertical position of the terrain relative to the height datum.</p><p>The fusion modes of operation are controlled by <a href="./../advanced_config/parameter_reference.html#EKF2_RNG_CTRL">EKF2_RNG_CTRL</a>:</p><ol><li><a href="#conditional-range-aiding">Conditional range aiding</a></li><li><a href="#range-height-fusion">Range height fusion</a></li></ol><p>For more details about the configuration of height sources, <a href="#height">click here</a>.</p><h4 id="conditional-range-aiding" tabindex="-1">Conditional range aiding <a class="header-anchor" href="#conditional-range-aiding" aria-label="Permalink to &quot;Conditional range aiding&quot;">​</a></h4><p>Conditional range finder fusion (a.k.a. <em>Conditional range aid</em>) activates the range finder fusion for height estimation during low speed/low altitude operation (in addition to the other active height sources). If the range finder is set as the reference height source (using <a href="./../advanced_config/parameter_reference.html#EKF2_HGT_REF">EKF2_HGT_REF</a>), the other active height sources such as baro and GNSS altitude will adjust their measurement to match the readings of the range finder over time. When the conditions are not met to start range aiding, a secondary reference is automatically selected.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Switching between height references causes the absolute altitude estimate to drift over time. This isn&#39;t an issue when flying in position mode but can be problematic if the drone is supposed to fly a mission at a specific GNSS altitude. If the absolute altitude drift is unwanted, it is recommended to set the GNSS altitude as the height reference, even when using conditional range aid.</p></div><p>It is primarily intended for <em>takeoff and landing</em>, in cases where the barometer setup is such that interference from rotor wash is excessive and can corrupt EKF state estimates.</p><p>Range aid may also be used to improve altitude hold when the vehicle is stationary.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><a href="./../flying/terrain_following_holding.html#terrain_hold">Terrain Hold</a> is recommended over <em>Range Aid</em> for terrain holding. This is because terrain hold uses the normal ECL/EKF estimator for determining height, and this is generally more reliable than a distance sensor in most conditions.</p></div><p><em>Conditional range aid</em> is enabled by setting <a href="./../advanced_config/parameter_reference.html#EKF2_RNG_CTRL">EKF2_RNG_CTRL</a> = &quot;Enabled (conditional mode)&quot; (1).</p><p>It is further configured using the <code>EKF2_RNG_A_</code> parameters:</p><ul><li><a href="./../advanced_config/parameter_reference.html#EKF2_RNG_A_VMAX">EKF2_RNG_A_VMAX</a>: Maximum horizontal speed, above which range aid is disabled.</li><li><a href="./../advanced_config/parameter_reference.html#EKF2_RNG_A_HMAX">EKF2_RNG_A_HMAX</a>: Maximum height, above which range aid is disabled.</li><li><a href="./../advanced_config/parameter_reference.html#EKF2_RNG_A_IGATE">EKF2_RNG_A_IGATE</a>: Range aid consistency checks &quot;gate&quot; (a measure of the error before range aid is disabled).</li></ul><h4 id="range-height-fusion" tabindex="-1">Range height fusion <a class="header-anchor" href="#range-height-fusion" aria-label="Permalink to &quot;Range height fusion&quot;">​</a></h4><p>PX4 allows you to continuously fuse the range finder as a source of height (in any flight mode/vehicle type). This may be useful for applications when the vehicle is <em>guaranteed</em> to only fly over a near-flat surface (e.g. indoors).</p><p>When using a distance sensor as a height source, fliers should be aware:</p><ul><li><p>Flying over obstacles can lead to the estimator rejecting rangefinder data (due to internal data consistency checks), which can result in poor altitude holding while the estimator is relying purely on accelerometer estimates.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>This scenario might occur when a vehicle ascends a slope at a near-constant height above ground, because the rangefinder altitude does not change while that estimated from the accelerometer does. The EKF performs innovation consistency checks that take into account the error between measurement and current state as well as the estimated variance of the state and the variance of the measurement itself. If the checks fail the rangefinder data will be rejected, and the altitude will be estimated from the accelerometer and the other selected height sources (GNSS, baro, vision), if enabled and available After 5 seconds of inconsistent data if the distance sensor is the active source oh height data, the estimator resets the height state to match the current distance sensor data. If one or more other sources of height are active, the range finder is declared faulty and the estimator continues to estimate its height using the other sensors. The measurements might also become consistent again, for example, if the vehicle descends, or if the estimated height drifts to match the measured rangefinder height.</p></div></li></ul><p>:::</p><ul><li><p>The local NED origin will move up and down with ground level.</p></li><li><p>Rangefinder performance over uneven surfaces (e.g. trees) can be very poor, resulting in noisy and inconsistent data. This again leads to poor altitude hold.</p></li></ul><p>The feature is enabled by setting <a href="./../advanced_config/parameter_reference.html#EKF2_RNG_CTRL">EKF2_RNG_CTRL</a> to &quot;Enabled&quot; (2). To make the range finder the height reference when active, set: <a href="./../advanced_config/parameter_reference.html#EKF2_HGT_REF">EKF2_HGT_REF</a> to &quot;Range sensor&quot;.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>To enable the range finder fusion only when the drone is stationary (in order to benefit from a better altitude estimate during takeoff and landing) but not fuse the range finder the rest of the time, use the <a href="#conditional-range-aiding">conditional mode</a> (1) of <a href="./../advanced_config/parameter_reference.html#EKF2_RNG_CTRL">EKF2_RNG_CTRL</a>.</p></div><h4 id="range-finder-obstruction-detection" tabindex="-1">Range Finder Obstruction Detection <a class="header-anchor" href="#range-finder-obstruction-detection" aria-label="Permalink to &quot;Range Finder Obstruction Detection&quot;">​</a></h4><p>The EKF can detect whether the rangefinder path-to-ground is obstructed (perhaps by a payload) using a kinematic consistency check between the vertical velocity estimate and the numerical derivative of the range finder data. If the range finder is statistically inconsistent with EKF2, the sensor is rejected for the rest of the flight unless the statistical test passes again for at least 1 second at a vertical speed of 0.5m/s or more.</p><p>The check is only enabled when the rangefinder is not used as the primary height source, and is only active while the vehicle is not moving horizontally (as it assumes a static ground height).</p><p>For effective obstruction detection, the range finder noise parameter needs to be tightly tuned using flight data. The kinematic consistency gate parameter can then be adjusted to obtain the desired fault detection sensitivity.</p><p>Tuning parameters:</p><ul><li><a href="./../advanced_config/parameter_reference.html#EKF2_RNG_NOISE">EKF2_RNG_NOISE</a></li><li><a href="./../advanced_config/parameter_reference.html#EKF2_RNG_K_GATE">EKF2_RNG_K_GATE</a></li></ul><h3 id="항속센서-보정" tabindex="-1">항속센서 보정 <a class="header-anchor" href="#항속센서-보정" aria-label="Permalink to &quot;항속센서 보정&quot;">​</a></h3><p>Equivalent Airspeed (EAS) data can be used to estimate wind velocity and reduce drift when GPS is lost by setting <a href="./../advanced_config/parameter_reference.html#EKF2_ARSP_THR">EKF2_ARSP_THR</a> to a positive value. Airspeed data will be used when it exceeds the threshold set by a positive value for <a href="./../advanced_config/parameter_reference.html#EKF2_ARSP_THR">EKF2_ARSP_THR</a> and the vehicle type is not rotary wing.</p><h3 id="합성-사이드슬립" tabindex="-1">합성 사이드슬립 <a class="header-anchor" href="#합성-사이드슬립" aria-label="Permalink to &quot;합성 사이드슬립&quot;">​</a></h3><p>Fixed-wing platforms can take advantage of an assumed sideslip observation of zero to improve wind speed estimation and also enable wind speed estimation without an airspeed sensor. This is enabled by setting the <a href="./../advanced_config/parameter_reference.html#EKF2_FUSE_BETA">EKF2_FUSE_BETA</a> parameter to 1.</p><p><a id="mc_wind_estimation_using_drag"></a></p><h3 id="항력을-사용한-멀티콥터-바람-추정" tabindex="-1">항력을 사용한 멀티콥터 바람 추정 <a class="header-anchor" href="#항력을-사용한-멀티콥터-바람-추정" aria-label="Permalink to &quot;항력을 사용한 멀티콥터 바람 추정&quot;">​</a></h3><p>Multi-rotor platforms can take advantage of the relationship between airspeed and drag force along the X and Y body axes to estimate North/East components of wind velocity. This can be enabled using <a href="./../advanced_config/parameter_reference.html#EKF2_DRAG_CTRL">EKF2_DRAG_CTRL</a>.</p><p>The relationship between airspeed and specific force (IMU accelerometer measurements) along the X and Y body axes is controlled by the <a href="./../advanced_config/parameter_reference.html#EKF2_BCOEF_X">EKF2_BCOEF_X</a>, <a href="./../advanced_config/parameter_reference.html#EKF2_BCOEF_Y">EKF2_BCOEF_Y</a> and <a href="./../advanced_config/parameter_reference.html#EKF2_MCOEF">EKF2_MCOEF</a> parameters which set the ballistic coefficients for flight in the X and Y directions, and the momentum drag produced by the propellers, respectively. The amount of specific force observation noise is set by the <a href="./../advanced_config/parameter_reference.html#EKF2_DRAG_NOISE">EKF2_DRAG_NOISE</a> parameter.</p><p>A good tuning is obtained as follows:</p><ol><li>Fly once in <a href="./../flight_modes_mc/position.html">Position mode</a> repeatedly forwards/backwards/left/right/up/down between rest and maximum speed (best results are obtained when this testing is conducted in still conditions).</li><li>Extract the <strong>.ulg</strong> log file using, for example, <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/analyze_view/log_download.html" target="_blank" rel="noreferrer">QGroundControl: Analyze &gt; Log Download</a><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The same <strong>.ulg</strong> log file can also be used to tune the <a href="#correction-for-static-pressure-position-error">static pressure position error coefficients</a>.</p></div></li></ol><p>::: 3. Use the log with the <a href="https://github.com/PX4/PX4-Autopilot/tree/main/src/modules/ekf2/EKF/python/tuning_tools/mc_wind_estimator" target="_blank" rel="noreferrer">mc_wind_estimator_tuning.py</a> Python script to obtain the optimal set of parameters.</p><h3 id="광류-센서" tabindex="-1">광류 센서 <a class="header-anchor" href="#광류-센서" aria-label="Permalink to &quot;광류 센서&quot;">​</a></h3><p><a href="./../sensor/optical_flow.html">Optical flow</a> data will be used if the following conditions are met:</p><ul><li>유효한 거리 센서 데이터를 사용할 수 있습니다.</li><li><a href="./../advanced_config/parameter_reference.html#EKF2_OF_CTRL">EKF2_OF_CTRL</a> is set.</li><li>The quality metric returned by the flow sensor is greater than the minimum requirement set by the <a href="./../advanced_config/parameter_reference.html#EKF2_OF_QMIN">EKF2_OF_QMIN</a> parameter.</li></ul><h3 id="외부-비전-시스템" tabindex="-1">외부 비전 시스템 <a class="header-anchor" href="#외부-비전-시스템" aria-label="Permalink to &quot;외부 비전 시스템&quot;">​</a></h3><p>Position, velocity or orientation measurements from an external vision system, e.g. Vicon, can be used.</p><p>The measurements that are fused are configured by setting the appropriate bits of <a href="./../advanced_config/parameter_reference.html#EKF2_EV_CTRL">EKF2_EV_CTRL</a> to <code>true</code>:</p><ul><li><code>0</code>: Horizontal position data</li><li><code>1</code>: Vertical position data. Height sources may additionally be configured using <a href="./../advanced_config/parameter_reference.html#EKF2_HGT_REF">EKF2_HGT_REF</a> (see section <a href="#height">Height</a>).</li><li><code>2</code>: Velocity data</li><li><code>3</code>: Yaw data</li></ul><p>Note that if yaw data is used (bit 3) the heading is with respect to the external vision frame; otherwise the heading is relative to North.</p><p>The EKF considers uncertainty in the visual pose estimate. This uncertainty information can be sent via the covariance fields in the MAVLink <a href="https://mavlink.io/en/messages/common.html#ODOMETRY" target="_blank" rel="noreferrer">ODOMETRY</a> message or it can be set through the parameters <a href="./../advanced_config/parameter_reference.html#EKF2_EVP_NOISE">EKF2_EVP_NOISE</a>, <a href="./../advanced_config/parameter_reference.html#EKF2_EVV_NOISE">EKF2_EVV_NOISE</a> and <a href="./../advanced_config/parameter_reference.html#EKF2_EVA_NOISE">EKF2_EVA_NOISE</a>. You can choose the source of the uncertainty with <a href="./../advanced_config/parameter_reference.html#EKF2_EV_NOISE_MD">EKF2_EV_NOISE_MD</a>.</p><h2 id="ecl-라이브러리-ekf를-어떻게-사용합니까" tabindex="-1">ECL 라이브러리 EKF를 어떻게 사용합니까? <a class="header-anchor" href="#ecl-라이브러리-ekf를-어떻게-사용합니까" aria-label="Permalink to &quot;ECL 라이브러리 EKF를 어떻게 사용합니까?&quot;">​</a></h2><p>EKF2 is enabled by default (for more information see <a href="./../advanced/switching_state_estimators.html">Switching State Estimators</a> and <a href="./../advanced_config/parameter_reference.html#EKF2_EN">EKF2_EN</a>).</p><h2 id="다른-추정치들과-비교하여-ecl-ekf의-장단점은-무엇입니까" tabindex="-1">다른 추정치들과 비교하여 ecl EKF의 장단점은 무엇입니까? <a class="header-anchor" href="#다른-추정치들과-비교하여-ecl-ekf의-장단점은-무엇입니까" aria-label="Permalink to &quot;다른 추정치들과 비교하여 ecl EKF의 장단점은 무엇입니까?&quot;">​</a></h2><p>Like all estimators, much of the performance comes from the tuning to match sensor characteristics. Tuning is a compromise between accuracy and robustness and although we have attempted to provide a tune that meets the needs of most users, there will be applications where tuning changes are required.</p><p>For this reason, no claims for accuracy relative to the legacy combination of <code>attitude_estimator_q</code> + <code>local_position_estimator</code> have been made and the best choice of estimator will depend on the application and tuning.</p><h3 id="단점" tabindex="-1">단점 <a class="header-anchor" href="#단점" aria-label="Permalink to &quot;단점&quot;">​</a></h3><ul><li>ecl EKF는 확장칼만필터에 대한 이해와 탐색 문제를 적용한 튜닝이 필요한복잡한 알고리즘입니다. 따라서, 좋은 결과를 얻지 못한 사용자는 무엇을 변경해야하는지 파악하는 것이 더 어렵습니다.</li><li>ecl EKF는 더 많은 RAM과 플래시 공간을 사용합니다.</li><li>ecl EKF는 더 많은 로깅 공간을 사용합니다.</li></ul><h3 id="장점" tabindex="-1">장점 <a class="header-anchor" href="#장점" aria-label="Permalink to &quot;장점&quot;">​</a></h3><ul><li>ecl EKF는 시간 지연 매개변수가 올바르게 설정되면 동적 조작 중에 정확도를 향상을 위하여 서로 다른 시간 지연 및 데이터 속도를 가진 센서의 데이터를 융합할 수 있습니다.</li><li>ecl EKF는 다양한 유형의 센서들을 융합할 수 있습니다.</li><li>ecl EKF는 센서 데이터에서 통계적으로 중요한 불일치를 감지하여 센서의 오류를 진단합니다.</li><li>For fixed-wing operation, the ecl EKF estimates wind speed with or without an airspeed sensor and is able to use the estimated wind in combination with airspeed measurements and sideslip assumptions to extend the dead-reckoning time available if GPS is lost in flight.</li><li>ecl EKF는 비행 단계 사이에 큰 자세 변화를 경험하는 테일시터 및 기타 기체의 정확도를 향상시키는 3축 가속도계 바이어스를 추정합니다.</li><li>연합 아키텍처 (결합된 자세/위치/속도 추정)는 자세 추정이 모든 센서 측정의 이점을 누릴 수 있음을 의미합니다. 이것은 올바르게 튜닝된 경우 향상된 태도 추정을 위한 잠재력을 제공하여야 합니다.</li></ul><h2 id="ekf-성능을-어떻게-확인합니까" tabindex="-1">EKF 성능을 어떻게 확인합니까? <a class="header-anchor" href="#ekf-성능을-어떻게-확인합니까" aria-label="Permalink to &quot;EKF 성능을 어떻게 확인합니까?&quot;">​</a></h2><p>EKF outputs, states and status data are published to a number of uORB topics which are logged to the SD card during flight. The following guide assumes that data has been logged using the <em>.ulog file format</em>. The <strong>.ulog</strong> format data can be parsed in python by using the <a href="https://github.com/PX4/pyulog" target="_blank" rel="noreferrer">PX4 pyulog library</a>.</p><p>Most of the EKF data is found in the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorInnovations.msg" target="_blank" rel="noreferrer">EstimatorInnovations</a> and <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a> uORB messages that are logged to the .ulog file.</p><p>A python script that automatically generates analysis plots and metadata can be found <a href="https://github.com/PX4/PX4-Autopilot/blob/main/Tools/ecl_ekf/process_logdata_ekf.py" target="_blank" rel="noreferrer">here</a>. To use this script file, cd to the <code>Tools/ecl_ekf</code> directory and enter <code>python process_logdata_ekf.py &lt;log_file.ulg&gt;</code>. This saves performance metadata in a csv file named <strong>&lt;log_file&gt;.mdat.csv</strong> and plots in a pdf file named <code>&lt;log_file&gt;.pdf</code>.</p><p>Multiple log files in a directory can be analysed using the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/Tools/ecl_ekf/batch_process_logdata_ekf.py" target="_blank" rel="noreferrer">batch_process_logdata_ekf.py</a> script. When this has been done, the performance metadata files can be processed to provide a statistical assessment of the estimator performance across the population of logs using the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/Tools/ecl_ekf/batch_process_metadata_ekf.py" target="_blank" rel="noreferrer">batch_process_metadata_ekf.py</a> script.</p><h3 id="출력-데이터" tabindex="-1">출력 데이터 <a class="header-anchor" href="#출력-데이터" aria-label="Permalink to &quot;출력 데이터&quot;">​</a></h3><ul><li>Attitude output data is found in the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/VehicleAttitude.msg" target="_blank" rel="noreferrer">VehicleAttitude</a> message.</li><li>Local position output data is found in the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/VehicleLocalPosition.msg" target="_blank" rel="noreferrer">VehicleLocalPosition</a> message.</li><li>Global (WGS-84) output data is found in the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/VehicleGlobalPosition.msg" target="_blank" rel="noreferrer">VehicleGlobalPosition</a> message.</li><li>Wind velocity output data is found in the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/Wind.msg" target="_blank" rel="noreferrer">Wind.msg</a> message.</li></ul><h3 id="상태" tabindex="-1">상태 <a class="header-anchor" href="#상태" aria-label="Permalink to &quot;상태&quot;">​</a></h3><p>Refer to states[24] in <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStates.msg" target="_blank" rel="noreferrer">EstimatorStates</a>. The index map for states[24] is as follows:</p><ul><li>[0 ... 3] Quaternions</li><li>[4 ... 6] Velocity NED (m/s)</li><li>[7 ... 9] Position NED (m)</li><li>[10 ... 12] IMU delta angle bias XYZ (rad)</li><li>[13 ... 15] IMU delta velocity bias XYZ (m/s)</li><li>[16 ... 18] Earth magnetic field NED (gauss)</li><li>[19 ... 21] Body magnetic field XYZ (gauss)</li><li>[22 ... 23] Wind velocity NE (m/s)</li></ul><h3 id="상태-분산" tabindex="-1">상태 분산 <a class="header-anchor" href="#상태-분산" aria-label="Permalink to &quot;상태 분산&quot;">​</a></h3><p>Refer to covariances[24] in <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStates.msg" target="_blank" rel="noreferrer">EstimatorStates</a>. The index map for covariances[24] is as follows:</p><ul><li>[0 ... 3] Quaternions</li><li>[4 ... 6] Velocity NED (m/s)^2</li><li>[7 ... 9] Position NED (m^2)</li><li>[10 ... 12] IMU delta angle bias XYZ (rad^2)</li><li>[13 ... 15] IMU delta velocity bias XYZ (m/s)^2</li><li>[16 ... 18] Earth magnetic field NED (gauss^2)</li><li>[19 ... 21] Body magnetic field XYZ (gauss^2)</li><li>[22 ... 23] Wind velocity NE (m/s)^2</li></ul><h3 id="observation-innovations-innovation-variances" tabindex="-1">Observation Innovations &amp; Innovation Variances <a class="header-anchor" href="#observation-innovations-innovation-variances" aria-label="Permalink to &quot;Observation Innovations &amp; Innovation Variances&quot;">​</a></h3><p>The observation <code>estimator_innovations</code>, <code>estimator_innovation_variances</code>, and <code>estimator_innovation_test_ratios</code> message fields are defined in <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorInnovations.msg" target="_blank" rel="noreferrer">EstimatorInnovations.msg</a>. The messages all have the same field names/types (but different units).</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The messages have the same fields because they are generated from the same field definition. The <code># TOPICS</code> line (at the end of <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorInnovations.msg" target="_blank" rel="noreferrer">the file</a>) lists the names of the set of messages to be created):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># TOPICS estimator_innovations estimator_innovation_variances estimator_innovation_test_ratios</span></span></code></pre></div></div><p>Some of the observations are:</p><ul><li>Magnetometer XYZ (gauss, gauss^2) : <code>mag_field[3]</code></li><li>Yaw angle (rad, rad^2) : <code>heading</code></li><li>True Airspeed (m/s, (m/s)^2) : <code>airspeed</code></li><li>Synthetic sideslip (rad, rad^2) : <code>beta</code></li><li>Optical flow XY (rad/sec, (rad/s)^2) : <code>flow</code></li><li>Height above ground (m, m^2) : <code>hagl</code></li><li>Drag specific force ((m/s)^2): <code>drag</code></li><li>속도 및 위치 혁신 : 센서 당</li></ul><p>In addition, each sensor has its own fields for horizontal and vertical position and/or velocity values (where appropriate). These are largely self documenting, and are reproduced below:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># GPS</span></span>
<span class="line"><span>float32[2] gps_hvel	# horizontal GPS velocity innovation (m/sec) and innovation variance ((m/sec)**2)</span></span>
<span class="line"><span>float32    gps_vvel	# vertical GPS velocity innovation (m/sec) and innovation variance ((m/sec)**2)</span></span>
<span class="line"><span>float32[2] gps_hpos	# horizontal GPS position innovation (m) and innovation variance (m**2)</span></span>
<span class="line"><span>float32    gps_vpos	# vertical GPS position innovation (m) and innovation variance (m**2)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># External Vision</span></span>
<span class="line"><span>float32[2] ev_hvel	# horizontal external vision velocity innovation (m/sec) and innovation variance ((m/sec)**2)</span></span>
<span class="line"><span>float32    ev_vvel	# vertical external vision velocity innovation (m/sec) and innovation variance ((m/sec)**2)</span></span>
<span class="line"><span>float32[2] ev_hpos	# horizontal external vision position innovation (m) and innovation variance (m**2)</span></span>
<span class="line"><span>float32    ev_vpos	# vertical external vision position innovation (m) and innovation variance (m**2)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Fake Position and Velocity</span></span>
<span class="line"><span>float32[2] fake_hvel	# fake horizontal velocity innovation (m/s) and innovation variance ((m/s)**2)</span></span>
<span class="line"><span>float32    fake_vvel	# fake vertical velocity innovation (m/s) and innovation variance ((m/s)**2)</span></span>
<span class="line"><span>float32[2] fake_hpos	# fake horizontal position innovation (m) and innovation variance (m**2)</span></span>
<span class="line"><span>float32    fake_vpos	# fake vertical position innovation (m) and innovation variance (m**2)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Height sensors</span></span>
<span class="line"><span>float32 rng_vpos	# range sensor height innovation (m) and innovation variance (m**2)</span></span>
<span class="line"><span>float32 baro_vpos	# barometer height innovation (m) and innovation variance (m**2)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Auxiliary velocity</span></span>
<span class="line"><span>float32[2] aux_hvel	# horizontal auxiliary velocity innovation from landing target measurement (m/sec) and innovation variance ((m/sec)**2)</span></span>
<span class="line"><span>float32    aux_vvel	# vertical auxiliary velocity innovation from landing target measurement (m/sec) and innovation variance ((m/sec)**2)</span></span></code></pre></div><h3 id="출력-보완-필터" tabindex="-1">출력 보완 필터 <a class="header-anchor" href="#출력-보완-필터" aria-label="Permalink to &quot;출력 보완 필터&quot;">​</a></h3><p>The output complementary filter is used to propagate states forward from the fusion time horizon to current time. To check the magnitude of the angular, velocity and position tracking errors measured at the fusion time horizon, refer to <code>output_tracking_error[3]</code> in the <code>ekf2_innovations</code> message.</p><p>The index map is as follows:</p><ul><li>[0] 각도 추적 오류 크기 (rad)</li><li>[1] 속도 추적 오류 크기 (m/s). The velocity tracking time constant can be adjusted using the <a href="./../advanced_config/parameter_reference.html#EKF2_TAU_VEL">EKF2_TAU_VEL</a> parameter. 이 매개변수를 줄이면 정상 상태 오류가 줄어들지만, NED 속도 출력에서 관찰 노이즈가 증가합니다.</li><li>[2] 위치 추적 오류 크기 (m). The position tracking time constant can be adjusted using the <a href="./../advanced_config/parameter_reference.html#EKF2_TAU_POS">EKF2_TAU_POS</a> parameter. 이 매개변수를 줄이면 정상 상태 오류가 줄어들지만, NED 위치 출력에서 관찰 노이즈가 증가합니다.</li></ul><h3 id="ekf-오류" tabindex="-1">EKF 오류 <a class="header-anchor" href="#ekf-오류" aria-label="Permalink to &quot;EKF 오류&quot;">​</a></h3><p>The EKF contains internal error checking for badly conditioned state and covariance updates. Refer to the <code>filter_fault_flags</code> in <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.</p><h3 id="관측-오류" tabindex="-1">관측 오류 <a class="header-anchor" href="#관측-오류" aria-label="Permalink to &quot;관측 오류&quot;">​</a></h3><p>There are two categories of observation faults:</p><ul><li>데이터 손실. 이에 대한 예는 반환을 제공이 되지 않는 범위 측정기입니다.</li><li>상태 예측과 센서 관찰의 차이인 혁신은 과도합니다. 예를 들어 과도한 진동으로 인한 큰 수직 위치 오류가 발생하여 기압계 높이 측정이 거부됩니다.</li></ul><p>Both of these can result in observation data being rejected for long enough to cause the EKF to attempt a reset of the states using the sensor observations. All observations have a statistical confidence checks applied to the innovations. The number of standard deviations for the check are controlled by the <code>EKF2_*_GATE</code> parameter for each observation type.</p><p>Test levels are available in <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a> as follows:</p><ul><li><code>mag_test_ratio</code>: ratio of the largest magnetometer innovation component to the innovation test limit</li><li><code>vel_test_ratio</code>: ratio of the largest velocity innovation component to the innovation test limit</li><li><code>pos_test_ratio</code>: ratio of the largest horizontal position innovation component to the innovation test limit</li><li><code>hgt_test_ratio</code>: ratio of the vertical position innovation to the innovation test limit</li><li><code>tas_test_ratio</code>: ratio of the true airspeed innovation to the innovation test limit</li><li><code>hagl_test_ratio</code>: ratio of the height above ground innovation to the innovation test limit</li></ul><p>For a binary pass/fail summary for each sensor, refer to innovation_check_flags in <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.</p><h3 id="gps-품질-검사" tabindex="-1">GPS 품질 검사 <a class="header-anchor" href="#gps-품질-검사" aria-label="Permalink to &quot;GPS 품질 검사&quot;">​</a></h3><p>The EKF applies a number of GPS quality checks before commencing GPS aiding. These checks are controlled by the <a href="./../advanced_config/parameter_reference.html#EKF2_GPS_CHECK">EKF2_GPS_CHECK</a> and <code>EKF2_REQ_*</code> parameters. The pass/fail status for these checks is logged in the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.gps_check_fail_flags message. This integer will be zero when all required GPS checks have passed. If the EKF is not commencing GPS alignment, check the value of the integer against the bitmask definition <code>gps_check_fail_flags</code> in <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.</p><h3 id="ekf-수치-오류" tabindex="-1">EKF 수치 오류 <a class="header-anchor" href="#ekf-수치-오류" aria-label="Permalink to &quot;EKF 수치 오류&quot;">​</a></h3><p>The EKF uses single precision floating point operations for all of its computations and first order approximations for derivation of the covariance prediction and update equations in order to reduce processing requirements. This means that it is possible when re-tuning the EKF to encounter conditions where the covariance matrix operations become badly conditioned enough to cause divergence or significant errors in the state estimates.</p><p>To prevent this, every covariance and state update step contains the following error detection and correction steps:</p><ul><li>혁신 분산이 관찰 분산보다 작거나 (불가능한 음의 상태 분산이 필요함) 공분산 업데이트가 모든 상태에 대해 음의 분산을 생성하는 경우 : <ul><li>상태 및 공분산 업데이트를 건너 뜁니다.</li><li>공분산 행렬의 해당 행과 열이 재설정됩니다.</li><li>The failure is recorded in the <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a> <code>filter_fault_flags</code> message</li></ul></li><li>상태 분산(공분산 행렬의 대각선)은 음이 아닌 값으로 제한됩니다.</li><li>상태 차이에는 상한값이 적용됩니다.</li><li>공분산 행렬에 대칭이 적용됩니다.</li></ul><p>After re-tuning the filter, particularly re-tuning that involve reducing the noise variables, the value of <code>estimator_status.gps_check_fail_flags</code> should be checked to ensure that it remains zero.</p><h2 id="높이-추정치가-다른-경우-어떻게-하여야-합니까" tabindex="-1">높이 추정치가 다른 경우 어떻게 하여야 합니까? <a class="header-anchor" href="#높이-추정치가-다른-경우-어떻게-하여야-합니까" aria-label="Permalink to &quot;높이 추정치가 다른 경우 어떻게 하여야 합니까?&quot;">​</a></h2><p>The most common cause of EKF height diverging away from GPS and altimeter measurements during flight is clipping and/or aliasing of the IMU measurements caused by vibration. If this is occurring, then the following signs should be evident in the data</p><ul><li><a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorInnovations.msg" target="_blank" rel="noreferrer">EstimatorInnovations</a>.vel_pos_innov[2] and <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorInnovations.msg" target="_blank" rel="noreferrer">EstimatorInnovations</a>.vel_pos_innov[5] will both have the same sign.</li><li><a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.hgt_test_ratio will be greater than 1.0</li></ul><p>The recommended first step is to ensure that the autopilot is isolated from the airframe using an effective isolation mounting system. An isolation mount has 6 degrees of freedom, and therefore 6 resonant frequencies. As a general rule, the 6 resonant frequencies of the autopilot on the isolation mount should be above 25Hz to avoid interaction with the autopilot dynamics and below the frequency of the motors.</p><p>An isolation mount can make vibration worse if the resonant frequencies coincide with motor or propeller blade passage frequencies.</p><p>The EKF can be made more resistant to vibration induced height divergence by making the following parameter changes:</p><ul><li>기본 높이 센서에 대한 혁신 게이트의 가치를 두 배로 늘립니다. If using barometric height this is <a href="./../advanced_config/parameter_reference.html#EKF2_BARO_GATE">EKF2_BARO_GATE</a>.</li><li>Increase the value of <a href="./../advanced_config/parameter_reference.html#EKF2_ACC_NOISE">EKF2_ACC_NOISE</a> to 0.5 initially. 발산이 여전히 발생하는 경우 0.1씩 더 증가하지만 1.0을 초과하지 않는 것이 좋습니다.</li></ul><p>Note that the effect of these changes will make the EKF more sensitive to errors in GPS vertical velocity and barometric pressure.</p><h2 id="위치-추정치가-다른-경우-어떻게-하여야-합니까" tabindex="-1">위치 추정치가 다른 경우 어떻게 하여야 합니까? <a class="header-anchor" href="#위치-추정치가-다른-경우-어떻게-하여야-합니까" aria-label="Permalink to &quot;위치 추정치가 다른 경우 어떻게 하여야 합니까?&quot;">​</a></h2><p>The most common causes of position divergence are:</p><ul><li>높은 진동 수준. <ul><li>자동조종장치의 기계적 격리를 개선합니다.</li><li>Increasing the value of <a href="./../advanced_config/parameter_reference.html#EKF2_ACC_NOISE">EKF2_ACC_NOISE</a> and <a href="./../advanced_config/parameter_reference.html#EKF2_GYR_NOISE">EKF2_GYR_NOISE</a> can help, but does make the EKF more vulnerable to GPS glitches.</li></ul></li><li>큰 자이로 바이어스 오프셋. <ul><li>자이로를 다시 튜닝합니다. 과도한 온도 감도를 확인하십시오 (콜드 스타트에서 예열하는 동안 &gt; 3도/초 바이어스 변화). 온도 변화 속도를 늦추기 위하여 절연체의 영향을받는 경우 센서를 교체하십시오.</li></ul></li><li>잘못된 요 정렬 <ul><li>자력계 보정과 정렬을 확인합니다.</li><li>QGC가 15도 이내인 지 확인하십시오.</li></ul></li><li>낮은 GPS 정확도 <ul><li>간섭을 확인합니다.</li><li>분리 및 차폐 개선</li><li>비행 위치에서 GPS 신호 방해와 반사경 확인 (고층 빌딩 근처)</li></ul></li><li>GPS 손실</li></ul><p>Determining which of these is the primary cause requires a methodical approach to analysis of the EKF log data:</p><ul><li>Plot the velocity innovation test ratio - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.vel_test_ratio</li><li>Plot the horizontal position innovation test ratio - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.pos_test_ratio</li><li>Plot the height innovation test ratio - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.hgt_test_ratio</li><li>Plot the magnetometer innovation test ratio - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.mag_test_ratio</li><li>Plot the GPS receiver reported speed accuracy - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/SensorGps.msg" target="_blank" rel="noreferrer">SensorGps.msg</a>.s_variance_m_s</li><li>Plot the IMU delta angle state estimates - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.states[10], states[11] and states[12]</li><li>EKF 내부 고주파 진동 메트릭을 플로팅합니다. <ul><li>Delta angle coning vibration - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.vibe[0]</li><li>High frequency delta angle vibration - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.vibe[1]</li><li>High frequency delta velocity vibration - <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.vibe[2]</li></ul></li></ul><p>During normal operation, all the test ratios should remain below 0.5 with only occasional spikes above this as shown in the example below from a successful flight:</p><p><img src="`+a+'" alt="Position, Velocity, Height and Magnetometer Test Ratios"></p><p>The following plot shows the EKF vibration metrics for a multirotor with good isolation. The landing shock and the increased vibration during takeoff and landing can be seen. Insufficient data has been gathered with these metrics to provide specific advice on maximum thresholds.</p><p><img src="'+t+'" alt="Vibration metrics - successful"></p><p>The above vibration metrics are of limited value as the presence of vibration at a frequency close to the IMU sampling frequency (1 kHz for most boards) will cause offsets to appear in the data that do not show up in the high frequency vibration metrics. The only way to detect aliasing errors is in their effect on inertial navigation accuracy and the rise in innovation levels.</p><p>In addition to generating large position and velocity test ratios of &gt; 1.0, the different error mechanisms affect the other test ratios in different ways:</p><h3 id="과도한-진동-여부-결정" tabindex="-1">과도한 진동 여부 결정 <a class="header-anchor" href="#과도한-진동-여부-결정" aria-label="Permalink to &quot;과도한 진동 여부 결정&quot;">​</a></h3><p>High vibration levels normally affect vertical position and velocity innovations as well as the horizontal components. Magnetometer test levels are only affected to a small extent.</p><p>(insert example plots showing bad vibration here)</p><h3 id="과도한-자이로-바이어스-결정" tabindex="-1">과도한 자이로 바이어스 결정 <a class="header-anchor" href="#과도한-자이로-바이어스-결정" aria-label="Permalink to &quot;과도한 자이로 바이어스 결정&quot;">​</a></h3><p>Large gyro bias offsets are normally characterised by a change in the value of delta angle bias greater than 5E-4 during flight (equivalent to ~3 deg/sec) and can also cause a large increase in the magnetometer test ratio if the yaw axis is affected. Height is normally unaffected other than extreme cases. Switch on bias value of up to 5 deg/sec can be tolerated provided the filter is given time settle before flying. Pre-flight checks performed by the commander should prevent arming if the position is diverging.</p><p>(insert example plots showing bad gyro bias here)</p><h3 id="낮은-요-정확도-결정" tabindex="-1">낮은 요 정확도 결정 <a class="header-anchor" href="#낮은-요-정확도-결정" aria-label="Permalink to &quot;낮은 요 정확도 결정&quot;">​</a></h3><p>Bad yaw alignment causes a velocity test ratio that increases rapidly when the vehicle starts moving due inconsistency in the direction of velocity calculated by the inertial nav and the GPS measurement. Magnetometer innovations are slightly affected. Height is normally unaffected.</p><p>(insert example plots showing bad yaw alignment here)</p><h3 id="낮은-gps-정확도-결정" tabindex="-1">낮은 GPS 정확도 결정 <a class="header-anchor" href="#낮은-gps-정확도-결정" aria-label="Permalink to &quot;낮은 GPS 정확도 결정&quot;">​</a></h3><p>Poor GPS accuracy is normally accompanied by a rise in the reported velocity error of the receiver in conjunction with a rise in innovations. Transient errors due to multipath, obscuration and interference are more common causes. Here is an example of a temporary loss of GPS accuracy where the multi-rotor started drifting away from its loiter location and had to be corrected using the sticks. The rise in <a href="https://github.com/PX4/PX4-Autopilot/blob/main/msg/EstimatorStatus.msg" target="_blank" rel="noreferrer">EstimatorStatus</a>.vel_test_ratio to greater than 1 indicates the GPs velocity was inconsistent with other measurements and has been rejected.</p><p><img src="'+i+'" alt="GPS glitch - test ratios"></p><p>This is accompanied with rise in the GPS receivers reported velocity accuracy which indicates that it was likely a GPS error.</p><p><img src="'+o+'" alt="GPS Glitch - reported receiver accuracy"></p><p>If we also look at the GPS horizontal velocity innovations and innovation variances, we can see the large spike in North velocity innovation that accompanies this GPS &#39;glitch&#39; event.</p><p><img src="'+n+'" alt="GPS Glitch - velocity innovations"></p><h3 id="gps-데이터-손실-결정" tabindex="-1">GPS 데이터 손실 결정 <a class="header-anchor" href="#gps-데이터-손실-결정" aria-label="Permalink to &quot;GPS 데이터 손실 결정&quot;">​</a></h3><p>Loss of GPS data will be shown by the velocity and position innovation test ratios &#39;flat-lining&#39;. If this occurs, check the other GPS status data in <code>vehicle_gps_position</code> for further information.</p><p>The following plot shows the NED GPS velocity innovations <code>ekf2_innovations_0.vel_pos_innov[0 ... 2]</code>, the GPS NE position innovations <code>ekf2_innovations_0.vel_pos_innov[3 ... 4]</code> and the Baro vertical position innovation <code>ekf2_innovations_0.vel_pos_innov[5]</code> generated from a simulated VTOL flight using SITL Gazebo.</p><p>The simulated GPS was made to lose lock at 73 seconds. Note the NED velocity innovations and NE position innovations &#39;flat-line&#39; after GPS is lost. Note that after 10 seconds without GPS data, the EKF reverts back to a static position mode using the last known position and the NE position innovations start to change again.</p><p><img src="'+r+'" alt="GPS Data Loss - in SITL"></p><h3 id="기압계-지면-효과-보상" tabindex="-1">기압계 지면 효과 보상 <a class="header-anchor" href="#기압계-지면-효과-보상" aria-label="Permalink to &quot;기압계 지면 효과 보상&quot;">​</a></h3><p>If the vehicle has the tendency during landing to climb back into the air when close to the ground, the most likely cause is barometer ground effect.</p><p>This is caused when air pushed down by the propellers hits the ground and creates a high pressure zone below the drone. The result is a lower reading of pressure altitude, leading to an unwanted climb being commanded. The figure below shows a typical situation where the ground effect is present. Note how the barometer signal dips at the beginning and end of the flight.</p><p><img src="'+s+'" alt="Barometer ground effect"></p><p>You can enable <em>ground effect compensation</em> to fix this problem:</p><ul><li>플롯에서 이륙 또는 착륙중 기압계 하락의 크기를 추정합니다. 위의 플롯에서 착륙중 약 6 미터의 기압계 딥을 읽을 수 있습니다.</li><li>Then set the parameter <a href="./../advanced_config/parameter_reference.html#EKF2_GND_EFF_DZ">EKF2_GND_EFF_DZ</a> to that value and add a 10 percent margin. 따라서, 이 경우 6.6 미터 값이 좋은 출발점이 됩니다.</li></ul><p>If a terrain estimate is available (e.g. the vehicle is equipped with a range finder) then you can additionally specify <a href="./../advanced_config/parameter_reference.html#EKF2_GND_MAX_HGT">EKF2_GND_MAX_HGT</a>, the above ground-level altitude below which ground effect compensation should be activated. If no terrain estimate is available this parameter will have no effect and the system will use heuristics to determine if ground effect compensation should be activated.</p><h2 id="추가-정보" tabindex="-1">추가 정보 <a class="header-anchor" href="#추가-정보" aria-label="Permalink to &quot;추가 정보&quot;">​</a></h2><ul><li><a href="https://youtu.be/HkYRJJoyBwQ" target="_blank" rel="noreferrer">PX4 State Estimation Overview</a>, <em>PX4 Developer Summit 2019</em>, Dr. Paul Riseborough): Overview of the estimator, and major changes from 2018/19, and the expected improvements through 2019/20.</li></ul>',231)]))}const y=l(m,[["render",p]]);export{F as __pageData,y as default};
