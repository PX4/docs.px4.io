import{_ as i,c as a,a8 as h,o as n}from"./chunks/framework.BDnHobkS.js";const E=JSON.parse('{"title":"Профілювання розміру бінаря","description":"","frontmatter":{},"headers":[],"relativePath":"uk/debug/binary_size_profiling.md","filePath":"uk/debug/binary_size_profiling.md"}'),k={name:"uk/debug/binary_size_profiling.md"};function t(p,s,l,e,F,r){return n(),a("div",null,s[0]||(s[0]=[h(`<h1 id="профілювання-розміру-бінаря" tabindex="-1">Профілювання розміру бінаря <a class="header-anchor" href="#профілювання-розміру-бінаря" aria-label="Permalink to &quot;Профілювання розміру бінаря&quot;">​</a></h1><p>The <code>bloaty_compare_master</code> build target allows you to get a better understanding of the impact of changes on code size. When it is used, the toolchain downloads the latest successful master build of a particular firmware and compares it to the local build (using the <a href="https://github.com/google/bloaty" target="_blank" rel="noreferrer">bloaty</a> size profiler for binaries).</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This can help analyse changes that (may) cause <code>px4_fmu-v2_default</code> to hit the 1MB flash limit.</p></div><p><em>Bloaty</em> must be in your path and found at <em>cmake</em> configure time. The PX4 <a href="https://github.com/PX4/containers/blob/master/docker/Dockerfile_nuttx-bionic" target="_blank" rel="noreferrer">docker files</a> install <em>bloaty</em> as shown:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --recursive</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/google/bloaty.git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/bloaty</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	&amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/bloaty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cmake</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -GNinja</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ninja</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bloaty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bloaty</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	&amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span></code></pre></div><p>The example below shows how you might see the impact of removing the <em>mpu9250</em> driver from <code>px4_fmu-v2_default</code>. Спочатку локально налаштовує збірку без драйвера:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> %</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> diff</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">diff</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a/boards/px4/fmu-v2/default.px4board</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b/boards/px4/fmu-v2/default.px4board</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 40d7778..2ce7972</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100644</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a/boards/px4/fmu-v2/default.px4board</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b/boards/px4/fmu-v2/default.px4board</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@@</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -36,7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +36,7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @@</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               CONFIG_DRIVERS_IMU_INVENSENSE_MPU9250=y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               CONFIG_DRIVERS_IMU_INVENSENSE_MPU9250=n</span></span></code></pre></div><p>Then use the make target, specifying the target build to compare (<code>px4_fmu-v2_default</code> in this case):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> px4_fmu-v2_default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bloaty_compare_master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     VM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIZE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                                                        FILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIZE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> --------------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                                                                  --------------</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-52</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::check_null_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> int</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                               </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-52</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::test_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                                                                </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-52</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250_gyro::MPU9250_gyro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MPU9250*,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-56</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpu9250::info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MPU9250_BUS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                                           </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-56</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-56</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpu9250::regdump</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MPU9250_BUS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                                        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-56</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                        -336</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-344</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250_mag::_measure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ak8963_regs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                                  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-344</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-684</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::MPU9250</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">device::Device*,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> device::Device</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cha</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -684</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-684</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                                                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-684</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]   </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-1000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::measure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                                                                 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -41.3%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   -1011</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [43 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Others]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                                                        -1011</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -41.3%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -1.0%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1.05Ki</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Unmapped]                                                                       +24.2Ki  +0.2%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -1.0%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -10.3Ki</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TOTAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                                            +14.9Ki</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  +0.1%</span></span></code></pre></div><p>This shows that removing <em>mpu9250</em> from <code>px4_fmu-v2_default</code> would save 10.3 kB of flash. It also shows the sizes of different pieces of the <em>mpu9250</em> driver.</p>`,10)]))}const g=i(k,[["render",t]]);export{E as __pageData,g as default};
