import{_ as e,c as t,j as i,a as n,G as l,a8 as p,B as h,o}from"./chunks/framework.BDnHobkS.js";const y=JSON.parse('{"title":"Інтерфейс подій","description":"","frontmatter":{},"headers":[],"relativePath":"uk/concept/events_interface.md","filePath":"uk/concept/events_interface.md"}'),k={name:"uk/concept/events_interface.md"};function d(r,s,c,g,E,u){const a=h("Badge");return o(),t("div",null,[s[0]||(s[0]=i("h1",{id:"інтерфеис-подіи",tabindex:"-1"},[n("Інтерфейс подій "),i("a",{class:"header-anchor",href:"#інтерфеис-подіи","aria-label":'Permalink to "Інтерфейс подій"'},"​")],-1)),l(a,{type:"tip",text:"PX4 v1.13"}),s[1]||(s[1]=p(`<p>The <em>Events Interface</em> provides a system-wide API for notification of events, which are published to GCSs via the <em>MAVLink Events Service</em> (to GCSs and other components) and also stored in <a href="./../dev_log/logging.html">system logs</a>.</p><p>Інтерфейс може використовуватися для публікації подій змін стану або будь-якого іншого типу події, включаючи такі речі, як стан готовності, завершення калібрування і досягнення цільової висоти злету.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Інтерфейс подій замінить використання викликів <code>mavlink_log_*</code> у коді PX4, (а також повідомлень <code>STATUS_TEXT</code> у MAVLink) для сповіщення про події в релізах PX4 після v1.13 та новіше. Буде проміжний період коли <a href="#backward-compatibility">обидва підходи будуть підтримуватися</a>.</p></div><h2 id="використання" tabindex="-1">Використання <a class="header-anchor" href="#використання" aria-label="Permalink to &quot;Використання&quot;">​</a></h2><h3 id="основне" tabindex="-1">Основне <a class="header-anchor" href="#основне" aria-label="Permalink to &quot;Основне&quot;">​</a></h3><p>А потім визначте та надішліть подію з бажаного місця коду:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;px4_platform_common/events.h&gt;</span></span></code></pre></div><p>А потім визначте та надішліть подію з бажаного місця коду:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mymodule_test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::Info, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Test Message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h4 id="зворотна-сумісність" tabindex="-1">Зворотна сумісність <a class="header-anchor" href="#зворотна-сумісність" aria-label="Permalink to &quot;Зворотна сумісність&quot;">​</a></h4><p>Для старих версій GCS без підтримки інтерфейсу подій, PX4 на цей момент надсилає також всі події як <code>mavlink_log_*</code> <code>STATUSTEXT</code> повідомлення. Крім того, повідомлення має бути промарковано додатковою табуляцією (<code>\\t</code>), щоб нові GCS змогли проігнорувати це і показати тільки подію.</p><p>Отже, коли ви додаєте подію, не забудьте також додати виклик <code>mavlink_log_</code>. Наприклад:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mavlink_log_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mavlink_log_pub, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Test Message</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mymodule_test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::Info, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Test Message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Вище - мінімальний приклад, цей - у більш розширеному вигляді.</p><h3 id="докладно" tabindex="-1">Докладно <a class="header-anchor" href="#докладно" aria-label="Permalink to &quot;Докладно&quot;">​</a></h3><p>Пояснення та вимоги:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arg1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arg2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* EVENT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @description</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * This is the detailed event description.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * - value of arg1: {1}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * - value of arg2: {2:.1}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;profile name=&quot;dev&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * (This paragraph is only meant to be shown to developers).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * This behavior can be configured with the parameter &lt;param&gt;COM_EXAMPLE&lt;/param&gt;.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/profile&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Link to documentation: &lt;a&gt;https://docs.px4.io&lt;/a&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;event_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::Error, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LogInternal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::Info}, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Event Message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, arg1, arg2);</span></span></code></pre></div><p>Події можуть мати незмінний набір аргументів, які можна вкласти у повідомлення або опис використовуючи шаблонні замінники (наприклад <code>{2:.1m}</code>, дивіться наступний розділ).</p><ul><li><p><code>/* EVENT</code>: Цей тег вказує, що коментар описує метадані для наступної події.</p></li><li><p><strong>event_name</strong>: ім&#39;я події (<code>events::ID(event_name)</code>).</p><ul><li>повинно бути унікальним в межах всього вихідного коду PX4. Як загальне правило, додайте префікс з назвою модуля або вихідного файлу для великих модулів.</li><li>має бути дійсна назва змінної, тобто не повинна містити пробіли, двокрапки тощо.</li><li>з цього імені отримується 24-бітний ID події за допомогою геш-функції. Це означає, що до тих пір, поки ім&#39;я події залишається однаковим, ID залишиться тим же.</li></ul></li><li><p><strong>Рівень журналювання</strong>:</p><ul><li><p>припустимі рівні журналювання такі ж, як і у перерахуванні MAVLink <a href="https://mavlink.io/en/messages/common.html#MAV_SEVERITY" target="_blank" rel="noreferrer">MAV_SEVERITY</a>. Рівні перелічені за зменшенням важливості:</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Emergency,</span></span>
<span class="line"><span>Alert,</span></span>
<span class="line"><span>Critical,</span></span>
<span class="line"><span>Error,</span></span>
<span class="line"><span>Warning,</span></span>
<span class="line"><span>Notice,</span></span>
<span class="line"><span>Info,</span></span>
<span class="line"><span>Debug,</span></span>
<span class="line"><span>Disabled,</span></span></code></pre></div></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Попередньо ми вказали окремий зовнішній і внутрішній рівень журналювання, які є рівнями для користувачів GCS і в файлі журналу, відповідно: \`{events::Log::Error, events::LogInternal::Info}\`.</span></span></code></pre></div></li><li><p><strong>Повідомлення про подію</strong>:</p><ul><li>Коротке повідомлення про подію в один рядок. Може мати шаблонні замінники для аргументів (наприклад <code>{1}</code>). Для додаткової інформації дивіться нижче. Для додаткової інформації дивіться нижче.</li></ul></li><li><p><strong>Опис події</strong>:</p><ul><li>Докладний, необов&#39;язковий опис події.</li><li>Може бути кілька рядів/абзаців.</li><li>It may contain template placeholders for arguments (e.g. <code>{2}</code>) and supported tags (see below)</li></ul></li></ul><h4 id="аргументи-та-перерахування" tabindex="-1">Аргументи та перерахування <a class="header-anchor" href="#аргументи-та-перерахування" aria-label="Permalink to &quot;Аргументи та перерахування&quot;">​</a></h4><p>Events can have a fixed set of arguments that can be inserted into the message or description using template placeholders (e.g. <code>{2:.1m}</code> - see next section).</p><p>Припустимі типи: <code>uint8_t</code>, <code>int8_t</code>, <code>uint16_t</code>, <code>int16_t</code>, <code>uint32_t</code>, <code>int32_t</code>, <code>uint64_t</code>, <code>int64_t</code> та <code>float</code>.</p><p>Формат тексту для опису повідомлення події:</p><ul><li>Користувацькі або характерні для PX4 перерахування для подій повинні бути визначені у <a href="https://github.com/PX4/PX4-Autopilot/blob/main/src/lib/events/enums.json" target="_blank" rel="noreferrer">src/lib/events/enums.json</a>, та можуть бути використані як аргументи події у формі <code>events::send&lt;events::px4::enums::my_enum_t&gt;(...)</code>.</li><li>&quot;Загальні&quot; події MAVLink визначені у <a href="https://github.com/mavlink/libevents/blob/master/events/common.json" target="_blank" rel="noreferrer">mavlink/libevents/events/common.json</a> та можуть бути використані як аргументи подій у формі <code>events::send&lt;events::common::enums::my_enum_t&gt;(...)</code>.</li></ul><h4 id="формат-тексту" tabindex="-1">Формат тексту <a class="header-anchor" href="#формат-тексту" aria-label="Permalink to &quot;Формат тексту&quot;">​</a></h4><p>Події записуються відповідно до рівня внутрішнього журналювання, а <a href="../log/flight_review.md">Огляд польоту</a> показує події.</p><ul><li><p>символи можна екранувати за допомогою \\</p><p>Ці символи повинні бути екрановані: &#39;\\\\&#39;, &#39;\\&lt;&#39;, &#39;\\{&#39;.</p></li><li><p>теги що підтримуються:</p><ul><li><p>Профілі: <code>&lt;profile name=&quot;[!]NAME&quot;&gt;CONTENT&lt;/profile&gt;</code></p><p><code>CONTENT</code> буде показано, лише якщо назва збігається з налаштованим профілем. Це може бути використано, наприклад, щоб приховати інформацію для розробників від кінцевих користувачів.</p></li><li><p>URLs: <code>&lt;a [href=&quot;URL&quot;]&gt;CONTENT&lt;/a&gt;</code>. If <code>href</code> is not set, use <code>CONTENT</code> as <code>URL</code> (i.e.<code>&lt;a&gt;https://docs.px4.io&lt;/a&gt;</code> is interpreted as <code>&lt;a href=&quot;https://docs.px4.io&quot;&gt;https://docs.px4.io&lt;/a&gt;</code>)</p></li><li><p>Parameters: <code>&lt;param&gt;PARAM_NAME&lt;/param&gt;</code></p></li><li><p>не дозволено використовувати вкладені теги того ж типу</p></li></ul></li><li><p>аргументи: шаблонні замінники, що відповідають синтаксису python з індексацією що починається з 1 (замість 0)</p><ul><li><p>загальна форма: <code>{ARG_IDX[:.NUM_DECIMAL_DIGITS][UNIT]}</code></p><p>UNIT:</p><ul><li>m: горизонтальна відстань в метрах</li><li>m_v: вертикальна відстань в метрах</li><li>m^2: площа в метрах квадратних</li><li>m/s: швидкість у метрах в секунду</li><li>C: температура у градусах Цельсія</li></ul></li><li><p><code>NUM_DECIMAL_DIGITS</code> підходить тільки для аргументів у вигляді дійсних чисел.</p></li></ul></li></ul><h2 id="логування" tabindex="-1">Логування <a class="header-anchor" href="#логування" aria-label="Permalink to &quot;Логування&quot;">​</a></h2><p>Події записуються відповідно до рівня внутрішнього журналювання, а <a href="./../log/flight_review.html">Огляд польоту</a> показує події.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Огляд польоту завантажує метадані на основі головної гілки PX4, тому, якщо визначення ще немає на головній гілці, огляд зможе показати тільки ID події.</p></div><h2 id="імплементація" tabindex="-1">Імплементація <a class="header-anchor" href="#імплементація" aria-label="Permalink to &quot;Імплементація&quot;">​</a></h2><p>Метадані для всіх подій вбудовані в окремий JSON файл метаданих (з використанням python скрипту, який сканує весь вихідний код у пошуках викликів подій).</p><p>Метадані для всіх подій вбудовані в окремий JSON файл метаданих (з використанням python скрипту, який сканує весь вихідний код у пошуках викликів подій).</p><h3 id="публікація-метаданих-подіі-в-gcs" tabindex="-1">Публікація метаданих події в GCS <a class="header-anchor" href="#публікація-метаданих-подіі-в-gcs" aria-label="Permalink to &quot;Публікація метаданих події в GCS&quot;">​</a></h3><p>Цей процес такий самий як і для <a href="./../advanced/parameters_and_configurations.html#publishing-parameter-metadata-to-a-gcs">метаданих параметрів</a>. Для отримання додаткової інформації див. <a href="../advanced/px4_metadata.md"> Метадані PX4 (трансляція і публікація)</a>.</p><p>Цей процес такий самий як і для <a href="./../advanced/parameters_and_configurations.html#publishing-parameter-metadata-to-a-gcs">метаданих параметрів</a>. Для отримання додаткової інформації див. <a href="./../advanced/px4_metadata.html">Метадані PX4 (трансляція і публікація)</a></p>`,36))])}const v=e(k,[["render",d]]);export{y as __pageData,v as default};
