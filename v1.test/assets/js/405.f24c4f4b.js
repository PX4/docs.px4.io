(window.webpackJsonp=window.webpackJsonp||[]).push([[405],{2743:function(t,a,s){"use strict";s.r(a);var _=s(19),v=Object(_.a)({},(function(){var t=this,a=t.$createElement,_=t._self._c||a;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"огляд-архітектури-px4"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#огляд-архітектури-px4"}},[t._v("#")]),t._v(" Огляд архітектури PX4")]),t._v(" "),_("p",[t._v("PX4 складається із двох головних шарів: "),_("a",{attrs:{href:"#flight-stack"}},[t._v("набору політного ПЗ")]),t._v(", що є системою керування та оцінки польоту, та "),_("a",{attrs:{href:"#middleware"}},[t._v("проміжного ПЗ")]),t._v(", яке є загальним робототехнічним прошарком ПЗ, що може підтримувати будь-який тип автономного робота, забезпечуючи внутрішній та зовнішній зв'язок та інтеграцію апаратного забезпечення.")]),t._v(" "),_("p",[t._v("Всі "),_("RouterLink",{attrs:{to:"/uk/airframes/"}},[t._v("планери")]),t._v(" PX4 мають окрему кодову базу (включаючи й інші роботизовані системи, такі як човни, ровери, підводні човни тощо). Побудова системи є "),_("a",{attrs:{href:"http://www.reactivemanifesto.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("реакційною"),_("OutboundLink")],1),t._v(", це означає що:")],1),t._v(" "),_("ul",[_("li",[t._v("Весь функціонал розділений на взаємозамінні та придатні для повторного використання компоненти")]),t._v(" "),_("li",[t._v("Зв'язок зроблено через асинхронне передавання повідомлень")]),t._v(" "),_("li",[t._v("Система може дати раду різним робочим навантаженням")])]),t._v(" "),_("p",[_("a",{attrs:{id:"architecture"}})]),t._v(" "),_("h2",{attrs:{id:"високорівнева-архітектура-пз"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#високорівнева-архітектура-пз"}},[t._v("#")]),t._v(" Високорівнева архітектура ПЗ")]),t._v(" "),_("p",[t._v("На діаграмі нижче показано детальний огляд будівельних блоків PX4. Верхня частина діаграми містить блоки проміжного ПЗ, тоді як нижня частина - компоненти набору польотного ПЗ.")]),t._v(" "),_("p",[_("img",{attrs:{src:s(657),alt:"Архітектура PX4"}})]),t._v(" "),_("p",[t._v("Вихідний код розділено на самодостатні модулі/програми (показано на діаграмі "),_("code",[t._v("моноширинним")]),t._v(" шрифтом). Зазвичай один блок відповідає одному модулю.")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[t._v("Під час виконання можна переглянути який з модулів виконується за допомогою команди "),_("code",[t._v("top")]),t._v(" в консолі, а кожен модуль може бути запущено окремо за допомогою "),_("code",[t._v("<module_name> start/stop")]),t._v(". Хоча команда "),_("code",[t._v("top")]),t._v(" характерна для оболонки NuttX, інші команди можуть бути використані також в оболонці SITL (pxh>). Для додаткової інформації про кожен з цих модулів дивіться "),_("RouterLink",{attrs:{to:"/uk/modules/modules_main.html"}},[t._v("Довідник команд та модулів")]),t._v(".")],1)]),t._v(" "),_("p",[t._v("Стрілки показують плин інформації для "),_("em",[t._v("найважливіших")]),t._v(" зв'язків між модулями. В реальності зв'язків набагато більше ніж показано, а деякі дані (наприклад параметри) отримуються більшістю модулів.")]),t._v(" "),_("p",[t._v("Модулі спілкуються один з одним через шину повідомлень публікації/підписки яка називається "),_("RouterLink",{attrs:{to:"/uk/middleware/uorb.html"}},[t._v("uORB")]),t._v(". Використання схеми публікації/підписки означає, що:")],1),t._v(" "),_("ul",[_("li",[t._v("Система реакційна — тобто є асинхронною та миттєво оновиться при наявності нових даних")]),t._v(" "),_("li",[t._v("Всі операції та комунікації повністю розпаралелено")]),t._v(" "),_("li",[t._v("Системний компонент може споживати дані звідки завгодно у спосіб безпечний для потоків")])]),t._v(" "),_("div",{staticClass:"custom-block note"},[_("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),_("p",[t._v("Ця архітектура дозволяє швидко і легко замінити кожен з цих блоків навіть під час виконання.")])]),t._v(" "),_("h3",{attrs:{id:"набір-польотного-пз"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#набір-польотного-пз"}},[t._v("#")]),t._v(" Набір польотного ПЗ")]),t._v(" "),_("p",[t._v("Набір польотного ПЗ є колекцією алгоритмів керування, навігації та спрямування для автономних дронів. Він включає контролери для планерів з фіксованим крилом, мультироторів та ВЗІП, а також спостерігача орієнтації та позиції.")]),t._v(" "),_("p",[t._v("У наступній діаграмі показано огляд будівельних блоків набору ПЗ для польоту. Він містить повний конвеєр від датчиків, вхідних даних РК та контролера автономного польоту (Navigator), до двигуна або управління сервоприводами (Actuators).")]),t._v(" "),_("p",[_("img",{attrs:{src:s(658),alt:"Високорівнева схема набору політного ПЗ у PX4"}})]),t._v(" "),_("p",[_("strong",[t._v("Спостерігач")]),t._v(" приймає вхідні дані з одного або більше датчиків, поєднує їх та обчислює стан рухомого засобу (наприклад орієнтацію з даних датчика ІВП або ж IMU).")]),t._v(" "),_("p",[_("strong",[t._v("Контролер")]),t._v(" - це компонент, який приймає на вхід заданий і виміряний або ж визначений стан (змінну процесу). Його мета - скорегувати значення змінної процесу, таким чином, щоб вона відповідала заданому значенню. Вихідні дані - це корекційні значення, щоб врешті-решт досягти заданих. Наприклад, контролер позиції приймає задані значення позиції на вході, змінна процесу є значенням позиції що оцінюється, а вихід - це орієнтація та задане значення газу, що рухає засіб до потрібної позиції.")]),t._v(" "),_("p",[_("strong",[t._v("Змішувач")]),t._v(' приймає команди примусу (наприклад "повернути вправо") і перекладає їх на окремі команди двигуна, при цьому гарантуючи, що певні межі не перевищено. Цей переклад є специфічним для типу засобу і залежить від різних факторів такі як розташування двигунів відносно центру мас або інерція обертання засобу.')]),t._v(" "),_("p",[_("a",{attrs:{id:"middleware"}})]),t._v(" "),_("h3",{attrs:{id:"проміжне-програмне-забезпечення"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#проміжне-програмне-забезпечення"}},[t._v("#")]),t._v(" Проміжне програмне забезпечення")]),t._v(" "),_("p",[_("RouterLink",{attrs:{to:"/uk/middleware/"}},[t._v("Проміжне ПЗ")]),t._v(" головним чином складається з драйверів для вбудованих датчиків, зв'язку із зовнішнім світом (допоміжним комп'ютером, GCS і т. ін.) та шиною повідомлень uORB.")],1),t._v(" "),_("p",[t._v("Крім того, в проміжне ПЗ включено "),_("RouterLink",{attrs:{to:"/uk/simulation/"}},[t._v("шар симуляції")]),t._v(', який дозволяє коду PX4 запускатися на настільній операційній системі та контролювати модельований комп\'ютером рухомий засіб у симульованому "світі".')],1),t._v(" "),_("h2",{attrs:{id:"темпи-оновлення-даних"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#темпи-оновлення-даних"}},[t._v("#")]),t._v(" Темпи оновлення даних")]),t._v(" "),_("p",[t._v("Оскільки модулі очікують оновлень повідомлень, зазвичай драйвери визначають як швидко оновлюється стан модуля. Більшість драйверів ІВП роблять вибірку даних на частоті 1 кГц, інтегрують їх і публікують з частотою 250 Гц. Інші частини системи, такі як "),_("code",[t._v("navigator")]),t._v(" не потребують такої високої швидкості поновлення даних тому виконуються значно повільніше.")]),t._v(" "),_("p",[t._v("Частота оновлення повідомлень на системі може бути "),_("RouterLink",{attrs:{to:"/uk/middleware/uorb.html"}},[t._v("перевірена")]),t._v(" в реальному часі, запустивши команду "),_("code",[t._v("uorb top")]),t._v(".")],1),t._v(" "),_("p",[_("a",{attrs:{id:"runtime-environment"}})]),t._v(" "),_("h2",{attrs:{id:"середовище-виконання"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#середовище-виконання"}},[t._v("#")]),t._v(" Середовище виконання")]),t._v(" "),_("p",[t._v("PX4 запускається на різних операційних системах які надають POSIX-API (наприклад, Linux, macOS, NuttX або QuRT). Вони також повинні мати якусь форму планування завдань в реальному часі (наприклад FIFO).")]),t._v(" "),_("p",[t._v("Комунікація між модулями (за допомогою "),_("RouterLink",{attrs:{to:"/uk/middleware/uorb.html"}},[t._v("uORB")]),t._v(") заснована на розділюваній пам'яті. Усе проміжне ПЗ PX4 виконується в єдиному адресному просторі, тобто пам'ять розділена між усіма модулями.")],1),t._v(" "),_("div",{staticClass:"custom-block note"},[_("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),_("p",[t._v("Система створена так, щоб з мінімальними зусиллями, можна було б запустити кожен модуль в окремому адресному просторі (частини, які необхідно буде змінити включають "),_("code",[t._v("uORB")]),t._v(", "),_("code",[t._v("parameter interface")]),t._v(", "),_("code",[t._v("dataman")]),t._v(" та "),_("code",[t._v("perf")]),t._v(").")])]),t._v(" "),_("p",[t._v("Існує 2 різні способи запуску модуля:")]),t._v(" "),_("ul",[_("li",[_("p",[_("strong",[t._v("Завдання")]),t._v(": Модуль виконується у своєму власному завданні з власним стеком і пріоритетом процесу.")])]),t._v(" "),_("li",[_("p",[_("strong",[t._v("Завдання робочої черги")]),t._v(": Модуль виконується в спільній робочій черзі, розділяючи той самий стек та пріоритет потоку робочої черги як і інші модулі в черзі.")]),t._v(" "),_("ul",[_("li",[t._v("Усі завдання повинні поводитися скооперовано, оскільки вони не можуть переривати одне одного.")]),t._v(" "),_("li",[t._v("Декілька "),_("em",[t._v("завдань робочої черги")]),t._v(" можуть запускатися у черзі, а також може бути кілька черг.")]),t._v(" "),_("li",[_("em",[t._v("Завдання робочої черги")]),t._v(' планується вказанням визначеного часу у майбутньому або через зворотний виклик "поновлення теми" uORB.')])]),t._v(" "),_("p",[t._v("Перевага запуску модулів у робочій черзі полягає в тому, що це використовує менше ОЗП, і потенційно призводить до меншої кількості перемикань завдань. Недоліки в тому, що "),_("em",[t._v("завданням робочої черги")]),t._v(" не дозволено перебувати в режимі сну або опитувати наявність повідомлення, або виконувати блокуючу операцію вводу/виводу (наприклад, читання з файлу). Довгострокові завдання (що виконують важкі обчислення) повинні потенційно також запускатися в окремому завданні або принаймні в окремій робочий черзі.")])])]),t._v(" "),_("div",{staticClass:"custom-block note"},[_("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),_("p",[t._v("Завдання запущені в робочій черзі не з'являються у виводі "),_("RouterLink",{attrs:{to:"/uk/modules/modules_command.html#top"}},[_("code",[t._v("top")])]),t._v(" (видно тільки робочі як такі, наприклад "),_("code",[t._v("wq:lp_default")]),t._v("). Використовуйте "),_("RouterLink",{attrs:{to:"/uk/modules/modules_system.html#work-queue"}},[_("code",[t._v("work_queue status")])]),t._v(" для показу всіх активних елементів черги.")],1)]),t._v(" "),_("h3",{attrs:{id:"фонові-завдання"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#фонові-завдання"}},[t._v("#")]),t._v(" Фонові завдання")]),t._v(" "),_("p",[_("code",[t._v("px4_task_spawn_cmd()")]),t._v(" використовується для запуску нових завдань (NuttX) або потоків (POSIX - Linux/macOS), які працюють незалежно від (батьківського) завдання, що їх викликало:")]),t._v(" "),_("div",{staticClass:"language-cpp extra-class"},[_("pre",{pre:!0,attrs:{class:"language-cpp"}},[_("code",[t._v("independent_task "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("px4_task_spawn_cmd")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v('"commander"')]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                    "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Ім'я процесу")]),t._v("\n    SCHED_DEFAULT"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                  "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Тип планування (RR or FIFO)")]),t._v("\n    SCHED_PRIORITY_DEFAULT "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Пріоритет планування")]),t._v("\n    "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                           "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Розмір стеку нового завдання або потоку")]),t._v("\n    commander_thread_main"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("          "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Головна функція задання або потоку")]),t._v("\n    "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("argv"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("        "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Вказівник на процедуру для передачі новому завданню")]),t._v("\n                                    "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// (аргументи командного рядка).")]),t._v("\n    "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),_("h3",{attrs:{id:"інформація-для-певноі-ос"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#інформація-для-певноі-ос"}},[t._v("#")]),t._v(" Інформація для певної ОС")]),t._v(" "),_("h4",{attrs:{id:"nuttx"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#nuttx"}},[t._v("#")]),t._v(" NuttX")]),t._v(" "),_("p",[_("a",{attrs:{href:"https://nuttx.apache.org//",target:"_blank",rel:"noopener noreferrer"}},[t._v("NuttX"),_("OutboundLink")],1),t._v(" є основною RTOS для запуску PX4 на платі керування польотами. Вона має відкритий вихідний код (під BSD ліцензією), легка, ефективна і дуже стабільна.")]),t._v(" "),_("p",[t._v("Модулі виконуються як завдання: вони мають свої списки дескрипторів файлів, але мають єдиний адресний простір. Завдання все ще може запустити один або кілька потоків, які розділяють той самий список дескрипторів файлів.")]),t._v(" "),_("p",[t._v("Кожне завдання/поток має стек фіксованого розміру, є періодичне завдання, яке перевіряє, що в всіх стеках залишилося достатньо вільного місця (засновано на розфарбовуванні стеку).")]),t._v(" "),_("h4",{attrs:{id:"linux-macos"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#linux-macos"}},[t._v("#")]),t._v(" Linux/macOS")]),t._v(" "),_("p",[t._v("На Linux або macOS, PX4 виконується в одному процесі, а модулі запускаються у своїх потоках (бо немає різниці між завданнями та потоками як на NuttX).")])])}),[],!1,null,null,null);a.default=v.exports},657:function(t,a,s){t.exports=s.p+"assets/img/PX4_Architecture.5a42a045.svg"},658:function(t,a,s){t.exports=s.p+"assets/img/PX4_High-Level_Flight-Stack.18829d0a.svg"}}]);