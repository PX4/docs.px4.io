(window.webpackJsonp=window.webpackJsonp||[]).push([[1185],{2749:function(t,a,e){"use strict";e.r(a);var s=e(19),_=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"запуск-системи"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#запуск-системи"}},[t._v("#")]),t._v(" Запуск системи")]),t._v(" "),e("p",[t._v("Запуск PX4 контрольований скриптами оболонки. На NuttX вони знаходяться у директорії "),e("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/tree/main/ROMFS/px4fmu_common/init.d",target:"_blank",rel:"noopener noreferrer"}},[t._v("ROMFS/px4fmu_common/init.d"),e("OutboundLink")],1),t._v(", деякі з них також використовуються на Posix системах (Linux/MacOS). Скрипти які використовуються тільки на Posix системах знаходяться у "),e("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/tree/main/ROMFS/px4fmu_common/init.d-posix",target:"_blank",rel:"noopener noreferrer"}},[t._v("ROMFS/px4fmu_common/init.d-posix"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("p",[t._v("Усі файли, які починаються з числа і підкреслення (наприклад, "),e("code",[t._v("10000_airaipl")]),t._v(") є попередньо визначеними конфігураціями планерів. Вони експортуються під час збірки в файл "),e("code",[t._v("airframes.xml")]),t._v(" який потім аналізується  "),e("a",{attrs:{href:"http://qgroundcontrol.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("QGroundControl"),e("OutboundLink")],1),t._v(" для користувацького інтерфейсу вибору планера. Як додати нову конфігурацію описано "),e("RouterLink",{attrs:{to:"/uk/dev_airframes/adding_a_new_frame.html"}},[t._v("тут")]),t._v(".")],1),t._v(" "),e("p",[t._v("Файли що залишилися є частиною загальної логіки запуску. Перший файл що виконується є скрипт "),e("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/ROMFS/px4fmu_common/init.d/rcS",target:"_blank",rel:"noopener noreferrer"}},[t._v("init.d/rcS"),e("OutboundLink")],1),t._v(" (або "),e("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/ROMFS/px4fmu_common/init.d-posix/rcS",target:"_blank",rel:"noopener noreferrer"}},[t._v("init.d-posix/rcS"),e("OutboundLink")],1),t._v(" на Posix), який викликає інші скрипти.")]),t._v(" "),e("p",[t._v("Наступні секції розділені відповідно до операційної системи, на яких виконується PX4.")]),t._v(" "),e("h2",{attrs:{id:"posix-linux-macos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#posix-linux-macos"}},[t._v("#")]),t._v(" Posix (Linux/MacOS)")]),t._v(" "),e("p",[t._v("На Posix системна оболонка використовується як інтерпретатор скриптів (наприклад, /bin/sh що є символьним посиланням на dash в Ubuntu). Щоб це працювало потрібно кілька речей:")]),t._v(" "),e("ul",[e("li",[t._v("Модулі PX4 повинні виглядати для системи як окремі виконувані файли. Це робиться за допомогою символьних посилань. Для кожного модуля створюється символьне посилання "),e("code",[t._v("px4-<module> -> px4")]),t._v(" в каталозі збірки "),e("code",[t._v("bin")]),t._v(". При виконанні двійкового файлу перевіряється його шлях ("),e("code",[t._v("argv[0]")]),t._v(") і якщо це модуль (починається з "),e("code",[t._v("px4-")]),t._v(") він відправляє команду на основний екземпляр px4 (див. нижче).")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Префікс "),e("code",[t._v("px4-")]),t._v(" використовується для уникнення конфліктів з системними командами (наприклад "),e("code",[t._v("shutdown")]),t._v("), також це дозволяє просте автодоповнення за допомогою клавіші "),e("code",[t._v("Tab")]),t._v(" при вводі <0>px4-<TAB></0>.")])]),t._v(" "),e("ul",[e("li",[t._v("Оболонка повинна знати, де шукати символьні посилання. Для цього директорія "),e("code",[t._v("bin")]),t._v(" із символьними посиланнями додається до змінної "),e("code",[t._v("PATH")]),t._v(" одразу перед виконанням скриптів запуску.")]),t._v(" "),e("li",[t._v("Оболонка запускає кожен модуль як новий (клієнтський) процес. Кожен клієнтський процес повинен спілкуватися з головним екземпляром px4 (сервером), де справжні модулі працюють як потоки. Це зроблено через "),e("a",{attrs:{href:"http://man7.org/linux/man-pages/man7/unix.7.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("сокет UNIX"),e("OutboundLink")],1),t._v(". Сервер прослуховує сокет, до якого клієнти можуть під'єднатися та надіслати команду. Сервер відправляє вихідні дані та код повернення назад до клієнта.")]),t._v(" "),e("li",[t._v("Стартові скрипти викликають модулі безпосередньо, наприклад "),e("code",[t._v("commander start")]),t._v(", замість використання префікса "),e("code",[t._v("px4-")]),t._v(". Це працює через псевдоніми: для кожного модуля створюється псевдонім у формі "),e("code",[t._v("alias <module>=px4-<module>")]),t._v(" файлом "),e("code",[t._v("bin/px4-alias.sh")]),t._v(".")]),t._v(" "),e("li",[t._v("Скрипт "),e("code",[t._v("rcS")]),t._v(" виконується з основного екземпляра px4. Він не запускає жодних модулів, але спочатку оновлює змінну "),e("code",[t._v("PATH")]),t._v(", а потім просто запускає оболонку з файлом "),e("code",[t._v("rcS")]),t._v(" як аргумент.")]),t._v(" "),e("li",[t._v("Крім того, декілька екземплярів серверу можуть бути запущені для симуляції кількох засобів. Клієнт обирає екземпляр через параметр "),e("code",[t._v("--instance")]),t._v(". В скрипті екземпляр доступний за допомогою змінної "),e("code",[t._v("$px4_instance")]),t._v(".")])]),t._v(" "),e("p",[t._v("Модулі можна виконувати з будь-якого терміналу, коли PX4 вже запущено в системі. Наприклад:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("PX4-Autopilot"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/build/px4_sitl_default/bin\n./px4-commander takeoff\n./px4-listener sensor_accel\n")])])]),e("h3",{attrs:{id:"динамічні-модулі"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#динамічні-модулі"}},[t._v("#")]),t._v(" Динамічні модулі")]),t._v(" "),e("p",[t._v("Зазвичай всі модулі компілюються в єдиний виконуваний файл PX4. Однак, на Posix системах, є можливість компіляції модуля в окремий файл, який можна завантажити в PX4 використовуючи команду "),e("code",[t._v("dyn")]),t._v(".")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("dyn ./test.px4mod\n")])])]),e("h2",{attrs:{id:"nuttx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nuttx"}},[t._v("#")]),t._v(" NuttX")]),t._v(" "),e("p",[t._v("NuttX має інтегрований інтерпретатор оболонки ("),e("a",{attrs:{href:"https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=139629410",target:"_blank",rel:"noopener noreferrer"}},[t._v("NuttShell (NSH)"),e("OutboundLink")],1),t._v("), тому скрипти можуть бути виконані безпосередньо.")]),t._v(" "),e("h3",{attrs:{id:"налагодження-завантаження-системи"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#налагодження-завантаження-системи"}},[t._v("#")]),t._v(" Налагодження завантаження системи")]),t._v(" "),e("p",[t._v("Відмова драйверу програмного компонента не призведе до перерваного завантаження. Це контролюється директивою "),e("code",[t._v("set +e")]),t._v(" в скрипті запуску.")]),t._v(" "),e("p",[t._v("Послідовність завантаження можна налагодити під'єднавши "),e("RouterLink",{attrs:{to:"/uk/debug/system_console.html"}},[t._v("системну консоль")]),t._v(" та перезавантажити плату за живленням. Отриманий журнал завантаження містить детальну інформацію про послідовність завантажування і має містити підказки, чому завантаження переривалось.")],1),t._v(" "),e("h4",{attrs:{id:"основні-причини-невдалого-завантаження"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#основні-причини-невдалого-завантаження"}},[t._v("#")]),t._v(" Основні причини невдалого завантаження")]),t._v(" "),e("ul",[e("li",[t._v("Для користувацьких додатків: у системі закінчилася оперативна пам'ять. Виконайте команду "),e("code",[t._v("free")]),t._v(" , щоб побачити кількість вільної оперативної пам'яті.")]),t._v(" "),e("li",[t._v("Відмова програмного забезпечення або припущення яке призвело до трасування стеку.")])]),t._v(" "),e("h3",{attrs:{id:"заміна-запуску-системи"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#заміна-запуску-системи"}},[t._v("#")]),t._v(" Заміна запуску системи")]),t._v(" "),e("p",[t._v("Весь процес завантаження може бути замінений шляхом створення файлу з новою конфігурацією "),e("code",[t._v("/etc/rc.txt")]),t._v(" на картці microSD (ніщо в старій конфігурації не буде автоматично запущено, і якщо файл порожній, зовсім нічого не буде запущено).")]),t._v(" "),e("p",[t._v("Налаштування стандартного завантаження майже завжди є кращим підходом. Це описано нижче.")]),t._v(" "),e("h3",{attrs:{id:"налаштування-запуску-системи"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#налаштування-запуску-системи"}},[t._v("#")]),t._v(" Налаштування запуску системи")]),t._v(" "),e("p",[t._v("Найкращий спосіб змінити запуск системи - це ввести "),e("RouterLink",{attrs:{to:"/uk/dev_airframes/adding_a_new_frame.html"}},[t._v("нову конфігурацію планера")]),t._v(". Файл конфігурації планеру може бути включений у прошивку або на SD карту.")],1),t._v(" "),e("p",[t._v('Якщо вам потрібно "підлаштувати" конфігурацію що існує, наприклад запустити один або більше застосунків або встановити значення кількох параметрів, можна вказати це створивши два файли у директорії '),e("code",[t._v("/etc/")]),t._v(" на SD картці:")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#customizing-the-configuration-config-txt"}},[t._v("/etc/config.txt")]),t._v(": для зміни значення параметрів")]),t._v(" "),e("li",[e("a",{attrs:{href:"#starting-additional-applications-extras-txt"}},[t._v("/etc/extras.txt")]),t._v(": для запуску застосунків")])]),t._v(" "),e("p",[t._v("Ці файли описані нижче.")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("Системні файли завантаження - це UNIX файли, які потребують закінчення рядків UNIX.\nЯкщо редагуєте їх на Windows - використовуйте відповідний редактор.")])]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),e("p",[t._v("Ці файли згадуються в коді PX4 як "),e("code",[t._v("/fs/microsd/etc/config.txt")]),t._v(" та "),e("code",[t._v("/fs/microsd/etc/extras.txt")]),t._v(", де коренева директорія microSD карти визначається шляхом "),e("code",[t._v("/fs/microsd")]),t._v(".")])]),t._v(" "),e("h4",{attrs:{id:"налаштування-конфігураціі-config-txt"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#налаштування-конфігураціі-config-txt"}},[t._v("#")]),t._v(" Налаштування конфігурації (config.txt)")]),t._v(" "),e("p",[t._v("Файл "),e("code",[t._v("config.txt")]),t._v(" можна використовувати для зміни параметрів. Він завантажується після того, як головна система була налаштована та "),e("em",[t._v("перед тим")]),t._v(" як завантажена.")]),t._v(" "),e("p",[t._v("Наприклад, ви можете створити файл на SD картці, "),e("code",[t._v("etc/config.txt")]),t._v(" з такими значеннями параметрів як показано:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("param set-default PWM_MAIN_DIS3 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nparam set-default PWM_MAIN_MIN3 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1120")]),t._v("\n")])])]),e("h4",{attrs:{id:"запуск-додаткових-застосунків-extras-txt"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#запуск-додаткових-застосунків-extras-txt"}},[t._v("#")]),t._v(" Запуск додаткових застосунків (extras.txt)")]),t._v(" "),e("p",[e("code",[t._v("extras.txt")]),t._v(" можна використовувати для запуску додаткових застосунків після завантаження основної системи. Зазвичай це будуть контролери корисного навантаження або подібні необов'язкові користувацькі компоненти.")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("Виклик невідомої команди в файлах завантаження системи може призвести до збою завантаження.\nЗазвичай система не транслює повідомлення mavlink після збою при завантаженні, в такій ситуації перевірте повідомлення про помилки, які виведено в системній консолі.")])]),t._v(" "),e("p",[t._v("Наступний приклад показує, як запускати користувацькі застосунки:")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Створіть файл на SD картці "),e("code",[t._v("etc/extras.txt")]),t._v(" із цим вмістом:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("custom_app start\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Команду можна зробити необов'язковою шляхом оздоблення команди директивами "),e("code",[t._v("set +e")]),t._v(" та "),e("code",[t._v("set -e")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" +e\noptional_app start      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Не призведе до помилки при завантаженні якщо optional_app не знайдено або відмовить")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" -e\n\nmandatory_app start     "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Перерве завантаження якщо mandatory_app не знайдено або відмовить")]),t._v("\n")])])])])])])}),[],!1,null,null,null);a.default=_.exports}}]);