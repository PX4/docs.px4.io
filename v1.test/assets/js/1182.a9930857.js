(window.webpackJsonp=window.webpackJsonp||[]).push([[1182],{2745:function(t,a,s){"use strict";s.r(a);var n=s(19),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"інтерфеис-подіи"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#інтерфеис-подіи"}},[t._v("#")]),t._v(" Інтерфейс подій")]),t._v(" "),s("Badge",{attrs:{type:"tip",text:"PX4 v1.13"}}),t._v(" "),s("p",[t._v("Інтерфейс може використовуватися для публікації подій змін стану або будь-якого іншого типу події, включаючи такі речі, як стан готовності, завершення калібрування і досягнення цільової висоти злету.")]),t._v(" "),s("p",[t._v("Інтерфейс може використовуватися для публікації подій змін стану або будь-якого іншого типу події, включаючи такі речі, як стан готовності, завершення калібрування і досягнення цільової висоти злету.")]),t._v(" "),s("div",{staticClass:"custom-block note"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("p",[t._v("інтерфейс подій замінить використання викликів "),s("code",[t._v("mavlink_log_*")]),t._v(" у коді PX4, (а також повідомлень "),s("code",[t._v("STATUS_TEXT")]),t._v(" у MAVLink) для сповіщення про події в релізах PX4 після v1.13 та новіше. Буде проміжний період коли "),s("a",{attrs:{href:"#backward-compatibility"}},[t._v("обидва підходи будуть підтримуватися")]),t._v(".")])]),t._v(" "),s("h2",{attrs:{id:"застосування"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#застосування"}},[t._v("#")]),t._v(" Застосування")]),t._v(" "),s("h3",{attrs:{id:"основне"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#основне"}},[t._v("#")]),t._v(" Основне")]),t._v(" "),s("p",[t._v("А потім визначте та надішліть подію з бажаного місця коду:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<px4_platform_common/events.h>")])]),t._v("\n")])])]),s("p",[t._v("А потім визначте та надішліть подію з бажаного місця коду:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[t._v("events"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mymodule_test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" events"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Log"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Test Message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"зворотна-сумісність"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#зворотна-сумісність"}},[t._v("#")]),t._v(" Зворотна сумісність")]),t._v(" "),s("p",[t._v("Для старих версій GCS без підтримки інтерфейсу подій, PX4 на цей момент надсилає також всі події як "),s("code",[t._v("mavlink_log_*")]),t._v(" "),s("code",[t._v("STATUSTEXT")]),t._v(" повідомлення. Крім того, повідомлення має бути промарковано додатковою табуляцією ("),s("code",[t._v("\\t")]),t._v("), щоб нові GCS змогли проігнорувати це і показати тільки подію.")]),t._v(" "),s("p",[t._v("Отже, коли ви додаєте подію, не забудьте також додати виклик "),s("code",[t._v("mavlink_log_")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mavlink_log_info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mavlink_log_pub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Test Message\\t"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nevents"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mymodule_test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" events"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Log"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Test Message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Вище - мінімальний приклад, цей - у більш розширеному вигляді:")]),t._v(" "),s("h3",{attrs:{id:"докладно"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#докладно"}},[t._v("#")]),t._v(" Докладно")]),t._v(" "),s("p",[t._v("Пояснення та вимоги:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uint8_t")]),t._v(" arg1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" arg2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.f")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/* EVENT\n * @description\n * Це докладний опис події.\n *\n * - значення arg1: {1}\n * - значення arg2: {2:.1}\n *\n * <profile name="dev">\n * (Цей абзац призначено для показу тільки розробникам).\n * Цю поведінку можна налаштувати за допомогою параметра <param>COM_EXAMPLE</param>.\n * </profile>\n *\n * Посилання на документацію: <a>https://docs.px4.io</a>\n */')]),t._v("\nevents"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token generic-function"}},[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token generic class-name"}},[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uint8_t")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"event_name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Log"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" events"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("LogInternal"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Event Message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Події можуть мати незмінний набір аргументів, які можна вкласти у повідомлення або опис використовуючи шаблонні замінники (наприклад "),s("code",[t._v("{2:.1m}")]),t._v(", дивіться наступний розділ).")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("/* EVENT")]),t._v(": Цей тег вказує, що коментар описує метадані для наступної події.")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("event_name")]),t._v(": ім'я події ("),s("code",[t._v("events::ID(event_name)")]),t._v(").")]),t._v(" "),s("ul",[s("li",[t._v("повинно бути унікальним в межах всього вихідного коду PX4. Як загальне правило, додайте префікс з назвою модуля або вихідного файлу для великих модулів.")]),t._v(" "),s("li",[t._v("має бути дійсна назва змінної, тобто не повинна містити пробіли, двокрапки тощо.")]),t._v(" "),s("li",[t._v("з цього імені отримується 24-бітний ID події за допомогою геш-функції. Це означає, що до тих пір, поки ім'я події залишається однаковим, ID залишиться тим же.")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Рівень журналювання")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("припустимі рівні журналювання такі ж, як і у перерахуванні MAVLink "),s("a",{attrs:{href:"https://mavlink.io/en/messages/common.html#MAV_SEVERITY",target:"_blank",rel:"noopener noreferrer"}},[t._v("MAV_SEVERITY"),s("OutboundLink")],1),t._v(". Рівні перелічені за зменшенням важливості:")]),t._v(" "),s("div",{staticClass:"language-plain extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[t._v("Emergency,\nAlert,\nCritical,\nError,\nWarning,\nNotice,\nInfo,\nDebug,\nDisabled,\n")])])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("- Попередньо ми вказали окремий зовнішній і внутрішній рівень журналювання, які є рівнями для користувачів GCS і в файлі журналу, відповідно: `{events::Log::Error, events::LogInternal::Info}`.\n  Для більшості випадків ви можете передати один рівень журналювання, і це буде використовуватися як для зовнішніх, так і для внутрішніх випадків.\nЄ випадки, коли є сенс мати два різних рівні журналювання.\nНаприклад, дія запобігання RTL: користувач повинен бачити його як Warning/Error, тоді як в журналі це очікувана відповідь системи, тому його можна встановити в `Info`.\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Повідомлення про подію")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("Коротке повідомлення про подію в один рядок. Може мати шаблонні замінники для аргументів (наприклад "),s("code",[t._v("{1}")]),t._v("). Для додаткової інформації дивіться нижче.")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Опис події")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("Докладний, необов'язковий опис події.")]),t._v(" "),s("li",[t._v("Може бути кілька рядів/абзаців.")]),t._v(" "),s("li",[t._v("Може мати шаблонні замінники для аргументів (тобто "),s("code",[t._v("{2}")]),t._v(") та тегів що підтримуються (дивіться нижче).")])])])]),t._v(" "),s("h4",{attrs:{id:"аргументи-та-перерахування"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#аргументи-та-перерахування"}},[t._v("#")]),t._v(" Аргументи та перерахування")]),t._v(" "),s("p",[t._v("Припустимі типи: "),s("code",[t._v("uint8_t")]),t._v(", "),s("code",[t._v("int8_t")]),t._v(", "),s("code",[t._v("uint16_t")]),t._v(", "),s("code",[t._v("int16_t")]),t._v(", "),s("code",[t._v("uint32_t")]),t._v(", "),s("code",[t._v("int32_t")]),t._v(", "),s("code",[t._v("uint64_t")]),t._v(", "),s("code",[t._v("int64_t")]),t._v(" та "),s("code",[t._v("float")]),t._v(".")]),t._v(" "),s("p",[t._v("Ви також можете використати перерахування як аргументи:")]),t._v(" "),s("p",[t._v("Формат тексту для опису повідомлення події:")]),t._v(" "),s("ul",[s("li",[t._v("Користувацькі або характерні для PX4 перерахування для подій повинні бути визначені у "),s("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/src/lib/events/enums.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("src/lib/events/enums.json"),s("OutboundLink")],1),t._v(", та можуть бути використані як аргументи події у формі "),s("code",[t._v("events::send<events::px4::enums::my_enum_t>(...)")]),t._v(".")]),t._v(" "),s("li",[t._v('"Загальні" події MAVLink визначені у '),s("a",{attrs:{href:"https://github.com/mavlink/libevents/blob/master/events/common.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("mavlink/libevents/events/common.json"),s("OutboundLink")],1),t._v(" та можуть бути використані як аргументи подій у формі "),s("code",[t._v("events::send<events::common::enums::my_enum_t>(...)")]),t._v(".")])]),t._v(" "),s("h4",{attrs:{id:"формат-тексту"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#формат-тексту"}},[t._v("#")]),t._v(" Формат тексту")]),t._v(" "),s("p",[t._v("Події записуються відповідно до рівня внутрішнього журналювання, а "),s("RouterLink",{attrs:{to:"/uk/log/flight_review.html"}},[t._v("Огляд польоту")]),t._v(" показує події.")],1),t._v(" "),s("ul",[s("li",[s("p",[t._v("символи можна екранувати за допомогою \\")]),t._v(" "),s("p",[t._v("Ці символи повинні бути екрановані: '\\\\', '\\<', '\\{'.")])]),t._v(" "),s("li",[s("p",[t._v("теги що підтримуються:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Профілі: "),s("code",[t._v('<profile name="[!]NAME">CONTENT</profile>')])]),t._v(" "),s("p",[s("code",[t._v("CONTENT")]),t._v(" буде показано, лише якщо назва збігається з налаштованим профілем. Це може бути використано, наприклад, щоб приховати інформацію для розробників від кінцевих користувачів.")])]),t._v(" "),s("li",[s("p",[t._v("URL: "),s("code",[t._v('<a [href="URL"]>CONTENT</a>')]),t._v(". Якщо "),s("code",[t._v("href")]),t._v(" не встановлено, використовуйте "),s("code",[t._v("CONTENT")]),t._v(" як "),s("code",[t._v("URL")]),t._v(" (наприклад "),s("code",[t._v("<a>https://docs.px4.io</a>")]),t._v("  сприймається як "),s("code",[t._v('<a href="https://docs.px4.io">https://docs.px4.io</a>')]),t._v(")")])]),t._v(" "),s("li",[s("p",[t._v("Параметри: "),s("code",[t._v("<param>PARAM_NAME</param>")])])]),t._v(" "),s("li",[s("p",[t._v("не дозволено використовувати вкладені теги того ж типу")])])])]),t._v(" "),s("li",[s("p",[t._v("аргументи: шаблонні замінники, що відповідають синтаксису python з індексацією що починається з 1 (замість 0)")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("загальна форма: "),s("code",[t._v("{ARG_IDX[:.NUM_DECIMAL_DIGITS][UNIT]}")])]),t._v(" "),s("p",[t._v("UNIT:")]),t._v(" "),s("ul",[s("li",[t._v("m: горизонтальна відстань в метрах")]),t._v(" "),s("li",[t._v("m_v: вертикальна відстань в метрах")]),t._v(" "),s("li",[t._v("m^2: площа в метрах квадратних")]),t._v(" "),s("li",[t._v("m/s: швидкість у метрах в секунду")]),t._v(" "),s("li",[t._v("C: температура у градусах Цельсія")])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("NUM_DECIMAL_DIGITS")]),t._v(" підходить тільки для аргументів у вигляді дійсних чисел.")])])])])]),t._v(" "),s("h2",{attrs:{id:"журналювання"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#журналювання"}},[t._v("#")]),t._v(" Журналювання")]),t._v(" "),s("p",[t._v("Події записуються відповідно до рівня внутрішнього журналювання, а "),s("RouterLink",{attrs:{to:"/uk/log/flight_review.html"}},[t._v("Огляд польоту")]),t._v(" показує події.")],1),t._v(" "),s("div",{staticClass:"custom-block note"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("p",[t._v("Огляд польоту завантажує метадані на основі головної гілки PX4, тому, якщо визначення ще немає на головній гілці, огляд зможе показати тільки ID події.")])]),t._v(" "),s("h2",{attrs:{id:"реалізація"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#реалізація"}},[t._v("#")]),t._v(" Реалізація")]),t._v(" "),s("p",[t._v("Метадані для всіх подій вбудовані в окремий JSON файл метаданих (з використанням python скрипту, який сканує весь вихідний код у пошуках викликів подій).")]),t._v(" "),s("p",[t._v("Метадані для всіх подій вбудовані в окремий JSON файл метаданих (з використанням python скрипту, який сканує весь вихідний код у пошуках викликів подій).")]),t._v(" "),s("h3",{attrs:{id:"публікація-метаданих-подіі-в-gcs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#публікація-метаданих-подіі-в-gcs"}},[t._v("#")]),t._v(" Публікація метаданих події в GCS")]),t._v(" "),s("p",[t._v("Цей процес такий самий як і для "),s("RouterLink",{attrs:{to:"/uk/advanced/parameters_and_configurations.html#publishing-parameter-metadata-to-a-gcs"}},[t._v("метаданих параметрів")]),t._v(". Для отримання додаткової інформації див. "),s("RouterLink",{attrs:{to:"/uk/advanced/px4_metadata.html"}},[t._v(" Метадані PX4 (трансляція і публікація)")]),t._v(".")],1),t._v(" "),s("p",[t._v("Цей процес такий самий як і для "),s("RouterLink",{attrs:{to:"/uk/advanced/parameters_and_configurations.html#publishing-parameter-metadata-to-a-gcs"}},[t._v("метаданих параметрів")]),t._v(". Для отримання додаткової інформації див. "),s("RouterLink",{attrs:{to:"/uk/advanced/px4_metadata.html"}},[t._v(" Метадані PX4 (трансляція і публікація)")]),t._v(".")],1)],1)}),[],!1,null,null,null);a.default=e.exports}}]);