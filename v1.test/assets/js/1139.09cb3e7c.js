(window.webpackJsonp=window.webpackJsonp||[]).push([[1139],{2655:function(a,t,s){"use strict";s.r(t);var e=s(19),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"параметри-та-налаштування"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#параметри-та-налаштування"}},[a._v("#")]),a._v(" Параметри та налаштування")]),a._v(" "),s("p",[a._v("PX4 використовує "),s("em",[a._v("param subsystem")]),a._v(" (таблицю значень "),s("code",[a._v("float")]),a._v(" і "),s("code",[a._v("int32_t")]),a._v(") і текстові файли (для скриптів запуску) для створення конфігурації.")]),a._v(" "),s("p",[a._v("У цьому розділі детально розглянуто підсистему "),s("em",[a._v("param")]),a._v(". У ньому описано, як відображати, зберігати і завантажувати параметри, а також як їх описувати і робити доступними для наземних станцій.")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[s("RouterLink",{attrs:{to:"/uk/concept/system_startup.html"}},[a._v("Запуск системи")]),a._v(" та роботу скриптів запуску "),s("RouterLink",{attrs:{to:"/uk/dev_airframes/adding_a_new_frame.html"}},[a._v("конфігурації фреймів")]),a._v(" описано на інших сторінках.")],1)]),a._v(" "),s("h2",{attrs:{id:"використання-командного-рядка"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#використання-командного-рядка"}},[a._v("#")]),a._v(" Використання командного рядка")]),a._v(" "),s("p",[s("RouterLink",{attrs:{to:"/uk/debug/system_console.html"}},[a._v("Системна консоль PX4")]),a._v(" пропонує інструмент "),s("RouterLink",{attrs:{to:"/uk/modules/modules_command.html#param"}},[a._v("param")]),a._v(", за допомогою якого можна встановлювати параметри, зчитувати їх значення, зберігати їх, а також експортувати й зберігати у файлах та відновлювати з них.")],1),a._v(" "),s("h3",{attrs:{id:"отримання-та-встановлення-параметрів"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#отримання-та-встановлення-параметрів"}},[a._v("#")]),a._v(" Отримання та встановлення параметрів")]),a._v(" "),s("p",[a._v("Команда "),s("code",[a._v("param show")]),a._v(" виводить усі параметри системи:")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("param show\n")])])]),s("p",[a._v('Для більшої вибірковості можна використовувати часткове ім\'я параметра з символом підстановки "*":')]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("nsh"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" param show RC_MAP_A*\nSymbols: x "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" used, + "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" saved, * "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" unsaved\nx   RC_MAP_AUX1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("359,498")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nx   RC_MAP_AUX2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("360,499")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nx   RC_MAP_AUX3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("361,500")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nx   RC_MAP_ACRO_SW "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("375,514")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n\n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("723")]),a._v(" parameters total, "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("532")]),a._v(" used.\n")])])]),s("p",[a._v("Ви можете використовувати прапорець "),s("code",[a._v("-c")]),a._v(", щоб показати всі параметри, які було змінено (порівняно з їх значеннями за замовчуванням):")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("param show -c\n")])])]),s("p",[a._v("Ви можете використати "),s("code",[a._v("param show-for-airframe")]),a._v(", щоб показати всі параметри, які було змінено від значень за замовчуванням лише для поточного файлу літального апарату (та значень за замовчуванням, які він імпортує).")]),a._v(" "),s("h3",{attrs:{id:"параметри-експорту-та-завантаження"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#параметри-експорту-та-завантаження"}},[a._v("#")]),a._v(" Параметри експорту та завантаження")]),a._v(" "),s("p",[a._v("Ви можете зберігати будь-які параметри, які були "),s("em",[a._v("змінені")]),a._v(" (які відрізняються від параметрів за замовчуванням).")]),a._v(" "),s("p",[a._v("Стандартна команда "),s("code",[a._v("param save")]),a._v(" збереже параметри у поточному файлі за замовчуванням:")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("param save\n")])])]),s("p",[a._v("Якщо вказати аргумент, вона збереже параметри у новому каталозі:")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("param save /fs/microsd/vtol_param_backup\n")])])]),s("p",[a._v("Існує дві різні команди для "),s("em",[a._v("завантаження")]),a._v(" параметрів:")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("param load")]),a._v(" спочатку виконує повне скидання всіх параметрів до значень за замовчуванням, а потім перезаписує значення параметрів будь-якими значеннями, збереженими у файлі.")]),a._v(" "),s("li",[s("code",[a._v("param import")]),a._v(" просто перезаписує значення параметрів значеннями з файлу, а потім зберігає результат (тобто фактично викликає "),s("code",[a._v("param save")]),a._v(").")])]),a._v(" "),s("p",[a._v("Команда "),s("code",[a._v("load")]),a._v(' ефективно скидає параметри до стану, у якому вони були збережені (ми говоримо "ефективно", тому що будь-які параметри, збережені у файлі, буде оновлено, але інші параметри можуть мати інші значення за замовчуванням, визначені у прошивці, ніж під час створення файлу параметрів).')]),a._v(" "),s("p",[a._v("На противагу цьому, "),s("code",[a._v("import")]),a._v(" об'єднує параметри у файлі з поточним станом апарату. Наприклад, можна просто імпортувати файл параметрів, що містить дані калібрування, не перезаписуючи решту конфігурації системи.")]),a._v(" "),s("p",[a._v("Приклади для обох випадків показані нижче:")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Reset the parameters to when file was saved")]),a._v("\nparam load /fs/microsd/vtol_param_backup\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Optionally save params (not done automatically with load)")]),a._v("\nparam save\n")])])]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Merge the saved parameters with current parameters")]),a._v("\nparam "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("import")]),a._v(" /fs/microsd/vtol_param_backup\n")])])]),s("h2",{attrs:{id:"створення-визначення-параметрів"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#створення-визначення-параметрів"}},[a._v("#")]),a._v(" Створення/визначення параметрів")]),a._v(" "),s("p",[a._v("Опис параметрів складається з двох частин:")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#parameter-metadata"}},[a._v("Метадані параметрів")]),a._v(" визначають значення за замовчуванням для кожного параметра у прошивці разом з іншими метаданими для відображення (і редагування) параметрів на наземних станціях керування та у документації.")]),a._v(" "),s("li",[s("a",{attrs:{href:"#c-c-api"}},[a._v("Код C/C++")]),a._v(", який надає доступ до отримання та/або зміни значень параметрів з модулів та драйверів PX4.")])]),a._v(" "),s("p",[a._v("Нижче описано кілька підходів до написання метаданих та коду. Де це можливо, код повинен використовувати оновлені "),s("a",{attrs:{href:"#yaml-metadata"}},[a._v("метадані YAML")]),a._v(" та "),s("a",{attrs:{href:"#c-api"}},[a._v("C++ API")]),a._v(", а не старі визначення параметрів/коду C, оскільки вони є більш гнучкими та надійними.")]),a._v(" "),s("p",[a._v("Метадані параметрів "),s("a",{attrs:{href:"#publishing-parameter-metadata-to-a-gcs"}},[a._v("компілюються у прошивку")]),a._v(", і надаються наземним станціям за посередництвом служби "),s("a",{attrs:{href:"https://mavlink.io/en/services/component_information.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("MAVLink Component Information service"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("h3",{attrs:{id:"назви-параметрів"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#назви-параметрів"}},[a._v("#")]),a._v(" Назви параметрів:")]),a._v(" "),s("p",[a._v("Назви параметрів не повинні перевищувати 16 ASCII символів.")]),a._v(" "),s("p",[a._v("За загальним правилом, кожен параметр у групі повинен мати однаковий (значущий) префікс, за яким слідує символ підкреслення, а "),s("code",[a._v("MC_")]),a._v(" і "),s("code",[a._v("FW_")]),a._v(" використовуються для параметрів, що відносяться саме до мультикоптерних або систем з фіксованим крилом. Ця конвенція не є обов'язковою.")]),a._v(" "),s("p",[a._v("Назва має збігатися як у коді, так і у метаданих "),s("a",{attrs:{href:"#parameter-metadata"}},[a._v("параметру")]),a._v(", щоб правильно асоціювати параметр з його метаданими (включно зі значенням за замовчуванням у прошивці).")]),a._v(" "),s("h3",{attrs:{id:"c-c-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#c-c-api"}},[a._v("#")]),a._v(" C / C++ API")]),a._v(" "),s("p",[a._v("Існують окремі C і C++ API, які можна використовувати для отримання доступу до значень параметрів з модулів і драйверів PX4.")]),a._v(" "),s("p",[a._v("Однією з важливих відмінностей між API є те, що версія на C++ має більш ефективний стандартизований механізм синхронізації зі змінами значень параметрів (наприклад, з GCS).")]),a._v(" "),s("p",[a._v("Синхронізація важлива, оскільки параметр може бути змінений на інше значення в будь-який момент. Ваш код повинен "),s("em",[a._v("завжди")]),a._v(" використовувати поточне значення зі сховища даних. Якщо отримати останню версію неможливо, то після зміни параметра буде потрібно перезавантаження ( вкажіть цю вимогу за допомогою метаданих "),s("code",[a._v("@reboot_required")]),a._v(").")]),a._v(" "),s("p",[a._v("Крім того, версія на C++ має кращу типізацію та менші витрати оперативної пам'яті. Недоліком є те, що ім'я параметра має бути відоме під час компіляції, тоді як C API може приймати динамічно створене ім'я як рядок.")]),a._v(" "),s("h4",{attrs:{id:"c-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#c-api"}},[a._v("#")]),a._v(" C++ API")]),a._v(" "),s("p",[a._v("C++ API надає макроси для оголошення параметрів як "),s("em",[a._v("атрибутів класу")]),a._v('. Ви додаєте якийсь "шаблонний" код для регулярного виявлення змін у '),s("RouterLink",{attrs:{to:"/uk/middleware/uorb.html"}},[a._v("uORB Topic")]),a._v(", пов'язаних з "),s("em",[a._v("будь-яким")]),a._v(" оновленням параметрів. Потім код фреймворку (невидимо) відстежує повідомлення uORB, які впливають на атрибути ваших параметрів, і підтримує їх синхронізацію. У решті коду ви можете просто використовувати визначені атрибути параметрів, і вони завжди будуть актуальними!")],1),a._v(" "),s("p",[a._v("Насамперед включіть необхідні заголовки до заголовка класу вашого модуля або драйвера:")]),a._v(" "),s("ul",[s("li",[s("p",[s("strong",[a._v("px4_platform_common/module_params.h")]),a._v(" для отримання макросу "),s("code",[a._v("DEFINE_PARAMETERS")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[a._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[a._v("include")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("<px4_platform_common/module_params.h>")])]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("parameter_update.h")]),a._v(" для доступу до повідомлень uORB "),s("code",[a._v("parameter_update")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[a._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[a._v("include")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("<uORB/topics/parameter_update.h>")])]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("Subscription.hpp")]),a._v(" для uORB C++ API підписки:")]),a._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[a._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[a._v("include")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("<uORB/Subscription.hpp>")])]),a._v("\n")])])])])]),a._v(" "),s("p",[a._v("Створіть свій клас з "),s("code",[a._v("ModuleParams")]),a._v(" і використовуйте "),s("code",[a._v("DEFINE_PARAMETERS")]),a._v(", щоб вказати список параметрів і пов'язані з ними атрибути класу. Назви параметрів мають збігатися з визначеннями метаданих параметрів.")]),a._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MyModule")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token base-clause"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ModuleParams")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Check for parameter changes and update them if needed.\n     */")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("parameters_update")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("DEFINE_PARAMETERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ParamInt"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("px4"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[a._v("::")]),a._v("params"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[a._v("::")]),a._v("SYS_AUTOSTART"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" _sys_autostart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**< example parameter */")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ParamFloat"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("px4"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[a._v("::")]),a._v("params"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[a._v("::")]),a._v("ATT_BIAS_MAX"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" _att_bias_max  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**< another parameter */")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Subscriptions")]),a._v("\n    uORB"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[a._v("::")]),a._v("SubscriptionInterval _parameter_update_sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ORB_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parameter_update"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("_s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Оновіть файл cpp за допомогою шаблону, щоб перевірити наявність повідомлення uORB, пов'язаного з оновленням параметрів.")]),a._v(" "),s("p",[a._v("Періодично викликайте "),s("code",[a._v("parameters_update();")]),a._v(" у коді, щоб перевірити, чи відбулося оновлення:")]),a._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Module")]),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[a._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("parameters_update")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("_parameter_update_sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updated")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        parameter_update_s param_update"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        _parameter_update_sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("param_update"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// If any parameter updated, call updateParams() to check if")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// this class attributes need updating (and do so).")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateParams")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("У наведеному вище методі:")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("_param_update_sub.updated()")]),a._v(" повідомляє нам, чи є "),s("em",[a._v("будь-яке")]),a._v(" оновлення в uORB-повідомленні "),s("code",[a._v("param_update")]),a._v(" (але не вказує, який саме параметр змінено).")]),a._v(" "),s("li",[a._v('Якщо було оновлено "деякий" параметр, ми копіюємо оновлення у '),s("code",[a._v("parameter_update_s")]),a._v(" ("),s("code",[a._v("param_update")]),a._v("), щоб очистити очікуване оновлення.")]),a._v(" "),s("li",[a._v("Потім викликаємо "),s("code",[a._v("ModuleParams::updateParams()")]),a._v('. Це "під капотом" оновлює всі атрибути параметрів, перелічені у нашому списку '),s("code",[a._v("DEFINE_PARAMETERS")]),a._v(".")])]),a._v(" "),s("p",[a._v("Атрибути параметрів ("),s("code",[a._v("_sys_autostart")]),a._v(" і "),s("code",[a._v("_att_bias_max")]),a._v(" у цьому випадку) можна використовувати для відображення параметрів, і вони будуть оновлюватися щоразу, коли значення параметра змінюватиметься.")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("Шаблон "),s("RouterLink",{attrs:{to:"/uk/modules/module_template.html"}},[a._v("Програми/Модуля")]),a._v(" використовує новий стиль C++ API, але не включає метадані "),s("a",{attrs:{href:"#parameter-metadata"}},[a._v("параметрів")]),a._v(".")],1)]),a._v(" "),s("h4",{attrs:{id:"c-api-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#c-api-2"}},[a._v("#")]),a._v(" C API")]),a._v(" "),s("p",[a._v("C API можна використовувати як у модулях, так і в драйверах.")]),a._v(" "),s("p",[a._v("Спочатку включіть параметр API:")]),a._v(" "),s("div",{staticClass:"language-C extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[a._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[a._v("include")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("<parameters/param.h>")])]),a._v("\n")])])]),s("p",[a._v("Потім отримайте параметр і присвойте його змінній (тут "),s("code",[a._v("my_param")]),a._v("), як показано нижче для "),s("code",[a._v("PARAM_NAME")]),a._v(". Змінна "),s("code",[a._v("my_param")]),a._v(" може бути використана в коді вашого модуля.")]),a._v(" "),s("div",{staticClass:"language-C extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("int32_t")]),a._v(" my_param "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("param_get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("param_find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"PARAM_NAME"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("my_param"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"custom-block note"},[s("p",{staticClass:"custom-block-title"},[a._v("Note")]),a._v(" "),s("p",[a._v("Якщо у метаданих параметра було оголошено "),s("code",[a._v("PARAM_NAME")]),a._v(", то буде встановлене його значення за замовчуванням, і наведений вище виклик для пошуку параметра завжди буде успішним.")])]),a._v(" "),s("p",[s("code",[a._v("param_find()")]),a._v(' є "дорогою" операцією, яка повертає хендл, що може бути використаний '),s("code",[a._v("param_get()")]),a._v(". Якщо ви збираєтеся читати параметр багато разів, ви можете кешувати хендл і використовувати його в "),s("code",[a._v("param_get()")]),a._v(" за потреби")]),a._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[a._v("#")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token expression"}},[a._v("Get the handle to the parameter")])]),a._v("\nparam_t my_param_handle "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" PARAM_INVALID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nmy_param_handle "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("param_find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"PARAM_NAME"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[a._v("#")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token expression"}},[a._v("Query the value of the parameter when needed")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int32_t")]),a._v(" my_param "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("param_get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("my_param_handle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("my_param"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h3",{attrs:{id:"метадані-параметра"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#метадані-параметра"}},[a._v("#")]),a._v(" Метадані параметра")]),a._v(" "),s("p",[a._v("PX4 використовує розгалужену систему метаданих параметрів для управління дружнім до користувача представленням параметрів, а також для встановлення значень за замовчуванням для кожного параметра у прошивці.")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("Правильні метадані мають вирішальне значення для якісного користувацького досвіду на наземній станції.")])]),a._v(" "),s("p",[a._v("Метадані параметрів можна зберігати будь-де у дереві коду у вигляді визначень параметрів "),s("strong",[a._v(".c")]),a._v(" або "),s("strong",[a._v(".yaml")]),a._v(" (визначення параметрів у форматі YAML є новішим і гнучкішим). Зазвичай він зберігається разом з відповідним модулем.")]),a._v(" "),s("p",[a._v("Система збірки витягує метадані (за допомогою "),s("code",[a._v("make parameters_metadata")]),a._v(") для створення "),s("RouterLink",{attrs:{to:"/uk/advanced_config/parameter_reference.html"}},[a._v("довідника параметрів")]),a._v(" та інформації про параметри, "),s("a",{attrs:{href:"#publishing-parameter-metadata-to-a-gcs"}},[a._v("що використовуються наземними станціями")]),a._v(".")],1),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),a._v(" "),s("p",[a._v("Після додавання файлу параметрів "),s("em",[a._v("new")]),a._v(" вам слід викликати "),s("code",[a._v("make clean")]),a._v(" перед збіркою, щоб згенерувати нові параметри (файли параметрів додаються як частина кроку конфігурації "),s("em",[a._v("cmake")]),a._v(", який відбувається для чистих збірок і якщо файл cmake змінено).")])]),a._v(" "),s("h4",{attrs:{id:"метадані-yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#метадані-yaml"}},[a._v("#")]),a._v(" Метадані YAML")]),a._v(" "),s("div",{staticClass:"custom-block note"},[s("p",{staticClass:"custom-block-title"},[a._v("Note")]),a._v(" "),s("p",[a._v("На момент написання статті визначення параметрів YAML не можна використовувати у "),s("em",[a._v("бібліотеках")]),a._v(".")])]),a._v(" "),s("p",[a._v("Метадані YAML призначені для повної заміни "),s("strong",[a._v(".c")]),a._v(" визначень. Він підтримує ті самі метадані, а також нові можливості, такі як множинні визначення.")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("Схема метаданих параметрів YAML знаходиться тут: "),s("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/validation/module_schema.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("validation/module_schema.yaml"),s("OutboundLink")],1),a._v(".")])]),a._v(" "),s("li",[s("p",[a._v("Приклад використання визначень YAML можна знайти у визначенні параметрів MAVLink: "),s("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/src/modules/mavlink/module.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("/src/modules/mavlink/module.yaml"),s("OutboundLink")],1),a._v(".")])]),a._v(" "),s("li",[s("p",[a._v("YAML-файл реєструється у системі збірки cmake шляхом додавання")]),a._v(" "),s("div",{staticClass:"language-cmake extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[a._v("MODULE_CONFIG\n  module.yaml\n")])])]),s("p",[a._v("до секції "),s("code",[a._v("px4_add_module")]),a._v(" файлу "),s("code",[a._v("CMakeLists.txt")]),a._v(" цього модуля.")])])]),a._v(" "),s("h4",{attrs:{id:"мета-дані-yaml-з-багатьма-екземплярами-шаблонами"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#мета-дані-yaml-з-багатьма-екземплярами-шаблонами"}},[a._v("#")]),a._v(" Мета-дані YAML з багатьма екземплярами (шаблонами)")]),a._v(" "),s("p",[a._v("Шаблонні визначення параметрів підтримуються у "),s("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/validation/module_schema.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("YAML визначеннях параметрів"),s("OutboundLink")],1),a._v(" (шаблонний код параметрів не підтримується).")]),a._v(" "),s("p",[a._v("YAML дозволяє визначати кількість екземплярів у назвах параметрів, описах, тощо за допомогою "),s("code",[a._v("${i}")]),a._v(". Наприклад, нижче буде згенеровано MY_PARAM_1_RATE, MY_PARAM_2_RATE і т.д.")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v("MY_PARAM_$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("_RATE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("short")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Maximum rate for instance $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("Наступні визначення YAML містять початковий та кінцевий індекси.")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("num_instances")]),a._v(" (за замовчуванням 1): Кількість інстансів, які потрібно згенерувати (>=1)")]),a._v(" "),s("li",[s("code",[a._v("instance_start")]),a._v(" (за замовчуванням 0): Номер першого інстансу. Якщо 0, "),s("code",[a._v("${i}")]),a._v(" розширюється до [0, N-1]`.")])]),a._v(" "),s("p",[a._v("Повний приклад див. у визначенні параметрів MAVLink: "),s("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/src/modules/mavlink/module.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("/src/modules/mavlink/module.yaml"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("h4",{attrs:{id:"c-параметр-метаданих"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#c-параметр-метаданих"}},[a._v("#")]),a._v(" c параметр метаданих")]),a._v(" "),s("p",[a._v("Застарілий підхід для визначення метаданих параметрів знаходиться у файлі з розширенням "),s("strong",[a._v(".c")]),a._v(" (на момент написання цієї статті це підхід, який найчастіше використовується у дереві коду).")]),a._v(" "),s("p",[a._v("Розділи метаданих параметрів виглядають так, як показано в наступних прикладах:")]),a._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * Pitch P gain\n *\n * Pitch proportional gain, i.e. desired angular speed in rad/s for error 1 rad.\n *\n * @unit 1/s\n * @min 0.0\n * @max 10\n * @decimal 2\n * @increment 0.0005\n * @reboot_required true\n * @group Multicopter Attitude Control\n */")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("PARAM_DEFINE_FLOAT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("MC_PITCH_P"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6.5f")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * Acceleration compensation based on GPS\n * velocity.\n *\n * @group Attitude Q estimator\n * @boolean\n */")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("PARAM_DEFINE_INT32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ATT_ACC_COMP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Макрос "),s("code",[a._v("PARAM_DEFINE_*")]),a._v(" в кінці визначає тип параметра ("),s("code",[a._v("PARAM_DEFINE_FLOAT")]),a._v(" або "),s("code",[a._v("PARAM_DEFINE_INT32")]),a._v("), ім'я параметра (яке має відповідати імені, що використовується у коді) та значення за замовчуванням у прошивці.")]),a._v(" "),s("p",[a._v("Рядки в блоці коментарів є необов'язковими, і в основному використовуються для керування параметрами відображення та редагування на наземній станції. Призначення кожного рядка наведено нижче (докладніше див. "),s("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/validation/module_schema.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("module_schema.yaml"),s("OutboundLink")],1),a._v(").")]),a._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('/**\n * <title>\n *\n * <longer description, can be multi-line>\n *\n * @unit <the unit, e.g. m for meters>\n * @min <the minimum sane value. Can be overridden by the user>\n * @max <the maximum sane value. Can be overridden by the user>\n * @decimal <the minimum sane value. Can be overridden by the user>\n * @increment <the "ticks" in which this value will increment in the UI>\n * @reboot_required true <add this if changing the param requires a system restart.>\n * @boolean <add this for integer parameters that represent a boolean value>\n * @group <a title for parameters that form a group>\n */')]),a._v("\n")])])]),s("h2",{attrs:{id:"публікація-метаданих-параметрів-у-gcs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#публікація-метаданих-параметрів-у-gcs"}},[a._v("#")]),a._v(" Публікація метаданих параметрів у GCS")]),a._v(" "),s("p",[a._v("JSON-файл метаданих параметрів компілюється у прошивку (або хоститься в Інтернеті) і стає доступним наземним станціям через службу "),s("a",{attrs:{href:"https://mavlink.io/en/services/component_information.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("MAVLink Component Metadata Service"),s("OutboundLink")],1),a._v(". Це гарантує, що метадані завжди актуальні для коду, який виконується на апараті.")]),a._v(" "),s("p",[a._v("Цей процес такий самий, як і для метаданих "),s("RouterLink",{attrs:{to:"/uk/concept/events_interface.html#publishing-event-metadata-to-a-gcs"}},[a._v("подій")]),a._v(". Для отримання додаткової інформації див. "),s("RouterLink",{attrs:{to:"/uk/advanced/px4_metadata.html"}},[a._v(" Метадані PX4 (Переклад і публікація)")]),a._v(".")],1),a._v(" "),s("h2",{attrs:{id:"подальша-інформація"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#подальша-інформація"}},[a._v("#")]),a._v(" Подальша інформація")]),a._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/uk/advanced_config/parameters.html"}},[a._v("Пошук/оновлення параметрів")])],1),a._v(" "),s("li",[s("RouterLink",{attrs:{to:"/uk/advanced_config/parameter_reference.html"}},[a._v("Довідник параметрів")])],1),a._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/PX4/PX4-Autopilot/blob/main/platforms/common/include/px4_platform_common/param.h#L129",target:"_blank",rel:"noopener noreferrer"}},[a._v("Реалізація параметрів"),s("OutboundLink")],1),a._v(" (інформація про "),s("code",[a._v(".get()")]),a._v(", "),s("code",[a._v(".commit()")]),a._v(" та інші методи)")])])])}),[],!1,null,null,null);t.default=n.exports}}]);