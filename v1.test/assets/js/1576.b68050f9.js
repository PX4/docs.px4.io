(window.webpackJsonp=window.webpackJsonp||[]).push([[1576],{3359:function(e,t,a){"use strict";a.r(t);var s=a(19),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"px4-ros-2-navigation-interface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#px4-ros-2-navigation-interface"}},[e._v("#")]),e._v(" PX4 ROS 2 Navigation Interface")]),e._v(" "),a("Badge",{attrs:{type:"warning",text:"main (PX4 v1.15)"}}),e._v(" "),a("Badge",{attrs:{type:"warning",text:"Experimental"}}),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("Experimental\nAt the time of writing, parts of the PX4 ROS 2 Interface Library are experimental, and hence subject to change.")])]),e._v(" "),a("p",[e._v("The "),a("RouterLink",{attrs:{to:"/uk/ros2/px4_ros2_interface_lib.html"}},[e._v("PX4 ROS 2 Interface Library")]),e._v(" navigation interface enables developers to send their position measurements to PX4 directly from ROS 2 applications, such as a VIO system or a map matching system.\nThe interface provides a layer of abstraction from PX4 and the uORB messaging framework, and introduces a few sanity checks on the requested state estimation updates sent via the interface.\nThese measurements are then fused into the EKF just as though they were internal PX4 measurements.")],1),e._v(" "),a("p",[e._v("The library provides two classes, "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/classpx4__ros2_1_1LocalPositionMeasurementInterface.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("LocalPositionMeasurementInterface")]),a("OutboundLink")],1),e._v(" and "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/classpx4__ros2_1_1GlobalPositionMeasurementInterface.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("GlobalPositionMeasurementInterface")]),a("OutboundLink")],1),e._v(", which both expose a similar "),a("code",[e._v("update")]),e._v(" method to provide either a local position or global position update to PX4, respectively.\nThe "),a("code",[e._v("update")]),e._v(" method expects a position measurement "),a("code",[e._v("struct")]),e._v(" ("),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/structpx4__ros2_1_1LocalPositionMeasurement.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("LocalPositionMeasurement")]),a("OutboundLink")],1),e._v(" or "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/structpx4__ros2_1_1GlobalPositionMeasurement.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("GlobalPositionMeasurement")]),a("OutboundLink")],1),e._v(") which developers can populate with their own generated position measurements.")]),e._v(" "),a("h2",{attrs:{id:"installation-and-first-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installation-and-first-test"}},[e._v("#")]),e._v(" Installation and First Test")]),e._v(" "),a("p",[e._v("The following steps are required to get started:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Make sure you have a working "),a("RouterLink",{attrs:{to:"/uk/ros/ros2_comm.html"}},[e._v("ROS 2 setup")]),e._v(", with "),a("a",{attrs:{href:"https://github.com/PX4/px4_msgs",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("px4_msgs")]),a("OutboundLink")],1),e._v(" in the ROS 2 workspace.")],1)]),e._v(" "),a("li",[a("p",[e._v("Clone the repository into the workspace:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$ros_workspace")]),e._v("/src\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone --recursive https://github.com/Auterion/px4-ros2-interface-lib\n")])])]),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),a("p",[e._v("To ensure compatibility, use the latest "),a("em",[e._v("main")]),e._v(" branches for PX4, "),a("em",[e._v("px4_msgs")]),e._v(" and the library.\nSee also "),a("a",{attrs:{href:"https://github.com/Auterion/px4-ros2-interface-lib#compatibility-with-px4",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(".")])])])]),e._v(" "),a("p",[e._v(":::")]),e._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[e._v("Build the workspace:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code")])])]),e._v(" "),a("li",[a("p",[e._v("In a different shell, start PX4 SITL:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code")])]),a("p",[e._v("(here we use Gazebo-Classic, but you can use any model or simulator)")])]),e._v(" "),a("li",[a("p",[e._v("In yet a different shell, run the micro XRCE agent (you can keep it running afterward):")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code")])])]),e._v(" "),a("li",[a("p",[e._v("Back in the ROS 2 terminal, source the workspace you just built (in step 3) and run the "),a("a",{attrs:{href:"https://github.com/Auterion/px4-ros2-interface-lib/tree/main/examples/cpp/navigation/global_navigation",target:"_blank",rel:"noopener noreferrer"}},[e._v("global_navigation"),a("OutboundLink")],1),e._v(" example, which periodically sends dummy global position updates:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code")])]),a("p",[e._v("You should get an output like this showing that the global interface is successfully sending position updates:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1702030701.836897756")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("example_global_navigation_node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(": example_global_navigation_node running"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("DEBUG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1702030702.837279784")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("example_global_navigation_node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(": Successfully sent position update to navigation interface.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("DEBUG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1702030703.837223884")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("example_global_navigation_node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(": Successfully sent position update to navigation interface.\n")])])])]),e._v(" "),a("li",[a("p",[e._v("In the PX4 shell, you can check that PX4 receives global position updates:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("listener aux_global_position\n")])])]),a("p",[e._v("The output should look like:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code")])])]),e._v(" "),a("li",[a("p",[e._v("Now you are ready to use the navigation interface to send your own position updates.")])])]),e._v(" "),a("h2",{attrs:{id:"how-to-use-the-library"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-use-the-library"}},[e._v("#")]),e._v(" How to use the Library")]),e._v(" "),a("p",[e._v("To send a position measurement, you populate the position struct with the values you have measured.\nThen call the interface's update function with that struct as the argument.")]),e._v(" "),a("p",[e._v("For a basic example of how to use this interface, check out the "),a("a",{attrs:{href:"https://github.com/Auterion/px4-ros2-interface-lib/tree/main/examples/cpp/navigation",target:"_blank",rel:"noopener noreferrer"}},[e._v("examples"),a("OutboundLink")],1),e._v(" in the "),a("code",[e._v("Auterion/px4-ros2-interface-lib")]),e._v(" repository, such as "),a("a",{attrs:{href:"https://github.com/Auterion/px4-ros2-interface-lib/blob/main/examples/cpp/navigation/local_navigation/include/local_navigation.hpp",target:"_blank",rel:"noopener noreferrer"}},[e._v("examples/cpp/navigation/local_navigation"),a("OutboundLink")],1),e._v(" or "),a("a",{attrs:{href:"https://github.com/Auterion/px4-ros2-interface-lib/blob/main/examples/cpp/navigation/local_navigation/include/global_navigation.hpp",target:"_blank",rel:"noopener noreferrer"}},[e._v("examples/cpp/navigation/global_navigation"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"local-position-updates"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#local-position-updates"}},[e._v("#")]),e._v(" Local Position Updates")]),e._v(" "),a("p",[e._v("First ensure that the PX4 parameter "),a("RouterLink",{attrs:{to:"/uk/advanced_config/parameter_reference.html#EKF2_EV_CTRL"}},[a("code",[e._v("EKF2_EV_CTRL")])]),e._v(" is properly configured to fuse external local measurements, by setting the appropriate bits to "),a("code",[e._v("true")]),e._v(":")],1),e._v(" "),a("ul",[a("li",[a("code",[e._v("0")]),e._v(": Horizontal position data")]),e._v(" "),a("li",[a("code",[e._v("1")]),e._v(": Vertical position data")]),e._v(" "),a("li",[a("code",[e._v("2")]),e._v(": Velocity data")]),e._v(" "),a("li",[a("code",[e._v("3")]),e._v(": Yaw data")])]),e._v(" "),a("p",[e._v("To send a local position measurement to PX4:")]),e._v(" "),a("ol",[a("li",[e._v("Create a "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/classpx4__ros2_1_1LocalPositionMeasurementInterface.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("LocalPositionMeasurementInterface")]),a("OutboundLink")],1),e._v(" instance by providing it with: a ROS node, and the pose and velocity reference frames of your measurements.")]),e._v(" "),a("li",[e._v("Populate a "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/structpx4__ros2_1_1LocalPositionMeasurement.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("LocalPositionMeasurement")]),a("OutboundLink")],1),e._v(" "),a("code",[e._v("struct")]),e._v(" with your measurements.")]),e._v(" "),a("li",[e._v("Pass the "),a("code",[e._v("struct")]),e._v(" to the "),a("code",[e._v("LocalPositionMeasurementInterface")]),e._v(" "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/classpx4__ros2_1_1LocalPositionMeasurementInterface.html#a6fd180b944710716d418b2cfe1c0c8e3",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("update()")]),a("OutboundLink")],1),e._v(" method.")])]),e._v(" "),a("p",[e._v("The available pose and velocity reference frames for your measurements are defined by the following "),a("code",[e._v("enum")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code")])]),a("p",[e._v("The "),a("code",[e._v("LocalPositionMeasurement")]),e._v(" struct is defined as follows:")]),e._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code")])]),a("p",[e._v("The "),a("code",[e._v("update()")]),e._v(" method of the local interface expects the following conditions to hold for "),a("code",[e._v("LocalPositionMeasurement")]),e._v(":")]),e._v(" "),a("ul",[a("li",[e._v("The sample timestamp is defined.")]),e._v(" "),a("li",[e._v("Values do not have a `NAN``.")]),e._v(" "),a("li",[e._v("If a measurement value is provided, its associated variance value is well defined (e.g. if "),a("code",[e._v("position_xy")]),e._v(" is defined, then "),a("code",[e._v("position_xy_variance")]),e._v(" must be defined).")]),e._v(" "),a("li",[e._v("If a measurement value is provided, its associated reference frame is not unknown (e.g. if "),a("code",[e._v("position_xy")]),e._v(" is defined, then the interface was initialised with a pose frame different from "),a("code",[e._v("PoseFrame::Unknown")]),e._v(").")])]),e._v(" "),a("p",[e._v("The following code snippet is an example of a ROS 2 node which uses the local navigation interface to send 3D pose updates in the North-East-Down (NED) reference frame to PX4:")]),e._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code")])]),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")])]),e._v(" "),a("p",[e._v("First ensure that the PX4 parameter "),a("RouterLink",{attrs:{to:"/uk/advanced_config/parameter_reference.html#EKF2_AGP_CTRL"}},[a("code",[e._v("EKF2_AGP_CTRL")])]),e._v(" is properly configured to fuse external global measurements, by setting the appropriate bits to "),a("code",[e._v("true")]),e._v(":")],1),e._v(" "),a("ul",[a("li",[a("code",[e._v("0")]),e._v(": Horizontal position data")]),e._v(" "),a("li",[a("code",[e._v("1")]),e._v(": Vertical position data")])]),e._v(" "),a("p",[e._v("To send a global position measurement to PX4:")]),e._v(" "),a("ol",[a("li",[e._v("Create a "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/classpx4__ros2_1_1GlobalPositionMeasurementInterface.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("GlobalPositionMeasurementInterface")]),a("OutboundLink")],1),e._v(" instance by providing it with a ROS node.")]),e._v(" "),a("li",[e._v("Populate a "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/structpx4__ros2_1_1GlobalPositionMeasurement.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("GlobalPositionMeasurement")]),a("OutboundLink")],1),e._v(" "),a("code",[e._v("struct")]),e._v(" with your measurements.")]),e._v(" "),a("li",[e._v("Pass the struct to the "),a("code",[e._v("GlobalPositionMeasurementInterface")]),e._v(" "),a("a",{attrs:{href:"https://auterion.github.io/px4-ros2-interface-lib/classpx4__ros2_1_1GlobalPositionMeasurementInterface.html#a1a183b595ef7f6a22f3a83ba543fe86d",target:"_blank",rel:"noopener noreferrer"}},[e._v("update()"),a("OutboundLink")],1),e._v(" method.")])]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("GlobalPositionMeasurement")]),e._v(" struct is defined as follows:")]),e._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code")])]),a("p",[e._v("Метод "),a("code",[e._v("update()")]),e._v(" глобального інтерфейсу очікує дотримання наступних умов для "),a("code",[e._v("GlobalPositionMeasment")]),e._v(":")]),e._v(" "),a("ul",[a("li"),e._v(" "),a("li",[e._v("Значення не мають NAN.")]),e._v(" "),a("li",[e._v("Якщо надано значення вимірювання, його відповідне значення розбіжності добре визначено (наприклад, якщо "),a("code",[e._v("lat_lon")]),e._v(" визначено, то необхідно вказати "),a("code",[e._v("horizontal_variance")]),e._v(").")])]),e._v(" "),a("p",[e._v("The following code snippet is an example of a ROS 2 node which uses the global navigation interface to send a measurement with latitude, longitude and altitude to PX4:")]),e._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code")])]),a("h2",{attrs:{id:"кілька-екземплярів-інтерфеису"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#кілька-екземплярів-інтерфеису"}},[e._v("#")]),e._v(" Кілька екземплярів інтерфейсу")]),e._v(" "),a("p",[e._v("Використання кількох екземплярів одного інтерфейсу (напр. локально та локально) для надсилання повідомлень про розрахунок буде передавати всі оновлення до однієї теми і що призведе до перехресної розмови.\nЦе не повинно впливати на об'єднання вимірювань в EKF, але різні джерела вимірювань стануть нерозрізненними.")])],1)}),[],!1,null,null,null);t.default=o.exports}}]);