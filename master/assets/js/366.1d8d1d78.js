(window.webpackJsonp=window.webpackJsonp||[]).push([[366],{1212:function(t,s,a){t.exports=a.p+"assets/img/architecture.94eff761.png"},1213:function(t,s,a){t.exports=a.p+"assets/img/architecture_ros2.f0ce052c.png"},1214:function(t,s,a){t.exports=a.p+"assets/img/architecture_ros.a06cff99.png"},2517:function(t,s,a){"use strict";a.r(s);var n=a(18),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"rtps-ros2-接口-px4-fastrtps桥接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rtps-ros2-接口-px4-fastrtps桥接"}},[t._v("#")]),t._v(" RTPS/ROS2 接口：PX4-FastRTPS桥接")]),t._v(" "),n("p",[n("em",[t._v("PX4-fastRTPS 桥接")]),t._v(" 在 PX4 中添加了一个实时发布订阅 (RTPS) 接口, 从而能够在PX4组件和 (offboard) "),n("em",[t._v("Fast RTPS")]),t._v(" 应用程序 (包括使用 ROS2/ROS 框架构建的应用程序) 之间进行 "),n("RouterLink",{attrs:{to:"/zh/middleware/uorb.html"}},[t._v("uORB 消息")]),t._v(" 交换。")],1),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v("RTPS是对象管理组 (OMG) 数据分发服务(DDS) 标准的基础协议。 其目的是利用发布/订阅模式实现可扩展、实时、可靠、高性能和可互操作的数据通信。 "),n("em",[t._v("Fast RTPS")]),t._v(" 是最新版本的RTPS协议和最小DDS API的一个非常轻量级的跨平台实现。")])]),t._v(" "),n("p",[t._v("RTPS 已被采用为 ROS2 (机器人操作系统) 的中间件。 *Fast RTPS桥接 * 使我们能够更好地与 ROS2 集成, 从而轻松共享传感器值、命令和其他车辆信息。")]),t._v(" "),n("p",[t._v("本主题介绍RTPS桥接体系结构 (以及如何在 ROS2/ROS 应用程序管道中使用它)。 还演示了如何编译所需的代码, 以便:")]),t._v(" "),n("ol",[n("li",[t._v("编写一个简单的 *Fast rtps * 应用程序来订阅PX4消息")]),t._v(" "),n("li",[t._v("在PX4上连接ROS2节点 (通过RTPS桥接, 并使用 "),n("code",[t._v("px4_ros_com")]),t._v(" 包)")]),t._v(" "),n("li",[t._v('如果要在PX4上连接ROS (ROS "1代")，需要额外使用 '),n("code",[t._v("ros1_bridge")]),t._v(" 包在ROS2和ROS之间做桥接。")])]),t._v(" "),n("h2",{attrs:{id:"什么时候应该使用-rtps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么时候应该使用-rtps"}},[t._v("#")]),t._v(" 什么时候应该使用 RTPS？")]),t._v(" "),n("p",[t._v("当您需要在飞行控制器和offboard部件之间可靠地共享时间敏感/实时信息时, 应使用RTPS。 特别是, 在off-board软件需要 (通过发送和接收 uORB主题) 成为 px4 中运行的软件组件的 "),n("em",[t._v("伙伴")]),t._v(" 的情况下，它非常有用。")]),t._v(" "),n("p",[t._v("可能的使用案例包括为实现机器视觉与机器人库进行的通信, 还使用在其它对实时性要求高的领域，比如向执行器发送数据和从传感器获取数据，这对于飞机控制是必需的。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" "),n("em",[t._v("Fast RTPS")]),t._v(" 并无取代MAVLink之意。 MAVLink 仍然是与地面站、云台、摄像机和其他offboard组件进行通信的首选协议 (尽管 "),n("em",[t._v("Fast rtps")]),t._v(" 为使用某些外设提供了第二个选择)。")])]),t._v(" "),n("p",[n("span")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Tip")]),t._v("RTPS可以用于较慢的链接 (例如无线数传), 但应注意不要使通道过载。")])]),t._v(" "),n("h2",{attrs:{id:"架构概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#架构概述"}},[t._v("#")]),t._v(" 架构概述")]),t._v(" "),n("h3",{attrs:{id:"rtps-桥接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rtps-桥接"}},[t._v("#")]),t._v(" RTPS 桥接")]),t._v(" "),n("p",[t._v("RTPS 桥接在 PX4 和 RTPS 应用程序之间交换消息, 在每个系统使用的 "),n("RouterLink",{attrs:{to:"/zh/middleware/uorb.html"}},[t._v("uORB")]),t._v(" 和 RTPS 消息之间无缝转换。")],1),t._v(" "),n("p",[n("img",{attrs:{src:a(1212),alt:"basic example flow"}})]),t._v(" "),n("p",[t._v("该体系结构的主要元素是上面图中所示的客户端 (client) 和代理 (agent) 进程。")]),t._v(" "),n("ul",[n("li",[n("em",[t._v("Client")]),t._v(" 是在飞行控制器上运行的 PX4 中间件守护进程。 它订阅由其他 PX4 组件发布的 uORB 主题, 并将更新发送给 "),n("em",[t._v("Agent")]),t._v(" (通过 UART 或 UDP 端口)。 它还接收来自 "),n("em",[t._v("Agent")]),t._v(" 的消息, 转换为 PX4 上的 uORB 消息并重新发布。")]),t._v(" "),n("li",[n("em",[t._v("Agent")]),t._v(" 在Offboard计算机上作为守护进程运行。 它监视来自 "),n("em",[t._v("Client")]),t._v(' 的 uORB 消息更新, 并通过RTPS (重新) 发布这些消息。 它还订阅来自其他 RTPS 应用程序的 "uORB" RTPS 消息, 并直接转发给 '),n("em",[t._v("Client")]),t._v("。")]),t._v(" "),n("li",[n("em",[t._v("Agent")]),t._v(" 和 "),n("em",[t._v("Client")]),t._v(" 通过串行链路 (UART) 或 UDP 网络进行连接。 uORB 信息事先经过了 "),n("a",{attrs:{href:"https://en.wikipedia.org/wiki/Common_Data_Representation",target:"_blank",rel:"noopener noreferrer"}},[t._v("CDR 序列化 "),n("OutboundLink")],1),t._v(" 处理 (*CDR 序列化 * 提供了一种在不同平台之间交换串行数据的通用格式)。")]),t._v(" "),n("li",[n("em",[t._v("Agent")]),t._v(" 和任何 "),n("em",[t._v("Fast RTPS")]),t._v(" 应用程序之间都是通过 UDP 连接的, 二者可以运行在同一设备上，也可以运行在不同设备上。 在一种典型的配置中, 它们运行于同一系统 (例如, 开发计算机、Linux 配套计算机或计算机板) 上, 通过 Wifi或 USB 连接到 "),n("em",[t._v("Client")]),t._v("。")])]),t._v(" "),n("h3",{attrs:{id:"ros2-ros-应用处理流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ros2-ros-应用处理流程"}},[t._v("#")]),t._v(" ROS2/ROS 应用处理流程")]),t._v(" "),n("p",[t._v("ROS2 的应用程序流程非常简单直接! ROS2 的应用程序流程非常简单直接! 由于 ROS2 原生支持 DDS/RTPS 作为其原生通信中间件, 因此您可以直接创建 ROS2 监听或广播节点, 通过 "),n("em",[t._v("PX4 Fast RTPS 桥接")]),t._v(" 订阅或发布PX4上的 uORB 数据。 正如下图所示。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" 您需要确保客户端和代理端（以及 ROS 节点上）的消息类型、头文件和源文件是从相同的接口描述语言（IDL）文件生成的。 "),n("code",[t._v("px4_ros_com")]),t._v(" 包提供了生成 ROS2 所需的消息和头文件所需的必要工具。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(1213),alt:"Architecture with ROS2"}})]),t._v(" "),n("p",[t._v("将 ROS 应用程序与 PX4 集成的体系结构如下所示。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1214),alt:"Architecture with ROS"}})]),t._v(" "),n("p",[t._v("请注意 "),n("a",{attrs:{href:"https://github.com/ros2/ros1_bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ros1_bridge"),n("OutboundLink")],1),t._v("的使用, 它在 ROS2 和 ROS 之间进行消息桥接。 因为 ROS 一代不支持 RTPS，所以只能这样做。")]),t._v(" "),n("h2",{attrs:{id:"代码生成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码生成"}},[t._v("#")]),t._v(" 代码生成")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" 要生成所需代码 "),n("RouterLink",{attrs:{to:"/zh/setup/fast-rtps-installation.html"}},[t._v("必须安装 Fast RTPS")]),t._v("! 如果你使用为"),n("RouterLink",{attrs:{to:"/zh/setup/dev_env_mac.html"}},[t._v("macOS")]),t._v(", "),n("RouterLink",{attrs:{to:"/zh/setup/dev_env_windows_cygwin.html"}},[t._v("Windows Cygwin")]),t._v(" 或 "),n("RouterLink",{attrs:{to:"/zh/setup/dev_env_linux_ubuntu.html"}},[t._v("Ubuntu")]),t._v("平台编写的标准安装程序/脚本，"),n("em",[t._v("Fast RTPS")]),t._v(" 是 "),n("em",[t._v("默认")]),t._v(" 安装的。")],1)]),t._v(" "),n("h3",{attrs:{id:"独立于-ros-的应用程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立于-ros-的应用程序"}},[t._v("#")]),t._v(" 独立于 ROS 的应用程序")]),t._v(" "),n("p",[t._v("编译 PX4 固件时, 将自动生成创建、编译和使用该桥接所需的所有代码。")]),t._v(" "),n("p",[n("em",[t._v("Client")]),t._v(" 应用程序也被编译成为固件的一部分，这是标准编译过程的一部分。 但是"),n("em",[t._v("Agent")]),t._v(" 必须为目标机单独/手动编译。")]),t._v(" "),n("p",[n("span")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Tip")]),t._v(" 桥接的代码也可以 "),n("RouterLink",{attrs:{to:"/zh/middleware/micrortps_manual_code_generation.html"}},[t._v("手动生成")]),t._v("。 大多数用户不需要这样做, 但链接的主题提供了编译过程的更详细的描述, 排故的时候也许有用。")],1)]),t._v(" "),n("p",[n("a",{attrs:{id:"px4_ros_com"}})]),t._v(" "),n("h3",{attrs:{id:"ros2-ros-应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ros2-ros-应用"}},[t._v("#")]),t._v(" ROS2/ROS 应用")]),t._v(" "),n("p",[t._v("完成编译的 "),n("a",{attrs:{href:"https://github.com/PX4/px4_ros_com",target:"_blank",rel:"noopener noreferrer"}},[t._v("px4_ros_com"),n("OutboundLink")],1),t._v(" 包可以生成从一个ROS2节点获取 PX4 uORB消息所需的所有组件 (如果使用 ROS一代，还需要 "),n("a",{attrs:{href:"https://github.com/ros2/ros1_bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ros1_bridge"),n("OutboundLink")],1),t._v(")。 这包括所有 "),n("em",[t._v("PX4 RTPS bridge")]),t._v(" 必需的组件, 包括 IDL 文件 ("),n("code",[t._v("micrortps_agent")]),t._v("必需), "),n("code",[t._v("micrortps_agent")]),t._v(" 本身以及ROS消息的源文件和头文件。")]),t._v(" "),n("p",[t._v("The ROS and ROS2 message definition headers and interfaces are generated from the "),n("a",{attrs:{href:"https://github.com/PX4/px4_msgs",target:"_blank",rel:"noopener noreferrer"}},[t._v("px4_msgs"),n("OutboundLink")],1),t._v(" package, which match the uORB messages counterparts under PX4-Autopilot. These are required by "),n("code",[t._v("px4_ros_com")]),t._v(" when generating the IDL files to be used by the "),n("code",[t._v("micrortps_agent")]),t._v(".")]),t._v(" "),n("p",[t._v("这两个分支还有几个监听和广播节点的代码示例。")]),t._v(" "),n("ul",[n("li",[t._v("一个支持 ROS2 的 "),n("code",[t._v("master")]),t._v(" 分支。 该分支的代码可以生成在 PX4 和 ROS2 之间桥接必需的所有 ROS2 消息和 IDL 文件。")]),t._v(" "),n("li",[t._v("一个支持 ROS 一代的 "),n("code",[t._v("ros1")]),t._v(" 分支。 该分支的代码可以生成 ROS 消息的头文件和源文件，这些文件与 "),n("code",[t._v("ros1_bridge")]),t._v(" "),n("em",[t._v("一起")]),t._v(" 使用，达到在PX4与ROS之间共享数据的目的。")])]),t._v(" "),n("p",[t._v("Both branches in "),n("code",[t._v("px4_ros_com")]),t._v(" additionally include some example listener and advertiser example nodes.")]),t._v(" "),n("h2",{attrs:{id:"支持的-uorb-消息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支持的-uorb-消息"}},[t._v("#")]),t._v(" 支持的 uORB 消息")]),t._v(" "),n("p",[t._v("生成的桥接代码将允许通过 RTPS 发布/订阅部分 uORB 主题。 这对于 ROS 或非 ROS 应用程序都是适用的。")]),t._v(" "),n("p",[t._v("为了 "),n("em",[t._v("自动生成代码")]),t._v("，在 PX4 "),n("strong",[t._v("Firmware/msg/tools/")]),t._v(" 目录下有一个 "),n("em",[t._v("yaml")]),t._v(" 定义文件 —— "),n("strong",[t._v("uorb_rtps_message_ids.yaml")]),t._v("。 该文件定义了 RTPS 可以使用的 uORB 消息子集，以及是用于发送、用于接收还是双向皆可，以及用于 DDS/RTPS 中间件的 RTPS ID。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" 所有消息都必须分配一个 RTPS ID 。")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rtps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actuator_armed\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actuator_control\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rtps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actuator_armed\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actuator_control\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" airspeed\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" battery_status\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" camera_capture\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" camera_trigger\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sensor_baro\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("msg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sensor_baro\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("receive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" "),n("code",[t._v("px4_ros_com")]),t._v("编译过程 (只) 运行 CMake 宏 "),n("code",[t._v("rosidl_generate_interfaces()")]),t._v(" 来生成 ROS2 IDL 文件和每个消息的头文件与源文件。 PX4固件中又一个IDL文件模板，只在PX4编译过程中才使用。")]),t._v(" "),n("p",[n("code",[t._v("px4_ros_com")]),t._v(" 为 ROS2/ROS 编译生成的IDL文件只有 "),n("em",[t._v("少许不同")]),t._v(" (但为PX4固件编译的就很不一样了)。 "),n("strong",[t._v("uorb_rtps_message_ids.yaml")]),t._v(" 文件将消息改名使之符合"),n("em",[t._v("PascalCased")]),t._v("标准 (改名这事儿与客户端-代理端之间的通信没有任何关系，但是对于 ROS2 是至关重要的，因为 ROS2 的消息命名必须符合 PascalCase 约定)。 新的IDL文件还反转了消息的发送/接收状态 (这是必须的，因为同一个消息在客户端是发送，在代理端的状态就是接收，反之亦然)。")])]),t._v(" "),n("p",[n("a",{attrs:{id:"client_firmware"}})]),t._v(" "),n("h2",{attrs:{id:"客户端-px4固件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端-px4固件"}},[t._v("#")]),t._v(" 客户端 (PX4固件)")]),t._v(" "),n("p",[t._v("标准的编译流程将 "),n("em",[t._v("Client")]),t._v(" 自动生成，并编译到PX4固件中。")]),t._v(" "),n("p",[t._v("要构建 NuttX/Pixhawk 飞行控制器的固件, 请选择带有 "),n("code",[t._v("_rtps")]),t._v(" 的配置文件。 例如，要为 px4_fmu-v4 构建 RTPS：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" px4_fmu-v4_rtps\n")])])]),n("p",[t._v("如果要构建 SITL 固件:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" px4_sitl_rtps\n")])])]),n("p",[n("em",[t._v("Client")]),t._v(" 应用程序可以从 "),n("RouterLink",{attrs:{to:"/zh/debug/system_console.html"}},[t._v("NuttShell/System Console")]),t._v(" 启动。 命令语法如下所示 (您可以指定任意个参数):")],1),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" micrortps_client start"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("stop "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  -t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("transport"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("UART"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("UDP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 缺省为 UART\n  -d "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("device"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             UART 设备. 缺省为 /dev/ttyACM0\n  -u "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("update_time_ms"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     订阅的 uORB 消息的刷新时间，单位ms。 缺省为 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  -l "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("loops"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("              该程序将循环执行多少次。 Default /dev/ttyACM0\n  -l "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("loops"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("              How many iterations will this program have. -1 表示无限循环， 缺省为 -1。 缺省为 -1。\n  -w "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("sleep_time_us"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      每次循环的休眠时间，单位us。 缺省为 1ms\n  -b "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("baudrate"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           UART 设备波特率 缺省为 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("460800")]),t._v("\n  -p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("poll_ms"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            UART设备轮询时间，单位ms， 缺省为 1ms\n  -r "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("reception port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     UDP接收端口号， -r "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("reception port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     UDP 接收端口， 缺省为 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("。 -s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("sending port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       UDP发送端口， 缺省为 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("。 Default "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("\n  -i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ip_address"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("         Select IP address "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" values: "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("x.x.x.x"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(". Default: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1\n")])])]),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v("默认情况下"),n("em",[t._v("Client")]),t._v(" 作为守护进程运行, 但您需要手动启动它。 PX4 固件的初始化代码将来可能会自动启动 "),n("em",[t._v("Client")]),t._v(" 作为一个永久的守护进程。")])]),t._v(" "),n("p",[t._v("例如, 为了启动通过 UDP 连接到代理的 SITL 的 "),n("em",[t._v("Client")]),t._v(" 守护进程, 请运行如下命令:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("micrortps_client start -t UDP\n")])])]),n("h2",{attrs:{id:"与-ros-无关的-offboard-fast-rtps-接口中的代理端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#与-ros-无关的-offboard-fast-rtps-接口中的代理端"}},[t._v("#")]),t._v(" 与 ROS 无关的 Offboard Fast RTPS 接口中的代理端")]),t._v(" "),n("p",[t._v("编译PX4固件时，相关的"),n("em",[t._v("Agent")]),t._v("代码会自动被 "),n("em",[t._v("生成")]),t._v("。 生成的源代码在这个目录下: "),n("strong",[t._v("build/"),n("target-platform",[t._v("/src/modules/micrortps_bridge/micrortps_client/micrortps_agent/")])],1),t._v(".")]),t._v(" "),n("p",[t._v("和 "),n("em",[t._v("Agent")]),t._v(" 有关的命令语法如下:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" build/"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("target-platform"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/src/modules/micrortps_bridge/micrortps_client/micrortps_agent\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" build "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" build\ncmake "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n")])])]),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" 如果要交叉编译 "),n("em",[t._v("Qualcomm Snapdragon Flight")]),t._v(" 平台，请参考 "),n("a",{attrs:{href:"https://github.com/eProsima/PX4-FastRTPS-PoC-Snapdragon-UDP#how-to-use",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个链接"),n("OutboundLink")],1),t._v("。")])]),t._v(" "),n("p",[t._v("要启动 "),n("em",[t._v("Agent")]),t._v(", 运行 "),n("code",[t._v("micrortps_agent")]),t._v(" 并在参数中指定连接到 "),n("em",[t._v("Client")]),t._v(" 的方式 ( 一个Linux设备连接到 "),n("em",[t._v("Client")]),t._v(" 的缺省方式是通过 UART 端口)。")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ ./micrortps_agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  -t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("transport"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("UART"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("UDP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 缺省为UART.\n  -d "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("device"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             UART设备， 缺省为 /dev/ttyACM0。\n  -d "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("device"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             UART设备， 缺省为 /dev/ttyACM0。\n  -w "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("sleep_time_us"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      每次循环的休眠时间，单位us。 默认 1ms。\n  -b "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("baudrate"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           UART设备波特率。 默认 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("460800")]),t._v("。\n  -p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("poll_ms"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            UART设备轮询时间，单位ms， 缺省为 1ms。 缺省为 1ms。\n  -r "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("reception port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     UDP 接收端口， 缺省为 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("。\n  -s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("sending port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       UDP发送端口， 缺省为 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("。\n")])])]),n("p",[t._v("如果要选择UDP连接，如下启动 "),n("em",[t._v("micrortps_agent")]),t._v(":")]),t._v(" "),n("p",[t._v("为了构建 "),n("em",[t._v("Agent")]),t._v(" 应用, 运行如下编译命令:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("./micrortps_agent -t UDP\n")])])]),n("h2",{attrs:{id:"面向-ros2-中间件的代理端接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#面向-ros2-中间件的代理端接口"}},[t._v("#")]),t._v(" 面向 ROS2 中间件的代理端接口")]),t._v(" "),n("p",[t._v("构建 "),n("code",[t._v("px4_ros_com")]),t._v(" 将自动生成并编译代理端应用。 也可以使用 "),n("a",{attrs:{href:"http://design.ros2.org/articles/build_tool.html",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("colcon")]),n("OutboundLink")],1),t._v(" 构建工具, 效果与上相同。 欲知构建详情，请参考 ** 构建 "),n("code",[t._v("px4_ros_com")]),t._v(" 程序包 ** 章节。")]),t._v(" "),n("h2",{attrs:{id:"构建-px4-ros-com-程序包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建-px4-ros-com-程序包"}},[t._v("#")]),t._v(" 构建 "),n("code",[t._v("px4_ros_com")]),t._v(" 程序包")]),t._v(" "),n("p",[t._v("要在一台 Ubuntu 18.04 机器上安装 ROS Melodic 和 ROS2 Bouncy, 分别参考如下链接:")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" ROS2只需要master分支 (但ROS两个分支都需要)。")])]),t._v(" "),n("h3",{attrs:{id:"分别安装-ros-和-ros2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分别安装-ros-和-ros2"}},[t._v("#")]),t._v(" 分别安装 ROS 和 ROS2")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v("以上安装和构建指南也适用于 Ubuntu 16.04, ROS Kinetic 或 ROS2 Ardent 开发环境。")])]),t._v(" "),n("p",[t._v("In order to install ROS Melodic and ROS2 Dashing (officially supported) on a Ubuntu 18.04 machine, follow the links below, respectively:")]),t._v(" "),n("ol",[n("li",[n("p",[n("a",{attrs:{href:"http://wiki.ros.org/melodic/Installation/Ubuntu",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装 ROS Melodic"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://index.ros.org/doc/ros2/Installation/Dashing/Linux-Install-Debians/",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装 ROS2 Bouncy"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[t._v("要正常地生成 IDL 文件还要安装以下组件 (仅 ROS2 Bouncy 发行版需要):")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" python3-colcon-common-extensions\n")])])])]),t._v(" "),n("li",[n("p",[n("em",[t._v("setuptools")]),t._v("也必须被安装 (使用 "),n("em",[t._v("pip")]),t._v(" 或 "),n("em",[t._v("apt")]),t._v("工具):")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ros-bouncy-rmw-opensplice-cpp\n")])])])]),t._v(" "),n("li",[n("p",[t._v("安装过程应该会自动安装 "),n("em",[t._v("colcon")]),t._v(" 构建工具，万一没有，也可手动安装:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" pip3 "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -U setuptools\n")])])]),n("blockquote",[n("p",[t._v("> "),n("strong",[t._v("Caution")]),t._v(" 不要通过deb仓库安装 "),n("code",[t._v("ros1_bridge")]),t._v(" 。 该程序包必须从源码构建。")])])])]),t._v(" "),n("h3",{attrs:{id:"配置工作空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置工作空间"}},[t._v("#")]),t._v(" 配置工作空间")]),t._v(" "),n("p",[t._v("由于 ROS2 和 ROS 环境变量的配置不同，你需要为每个 ROS 版本分配独立的工作空间。 下面是一个例子：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("对于 ROS2, 如下创建工作空间:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/px4_ros_com_ros2/src\n")])])]),n("p",[t._v("然后，把 ROS2 ("),n("code",[t._v("master")]),t._v(") 分支克隆到 "),n("code",[t._v("/src")]),t._v(" 目录:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/PX4/px4_ros_com.git ~/px4_ros_com_ros2/src/px4_ros_com "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 克隆 master 分支")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("对于 ROS, 遵循同样的流程, 但是要另建一个目录并克隆另一个分支:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/px4_ros_com_ros1/src\n")])])]),n("p",[t._v("然后，克隆 ROS2 ("),n("code",[t._v("ros1")]),t._v(") 分支到 "),n("code",[t._v("/src")]),t._v(" 目录:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/PX4/px4_ros_com.git ~/px4_ros_com_ros1/src/px4_ros_com -b ros1 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 克隆 'ros1' 分支")]),t._v("\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"构建工作空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建工作空间"}},[t._v("#")]),t._v(" 构建工作空间")]),t._v(" "),n("p",[n("code",[t._v("px4_ros_com/scripts")]),t._v(" 目录下有几个脚本可以用来构建这两个工作空间。")]),t._v(" "),n("p",[n("code",[t._v("build_all.bash")]),t._v(" 这个脚本可以一次性编译两个工作空间。 使用命令 "),n("code",[t._v("source build_all.bash --help")]),t._v(" 查看脚本的用法。 最常用的使用方式是把 ROS(1) 工作区目录路径和 PX4 固件目录路径作为参数:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" build_all.bash --ros1_ws_dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path/to/px4_ros_com_ros1/ws"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" 如果 "),n("em",[t._v("监听应用")]),t._v(" 没有打印任何信息, 检查一下 "),n("em",[t._v("Client")]),t._v(" 是不是没有运行。")])]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Tip")]),t._v(" 在开发过程中最好的即刻/临时的补救措施就是从 "),n("em",[t._v("NuttShell")]),t._v(" 关闭MAVLink：")])]),t._v(" "),n("p",[t._v("以下步骤将详述怎样 "),n("em",[t._v("手动")]),t._v(" 构建这些程序包 (只是为了加深您的理解):")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("build_ros1_bridge.bash")]),t._v(" 可以构建 "),n("code",[t._v("ros1_bridge")]),t._v(";")]),t._v(" "),n("li",[n("code",[t._v("build_ros2_workspace.bash")]),t._v(" (只构建 "),n("code",[t._v("px4_ros_com")]),t._v(" 的 "),n("code",[t._v("ros1")]),t._v(" 分支) 可以构建 "),n("code",[t._v("px4_ros_com")]),t._v(" "),n("code",[t._v("ros1")]),t._v(" 分支所在的 ROS1 工作空间;")]),t._v(" "),n("li",[n("code",[t._v("build_ros2_workspace.bash")]),t._v(" 可以构建 "),n("code",[t._v("px4_ros_com")]),t._v(" "),n("code",[t._v("master")]),t._v(" 分支所在的工作空间;")])]),t._v(" "),n("p",[t._v("以下步骤将详述怎样 "),n("em",[t._v("手动")]),t._v(" 构建这些程序包 (只是为了加深您的理解):")]),t._v(" "),n("ol",[n("li",[n("p",[n("code",[t._v("cd")]),t._v(" 到 "),n("code",[t._v("px4_ros_com_ros2")]),t._v(" 目录并 source 一下 ROS2 的环境变量。 不用管是否提示您该工作空间已经设置过：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/bouncy/setup.bash\n")])])])]),t._v(" "),n("li",[n("p",[t._v("克隆 "),n("code",[t._v("ros1_bridge")]),t._v(" 程序包到 ROS2 工作空间:")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/ros2/ros1_bridge.git ~/px4_ros_com_ros2/src/ros1_bridge\n")])])])]),t._v(" "),n("li",[n("p",[t._v("构建 "),n("code",[t._v("px4_ros_com")]),t._v(" 程序包, 并排除 "),n("code",[t._v("ros1_bridge")]),t._v(" 程序包：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("colcon build --symlink-install --packages-skip ros1_bridge --event-handlers console_direct+\n")])])]),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" "),n("code",[t._v("--event-handlers console_direct+")]),t._v(" 参数只是为了让 "),n("code",[t._v("colcon")]),t._v(' 将构建过程的详细信息打印出来，如果想要 "安静的" 构建过程，可以去掉该参数。')])])]),t._v(" "),n("li",[n("p",[t._v("然后，按照 ROS(1) 程序包的构建流程进行编译。 为此，您必须先 source 一下环境变量，使 "),n("code",[t._v("ros1_bridge")]),t._v(" 在构建过程中能够在 PATH 变量下找到 ROS1 和 ROS2 所设置的路径：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/melodic/setup.bash\n "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/bouncy/setup.bash\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在 ROS 这一端构建 "),n("code",[t._v("px4_ros_com")]),t._v(" 程序包：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_com_ros1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" colcon build --symlink-install --event-handlers console_direct+\n")])])])]),t._v(" "),n("li",[n("p",[t._v("然后 source 一下工作空间：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros1/install/setup.bash\n "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n")])])])]),t._v(" "),n("li",[n("p",[t._v("最后，编译 "),n("code",[t._v("ros1_bridge")]),t._v("。 请注意, 构建过程可能会占用大量内存资源。 在内存较小的机器上, 减少并行编译的线程数目 (比如可以设置环境变量 "),n("code",[t._v("MAKEFLAGS=-j1")]),t._v(")。 要查看编译过程的更详细信息，请移步 "),n("a",{attrs:{href:"https://github.com/ros2/ros1_bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ros1_bridge"),n("OutboundLink")],1),t._v("程序包的网页。")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_com_ros2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" colcon build --symlink-install --packages-select ros1_bridge --cmake-force-configure --event-handlers console_direct+\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"清理工作空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#清理工作空间"}},[t._v("#")]),t._v(" 清理工作空间")]),t._v(" "),n("p",[t._v("在一次构建之后，如果想要再做一次干净的/新鲜的编译 (比如，你更改了一些代码然后想要一次 rebuild)，有些文件是必须要删除的。 不幸的是 "),n("em",[t._v("colcon")]),t._v(" 目前无法自动清除 "),n("strong",[t._v("build")]),t._v(", "),n("strong",[t._v("install")]),t._v(" 和 "),n("strong",[t._v("log")]),t._v(" 目录, 所以这三个目录必须被手动删除。")]),t._v(" "),n("p",[n("strong",[t._v("clean_all.bash")]),t._v(" 脚本 (在 "),n("strong",[t._v("px4_ros_com/scripts")]),t._v(" 目录下) 可以帮你完成这个清理工作。 最常用的用法就是把 ROS(1) 的工作空间路径作为参数 (因为这个路径通常不是缺省路径)：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" build_all.bash --ros1_ws_dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path/to/px4_ros_com_ros1/ws"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" --px4_firmware_dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path/to/PX4/Firmware"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("h2",{attrs:{id:"创建一个-fast-rtps-监听应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建一个-fast-rtps-监听应用"}},[t._v("#")]),t._v(" 创建一个 Fast RTPS 监听应用")]),t._v(" "),n("p",[t._v("一旦 "),n("em",[t._v("Client")]),t._v(" (在飞行控制器上) 和 "),n("em",[t._v("Agent")]),t._v(" (在一台 offboard 计算机上) 同时运行并且成功互联, "),n("em",[t._v("Fast RTPS")]),t._v(" 应用就可以通过 RTPS 发布或订阅PX4 上的 uORB 消息。")]),t._v(" "),n("p",[t._v("下面这个例子演示了怎样创建一个订阅了 "),n("code",[t._v("sensor_combined")]),t._v(" 主题并打印 (来自PX4) 的消息更新的 "),n("em",[t._v("Fast RTPS")]),t._v(' "监听" 应用。 一个已连接的 RTPS 应用可以在与 '),n("em",[t._v("Agent")]),t._v(" 同一网段的任何计算机上运行。 在这个例子中 "),n("em",[t._v("Agent")]),t._v(" and "),n("em",[t._v("监听应用")]),t._v(" 在同一台计算机上运行。")]),t._v(" "),n("p",[n("em",[t._v("fastrtpsgen")]),t._v(" 脚本可以从 IDL 消息文件创建一个简单的 RTPS 应用。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" RTPS 消息在 IDL 文件中定义并被 "),n("em",[t._v("fastrtpsgen")]),t._v(" 编译成 C++ 代码。 作为桥接组件构建过程的一部分,自动为用于发送/接收的 uORB 消息文件生成了 IDL 文件 (见 "),n("strong",[t._v("build/BUILDPLATFORM/src/modules/micrortps_bridge/micrortps_agent/idl/*.idl")]),t._v(" 目录)。 当你创建一个 "),n("em",[t._v("Fast RTPS")]),t._v(" 应用并与 PX4 通信时，这些 IDL 文件是必需的。")])]),t._v(" "),n("p",[t._v("输入以下命令来创建应用：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" clean_all.bash --ros1_ws_dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("path/to/px4_ros_com_ros1/ws"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("这段代码创建了一个基本的订阅器和广播器，和一个运行它们的主程序。 要打印来自 "),n("code",[t._v("sensor_combined")]),t._v(" 主题的数据, 修改 "),n("strong",[t._v("sensor_combined_Subscriber.cxx")]),t._v(" 文件中的 "),n("code",[t._v("onNewDataMessage()")]),t._v(" 方法。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" sensor_combined_Subscriber"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SubListener")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNewDataMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Subscriber"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" sub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Take data")]),t._v("\n    sensor_combined_ st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sub"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("takeNextData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("m_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sampleKind "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" ALIVE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Print your structure data here.")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("n_msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sample received, count="')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" n_msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"============================="')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_integral_dt: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_integral_dt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_timestamp_relative: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_timestamp_relative")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_integral_dt: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_integral_dt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magnetometer_timestamp_relative: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_timestamp_relative")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magnetometer_ga: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_timestamp_relative: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_timestamp_relative")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_alt_meter: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_alt_meter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_temp_celcius: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_temp_celcius")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("要在Linux上构建并运行该应用：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" -f makefile_x64Linux2.6gcc\nbin/*/sensor_combined_PublisherSubscriber subscriber\n")])])]),n("p",[t._v("然后就可以看到打印出的传感器信息：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("Sample received, "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10119")]),t._v("\nReceived sensor_combined data\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\ngyro_rad: -0.0103228, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0140477")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000319406")]),t._v("\ngyro_integral_dt: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.004")]),t._v("\naccelerometer_timestamp_relative: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\naccelerometer_m_s2: -2.82708, -6.34799, -7.41101\naccelerometer_integral_dt: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.004")]),t._v("\nmagnetometer_timestamp_relative: -10210\nmagnetometer_ga: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.60171")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0405879")]),t._v(", -0.040995\nbaro_timestamp_relative: -17469\nbaro_alt_meter: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("368.647")]),t._v("\nbaro_temp_celcius: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("43.93")]),t._v("\n")])])]),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" If the "),n("em",[t._v("Listener application")]),t._v(" does not print anything, make sure the "),n("em",[t._v("Client")]),t._v(" is running.")])]),t._v(" "),n("h2",{attrs:{id:"创建一个-ros2-监听器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建一个-ros2-监听器"}},[t._v("#")]),t._v(" 创建一个 ROS2 监听器")]),t._v(" "),n("p",[t._v("如果 "),n("code",[t._v("px4_ros_com")]),t._v(" 已经构建成功, 你可以利用生成的 "),n("em",[t._v("micro-RTPS")]),t._v(" 代理程序和自动生成的ROS2消息源文件和头文件，这些文件与 uORB 消息是一一对应的。")]),t._v(" "),n("p",[t._v("要在 ROS2 上创建一个监听器, 让我们以 "),n("code",[t._v("sensor_combined_listener.cpp")]),t._v(" node under "),n("code",[t._v("px4_ros_com/src/listeners")]),t._v(" 作为举例：")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<rclcpp/rclcpp.hpp>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<px4_ros_com/msg/sensor_combined.hpp>")])]),t._v("\n")])])]),n("p",[t._v("上面两行代码将与ROS2中间件交互的 C++ 库包含进来。 同时还包含了我们要用到的消息头文件。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @brief Sensor Combined uORB topic data callback\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SensorCombinedListener")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token base-clause"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),n("p",[t._v("上面这行代码创建了一个子类 "),n("code",[t._v("SensorCombinedListener")]),t._v("， 继承自 "),n("code",[t._v("rclcpp::Node")]),t._v(" 基类。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" sensor_combined_Subscriber"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SubListener")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNewDataMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Subscriber"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" sub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Take data")]),t._v("\n    sensor_combined_ st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sub"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("takeNextData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("m_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sampleKind "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" ALIVE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Print your structure data here.")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("n_msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sample received, count="')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" n_msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"============================="')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_rad")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_integral_dt: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gyro_integral_dt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_timestamp_relative: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_timestamp_relative")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_m_s2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_integral_dt: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("accelerometer_integral_dt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magnetometer_timestamp_relative: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_timestamp_relative")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magnetometer_ga: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("magnetometer_ga")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_timestamp_relative: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_timestamp_relative")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_alt_meter: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_alt_meter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baro_temp_celcius: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("baro_temp_celcius")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这段代码创建了一个回调函数，在收到 "),n("code",[t._v("sensor_combined")]),t._v(" 消息时被调用。 一旦收到消息就打印出每一个字段。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explicit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SensorCombinedListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sensor_combined_listener"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" px4_ros_com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("SensorCombined"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("SharedPtr msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RECEIVED DATA ON SENSOR COMBINED"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"================================"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[0]: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[1]: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[2]: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_integral_dt: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_integral_dt "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_timestamp_relative: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_timestamp_relative "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[0]: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[1]: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[2]: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_integral_dt: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_integral_dt "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("上面这段代码创建了 "),n("code",[t._v("sensor_combined_topic")]),t._v(" 主题的订阅，可以匹配到一个或多个该消息的 ROS 广播者上。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting sensor_combined listener node..."')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("make_shared"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SensorCombinedListener"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("在 "),n("code",[t._v("main")]),t._v(" 函数中将 "),n("code",[t._v("SensorCombinedListener")]),t._v("类作为一个 ROS 节点实例化。")]),t._v(" "),n("h2",{attrs:{id:"创建一个ros2广播器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建一个ros2广播器"}},[t._v("#")]),t._v(" 创建一个ROS2广播器")]),t._v(" "),n("p",[t._v("ROS2 广播器节点将数据发布到 DDS/RTPS 网络 (再转发至 PX4)。")]),t._v(" "),n("p",[t._v("以 "),n("code",[t._v("px4_ros_com/src/listeners")]),t._v(" 目录下的 "),n("code",[t._v("debug_vect_advertiser.cpp")]),t._v(" 为例：")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting sensor_combined listener node..."')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("make_shared"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SensorCombinedListener"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("包含必要的头文件，包括 "),n("code",[t._v("debug_vect")]),t._v(" 消息头文件。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DebugVectAdvertiser")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token base-clause"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),n("p",[t._v("上面这行代码创建了一个 "),n("code",[t._v("DebugVectAdvertiser")]),t._v(" 类，继承自 "),n("code",[t._v("rclcpp::Node")]),t._v(" 基类。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DebugVectAdvertiser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug_vect_advertiser"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        publisher_ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("create_publisher"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("px4_ros_com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("DebugVect"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DebugVect_topic"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" timer_callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" debug_vect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" px4_ros_com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DebugVect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nanoseconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1E-3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RCLCPP_INFO")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_logger")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Publishing debug_vect: time: %f x:%f y:%f z:%f"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("publisher_"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("debug_vect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        timer_ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_wall_timer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timer_callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("TimerBase"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("SharedPtr timer_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Publisher"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("px4_ros_com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("DebugVect"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("SharedPtr publisher_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("这段代码创建了一个用来发送消息的回调函数。 发送消息的回调函数由定时器触发的，每秒钟发送两次消息。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting debug_vect advertiser node..."')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("make_shared"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("DebugVectAdvertiser"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("make_shared"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("DebugVectAdvertiser"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这段代码在 "),n("code",[t._v("main")]),t._v(" 函数中将 "),n("code",[t._v("DebugVectAdvertiser")]),t._v(" 类实例化成一个ROS节点。")]),t._v(" "),n("h2",{attrs:{id:"创建一个ros监听器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建一个ros监听器"}},[t._v("#")]),t._v(" 创建一个ROS监听器")]),t._v(" "),n("p",[t._v("创建ROS节点的方法有详细的文档供参考，不在赘述。 在 "),n("code",[t._v("ros1")]),t._v(" 分支的代码的 "),n("code",[t._v("px4_ros_com/src/listeners")]),t._v(" 目录下，有一个关于 "),n("code",[t._v("sensor_combined")]),t._v(" 消息的ROS 监听器的例子。")]),t._v(" "),n("h2",{attrs:{id:"与ros无关的应用程序的示例-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#与ros无关的应用程序的示例-测试"}},[t._v("#")]),t._v(" 与ROS无关的应用程序的示例/测试")]),t._v(" "),n("p",[t._v("下面是PX4-FastRTPS桥接在实际应用中的更多示例。")]),t._v(" "),n("ul",[n("li",[n("RouterLink",{attrs:{to:"/zh/middleware/micrortps_throughput_test.html"}},[t._v("吞吐量测试")]),t._v(": 一个测试PX4-FastRTPS桥接吞吐量的简单示例。")],1)]),t._v(" "),n("h2",{attrs:{id:"px4-fastrpts桥接与-ros2-和-ros-的联合测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#px4-fastrpts桥接与-ros2-和-ros-的联合测试"}},[t._v("#")]),t._v(" PX4-FastRPTS桥接与 ROS2 和 ROS 的联合测试")]),t._v(" "),n("p",[t._v("快速测试该模块的流程如下 (使用 PX4 SITL 和 Gazebo)：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("启动 PX4 SITL 和 Gazebo：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" px4_sitl_rtps gazebo\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在一个终端里，source 一下 ROS2 工作空间的环境变量，然后启动 "),n("code",[t._v("ros1_bridge")]),t._v(" (这样 ROS2 和 ROS 节点就可以互相通信了)。 还要将 "),n("code",[t._v("ROS_MASTER_URI")]),t._v(" 设置为 "),n("code",[t._v("roscore")]),t._v(" 正在/即将运行的IP。")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/ardent/setup.bash\n $ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n $ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ROS_MASTER_URI")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://localhost:11311\n $ ros2 run ros1_bridge dynamic_bridge\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在另一个终端里，source 一下 ROS 工作空间的环境变量，然后启动 "),n("code",[t._v("sensor_combined")]),t._v(" 监听器节点。 使用 "),n("code",[t._v("roslaunch")]),t._v(" 启动应用程序时，首先会自动启动 "),n("code",[t._v("roscore")]),t._v(" ：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros1/install/setup.bash\n $ roslaunch px4_ros_com sensor_combined_listener.launch\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在一个终端里，source 一下 ROS2 工作空间的环境变量，然后启动 "),n("code",[t._v("micrortps_agent")]),t._v(" 守护程序并使用UDP传输协议：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n $ micrortps_agent -t UDP\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在 "),n("RouterLink",{attrs:{to:"/zh/debug/system_console.html"}},[t._v("NuttShell/System 控制台")]),t._v(" 里， 启动 "),n("code",[t._v("micrortps_client")]),t._v(" 守护进程，也使用UDP协议：")],1),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" micrortps_client start -t UDP\n")])])]),n("p",[t._v("现在启动 ROS 监听器，你就可以在终端/控制台上看到数据被打印出来：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("RECEIVED DATA FROM SENSOR COMBINED\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\n gyro_rad"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00341645")]),t._v("\n gyro_rad"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00626475")]),t._v("\n gyro_rad"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -0.000515705\n gyro_integral_dt: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4739")]),t._v("\n accelerometer_timestamp_relative: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n accelerometer_m_s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -0.273381\n accelerometer_m_s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0949186")]),t._v("\n accelerometer_m_s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -9.76044\n accelerometer_integral_dt: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4739")]),t._v("\n\n Publishing back"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),n("p",[t._v("你还可以使用 "),n("code",[t._v("rostopic hz")]),t._v(" 命令来检查消息的发送频率。 例如 "),n("code",[t._v("sensor_combined")]),t._v(" 消息：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("average rate: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("248.187")]),t._v("\n min: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00147s window: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2724")]),t._v("\n average rate: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("248.006")]),t._v("\n min: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00147s window: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2972")]),t._v("\n average rate: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.330")]),t._v("\n min: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00148s window: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3212")]),t._v("\n average rate: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.497")]),t._v("\n min: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00149s window: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3464")]),t._v("\n average rate: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.458")]),t._v("\n min: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00149s window: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3712")]),t._v("\n average rate: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.485")]),t._v("\n min: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00148s window: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3960")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在一个终端里，你也可以使用以下命令来测试 "),n("code",[t._v("sensor_combined")]),t._v(" ROS2 监听器：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n $ sensor_combined_listener "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or ros2 run px4_ros_com sensor_combined_listener")]),t._v("\n")])])])])]),t._v(" "),n("p",[t._v("也会有数据被打印到控制台输出。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" If ones uses the "),n("code",[t._v("build_all.bash")]),t._v(" script, it automatically open and source all the required terminals so one just has to run the respective apps in each terminal.")])]),t._v(" "),n("h2",{attrs:{id:"故障处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#故障处理"}},[t._v("#")]),t._v(" 故障处理")]),t._v(" "),n("h3",{attrs:{id:"client-reports-that-selected-uart-port-is-busy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#client-reports-that-selected-uart-port-is-busy"}},[t._v("#")]),t._v(" Client reports that selected UART port is busy")]),t._v(" "),n("p",[t._v("如果所选串口已被占用，可能是MAVLink应用已经在运行。 如果MAVLink和RTPS连接需要同时运行，你必须为RTPS连接指定另一个端口或者将这个端口配置为可以共享。\n")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Tip")]),t._v(" A quick/temporary fix to allow bridge testing during development is to stop MAVLink from "),n("em",[t._v("NuttShell")]),t._v(":")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code")])])]),t._v(" "),n("p",[t._v("sh\nmavlink stop-all")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("\n### Agent not built/fastrtpsgen is not found\n\n*Agent*代码是由一个叫做 *fastrtpsgen* 的 *Fast RTPS* 工具生成的。\n\n如果你没有将 Fast RTPS 安装到默认路径，那就必须在执行 *make*之前，将环境变量 `FASTRTPSGEN_DIR` 设置为你的安装路径。\n\n在 Linux/Mac 平台上可以这样：\n\n```sh\nexport FASTRTPSGEN_DIR=/path/to/fastrtps/install/folder/bin\n")])])]),n("blockquote",[n("p",[n("strong",[t._v("Note")]),t._v(" 如果 "),n("RouterLink",{attrs:{to:"/zh/setup/fast-rtps-installation.html"}},[t._v("Fast RTPS 安装在默认路径")]),t._v(" 就不会发生此类问题。")],1)]),t._v(" "),n("h3",{attrs:{id:"enable-uart-on-an-obc-onboard-computer"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#enable-uart-on-an-obc-onboard-computer"}},[t._v("#")]),t._v(" Enable UART on an OBC (onboard computer)")]),t._v(" "),n("p",[t._v("要在树莓派或其它OBC上使用UART传输，你必须首先使能所有串口：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("确保 "),n("code",[t._v("userid")]),t._v(" (在树莓派上默认用户是 pi) 是 "),n("code",[t._v("dialout")]),t._v(" 用户组的成员：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("groups")]),t._v(" pi\n "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("usermod")]),t._v(" -a -G dialout pi\n")])])])]),t._v(" "),n("li",[n("p",[t._v("特别针对树莓派，你需要关闭使用该端口的GPIO串行控制台：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" raspi-config\n")])])]),n("p",[t._v("在显示的菜单中进入 "),n("strong",[t._v("Interfacing options > Serial")]),t._v(" 选项。 为 "),n("em",[t._v("Would you like a login shell to be accessible over serial?")]),t._v(" 选择 "),n("strong",[t._v("NO")]),t._v(" 。 重启使之生效。")])]),t._v(" "),n("li",[n("p",[t._v("在内核中查看UART：")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /boot/config.txt\n")])])]),n("p",[t._v("确保 "),n("code",[t._v("enable_uart")]),t._v(" 被设置为 1：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v(" enable_uart=1\n")])])])])]),t._v(" "),n("h2",{attrs:{id:"更多信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更多信息"}},[t._v("#")]),t._v(" 更多信息")]),t._v(" "),n("ul",[n("li",[n("RouterLink",{attrs:{to:"/zh/dev_setup/fast-rtps-installation.html"}},[t._v("FastRTPS 安装")])],1),t._v(" "),n("li",[n("RouterLink",{attrs:{to:"/zh/middleware/micrortps_manual_code_generation.html"}},[t._v("手动生成客户端和代理端代码")])],1),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/ros2/ros2/wiki/DDS-and-ROS-middleware-implementations",target:"_blank",rel:"noopener noreferrer"}},[t._v("DDS 和 ROS 中间件的实现"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);