(window.webpackJsonp=window.webpackJsonp||[]).push([[751],{1259:function(t,s,a){t.exports=a.p+"assets/img/architecture_ros2.f0ce052c.png"},3279:function(t,s,a){"use strict";a.r(s);var e=a(19),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"ros-2-user-guide-px4-ros-2-bridge"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ros-2-user-guide-px4-ros-2-bridge"}},[t._v("#")]),t._v(" ROS 2 User Guide (PX4-ROS 2 Bridge)")]),t._v(" "),e("p",[t._v("This topic explains how to setup and use ROS 2 with PX4.")]),t._v(" "),e("p",[t._v("It provides an overview of the ROS2-PX4 bridge architecture and application pipeline, along with instructions on how to install all the needed software and build ROS 2 applications.")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("The Fast DDS interface in the PX4 Autopilot can be leveraged by any applications running and linked in DDS domains (including ROS nodes).")]),t._v(" "),e("p",[t._v("For information about using the "),e("em",[t._v("microRTPS bridge")]),t._v(" "),e("strong",[t._v("without ROS 2")]),t._v(", see the "),e("RouterLink",{attrs:{to:"/zh/middleware/micrortps.html"}},[t._v("RTPS/DDS Interface section")]),t._v(".")],1)]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("For a more detailed and visual explanation on how to use PX4 with ROS 2 see these presentations from the PX4 maintainers:")]),t._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"https://www.youtube.com/watch?v=qhLATrkA_Gw",target:"_blank",rel:"noopener noreferrer"}},[t._v("ROS World 2020 - Getting started with ROS 2 and PX4"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.youtube.com/watch?v=2Szw8Pk3Z0Q",target:"_blank",rel:"noopener noreferrer"}},[t._v('PX4 Dev Summit 2019 - "ROS 2 Powered PX4"'),e("OutboundLink")],1)])])]),t._v(" "),e("h2",{attrs:{id:"overview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[t._v("#")]),t._v(" Overview")]),t._v(" "),e("p",[t._v("The application pipeline for ROS 2 is very straightforward, thanks to the native communications middleware (DDS/RTPS). The "),e("RouterLink",{attrs:{to:"/zh/middleware/micrortps.html"}},[t._v("microRTPS Bridge")]),t._v(" consists of a client running on PX4 and an agent running on the Mission/Companion Computer, which communicate to provide bi-directional data exchange and message translation between UORB and ROS 2 message formats. This allows you to create ROS 2 subscribers or publisher nodes that interface directly with PX4 UORB topics! This is shown in the diagram below.")],1),t._v(" "),e("p",[e("img",{attrs:{src:a(1259),alt:"Architecture with ROS 2"}})]),t._v(" "),e("p",[t._v("ROS 2 uses the "),e("a",{attrs:{href:"https://github.com/PX4/px4_msgs",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("px4_msgs")]),e("OutboundLink")],1),t._v(" and "),e("a",{attrs:{href:"https://github.com/PX4/px4_ros_com",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("px4_ros_com")]),e("OutboundLink")],1),t._v(" packages to ensure that matching message definitions are used for creating both the client and the agent code (this is important), and also to remove the requirement for PX4 to be present when building ROS code.")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("px4_msgs")]),t._v(" contains PX4 ROS message definitions. When this project is built it generates the corresponding ROS 2-compatible typesupport, used by ROS 2 nodes, and IDL files, used by "),e("code",[t._v("fastddsgen")]),t._v(" to generate the microRTPS agent code.")]),t._v(" "),e("li",[e("code",[t._v("px4_ros_com")]),t._v(" contains the microRTPS agent code templates for the agent publishers and subscribers. The build process runs a "),e("code",[t._v("fastddsgen")]),t._v(" instance to generate the code for the "),e("code",[t._v("micrortps_agent")]),t._v(", which compiles into a single executable.")])]),t._v(" "),e("p",[t._v("The PX4 Autopilot project automatically updates "),e("a",{attrs:{href:"https://github.com/PX4/px4_msgs",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("px4_msgs")]),e("OutboundLink")],1),t._v(" with new message definitions whenever they are changed (in the "),e("code",[t._v("master")]),t._v(" branch).")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("The subset of uORB topics that will be accessible to ROS applications can be found in the "),e("a",{attrs:{href:"https://github.com/PX4/px4_ros_com/blob/master/templates/urtps_bridge_topics.yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("bridge configuration yaml file"),e("OutboundLink")],1),t._v(".")])]),t._v(" "),e("p",[t._v("PX4 firmware contains the microRTPS client based on its build-time message definitions.")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("Astute readers will note that the generated agent might not have been built with that same set of definitions (unless they were both built of the same 'master' commit).")]),t._v(" "),e("p",[t._v("Right now this is not a problem because the PX4 message set/definitions are relatively stable and the updated/new messages get automatically deployed to "),e("code",[t._v("px4_msgs")]),t._v(".")]),t._v(" "),e("p",[t._v("In the near future the intention is to:")]),t._v(" "),e("ol",[e("li",[t._v("Create also a branch per release in both "),e("code",[t._v("px4_ros_com")]),t._v(" and "),e("code",[t._v("px4_msgs")]),t._v(", so both the message definitions and agent code match the ones present on the PX4/client side by the time of the release.")]),t._v(" "),e("li",[t._v("Have an initial message exchange of the bridge configuration, using the messages structs MD5SUMs to verify if the messages definitions are the same, and if not, disable their stream and warn the user.")])])]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),e("p",[t._v('You cannot use an agent generated as part of a "normal" PX4 build with ROS 2 (e.g. if the user uses '),e("code",[t._v("BUILD_MICRORTPS_AGENT=1 make px4_sitl_rtps")]),t._v('). While microRTPS client is the same, the IDL files used by ROS 2 are slightly different from the custom ones with generate in PX4. The other detail is that the "normal" PX4 build doesn\'t use '),e("code",[t._v("fastddsgen")]),t._v(" with typesupport for ROS 2 networks - and that's also one of the main reasons we have a separate microRTPS agent in "),e("code",[t._v("px4_ros_com")]),t._v(", which is completely compatible with ROS 2 networks. We use the "),e("code",[t._v("px4_msg")]),t._v(" to generate appropriate IDL files for the "),e("code",[t._v("micrortps_agent")]),t._v(" in "),e("code",[t._v("px4_ros_com")]),t._v(".")])]),t._v(" "),e("h2",{attrs:{id:"installation-setup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installation-setup"}},[t._v("#")]),t._v(" Installation & Setup")]),t._v(" "),e("p",[t._v("To setup ROS 2 for use with PX4 you will need to:")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#install-fast-dds"}},[t._v("Install Fast DDS")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#install-ros-2"}},[t._v("Install ROS2")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#build-ros-2-workspace"}},[t._v("Build ROS 2 Workspace")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#sanity-check-the-installation"}},[t._v("Sanity Check the Installation")]),t._v(" (Optional)")])]),t._v(" "),e("h3",{attrs:{id:"install-fast-dds"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-fast-dds"}},[t._v("#")]),t._v(" Install Fast DDS")]),t._v(" "),e("p",[t._v("Follow the "),e("RouterLink",{attrs:{to:"/zh/dev_setup/fast-dds-installation.html"}},[t._v("Fast DDS Installation Guide")]),t._v(" to install "),e("strong",[t._v("Fast RTPS(DDS) 2.0.2")]),t._v(" (or later) and "),e("strong",[t._v("Fast-RTPS-Gen 1.0.4")]),t._v(" (not later!) and their dependencies.")],1),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),e("p",[t._v("Check the guide to confirm the latest dependencies! You won't be able to continue with this guide until the correct versions of "),e("strong",[t._v("Fast RTPS(DDS)")]),t._v(" and "),e("strong",[t._v("Fast-RTPS-Gen")]),t._v(" have been installed.")])]),t._v(" "),e("h3",{attrs:{id:"install-ros-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-ros-2"}},[t._v("#")]),t._v(" Install ROS 2")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("This install and build guide covers ROS 2 Foxy in Ubuntu 20.04. ::: :::warning If ROS_DOMAIN_ID is set in environment variables from ROS2 tutorial, you need to unset ROS_DOMAIN_ID for connection between ROS2 and microRTPS-agent. ::: To install ROS 2 and its dependencies:")]),t._v(" "),e("ol",[e("li",[e("p",[e("a",{attrs:{href:"https://index.ros.org/doc/ros2/Installation/Foxy/Linux-Install-Debians/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Install ROS 2 Foxy"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("The install process should also install the "),e("strong",[e("code",[t._v("colcon")])]),t._v(" build tools, but in case that doesn't happen, you can install the tools manually:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" python3-colcon-common-extensions\n")])])])]),t._v(" "),e("li",[e("p",[e("strong",[e("code",[t._v("eigen3_cmake_module")])]),t._v(" is also required, since Eigen3 is used on the transforms library:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ros-foxy-eigen3-cmake-module\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Some Python dependencies must also be installed (using "),e("strong",[e("code",[t._v("pip")])]),t._v(" or "),e("strong",[e("code",[t._v("apt")])]),t._v("):")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" pip3 "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -U empy pyros-genmsg setuptools\n")])])])])]),t._v(" "),e("h3",{attrs:{id:"build-ros-2-workspace"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#build-ros-2-workspace"}},[t._v("#")]),t._v(" Build ROS 2 Workspace")]),t._v(" "),e("p",[t._v("This section shows how create a ROS 2 workspace hosted in your "),e("em",[t._v("home directory")]),t._v(" (modify the commands as needed to put the source code elsewhere). The "),e("code",[t._v("px4_ros_com")]),t._v(" and "),e("code",[t._v("px4_msg")]),t._v(" packages are cloned to a workspace folder, and then a script is used to build the workspace.")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("The build process will open new tabs on the console, corresponding to different stages of the build process that need to have different environment configurations sourced.")])])]),t._v(" "),e("p",[t._v("To create and build the workspace:")]),t._v(" "),e("ol",[e("li",[t._v("Create a workspace directory using:"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/px4_ros_com_ros2/src\n")])])])]),t._v(" "),e("li",[t._v("Clone the ROS 2 bridge packages "),e("code",[t._v("px4_ros_com")]),t._v(" and "),e("code",[t._v("px4_msgs")]),t._v(" to the "),e("code",[t._v("/src")]),t._v(" directory (the "),e("code",[t._v("master")]),t._v(" branch is cloned by default):"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/PX4/px4_ros_com.git ~/px4_ros_com_ros2/src/px4_ros_com\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/PX4/px4_msgs.git ~/px4_ros_com_ros2/src/px4_msgs\n")])])])]),t._v(" "),e("li",[t._v("Use the "),e("code",[t._v("build_ros2_workspace.bash")]),t._v(" script to build the ROS 2 workspace (including "),e("code",[t._v("px4_ros_com")]),t._v(" and "),e("code",[t._v("px4_msgs")]),t._v(")."),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_com_ros2/src/px4_ros_com/scripts\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" build_ros2_workspace.bash\n")])])])])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("All script options can be listed by calling it with the "),e("code",[t._v("--help")]),t._v(" argument. In particular the "),e("code",[t._v("--verbose")]),t._v(" argument shows the full "),e("em",[t._v("colcon")]),t._v(" build output.")])]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("px4_ros_com/scripts")]),t._v(" directory contains multiple scripts for building different kinds of workspaces.")])]),t._v(" "),e("h3",{attrs:{id:"sanity-check-the-installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sanity-check-the-installation"}},[t._v("#")]),t._v(" Sanity Check the Installation")]),t._v(" "),e("p",[t._v("One way to check that the installation/setup succeeded is to test that the bridge can communicate with PX4. We can do this by running the bridge against PX4 running in the simulator.")]),t._v(" "),e("ol",[e("li",[e("p",[e("RouterLink",{attrs:{to:"/zh/dev_setup/dev_env_linux_ubuntu.html"}},[t._v("Setup your PX4 Ubuntu Linux development environment")]),t._v(" - the default instructions get the latest version of PX4 source and install all the needed tools.")],1)]),t._v(" "),e("li",[e("p",[t._v("Open a new terminal in the root of the "),e("strong",[t._v("PX4 Autopilot")]),t._v(" project, and then start a PX4 Gazebo simulation using:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" px4_sitl_rtps gazebo\n")])])]),e("p",[t._v("Once PX4 has fully started the terminal will display the "),e("RouterLink",{attrs:{to:"/zh/debug/system_console.html"}},[t._v("NuttShell/System Console")]),t._v(". Note also that PX4 SITL will automatically start the "),e("code",[t._v("micrortps_client")]),t._v(" connected to UDP ports 2019 and 2020.")],1)]),t._v(" "),e("li",[e("p",[t._v("On a "),e("em",[t._v("new")]),t._v(" terminal, "),e("code",[t._v("source")]),t._v(" the ROS 2 workspace and then start the "),e("code",[t._v("micrortps_agent")]),t._v(" daemon with UDP as the transport protocol:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n$ micrortps_agent -t UDP\n")])])])]),t._v(" "),e("li",[e("p",[t._v('Open a new terminal and start a "listener" using the provided launch file:')]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n$ ros2 launch px4_ros_com sensor_combined_listener.launch.py\n")])])]),e("p",[t._v("If the bridge is working correctly you will be able to see the data being printed on the terminal/console where you launched the ROS listener:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("RECEIVED DATA FROM SENSOR COMBINED\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\nts: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("870938190")]),t._v("\ngyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00341645")]),t._v("\ngyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00626475")]),t._v("\ngyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -0.000515705\ngyro_integral_dt: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4739")]),t._v("\naccelerometer_timestamp_relative: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\naccelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -0.273381\naccelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0949186")]),t._v("\naccelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": -9.76044\naccelerometer_integral_dt: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4739")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("You can also verify the rate of the message using "),e("code",[t._v("ros2 topic hz")]),t._v(". E.g. in the case of "),e("code",[t._v("sensor_combined")]),t._v(" use "),e("code",[t._v("ros2 topic hz /fmu/sensor_combined/out")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("average rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("248.187")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00147s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2724")]),t._v("\naverage rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("248.006")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00147s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2972")]),t._v("\naverage rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.330")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00148s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3212")]),t._v("\naverage rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.497")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00149s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3464")]),t._v("\naverage rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.458")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00149s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3712")]),t._v("\naverage rate: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("247.485")]),t._v("\n min: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".000s max: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".012s std dev: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".00148s window: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3960")]),t._v("\n")])])]),e("h2",{attrs:{id:"ros-2-example-applications"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ros-2-example-applications"}},[t._v("#")]),t._v(" ROS 2 Example Applications")]),t._v(" "),e("h3",{attrs:{id:"creating-a-ros-2-listener"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-ros-2-listener"}},[t._v("#")]),t._v(" Creating a ROS 2 listener")]),t._v(" "),e("p",[t._v("With the "),e("code",[t._v("px4_ros_com")]),t._v(" built successfully, one can now take advantage of the generated "),e("em",[t._v("microRTPS")]),t._v(" agent app and also from the generated sources and headers of the ROS 2 msgs from "),e("code",[t._v("px4_msgs")]),t._v(", which represent a one-to-one matching with the uORB counterparts.")]),t._v(" "),e("p",[t._v("To create a listener node on ROS 2, lets take as an example the "),e("code",[t._v("sensor_combined_listener.cpp")]),t._v(" node under "),e("code",[t._v("px4_ros_com/src/examples/listeners")]),t._v(".")]),t._v(" "),e("p",[t._v("The code first imports the C++ libraries needed to interface with the ROS 2 middleware and the required message header file:")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token macro property"}},[e("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),e("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("<rclcpp/rclcpp.hpp>")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token macro property"}},[e("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),e("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("<px4_msgs/msg/sensor_combined.hpp>")])]),t._v("\n")])])]),e("p",[t._v("Then it creates a "),e("code",[t._v("SensorCombinedListener")]),t._v(" class that subclasses the generic "),e("code",[t._v("rclcpp::Node")]),t._v(" base class.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @brief Sensor Combined uORB topic data callback\n */")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SensorCombinedListener")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token base-clause"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),e("p",[t._v("This creates a callback function for when the "),e("code",[t._v("sensor_combined")]),t._v(" uORB messages are received (now as RTPS/DDS messages), and outputs the content of the message fields each time the message is received.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explicit")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SensorCombinedListener")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Node")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sensor_combined_listener"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        subscription_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token generic-function"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_subscription")]),e("span",{pre:!0,attrs:{class:"token generic class-name"}},[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("px4_msgs"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("SensorCombined"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmu/sensor_combined/out"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" px4_msgs"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("SensorCombined"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("UniquePtr msg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RECEIVED SENSOR COMBINED DATA"')]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"============================="')]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ts: "')]),t._v("          "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("timestamp    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[0]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[1]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_rad[2]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_rad"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gyro_integral_dt: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("gyro_integral_dt "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_timestamp_relative: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_timestamp_relative "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[0]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[1]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_m_s2[2]: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_m_s2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accelerometer_integral_dt: "')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("accelerometer_integral_dt "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("The lines below create a publisher to the "),e("code",[t._v("sensor_combined")]),t._v(" uORB topic, which can be matched with one or more compatible ROS2 subscribers to the "),e("code",[t._v("fmu/sensor_combined/out")]),t._v(" ROS2 topic.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Subscription"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("px4_msgs"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("SensorCombined"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("SharedPtr subscription_"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("The instantiation of the "),e("code",[t._v("SensorCombinedListener")]),t._v(" class as a ROS node is done on the "),e("code",[t._v("main")]),t._v(" function.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting sensor_combined listener node..."')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token generic-function"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make_shared")]),e("span",{pre:!0,attrs:{class:"token generic class-name"}},[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SensorCombinedListener"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"creating-a-ros-2-advertiser"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-ros-2-advertiser"}},[t._v("#")]),t._v(" Creating a ROS 2 advertiser")]),t._v(" "),e("p",[t._v("A ROS 2 advertiser node publishes data into the DDS/RTPS network (and hence to the PX4 Autopilot).")]),t._v(" "),e("p",[t._v("Taking as an example the "),e("code",[t._v("debug_vect_advertiser.cpp")]),t._v(" under "),e("code",[t._v("px4_ros_com/src/advertisers")]),t._v(", first we import required headers, including the "),e("code",[t._v("debug_vect")]),t._v(" msg header.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token macro property"}},[e("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),e("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("<chrono>")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token macro property"}},[e("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),e("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("<rclcpp/rclcpp.hpp>")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token macro property"}},[e("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),e("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("<px4_msgs/msg/debug_vect.hpp>")])]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("chrono_literals"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("Then the code creates a "),e("code",[t._v("DebugVectAdvertiser")]),t._v(" class that subclasses the generic "),e("code",[t._v("rclcpp::Node")]),t._v(" base class.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DebugVectAdvertiser")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token base-clause"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),e("p",[t._v("The code below creates a function for when messages are to be sent. The messages are sent based on a timed callback, which sends two messages per second based on a timer.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("DebugVectAdvertiser")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Node")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug_vect_advertiser"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        publisher_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token generic-function"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_publisher")]),e("span",{pre:!0,attrs:{class:"token generic class-name"}},[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("px4_msgs"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("DebugVect"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmu/debug_vect/in"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" timer_callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto")]),t._v(" debug_vect "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" px4_msgs"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("DebugVect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("chrono"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token generic-function"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time_point_cast")]),e("span",{pre:!0,attrs:{class:"token generic class-name"}},[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("chrono"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("microseconds"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("chrono"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("steady_clock"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time_since_epoch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("string name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("copy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("begin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("begin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("RCLCPP_INFO")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_logger")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\033[97m Publishing debug_vect: time: %llu x: %f y: %f z: %f \\033[0m"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("z"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("publisher_"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("publish")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("debug_vect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        timer_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_wall_timer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timer_callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("TimerBase"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("SharedPtr timer_"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("Publisher"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("px4_msgs"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("msg"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("DebugVect"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("SharedPtr publisher_"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("The instantiation of the "),e("code",[t._v("DebugVectAdvertiser")]),t._v(" class as a ROS node is done on the "),e("code",[t._v("main")]),t._v(" function.")]),t._v(" "),e("div",{staticClass:"language-cpp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting debug_vect advertiser node..."')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setvbuf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _IONBF"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BUFSIZ"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("spin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("std"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token generic-function"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make_shared")]),e("span",{pre:!0,attrs:{class:"token generic class-name"}},[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("DebugVectAdvertiser"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    rclcpp"),e("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"offboard-control"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#offboard-control"}},[t._v("#")]),t._v(" Offboard Control")]),t._v(" "),e("p",[t._v("For a complete reference example on how to use Offboard control with PX4, see: "),e("RouterLink",{attrs:{to:"/zh/ros/ros2_offboard_control.html"}},[t._v("ROS 2 Offboard control example")]),t._v(".")],1),t._v(" "),e("h2",{attrs:{id:"manual-workspace-setup-with-a-ros1-compatible-workspace-fyi-only"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#manual-workspace-setup-with-a-ros1-compatible-workspace-fyi-only"}},[t._v("#")]),t._v(" Manual Workspace Setup with a ROS1 compatible workspace (FYI Only)")]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("This is provided to help you better understand the build process and how to include the ROS1 workspace. It is not needed to build or use ROS 2. It additionally includes instructions for building the "),e("code",[t._v("ros1_bridge")]),t._v(" package, which is used in "),e("RouterLink",{attrs:{to:"/zh/ros/ros1_via_ros2.html"}},[t._v("ROS (1) via ROS 2 Bridge")]),t._v(".")],1)]),t._v(" "),e("p",[t._v("This section describes the process to "),e("em",[t._v("manually")]),t._v(" setup your workspace and build the "),e("code",[t._v("px4_ros_com")]),t._v(", "),e("code",[t._v("px4_msgs")]),t._v(", and "),e("code",[t._v("ros1_bridge")]),t._v(" package. The topic effectively explains the operation of the "),e("code",[t._v("build_ros2_workspace.bash")]),t._v(" script in the "),e("a",{attrs:{href:"#build-ros-2-workspace"}},[t._v("installation instructions")]),t._v(").")]),t._v(" "),e("p",[e("strong",[t._v("To build the ROS 2 workspace only:")])]),t._v(" "),e("ol",[e("li",[e("p",[e("code",[t._v("cd")]),t._v(" into "),e("code",[t._v("px4_ros_com_ros2")]),t._v(" dir and source the ROS 2 environment. Don't mind if it tells you that a previous workspace was set before:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_com_ros2\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/foxy/setup.bash\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Build the workspace:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("colcon build --symlink-install --event-handlers console_direct+\n")])])])])]),t._v(" "),e("p",[t._v("To build both ROS 2 and ROS (1) workspaces (replacing the previous steps):")]),t._v(" "),e("ol",[e("li",[e("p",[e("code",[t._v("cd")]),t._v(" into "),e("code",[t._v("px4_ros_com_ros2")]),t._v(" dir and source the ROS 2 environment. Don't mind if it tells you that a previous workspace was set before:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/foxy/setup.bash\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Clone the "),e("code",[t._v("ros1_bridge")]),t._v(" package so it can be built on the ROS 2 workspace:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/ros2/ros1_bridge.git -b dashing ~/px4_ros_com_ros2/src/ros1_bridge\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Build the "),e("code",[t._v("px4_ros_com")]),t._v(" and "),e("code",[t._v("px4_msgs")]),t._v(" packages, excluding the "),e("code",[t._v("ros1_bridge")]),t._v(" package:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("colcon build --symlink-install --packages-skip ros1_bridge --event-handlers console_direct+\n")])])])])]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[e("code",[t._v("--event-handlers console_direct+")]),t._v(" only serve the purpose of adding verbosity to the "),e("code",[t._v("colcon")]),t._v(' build process, and can be removed if one wants a more "quiet" build.')])]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Then build the ROS(1) packages side. First open a "),e("strong",[t._v("new")]),t._v(" terminal window and source the ROS(1) environment that was installed on the system:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /opt/ros/melodic/setup.bash\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Build the "),e("code",[t._v("px4_ros_com")]),t._v(" and "),e("code",[t._v("px4_msgs")]),t._v(" packages on the ROS end (using the terminal opened in the previous step):")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_com_ros1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" colcon build --symlink-install --event-handlers console_direct+\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Open another new terminal and then source the environments and workspaces in the order listed below:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros1/install/setup.bash\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/px4_ros_com_ros2/install/setup.bash\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Finally, build the "),e("code",[t._v("ros1_bridge")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/px4_ros_com_ros2 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" colcon build --symlink-install --packages-select ros1_bridge --cmake-force-configure --event-handlers console_direct+\n")])])])])]),t._v(" "),e("div",{staticClass:"custom-block note"},[e("p",{staticClass:"custom-block-title"},[t._v("注解")]),t._v(" "),e("p",[t._v("The build process may consume a lot of memory resources. On a resource limited machine, reduce the number of jobs being processed in parallel (e.g. set environment variable "),e("code",[t._v("MAKEFLAGS=-j1")]),t._v("). For more details on the build process, see the build instructions on the "),e("a",{attrs:{href:"https://github.com/ros2/ros1_bridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ros1_bridge"),e("OutboundLink")],1),t._v(" package page.")])]),t._v(" "),e("h3",{attrs:{id:"cleaning-the-workspaces"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cleaning-the-workspaces"}},[t._v("#")]),t._v(" Cleaning the workspaces")]),t._v(" "),e("p",[t._v("After building the workspaces there are many files that must be deleted before you can do a clean/fresh build (for example, after you have changed some code and want to rebuild).")]),t._v(" "),e("p",[t._v("Unfortunately "),e("em",[t._v("colcon")]),t._v(" does not currently have a way of cleaning the generated "),e("strong",[t._v("build")]),t._v(", "),e("strong",[t._v("install")]),t._v(" and "),e("strong",[t._v("log")]),t._v(" directories, so these directories must be deleted manually.")]),t._v(" "),e("p",[t._v("The "),e("strong",[t._v("clean_all.bash")]),t._v(" script (in "),e("strong",[t._v("px4_ros_com/scripts")]),t._v(") is provided to ease this cleaning process, this script can be used to clean all of the workspace options listed above (ROS 2, ROS 1, and Both)")]),t._v(" "),e("p",[t._v("The most common way of using it is by passing it the ROS (1) workspace directory path (since it's usually not on the default path):")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" clean_all.bash --ros1_ws_dir "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path/to/px4_ros_com_ros1/ws"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("Like the build scripts, the "),e("code",[t._v("clean_all.bash")]),t._v(" script also has a "),e("code",[t._v("--help")]),t._v(" guide.")])]),t._v(" "),e("h2",{attrs:{id:"additional-information"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#additional-information"}},[t._v("#")]),t._v(" Additional information")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/ros2/ros2/wiki/DDS-and-ROS-middleware-implementations",target:"_blank",rel:"noopener noreferrer"}},[t._v("DDS and ROS middleware implementations"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);