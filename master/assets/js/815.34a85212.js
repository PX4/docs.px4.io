(window.webpackJsonp=window.webpackJsonp||[]).push([[815],{1571:function(e,t,n){"use strict";n.r(t);var o=n(19),a=Object(o.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"px4-ethernet-setup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#px4-ethernet-setup"}},[e._v("#")]),e._v(" PX4 Ethernet Setup")]),e._v(" "),n("p",[e._v("Ethernet connectivity provides a fast, reliable, and flexible communication alternative to using USB or other serial connections.")]),e._v(" "),n("p",[e._v('It can be used to connect to ground stations, companion computers, and other MAVLink systems.\nIt is particularly recommended when connecting to systems that "natively" use Ethernet - for example IP Radios.')]),e._v(" "),n("p",[e._v("This topic covers:")]),e._v(" "),n("ul",[n("li",[e._v("Supported flight controllers")]),e._v(" "),n("li",[e._v("Ethernet network setup for PX4 and any systems it needs to connect to (including ground stations and companion computers).")]),e._v(" "),n("li",[e._v("Configuring the PX4 Ethernet port, specifying the UDP ports and profiles that should be used for connecting to a GCS and a companion computer.")]),e._v(" "),n("li",[e._v("Using MAVSDK or ROS to connect to PX4 over the network.")])]),e._v(" "),n("h2",{attrs:{id:"supported-flight-controllers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#supported-flight-controllers"}},[e._v("#")]),e._v(" Supported Flight Controllers")]),e._v(" "),n("p",[e._v("PX4 supports Ethernet connectivity on "),n("a",{attrs:{href:"https://github.com/pixhawk/Pixhawk-Standards/blob/master/DS-011%20Pixhawk%20Autopilot%20v5X%20Standard.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pixhawk 5X-standard"),n("OutboundLink")],1),e._v(" flight controllers (and later) that have an Ethernet port.\nIt may also be supported on other boards.")]),e._v(" "),n("p",[e._v("Supported flight controllers include:")]),e._v(" "),n("ul",[n("li",[n("RouterLink",{attrs:{to:"/en/flight_controller/pixhawk5x.html"}},[e._v("Holybro Pixhawk 5X")])],1)]),e._v(" "),n("h2",{attrs:{id:"px4-ethernet-port-configuration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#px4-ethernet-port-configuration"}},[e._v("#")]),e._v(" PX4 Ethernet Port Configuration")]),e._v(" "),n("div",{staticClass:"custom-block note"},[n("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),n("p",[e._v("The Ethernet port configuration sets the properties of the "),n("em",[e._v("serial link")]),e._v(" (which is how PX4 views the Ethernet connection).\nThis includes the set of MAVLink messages that are streamed, the data rate, the UDP ports that a remote system can connect listen to, etc.\nYou will separately need to configure the PX4 "),n("em",[e._v("network settings")]),e._v(".\nThis is covered separately (in the following sections).")])]),e._v(" "),n("p",[e._v("PX4 configures the Ethernet (serial) port to connect to a GCS by default via MAVLink.")]),e._v(" "),n("p",[e._v("Specifically it sets the configuration parameters as shown:")]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",[e._v("Parameter")]),e._v(" "),n("th",[e._v("Value")]),e._v(" "),n("th",[e._v("Description")])])]),e._v(" "),n("tbody",[n("tr",[n("td",[n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_CONFIG"}},[e._v("MAV_2_CONFIG")])],1),e._v(" "),n("td",[e._v("1000")]),e._v(" "),n("td",[e._v("Configure Ethernet port")])]),e._v(" "),n("tr",[n("td",[n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_BROADCAST"}},[e._v("MAV_2_BROADCAST")])],1),e._v(" "),n("td",[e._v("1")]),e._v(" "),n("td",[e._v("Broadcast "),n("code",[e._v("HEARTBEAT")]),e._v(" messages")])]),e._v(" "),n("tr",[n("td",[n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_MODE"}},[e._v("MAV_2_MODE")])],1),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v('Send the "normal" set of MAVLink messages (i.e. the GCS set)')])]),e._v(" "),n("tr",[n("td",[n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_RADIO_CTL"}},[e._v("MAV_2_RADIO_CTL")])],1),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("Disable software throttling of MAVLink traffic")])]),e._v(" "),n("tr",[n("td",[n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_RATE"}},[e._v("MAV_2_RATE")])],1),e._v(" "),n("td",[e._v("100000")]),e._v(" "),n("td",[e._v("Maximum sending rate")])]),e._v(" "),n("tr",[n("td",[n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_REMOTE_PRT"}},[e._v("MAV_2_REMOTE_PRT")])],1),e._v(" "),n("td",[e._v("14550")]),e._v(" "),n("td",[e._v("MAVLink Remote Port of 14550 (GCS)")])]),e._v(" "),n("tr",[n("td",[n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_UDP_PRT"}},[e._v("MAV_2_UDP_PRT")])],1),e._v(" "),n("td",[e._v("14550")]),e._v(" "),n("td",[e._v("MAVLink Network Port of 14550 (GCS)")])])])]),e._v(" "),n("p",[e._v("To configure the port to connect to a companion computer you would change "),n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_REMOTE_PRT"}},[e._v("MAV_2_REMOTE_PRT")]),e._v(" and "),n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_UDP_PRT"}},[e._v("MAV_2_UDP_PRT")]),e._v(" to "),n("code",[e._v("14540")]),e._v(" and "),n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_MODE"}},[e._v("MAV_2_MODE")]),e._v(" to "),n("code",[e._v("2")]),e._v(" (Onboard).")],1),e._v(" "),n("p",[e._v("For more information on MAVLink serial port configuration see "),n("RouterLink",{attrs:{to:"/en/peripherals/mavlink_peripherals.html"}},[e._v("MAVLink Peripherals (GCS/OSD/Companion)")])],1),e._v(" "),n("h2",{attrs:{id:"setting-up-the-ethernet-network"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-the-ethernet-network"}},[e._v("#")]),e._v(" Setting up the Ethernet Network")]),e._v(" "),n("p",[e._v("To connect systems over Ethernet you need to configure them to run on the same IP network, so that each system has a unique IP address and knows how to find the other systems.")]),e._v(" "),n("p",[e._v('There is no single "out of the box configuration" that we can provide that will necessarily work in your local network.\nTherefore as an example of the kind of configuration you might do, below we show how to set up the systems on an IP network with addresses '),n("code",[e._v("192.168.0.Xxx")]),e._v(", where PX4 has a statically allocated address "),n("code",[e._v("192.168.0.4")]),e._v(" and the computer has address "),n("code",[e._v("192.168.0.1")]),e._v(".\nIf you connect a companion computer or other system to the network you would need to use a similar approach to allocate its address (or you could set up a DHCP server and allocate addresses dynamically).")]),e._v(" "),n("div",{staticClass:"custom-block note"},[n("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),n("p",[e._v('There is nothing "special" about the network configuration (other than perhaps the tools used to modify the network settings); it works much the same as any home or business network.\nWhich is to say that a knowledge of how IP networks work is highly desirable!')])]),e._v(" "),n("h3",{attrs:{id:"px4-ethernet-network-setup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#px4-ethernet-network-setup"}},[e._v("#")]),e._v(" PX4 Ethernet Network Setup")]),e._v(" "),n("p",[e._v("PX4 uses the "),n("RouterLink",{attrs:{to:"/en/modules/modules_system.html#netman"}},[e._v("netman")]),e._v(" module to apply and update network settings.")],1),e._v(" "),n("p",[e._v("Network settings are defined in the configuration file "),n("code",[e._v("/fs/microsd/net.cfg")]),e._v(" on the SD card.\nThis is a text file, that defines each setting on a new line as a "),n("code",[e._v("name=value")]),e._v(" pair.\nA configuration file might look like this:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("DEVICE=eth0\nBOOTPROTO=fallback\nIPADDR=192.168.0.4\nNETMASK=255.255.255.0\nROUTER=192.168.0.254\nDNS=192.168.0.254\n")])])]),n("p",[e._v("Where the values are:")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("DEVICE")]),e._v(": Interface name. Default is "),n("code",[e._v("eth0")]),e._v(".")]),e._v(" "),n("li",[n("code",[e._v("BOOTPROTO")]),e._v(": Protocol for getting PX4 IP address. Valid values for proto are: "),n("code",[e._v("dhcp")]),e._v(", "),n("code",[e._v("static")]),e._v(", "),n("code",[e._v("fallback")]),e._v(" (use DHCP but fall back to static address after time, if that fails)")]),e._v(" "),n("li",[n("code",[e._v("IPADDR")]),e._v(": Static IP address (used if BOOTPROTO is "),n("code",[e._v("static")]),e._v(" or "),n("code",[e._v("fallback")]),e._v(")")]),e._v(" "),n("li",[n("code",[e._v("NETMASK")]),e._v(": Network mask")]),e._v(" "),n("li",[n("code",[e._v("ROUTER")]),e._v(": The addess of the default route.")]),e._v(" "),n("li",[n("code",[e._v("DNS")]),e._v(": The address of the DNS server.")])]),e._v(" "),n("p",[e._v('To set the above "example" configuration using the '),n("em",[e._v("QGroundControl")]),e._v(":")]),e._v(" "),n("ol",[n("li",[e._v("Connect the flight controller to the computer with the USB cable.")]),e._v(" "),n("li",[e._v("Open "),n("strong",[e._v("QGroundcontrol > Analyze Tools > MAVLink Console")])]),e._v(" "),n("li",[e._v('Enter commands "like" the ones below into the '),n("em",[e._v("MAVLink Console")]),e._v(" (to write the values to the configuration file):"),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("echo DEVICE=eth0 > /fs/microsd/net.cfg\necho BOOTPROTO=fallback >> /fs/microsd/net.cfg\necho IPADDR=192.168.0.4 >> /fs/microsd/net.cfg\necho NETMASK=255.255.255.0 >>/fs/microsd/net.cfg\necho ROUTER=192.168.0.254 >>/fs/microsd/net.cfg\necho DNS=192.168.0.254 >>/fs/microsd/net.cfg\n")])])])]),e._v(" "),n("li",[e._v("Once the network configuration has been set you can disconnect the USB cable.")]),e._v(" "),n("li",[e._v("Reboot the flight controller to apply the settings.")])]),e._v(" "),n("h3",{attrs:{id:"ubuntu-ethernet-network-setup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-ethernet-network-setup"}},[e._v("#")]),e._v(" Ubuntu Ethernet Network Setup")]),e._v(" "),n("p",[e._v("If you're using Ubuntu for your ground station (or companion computer) then you can use "),n("a",{attrs:{href:"https://netplan.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("netplan"),n("OutboundLink")],1),e._v(" to configure the network.")]),e._v(" "),n("p",[e._v('Below we show how you write a setup to the netplan configuration file "'),n("code",[e._v("/etc/netplan/01-network-manager-all.yaml")]),e._v('", which would run on the same network as used by the PX4 setup above.\nNote that there are many more '),n("a",{attrs:{href:"https://netplan.io/examples/",target:"_blank",rel:"noopener noreferrer"}},[e._v("examples"),n("OutboundLink")],1),e._v(" and instructions in the "),n("a",{attrs:{href:"https://netplan.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("netplan"),n("OutboundLink")],1),e._v(" documentation.")]),e._v(" "),n("p",[e._v("To setup the Ubuntu Computer:")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("In a terminal, create and open a "),n("code",[e._v("netplan")]),e._v(" configuration file: "),n("code",[e._v("/etc/netplan/01-network-manager-all.yaml")]),e._v("\nBelow we do this using the "),n("em",[e._v("nano")]),e._v(" text editor.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("sudo nano /etc/netplan/01-network-manager-all.yaml \n")])])])]),e._v(" "),n("li",[n("p",[e._v("Copy and paste the following configuration information into the file (note: the indentations are important!):")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("network:\n  version: 2\n  renderer: NetworkManager\n  ethernets:\n      enp2s0:\n          addresses:\n              - 192.168.0.1/24\n          nameservers:\n              addresses: [192.168.0.1]\n          routes:\n              - to: 192.168.0.1\n                via: 192.168.0.1\n")])])]),n("p",[e._v("Save and exit the editor.")])]),e._v(" "),n("li",[n("p",[e._v("Apply the "),n("em",[e._v("netplan")]),e._v(" configuration by entering the following command into the Ubuntu terminal.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("sudo netplan apply\n")])])])])]),e._v(" "),n("p",[e._v("If you have already configured the Pixhawk 5X, at this point you could connect it to the computer via an Ethernet cable and it would be automatically deteced by QGroundControl.")]),e._v(" "),n("h3",{attrs:{id:"companion-computer-ethernet-network-setup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#companion-computer-ethernet-network-setup"}},[e._v("#")]),e._v(" Companion Computer Ethernet Network Setup")]),e._v(" "),n("p",[e._v("The setup for a companion computer will depend on the companion computer's operating system.")]),e._v(" "),n("p",[e._v("A Linux operating system may support "),n("code",[e._v("netplan")]),e._v(", in which case the instructions would be the same as above, but using a unique IP address.")]),e._v(" "),n("h2",{attrs:{id:"gcs-setup-example"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gcs-setup-example"}},[e._v("#")]),e._v(" GCS Setup Example")]),e._v(" "),n("p",[e._v("To connect a GCS to PX4 over Ethernet:")]),e._v(" "),n("ol",[n("li",[n("a",{attrs:{href:"#setting-up-the-ethernet-network"}},[e._v("Set up the Ethernet Network")]),e._v(" so your ground station computer and PX4 run on the same network.")]),e._v(" "),n("li",[e._v("Connect the computer and PX4 using an Ethernet cable and start QGroundControl.")]),e._v(" "),n("li",[e._v("QGroundControl should connect automatically.")])]),e._v(" "),n("div",{staticClass:"custom-block note"},[n("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),n("p",[n("a",{attrs:{href:"#px4-ethernet-port-configuration"}},[e._v("PX4 Ethernet Port Configuration")]),e._v(" is not required because it is setup by default for connecting to a GCS.")])]),e._v(" "),n("h2",{attrs:{id:"mavsdk-python-setup-example"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mavsdk-python-setup-example"}},[e._v("#")]),e._v(" MAVSDK-Python Setup Example")]),e._v(" "),n("p",[e._v("To setup MAVSDK-Python running on a companion computer:")]),e._v(" "),n("ol",[n("li",[n("p",[n("a",{attrs:{href:"#setting-up-the-ethernet-network"}},[e._v("Set up the Ethernet Network")]),e._v(" so your companion computer and PX4 run on the same network.")])]),e._v(" "),n("li",[n("p",[e._v("Modify the "),n("a",{attrs:{href:"#px4-ethernet-port-configuration"}},[e._v("PX4 Ethernet Port Configuration")]),e._v(" to connect to a companion computer.\nYou will need to change the parameters "),n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_REMOTE_PRT"}},[e._v("MAV_2_REMOTE_PRT")]),e._v(" and "),n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_UDP_PRT"}},[e._v("MAV_2_UDP_PRT")]),e._v(" to "),n("code",[e._v("14540")]),e._v(", and "),n("RouterLink",{attrs:{to:"/en/advanced_config/parameter_reference.html#MAV_2_MODE"}},[e._v("MAV_2_MODE")]),e._v(" to "),n("code",[e._v("2")]),e._v(" (Onboard).")],1)]),e._v(" "),n("li",[n("p",[e._v("Follow the instructions in "),n("a",{attrs:{href:"https://github.com/mavlink/MAVSDK-Python",target:"_blank",rel:"noopener noreferrer"}},[e._v("MAVSDK-python"),n("OutboundLink")],1),e._v(" to install and use MAVSDK.")]),e._v(" "),n("p",[e._v("For example, your code will connect to the PX4 using:")]),e._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" drone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("system_address"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"udp://:14540"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])])])]),e._v(" "),n("div",{staticClass:"custom-block note"},[n("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),n("p",[e._v("MAVSDK can connect to the PX4 on port "),n("code",[e._v("14550")]),e._v(" if you don't modify the PX4 Ethernet port configuration.\nHowever this is not recommended because the default configuration is optimised for communicating with a GCS (not a companion computer).")])]),e._v(" "),n("h3",{attrs:{id:"ros2-setup-example"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ros2-setup-example"}},[e._v("#")]),e._v(" ROS2 Setup Example")]),e._v(" "),n("p",[e._v("Prerequisites:")]),e._v(" "),n("ul",[n("li",[e._v("You have a supported autopilot hardware with RTPS feature enabled firmware on it by using "),n("RouterLink",{attrs:{to:"/en/middleware/micrortps.html#client-px4-px4-autopilot"}},[e._v("this guide")]),e._v(".")],1),e._v(" "),n("li",[n("RouterLink",{attrs:{to:"/en/ros/ros2_comm.html#sanity-check-the-installation"}},[e._v("ROS2")]),e._v(" has been set up correctly and "),n("RouterLink",{attrs:{to:"/en/ros/ros2_comm.html#sanity-check-the-installation"}},[e._v("sanity check")]),e._v(" has been confirmed.")],1),e._v(" "),n("li",[e._v("You have followed the Ethernet network and port setup as discussed at the top of this page.")])]),e._v(" "),n("p",[e._v("In this example it is assumed that you have followed the example to set your IP addresses.")]),e._v(" "),n("ol",[n("li",[e._v("Connect your Flight controller via Ethernet")]),e._v(" "),n("li",[e._v("Open "),n("strong",[e._v("QGroundcontrol > Analyze Tools > MAVLink Console")])]),e._v(" "),n("li",[e._v("Enter the command below to start the micro_rtps client on your flight controller.\nNote that the remote IP here is your companion computer IP.\nThis by default starts the micrortps_client connected to UDP ports 2019 and 2020\nTo make changes you can take a look at "),n("RouterLink",{attrs:{to:"/en/middleware/micrortps.html#client-px4-px4-autopilot"}},[e._v("RTPS guide")]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("micrortps_client start -t UDP -i <remote IP>\n")])])]),e._v("An output like below is expected in the console:"),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("INFO  [micrortps_client] UDP transport: ip address: 192.168.0.1; recv port: 2019; send port: 2020\nINFO  [micrortps_client] UDP transport: Trying to connect...\nINFO  [micrortps_client] UDP transport: Connected to server!\n")])])])],1),e._v(" "),n("li",[e._v("Then we need to run the agent by typing the below commands in a new terminal on either our Linux computer.\nThis will start the agent on "),n("code",[e._v("localhost")]),e._v(" which is "),n("code",[e._v("127.0.0.1")]),e._v("."),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ source ~/px4_ros_com_ros2/install/setup.bash\n$ micrortps_agent start -t UDP\n")])])])]),e._v(" "),n("li",[e._v("In a new terminal you can run a listener node to confirm the connection is established:"),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ source ~/px4_ros_com_ros2/install/setup.bash\n$ ros2 launch px4_ros_com sensor_combined_listener.launch.py\n")])])])])]),e._v(" "),n("p",[e._v("If everything goes ok and there is an established connection you can see the output below in your terminal:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("RECEIVED SENSOR COMBINED DATA\n=============================\nts: 855801598\ngyro_rad[0]: -0.00339938\ngyro_rad[1]: 0.00440091\ngyro_rad[2]: 0.00513893\ngyro_integral_dt: 4997\naccelerometer_timestamp_relative: 0\naccelerometer_m_s2[0]: -0.0324082\naccelerometer_m_s2[1]: 0.0392213\naccelerometer_m_s2[2]: -9.77914\naccelerometer_integral_dt: 4997\n")])])])])}),[],!1,null,null,null);t.default=a.exports}}]);