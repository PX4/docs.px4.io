import{_ as e,a as i,b as a,c as t,d as s,e as n}from"./chunks/plotjuggler_quaternion_roll_plotted.CJGUXW66.js";import{_ as l,c as o,o as r,ab as h}from"./chunks/framework.CUflZczI.js";const _=JSON.parse('{"title":"Log Analysis using PlotJuggler","description":"","frontmatter":{},"headers":[],"relativePath":"en/log/plotjuggler_log_analysis.md","filePath":"en/log/plotjuggler_log_analysis.md"}'),p={name:"en/log/plotjuggler_log_analysis.md"},d=h('<h1 id="log-analysis-using-plotjuggler" tabindex="-1">Log Analysis using PlotJuggler <a class="header-anchor" href="#log-analysis-using-plotjuggler" aria-label="Permalink to &quot;Log Analysis using PlotJuggler&quot;">​</a></h1><p><a href="https://github.com/facontidavide/PlotJuggler" target="_blank" rel="noreferrer">PlotJuggler</a> can be used to analyze ULogs for in-depth, development purposes. It is incredibly useful as every uORB topic is exposed / can be graphed, as well as having custom functions to modify the data (e.g. from Quaternion values to Roll / Pitch / Yaw).</p><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><p>You can find the latest releases of the Plot Juggler <a href="https://github.com/facontidavide/PlotJuggler/releases" target="_blank" rel="noreferrer">here</a>.</p><h4 id="notes-on-windows-distribution" tabindex="-1">Notes on Windows distribution <a class="header-anchor" href="#notes-on-windows-distribution" aria-label="Permalink to &quot;Notes on Windows distribution&quot;">​</a></h4><p>The latest version of PlotJuggler for Windows may not work. In this case fallback to <a href="https://github.com/facontidavide/PlotJuggler/releases/tag/2.8.4" target="_blank" rel="noreferrer">v2.8.4 here</a> (this is known to work with Windows).</p><h4 id="notes-on-appimage-for-linux-distributions" tabindex="-1">Notes on AppImage for Linux distributions <a class="header-anchor" href="#notes-on-appimage-for-linux-distributions" aria-label="Permalink to &quot;Notes on AppImage for Linux distributions&quot;">​</a></h4><p>If the downloaded AppImage does not open, you may need to change its access settings. This is done in the terminal using the following command:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 777</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Path-To-PlotJuggler-AppImag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h2 id="general-usage" tabindex="-1">General Usage <a class="header-anchor" href="#general-usage" aria-label="Permalink to &quot;General Usage&quot;">​</a></h2><p>Two most common tasks are &quot;Searching&quot; for the logged uORB topic, and &quot;Drag and Dropping&quot; a field in a specific topic onto the graph view. These are demonstrated in the diagram below.</p><p><img src="'+e+'" alt="Plot Juggler basic usage"></p><h3 id="splitting-horizontally-vertically-multi-panel" tabindex="-1">Splitting Horizontally / Vertically : Multi Panel <a class="header-anchor" href="#splitting-horizontally-vertically-multi-panel" aria-label="Permalink to &quot;Splitting Horizontally / Vertically : Multi Panel&quot;">​</a></h3><p>One of the most powerful feature is splitting the screen in either horizontal/vertical orientation and displaying different graphs at the same time ( with a synchronized time-bar on top, as you move the time cursor in the bottom).</p><p>This is demonstrated in an animation below:</p><p><img src="'+i+'" alt="Plot Juggler Multi panel demonstration"></p><p>In this example, <code>vehicle_local_position</code> topic&#39;s <code>ax</code>, <code>ay</code> and <code>az</code> (Acceleration estimate) components were graphed first by splitting the screen in 3 sections. Then, the <code>vz</code> (Velocity estimate) component was added under right pane, and finally <code>battery_status</code> topic&#39;s <code>current_a</code> (Battery current) was graphed in the lower-mid pane.</p><p>Although not obvious in the beginning you can observe that whenever the vehicle starts moving (battery current value goes high), the acceleration and velocity values start to move around as well. This is because all the data is displayed as a time-series, which shows each value at on a specific timestamp.</p><p>This is useful for providing a broad view of what happened and why. It is often hard to troubleshoot a problem just by looking at one graph, but by having multiple graphs displayed, it is much easier to figure out what was going on in the system.</p><h3 id="displaying-data-in-2d" tabindex="-1">Displaying Data in 2D <a class="header-anchor" href="#displaying-data-in-2d" aria-label="Permalink to &quot;Displaying Data in 2D&quot;">​</a></h3><p>Another powerful feature is the ability to display 2D data on a XY plane (each data on X, Y axis) in a scatter-plot manner. This is done by selecting two data points by holding <code>Ctrl</code> key while selecting each of them (e.g. <code>vehicle_local_position</code> topic&#39;s <code>x</code> and <code>y</code> components), and drag &amp; dropping it with the <code>Right mouse cursor</code> pressed.</p><p><img src="'+a+'" alt="Plot Juggler 2D graphing"></p><p>In this example, the estimated vehicle&#39;s position in local coordinate frame is graphed onto a XY-plane which shows a 2D view of the estimated position, and the <code>vx</code> and <code>vy</code> components (Velocity estimate) are graphed on the right, with the <code>vz</code> (Vertical velocity estimate) graphed underneath it in a split view.</p><p>This in turn shows the relationship between position and the velocity of the vehicle intuitively. For example, note how when the vehicle moves in the X-axis direction, the <code>vx</code> value goes high, and as the vehicle turns to the Y-axis direction, the <code>vy</code> value starts to change as well.</p><h4 id="using-the-play-button" tabindex="-1">Using the &#39;Play&#39; button <a class="header-anchor" href="#using-the-play-button" aria-label="Permalink to &quot;Using the &#39;Play&#39; button&quot;">​</a></h4><p>Here the <strong>Play</strong> button is used to play the recorded data in real time (speed factor can be adjusted in the lower-right corner). This shows the position / velocity relationship described above in detail.</p><p><img src="'+t+'" alt="Plot Juggler 2D in-depth analysis"></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Try out the boat testing log analysis yourself by downloading the ULog and Layout file used above!</p><ul><li><a href="https://github.com/PX4/PX4-user_guide/raw/v1.15/assets/flight_log_analysis/plot_juggler/sample_log_boat_testing_2022-7-28-13-31-16.ulg" target="_blank" rel="noreferrer">Boat testing ULog</a></li><li><a href="https://raw.githubusercontent.com/PX4/PX4-user_guide/v1.15/assets/flight_log_analysis/plot_juggler/sample_log_boat_testing_layout.xml" target="_blank" rel="noreferrer">Boat testing Analysis Layout</a></li></ul></div><h3 id="layout-templates" tabindex="-1">Layout Templates <a class="header-anchor" href="#layout-templates" aria-label="Permalink to &quot;Layout Templates&quot;">​</a></h3><p>There are a number of PlotJuggler layout files shared by PX4 Developers. Each can be used for a specific purpose (Multicopter tuning, VTOL tuning, Boat debugging, etc.):</p><ul><li><a href="https://github.com/PX4/PX4-user_guide/blob/v1.15/assets/flight_log_analysis/plot_juggler/plotjuggler_sample_view.xml" target="_blank" rel="noreferrer">Sample View layout</a> : Template used in the <a href="#splitting-horizontally-vertically-multi-panel">Multi-panel example</a> above.</li></ul><h2 id="advanced-usage" tabindex="-1">Advanced Usage <a class="header-anchor" href="#advanced-usage" aria-label="Permalink to &quot;Advanced Usage&quot;">​</a></h2><h3 id="creating-custom-time-series-using-lua-script" tabindex="-1">Creating custom time series using LUA script <a class="header-anchor" href="#creating-custom-time-series-using-lua-script" aria-label="Permalink to &quot;Creating custom time series using LUA script&quot;">​</a></h3><p>Plot Juggler supports having LUA scripts to process and display data. This is a powerful feature that can do things like integrating the curve, averaging two curves, removing offsets, etc.</p><h4 id="calculating-roll-pitch-yaw-from-quaternion" tabindex="-1">Calculating Roll/Pitch/Yaw from Quaternion <a class="header-anchor" href="#calculating-roll-pitch-yaw-from-quaternion" aria-label="Permalink to &quot;Calculating Roll/Pitch/Yaw from Quaternion&quot;">​</a></h4><p><img src="'+s+'" alt="Quaternion to Roll using Lua script"></p><p>To know vehicle&#39;s attitude, PX4 logs the estimated attitude&#39;s quaternion in the <code>vehicle_attitude</code> topic in an array of floating point values (q[4]). Since these values don&#39;t give contextual information (e.g. <code>roll</code>), it needs a transformation involving trigonometric functions.</p><ol><li>Search for <code>vehicle_attitude</code> topic in Timeseries List panel on the left</li><li>Select 4 quaternion members (<code>q.00, q.01, q.02, q.03</code>) by clicking <code>q.00</code> first, then holding Shift + clicking <code>q.03</code>. They should all be selected</li><li>Click the &#39;+&#39; symbol in the lower-left &#39;Custom Series&#39; section to create new series</li><li>Select 4 quaternion members again, and drag them to &#39;Input timeseries + Additional source timeseries&#39; tab on upper-left corner</li><li>Double click on the <code>quat_to_roll</code> from the Function Library. Now you should have the plot on upper section</li><li>Assign the name for the plot (e.g. <code>roll</code>) in the text box in upper-right corner</li><li>Click &#39;Create New Timeseries&#39;. You should now have the plot in &#39;Custom Series&#39;</li></ol><p>Here the custom series <code>Roll</code> is displayed along with other timeseries, including it&#39;s original form in Quaternion on the right, which is not human-readable (using PlotJuggler 3.5.0):</p><p><img src="'+n+`" alt="Quaternion Roll plotted"></p><p>The <code>quat_to_roll</code> function looks like this:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dcm21 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> z)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dcm22 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> w</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> z</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">z</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">roll </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> math.atan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dcm21, dcm22)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> roll</span></span></code></pre></div>`,42),c=[d];function g(u,k,m,y,b,f){return r(),o("div",null,c)}const w=l(p,[["render",g]]);export{_ as __pageData,w as default};
