import{_ as s,c as i,o as a,ab as h}from"./chunks/framework.CUflZczI.js";const y=JSON.parse('{"title":"Профілювання двійкового розміру","description":"","frontmatter":{},"headers":[],"relativePath":"uk/debug/binary_size_profiling.md","filePath":"uk/debug/binary_size_profiling.md"}'),n={name:"uk/debug/binary_size_profiling.md"},k=h(`<h1 id="профілювання-двіикового-розміру" tabindex="-1">Профілювання двійкового розміру <a class="header-anchor" href="#профілювання-двіикового-розміру" aria-label="Permalink to &quot;Профілювання двійкового розміру&quot;">​</a></h1><p>Ціль збірки <code>bloaty_compare_master</code> дозволяє вам краще зрозуміти вплив змін на розмір коду. Коли використовується, інструментарій завантажує останню успішну майстер-збірку певного прошивкового ПЗ та порівнює її з локальною збіркою (використовуючи <a href="https://github.com/google/bloaty" target="_blank" rel="noreferrer">bloaty</a> розмір профілювальника для бінарних файлів).</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Це може допомогти проаналізувати зміни, які (можливо) призводять до того, що <code>px4_fmu-v2_default</code> досягає обмеження 1 МБ для флешу.</p></div><p><em>Bloaty</em> повинен бути у вашому шляху та бути знайденим у час налаштування <em>cmake</em>. The PX4 <a href="https://github.com/PX4/containers/blob/master/docker/Dockerfile_nuttx-bionic" target="_blank" rel="noreferrer">docker files</a> install <em>bloaty</em> as shown:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --recursive</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/google/bloaty.git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/bloaty</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/bloaty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cmake</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -GNinja</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ninja</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bloaty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bloaty</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span></code></pre></div><p>Приклад нижче показує, як ви можете побачити вплив видалення драйвера <em>mpu9250</em> з <code>px4_fmu-v2_default</code>. Спочатку локально налаштовує збірку без драйвера:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> %</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> diff</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">diff</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a/boards/px4/fmu-v2/default.px4board</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b/boards/px4/fmu-v2/default.px4board</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 40d7778..2ce7972</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100644</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a/boards/px4/fmu-v2/default.px4board</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+++</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b/boards/px4/fmu-v2/default.px4board</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@@</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -36,7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +36,7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @@</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               CONFIG_DRIVERS_IMU_INVENSENSE_MPU9250=y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               CONFIG_DRIVERS_IMU_INVENSENSE_MPU9250=n</span></span></code></pre></div><p>Потім використовуйте ціль створення, вказавши ціль для порівняння (<code>px4_fmu-v2_default</code> у цьому випадку):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> px4_fmu-v2_default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bloaty_compare_master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     VM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIZE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                                                        FILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIZE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> --------------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                                                                  --------------</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-52</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::check_null_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> int</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                               </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-52</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::test_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                                                                </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-52</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250_gyro::MPU9250_gyro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MPU9250*,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-56</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpu9250::info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MPU9250_BUS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                                           </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-56</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]     </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-56</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mpu9250::regdump</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MPU9250_BUS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                                        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-56</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                        -336</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-344</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250_mag::_measure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ak8963_regs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                                  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-344</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-684</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::MPU9250</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">device::Device*,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> device::Device</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cha</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -684</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-684</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                                                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-684</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]   </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-1000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MPU9250::measure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                                                                 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [DEL]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -41.3%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   -1011</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [43 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Others]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                                                        -1011</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -41.3%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -1.0%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1.05Ki</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Unmapped]                                                                       +24.2Ki  +0.2%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -1.0%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -10.3Ki</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TOTAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                                            +14.9Ki</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  +0.1%</span></span></code></pre></div><p>Це показує, що видалення <em>mpu9250</em> з <code>px4_fmu-v2_default</code> заощадило б 10,3 кБ флешу. Це також показує розміри різних частин драйвера <em>mpu9250</em>.</p>`,10),p=[k];function l(t,e,F,r,d,E){return a(),i("div",null,p)}const C=s(n,[["render",l]]);export{y as __pageData,C as default};
