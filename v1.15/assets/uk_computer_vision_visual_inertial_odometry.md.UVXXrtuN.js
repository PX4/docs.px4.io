import{_ as e}from"./chunks/ekf2_ev_delay_tuning.Bgxz8N1S.js";import{_ as a,c as t,o,ab as r}from"./chunks/framework.CUflZczI.js";const O=JSON.parse('{"title":"Візуально-інерційна одометрія (VIO)","description":"","frontmatter":{},"headers":[],"relativePath":"uk/computer_vision/visual_inertial_odometry.md","filePath":"uk/computer_vision/visual_inertial_odometry.md"}'),i={name:"uk/computer_vision/visual_inertial_odometry.md"},l=r('<h1 id="візуально-інерціина-одометрія-vio" tabindex="-1">Візуально-інерційна одометрія (VIO) <a class="header-anchor" href="#візуально-інерціина-одометрія-vio" aria-label="Permalink to &quot;Візуально-інерційна одометрія (VIO)&quot;">​</a></h1><p><em>Візуальна інерціальна одометрія</em> (VIO) — це техніка <a href="./../computer_vision/">комп’ютерного бачення</a>, яка використовується для оцінки тривимірної <em>пози</em> (локального положення та орієнтації) і <em>швидкості</em> транспортного засобу, що рухається, відносно <em>локальної</em> вихідної позиції. Він зазвичай використовується для навігації транспортного засобу в ситуаціях, коли GPS відсутній або ненадійний (наприклад, у приміщенні або під час прольоту під мостом).</p><p>VIO використовує <a href="https://en.wikipedia.org/wiki/Visual_odometry" target="_blank" rel="noreferrer">Візуальну одометрію</a> для оцінки <em>позиції</em> транспортного засобу на основі зображень із камери в поєднанні з інерційними вимірюваннями з IMU транспортного засобу (щоб виправити помилки, пов’язані зі швидким рухом транспортного засобу, що призводить до поганого захоплення зображення).</p><p>Ця тема надає керівництво щодо налаштування PX4 та супутнього комп&#39;ютера для налаштування VIO.</p><p>:::note Рекомендоване налаштування використовує ROS для передачі інформації VIO до PX4. Однак сам PX4 не цікавиться джерелом повідомлень, якщо вони надаються через відповідний <a href="./../ros/external_position_estimation.html#px4-mavlink-integration">інтерфейс MAVLink</a>. :::</p><h2 id="рекомендована-настроика" tabindex="-1">Рекомендована настройка <a class="header-anchor" href="#рекомендована-настроика" aria-label="Permalink to &quot;Рекомендована настройка&quot;">​</a></h2><p>Апаратна та програмна настройка для VIO запропонована в розділах нижче як ілюстрація того, як підключити систему VIO до PX4. Вона використовує готову систему відстеження камери та супутній комп&#39;ютер, що працює під керуванням ROS. ROS використовується для зчитування інформації про одометрію з камери та подачі її до PX4.</p><p>Прикладом підходящої відстежуючої камери є камера відстеження <a href="./../peripherals/camera_t265_vio.html">Intel® RealSense™ T265</a>.</p><h3 id="встановлення-камери" tabindex="-1">Встановлення камери <a class="header-anchor" href="#встановлення-камери" aria-label="Permalink to &quot;Встановлення камери&quot;">​</a></h3><p>Прикріпіть камеру до супутнього комп&#39;ютера та закріпіть її на рамі:</p><ul><li>Прикріпіть камеру з лінзами, спрямованими вниз, якщо це можливо (за замовчуванням).</li><li>Камери зазвичай дуже чутливі до вібрацій; рекомендується використовувати м&#39;яке кріплення (наприклад, за допомогою віброізоляційної піни).</li></ul><h3 id="налаштування-комп-ютера-компаньиона" tabindex="-1">Налаштування комп&#39;ютера компаньйона <a class="header-anchor" href="#налаштування-комп-ютера-компаньиона" aria-label="Permalink to &quot;Налаштування комп&#39;ютера компаньйона&quot;">​</a></h3><p>Для налаштування ROS та PX4:</p><ul><li>На комп&#39;ютері-супутнику встановіть та налаштуйте <a href="./../ros/mavros_installation.html">MAVROS</a>.</li><li>Реалізуйте та запустіть вузол ROS для зчитування даних з камери та публікації відомостей VIO за допомогою MAVROS. <ul><li>Дивіться розділ нижче про вузол <a href="#vio_ros_node">ROS VIO</a> для подробиць щодо вимог до цього вузла.</li></ul></li><li>Слідуйте інструкціям <a href="#ekf2_tuning">нижче</a> для налаштування оцінювача EKF2 в PX4.</li><li>Перевірте підключення до керуючого контролера.</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Ви можете використовувати <em>QGroundControl</em> <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/analyze_view/mavlink_inspector.html" target="_blank" rel="noreferrer">MAVLink Inspector</a>, щоб переконатися, що ви отримуєте повідомлення <code>ODOMETRY</code> або <code>VISION_POSITION_ESTIMATE</code> (або перевірити наявність Повідомлення <code>HEARTBEAT</code>, які мають ідентифікатор компонента 197 (<code>MAV_COMP_ID_VISUAL_INERTIAL_ODOMETRY</code>)).</p></div><ul><li><a href="#verify_estimate">Перевірте, чи VIO налаштовано правильно</a> перед першим польотом!</li></ul><p><a id="vio_ros_node"></a></p><h3 id="ros-vio-вузол" tabindex="-1">ROS VIO вузол <a class="header-anchor" href="#ros-vio-вузол" aria-label="Permalink to &quot;ROS VIO вузол&quot;">​</a></h3><p>У цьому рекомендованому налаштуванні ROS вузла VIO потрібно</p><ol><li>інтерфейс з обраною апаратурою камери або сенсора,</li><li>створити повідомлення відомостей, що містять оцінку позиції, які будуть надіслані до PX4 за допомогою MAVROS, та</li><li>публікувати повідомлення для вказівки стану системи VIO.</li></ol><p>Реалізація вузла ROS буде конкретною для використовуваної камери і буде потребувати розробки для використання відповідного інтерфейсу та драйверів для камери.</p><p>Повідомлення відомостей повинні бути типу <a href="http://docs.ros.org/en/noetic/api/nav_msgs/html/msg/Odometry.html" target="_blank" rel="noreferrer"><code>nav_msgs/Odometry</code></a> та публікуватися на темі <code>/mavros/odometry/out</code>.</p><p>Повідомлення стану системи типу <a href="https://github.com/mavlink/mavros/blob/master/mavros_msgs/msg/CompanionProcessStatus.msg" target="_blank" rel="noreferrer"><code>mavros_msgs/CompanionProcessStatus</code></a> повинні публікуватися на темі <code>/mavros/companion_process/status</code>. Вони повинні ідентифікувати компонент як <code>MAV_COMP_ID_VISUAL_INERTIAL_ODOMETRY</code> (197) та вказувати <code>стан системи</code>. Рекомендовані значення статусу:</p><ul><li><code>MAV_STATE_ACTIVE</code> коли система VIO працює як очікувалося,</li><li><code>MAV_STATE_CRITICAL</code> коли система VIO працює, але з низькою впевненістю, та</li><li><code>MAV_STATE_FLIGHT_TERMINATION</code> коли система зазнала відмови або впевненість в оцінці неприйнятно низька.</li></ul><p><a id="ekf2_tuning"></a></p><h3 id="вдосконалення" tabindex="-1">Вдосконалення <a class="header-anchor" href="#вдосконалення" aria-label="Permalink to &quot;Вдосконалення&quot;">​</a></h3><p>Наступні параметри повинні бути задані для використання зовнішньої позиції з EKF2.</p><table><thead><tr><th>Параметр</th><th>Налаштуйте зовнішнє позиційне оцінювання</th></tr></thead><tbody><tr><td><a href="./../advanced_config/parameter_reference.html#EKF2_EV_CTRL">EKF2_EV_CTRL</a></td><td>Встановіть <em>горизонтальне об&#39;єднання позиції</em>, <em>вертикальне об&#39;єднання позиції</em>, <em>об&#39;єднання швидкості</em> та <em>об&#39;єднання кута</em> курсу згідно з вашою бажаною моделлю об&#39;єднання.</td></tr><tr><td><a href="./../advanced_config/parameter_reference.html#EKF2_HGT_REF">EKF2_HGT_REF</a></td><td>Встановіть на <em>Vision</em>, щоб використовувати візуальну інформацію як датчик відліку висоти.</td></tr><tr><td><a href="./../advanced_config/parameter_reference.html#EKF2_EV_DELAY">EKF2_EV_DELAY</a></td><td>Встановіть різницю між міткою часу вимірювання та &quot;фактичним&quot; часом захоплення. Для отримання додаткової інформації дивіться нижче. Для отримання додаткової інформації див. <a href="#tuning-EKF2_EV_DELAY">нижче</a>.</td></tr><tr><td><a href="./../advanced_config/parameter_reference.html#EKF2_EV_POS_X">EKF2_EV_POS_X</a>, <a href="./../advanced_config/parameter_reference.html#EKF2_EV_POS_Y">EKF2_EV_POS_Y</a>, <a href="./../advanced_config/parameter_reference.html#EKF2_EV_POS_Z">EKF2_EV_POS_Z</a></td><td>Встановіть положення візуального датчика відносно корпусу транспортного засобу.</td></tr></tbody></table><p>Їх можна встановити в <em>QGroundControl</em> &gt; <strong>Налаштування автомобіля &gt; Параметри &gt; EKF2</strong> (не забудьте перезавантажити контролер польоту, щоб зміни параметрів набули чинності).</p><p>Для отримання додаткової детальної інформації дивіться: <a href="./../advanced_config/tuning_the_ecl_ekf.html#external-vision-system">ECL/EKF огляд і налаштування &amp; Tuning&gt; Зовнішня система візуальної оцінки</a>.</p><p><a id="tuning-EKF2_EV_DELAY"></a></p><h4 id="налаштування-ekf2-ev-delay" tabindex="-1">Налаштування EKF2_EV_DELAY <a class="header-anchor" href="#налаштування-ekf2-ev-delay" aria-label="Permalink to &quot;Налаштування EKF2_EV_DELAY&quot;">​</a></h4><p><a href="./../advanced_config/parameter_reference.html#EKF2_EV_DELAY">EKF2_EV_DELAY</a> - це <em>затримка оцінювача позиції за допомогою візійної системи відносно вимірювань</em>. Іншими словами, це різниця між міткою часу візійної системи та &quot;фактичним&quot; часом захоплення, який був би записаний годинником IMU (тобто &quot;базовий годинник&quot; для EKF2).</p><p>Технічно це може бути встановлено на 0, якщо є правильне відміткове (не тільки час прибуття) та синхронізація часу (наприклад, за допомогою NTP) між MoCap та (наприклад) комп&#39;ютерами ROS. На практиці це може потребувати емпіричного налаштування, оскільки затримки в ланцюгу зв&#39;язку дуже специфічні для конкретного обладнання. Рідко коли система налаштована з повністю синхронізованим ланцюгом!</p><p>Приблизна оцінка затримки може бути отримана з журналів, перевіряючи зсув між частотами IMU та частотами EV:</p><p><img src="'+e+'" alt="ekf2_ev_delay log"></p><p>:::note Графік зовнішніх даних проти вбудованої оцінки (як вище) може бути створений за допомогою <a href="./../log/flight_log_analysis.html#flightplot">FlightPlot</a> або подібних засобів аналізу польоту. :::</p><p>Значення може бути подальшим налаштоване шляхом зміни параметра для знаходження значення, яке дає найменші інновації EKF під час динамічних маневрів.</p><p><a id="verify_estimate"></a></p><h2 id="перевірка-підтвердження-оцінки-vio" tabindex="-1">Перевірка/підтвердження оцінки VIO <a class="header-anchor" href="#перевірка-підтвердження-оцінки-vio" aria-label="Permalink to &quot;Перевірка/підтвердження оцінки VIO&quot;">​</a></h2><p>::: note Параметр <a href="./../advanced_config/parameter_reference.html#MAV_ODOM_LP">MAV_ODOM_LP</a>, згаданий нижче, був вилучений у PX4 v1.14. Цей розділ потрібно оновити. :::</p><p>Виконайте наступні перевірки, щоб переконатися, що VIO працює належним чином <em>перед</em> першим польотом:</p><ul><li>Встановіть параметр PX4 <code>MAV_ODOM_LP</code> на <code>1</code>. Після цього PX4 буде передавати отриману зовнішню позицію у вигляді повідомлень MAVLink <a href="https://mavlink.io/en/messages/common.html#ODOMETRY" target="_blank" rel="noreferrer">ODOMETRY</a>. Ви можете перевірити ці повідомлення MAVLink за допомогою <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/analyze_view/mavlink_inspector.html" target="_blank" rel="noreferrer">інспектора MAVLink </a> в <em>QGroundControl</em></li><li>Поверніть літак так, щоб кватерніон повідомлення <code>ODOMETRY</code> був дуже близьким до одиничного кватерніону (w=1, x=y=z=0). <ul><li>На цьому етапі корпус виробу зорієнтований у відповідності з ориєнтацією відносно зовнішньої системи координат.</li><li>Якщо вам не вдається отримати кватерніон, близький до одиничного, без обертання або нахилу вашого літака, це, ймовірно, означає, що ваша рама все ще має зміщення нахилу або кочування. У цьому випадку не продовжуйте і перевірте знову свої координатні рамки.</li></ul></li><li>Після зорієнтування ви можете підняти літак з землі, і ви маєте бачити, як координата z позиції зменшується. Переміщення літака вперед повинно збільшувати координату x позиції, а переміщення вправо - збільшувати координату y. Переміщення засобу праворуч повинно збільшити координату Y.</li><li>Перевірте, що лінійні швидкості у повідомленні виражені в описаній відносно корпусу <em>FRD</em> відліковій системі.</li><li>Встановіть параметр PX4 <code>MAV_ODOM_LP</code> назад на 0. PX4 припинить передавати повідомлення <code>ODOMETRY</code> назад.</li></ul><p>Якщо ці кроки є послідовними, ви можете спробувати свій перший польот:</p><ol><li><p>Покладіть літак на землю і почніть передавати зворотний зв&#39;язок <code>ODOMETRY</code> (як вище). Потягніть палицю газу вниз і зберметизуйте двигуни.</p><p>На цьому етапі, зліва палиця на найнижчому положенні, перейдіть у режим позиціонного контролю. Ви повинні побачити зелену лампочку. Зелена лампочка свідчить про те, що доступний зворотний зв&#39;язок позиції, і позиційний контроль активований.</p></li><li><p>Покладіть палицю газу в середину (мертву зону), щоб літак підтримував свою висоту. Підняття палиці збільшить висоту посилки, тоді як зниження значення зменшить її. Так само, інша палиця змінить положення над землею.</p></li><li><p>Збільшуйте значення перемикача газу, і літак злетить. Відразу після цього поверніть його в середину.</p></li><li><p>Переконайтеся, що літак може утримувати свою позицію.</p></li></ol><h2 id="відстеження-проблем" tabindex="-1">Відстеження проблем <a class="header-anchor" href="#відстеження-проблем" aria-label="Permalink to &quot;Відстеження проблем&quot;">​</a></h2><p>Спочатку переконайтеся, що MAVROS успішно підключається до автопілота.</p><p>Якщо підключення відбувається належним чином, можливі проблеми/рішення:</p><ul><li><p><strong>Проблема:</strong> У мене виникає дрейф / відліт дрона, коли він літає, але не коли я несу його без пропелерів.</p><ul><li>Якщо використовуєте <a href="./../peripherals/camera_t265_vio.html">T265</a>, спробуйте його м&#39;яко кріпити (ця камера дуже чутлива до високочастотних вібрацій).</li></ul></li><li><p><strong>Проблема:</strong> У мене виникає &quot;туалетний боулінг&quot;, коли ввімкнено VIO.</p><ul><li>Переконайтеся, що орієнтація камери відповідає трансформації в запущеному файлі. Використовуйте Інспектор MAVLink <em>QGroundControl</em>, щоб перевірити, що швидкості в повідомленні <code>ODOMETRY</code>, що надходить від MAVROS, вирівнані з системою координат FRD.</li></ul></li><li><p><strong>Проблема:</strong> Я хочу використовувати позицію зору для замикання петель, і також хочу запустити GPS.</p><ul><li>Це дійсно складно, оскільки коли вони не збігаються, це збентежить EKF. За результатами тестування, надійніше використовувати візійну швидкість (якщо ви знайдете спосіб зробити цю конфігурацію надійною, дайте нам знати).</li></ul></li></ul><h2 id="інформація-для-розробників" tabindex="-1">Інформація для розробників <a class="header-anchor" href="#інформація-для-розробників" aria-label="Permalink to &quot;Інформація для розробників&quot;">​</a></h2><p>Розробники, які зацікавлені в розширенні цієї реалізації (або написанні іншої, яка може не залежати від ROS), повинні подивитися <a href="./../ros/external_position_estimation.html">використання візійних або систем відстеження руху для оцінки позиції.</a>.</p><p>Ця тема також пояснює, як налаштувати VIO для використання з оцінювачем LPE (застарілим).</p><h2 id="додаткова-інформація" tabindex="-1">Додаткова інформація <a class="header-anchor" href="#додаткова-інформація" aria-label="Permalink to &quot;Додаткова інформація&quot;">​</a></h2><ul><li><a href="./../advanced_config/tuning_the_ecl_ekf.html#external-vision-system">Огляд та налаштування &amp; ECL/EKF &gt; Зовнішня візійна система</a></li></ul>',54),n=[l];function _(d,c,s,m,p,h){return o(),t("div",null,n)}const E=a(i,[["render",_]]);export{O as __pageData,E as default};
