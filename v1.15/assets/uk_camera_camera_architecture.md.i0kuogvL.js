import{_ as e,c as a,o as r,ab as c}from"./chunks/framework.CUflZczI.js";const k=JSON.parse('{"title":"Архітектура/Інтеграція камери PX4","description":"","frontmatter":{},"headers":[],"relativePath":"uk/camera/camera_architecture.md","filePath":"uk/camera/camera_architecture.md"}'),o={name:"uk/camera/camera_architecture.md"},t=c('<h1 id="архітектура-інтеграція-камери-px4" tabindex="-1">Архітектура/Інтеграція камери PX4 <a class="header-anchor" href="#архітектура-інтеграція-камери-px4" aria-label="Permalink to &quot;Архітектура/Інтеграція камери PX4&quot;">​</a></h1><p>Ця тема надає короткий огляд того, як підтримується камера PX4 <strong>реалізована</strong>.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Дивіться <a href="./../camera/">Камера</a> для отримання інформації щодо <em>використання</em> камер.</p></div><h2 id="загальнии-огляд" tabindex="-1">Загальний огляд <a class="header-anchor" href="#загальнии-огляд" aria-label="Permalink to &quot;Загальний огляд&quot;">​</a></h2><p>PX4 інтегрується з трьома типами камер:</p><ul><li><a href="./../camera/mavlink_v2_camera.html">Камери MAVLink</a>, які підтримують <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">Протокол Камери v2</a> (<strong>РЕКОМЕНДОВАНО</strong>).</li><li><a href="./../camera/mavlink_v1_camera.html">Прості камери MAVLink</a>, які підтримують старший <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">Протокол камери v1</a>.</li><li><a href="./../camera/fc_connected_camera.html">Камери, підключені до виходів контролера польоту</a>, які керуються з використанням <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">протоколу камери v1</a>.</li></ul><p>Всі ці камери повинні реагувати на команди MAVLink, отримані через MAVLink або знайдені в місіях (конкретний протокол залежить від камери).</p><p>Використана широка архітектура описана нижче.</p><h2 id="камери-mavlink-протокол-камери-v2" tabindex="-1">Камери MAVLink (Протокол камери v2) <a class="header-anchor" href="#камери-mavlink-протокол-камери-v2" aria-label="Permalink to &quot;Камери MAVLink (Протокол камери v2)&quot;">​</a></h2><p>PX4 не має конкретної обробки для <a href="./../camera/mavlink_v2_camera.html">MAVLink камер</a>, які підтримують <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">Протокол камери v2</a>, крім <a href="#camera-commands-in-missions">переемітації елементів камери в місіях як команди</a></p><p>Очікується, що земні станції будуть спілкуватися з цими камерами безпосередньо, щоб надсилати команди. PX4 повинен бути налаштований для маршрутизації трафіку MAVLink між камерою та земними станціями за необхідності.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Модулі <code>camera_trigger</code>, <code>camera_capture</code> та <code>camera_feedback</code> не використовуються з цією камерою.</p></div><h2 id="камери-підключені-за-допомогою-fc" tabindex="-1">Камери, підключені за допомогою FC <a class="header-anchor" href="#камери-підключені-за-допомогою-fc" aria-label="Permalink to &quot;Камери, підключені за допомогою FC&quot;">​</a></h2><p>Камери, підключені до виходів контролера польоту, потребують PX4 для активації виходів для запуску камери, і можуть потребувати PX4 для виявлення, коли <a href="./../camera/fc_connected_camera.html#camera-capture-configuration">пін захоплення камери</a> був спрацьований камерним гарячим черевиком (для покращення часу реєстрації захопленої камери).</p><p>Ця робота виконується трьома компонентами PX4: <a href="https://github.com/PX4/PX4-Autopilot/tree/release/1.15/src/drivers/camera_trigger" target="_blank" rel="noreferrer"><code>camera_trigger</code> driver</a>, <a href="https://github.com/PX4/PX4-Autopilot/tree/release/1.15/src/drivers/camera_capture" target="_blank" rel="noreferrer"><code>camera_capture</code> driver</a>, модуль <code>camera-feedback</code> (../modules/modules_system.md#camera-feedback).</p><p><code>camera_trigger</code> підписується на тему <a href="./../msg_docs/VehicleCommand.html">VehicleCommand</a> та відстежує оновлення в <a href="./../camera/fc_connected_camera.html#mavlink-command-interface">команди, які він підтримує</a>. Ці оновлення відбуваються, коли отримано команду через MAVLink або коли <a href="#camera-commands-in-missions">елемент камери досягнутий у місії</a>.</p><p>Команди увімкнення та вимкнення спрацьовують, а також налаштовують спрацьовування за часовими та відстаневими інтервалами. Водій відстежує ці інтервали, і коли це потрібно, спрацьовують виходи. Водій публікує тему <a href="./../msg_docs/CameraTrigger.html">CameraTrigger</a> (з полем <code>feedback</code>, встановленим на <code>false</code>), що спричиняє відсилання повідомлення MAVLink <a href="https://mavlink.io/en/messages/common.html#CAMERA_TRIGGER" target="_blank" rel="noreferrer">CAMERA_TRIGGER</a>.</p><p>Драйвер <code>camera_capture</code>, якщо він увімкнений, слідкує за підключенням камери та, спрацьовуючи, оприлюднює тему <a href="./../msg_docs/CameraTrigger.html">CameraTrigger</a> (з полем <code>feedback</code>, встановленим на <code>true</code>), що також спричиняє відсилання повідомлення MAVLink <a href="https://mavlink.io/en/messages/common.html#CAMERA_TRIGGER" target="_blank" rel="noreferrer">CAMERA_TRIGGER</a>.</p><p>Модуль &#39;camera_feedback&#39; відстежує оновлення теми <a href="./../msg_docs/CameraTrigger.html">CameraTrigger</a>, та публікує тему <a href="./../msg_docs/CameraCapture.html">CameraCapture</a> для оновлення <code>CameraTrigger</code> від <em>або</em> <code>camera_trigger</code>, або <code>camera_capture</code>. Інформація, яка використовується, залежить від того, чи увімкнений пін захоплення камери, і значення поля <code>CameraTrigger.feedback</code>. Ця тема <code>CameraCapture</code> реєструється і може бути використана для отримання часу знімку.</p><h2 id="камери-mavlink-протокол-камери-v1" tabindex="-1">Камери MAVLink (Протокол камери v1) <a class="header-anchor" href="#камери-mavlink-протокол-камери-v1" aria-label="Permalink to &quot;Камери MAVLink (Протокол камери v1)&quot;">​</a></h2><p><a href="./../camera/mavlink_v1_camera.html">MAVLink камери, які підтримують старіший Camera Protocol v1</a> інтегруються так само, як і <a href="#fc-connected-cameras">Камери, що підключаються через FC</a>.</p><p><code>camera_trigger</code> підписується на тему <a href="./../msg_docs/VehicleCommand.html">VehicleCommand</a> та відстежує оновлення в <a href="./../camera/fc_connected_camera.html#mavlink-command-interface">команди, які він підтримує</a>. Це відбувається, коли команда надходить через MAVLink або коли <a href="#camera-commands-in-missions">елемент камери знаходиться в місіях</a>.</p><p>Команди дозволяють увімкнути та вимкнути спрацьовування, а також налаштувати спрацювання за часовими та відстаневими інтервалами. Водій відслідковує ці інтервали, але з &quot;MAVLink backend&quot; не потрібно фактично спрацьовувати будь-які виводи (оскільки команди переадресовуються на камеру). Коли камера спрацьовує, водій публікує тему <a href="./../msg_docs/CameraTrigger.html">CameraTrigger</a> (з полем <code>feedback</code>, встановленим на <code>false</code>), що спричиняє відсилання повідомлення MAVLink <a href="https://mavlink.io/en/messages/common.html#CAMERA_TRIGGER" target="_blank" rel="noreferrer">CAMERA_TRIGGER</a>. Модуль <code>camera_feedback</code> повинен, а потім записати відповідну тему <code>CameraCapture</code>.</p><h2 id="команди-камери-у-місіях" tabindex="-1">Команди камери у місіях <a class="header-anchor" href="#команди-камери-у-місіях" aria-label="Permalink to &quot;Команди камери у місіях&quot;">​</a></h2><p>PX4 повторно видає пункти камери, знайдені в місіях, як команди MAVLink для всіх підтримуваних [Протоколів камери v2] (<a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">https://mavlink.io/en/services/camera.html</a>) та [Протоколів камери v1] (<a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">https://mavlink.io/en/services/camera.html</a>). Системний ідентифікатор випущених команд співпадає з ідентифікатором автопілота. Ідентифікатор компоненту команд може відрізнятися, але зазвичай вони надсилаються на <a href="https://mavlink.io/en/messages/common.html#MAV_COMP_ID_CAMERA" target="_blank" rel="noreferrer">MAV_COMP_ID_CAMERA (100)</a> або <a href="https://mavlink.io/en/messages/common.html#MAV_COMP_ID_ALL" target="_blank" rel="noreferrer">MAV_COMP_ID_ALL</a> (дивіться документацію камери для того, який ID використовується у кожному випадку).</p><p>Команди випромінюються незалежно від того, чи є підключена камера будь-якого типу, за умови наявності каналу MAVLink для випромінювання.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Загалом PX4 повторно видає всі команди місій, які можуть бути використані зовнішніми компонентами MAVLink, такими як джимбалі. Команди для точок маршруту та умовної поведінки не випускаються.</p></div><p>Розділи нижче висвітлюють цікаві частини кодової бази</p><h3 id="команди-підтримувані-у-місіях" tabindex="-1">Команди, підтримувані у місіях <a class="header-anchor" href="#команди-підтримувані-у-місіях" aria-label="Permalink to &quot;Команди, підтримувані у місіях&quot;">​</a></h3><p>Команди, підтримувані в місіях, включаючи команди камери, показані в цих методах:</p><ul><li><a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/navigator/MissionFeasibility/FeasibilityChecker.cpp#L257-L306" target="_blank" rel="noreferrer"><code>bool FeasibilityChecker::checkMissionItemValidity(mission_item_s &amp;mission_item, const int current_index)</code></a></li><li><a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/mavlink/mavlink_mission.cpp#L1672-L1693" target="_blank" rel="noreferrer"><code>format_mavlink_mission_item()</code></a></li></ul><h3 id="потік-для-повторноі-відправки-команд-камери-знаиденоі-у-місіях" tabindex="-1">Потік для повторної відправки команд камери, знайденої у місіях <a class="header-anchor" href="#потік-для-повторноі-відправки-команд-камери-знаиденоі-у-місіях" aria-label="Permalink to &quot;Потік для повторної відправки команд камери, знайденої у місіях&quot;">​</a></h3><ul><li><a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/navigator/mission.cpp#L187-L281" target="_blank" rel="noreferrer"><code>void Mission::setActiveMissionItems()</code></a><ul><li>Предмети місії виконуються, коли вони активовані.</li><li><code>issue_command(_mission_item)</code> викликається в кінці цього, щоб відправити поточну непунктову команду <ul><li><a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/navigator/mission_block.cpp#L543-L562" target="_blank" rel="noreferrer"><code>MissionBlock::видача_команди(const mission_item_s &amp;item)</code></a><ul><li>Створює команду для місії транспортного засобу, а потім викликає <code>publish_vehicle_cmd</code> для публікації її (<code>_navigator-&gt;publish_vehicle_cmd(&amp;vcmd);</code>) <ul><li><a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/navigator/navigator_main.cpp#L1358" target="_blank" rel="noreferrer"><code>void Navigator::publish_vehicle_cmd(vehicle_command_s *vcmd)</code></a><ul><li>Для деяких команд камери це встановлює ідентифікатор компонента на ідентифікатор компонента камери (<code>vcmd-&gt;target_component = 100; // MAV_COMP_ID_CAMERA</code>)</li><li>Усі інші просто публікуються під стандартний компонент ID.</li><li>Тема UORB <code>VehicleCommand</code> публікується.</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p>Код потоку MAVLink відстежує зміни у темі <code>VehicleCommand</code> та публікує їх через MAVLink. Команда MAVLink надсилається незалежно від того, чи є камера камерою MAVLink, чи підключена до контролера польоту.</p><p>Драйвер <code>camera_trigger</code>, якщо включений, також контролює зміни для <code>VehicleCommand</code>. Якщо він налаштований з внутрішнім інтерфейсом для камери, підключеної до вихідних сигналів контролера польоту, він відповідним чином активує ці вихідні сигнали.</p><h2 id="журналювання" tabindex="-1">Журналювання <a class="header-anchor" href="#журналювання" aria-label="Permalink to &quot;Журналювання&quot;">​</a></h2><p>Теми <code>CameraCapture</code> реєструються при оновленні <code>CameraTrigger</code>. Введений тема буде залежати від того, чи увімкнений пін захоплення камери.</p><p>Зверніть увагу, що події захоплення камери не реєструються, коли використовується <a href="./../camera/mavlink_v2_camera.html">камери MAVLink, що підтримують протокол камери v2</a>, оскільки відповідні події спрацювання тригера не генеруються в межах PX4.</p><h2 id="дивіться-також" tabindex="-1">Дивіться також <a class="header-anchor" href="#дивіться-також" aria-label="Permalink to &quot;Дивіться також&quot;">​</a></h2><ul><li>Драйвер Тригера камери: <a href="https://github.com/PX4/PX4-Autopilot/tree/release/1.15/src/drivers/camera_trigger" target="_blank" rel="noreferrer">вихідний код</a></li><li>Драйвер захоплення камери: <a href="https://github.com/PX4/PX4-Autopilot/tree/release/1.15/src/drivers/camera_capture" target="_blank" rel="noreferrer">вихідний код</a></li></ul>',40),i=[t];function l(m,n,s,d,h,_){return r(),a("div",null,i)}const f=e(o,[["render",l]]);export{k as __pageData,f as default};
