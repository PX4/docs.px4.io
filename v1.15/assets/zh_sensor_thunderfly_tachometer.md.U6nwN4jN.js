import{_ as e}from"./chunks/tfrpm01_electronics.CjU-uRr0.js";import{_ as t,a}from"./chunks/transmissive_probe.C3GzqVuq.js";import{_ as r,c as o,o as s,ab as n}from"./chunks/framework.CUflZczI.js";const y=JSON.parse('{"title":"ThunderFly TFRPM01 Revolution Counter","description":"","frontmatter":{},"headers":[],"relativePath":"zh/sensor/thunderfly_tachometer.md","filePath":"zh/sensor/thunderfly_tachometer.md"}'),i={name:"zh/sensor/thunderfly_tachometer.md"},l=n('<h1 id="thunderfly-tfrpm01-revolution-counter" tabindex="-1">ThunderFly TFRPM01 Revolution Counter <a class="header-anchor" href="#thunderfly-tfrpm01-revolution-counter" aria-label="Permalink to &quot;ThunderFly TFRPM01 Revolution Counter&quot;">​</a></h1><p>The <a href="https://github.com/ThunderFly-aerospace/TFRPM01" target="_blank" rel="noreferrer">TFRPM01</a> tachometer is a small, and low system demanding revolution-counter.</p><p>The board itself does not include the actual sensor but can be used with many different sensors/probe types for revolution counting. It has an I²C connector for connecting to PX4 and is connected to the actual sensor via a 3-pin connector. It also has an LED that offers basic diagnostic information.</p><p><img src="'+e+'" alt="TFRPM01A"></p><div class="info custom-block"><p class="custom-block-title">The TFRPM01 sensor is open-source hardware commercially available from <a href="https://www.thunderfly.cz/" target="_blank" rel="noreferrer">ThunderFly s.r.o.</a> (manufacturing data is <a href="https://github.com/ThunderFly-aerospace/TFRPM01" target="_blank" rel="noreferrer">available on GitHub</a>).</p></div><h2 id="硬件连接" tabindex="-1">硬件连接 <a class="header-anchor" href="#硬件连接" aria-label="Permalink to &quot;硬件连接&quot;">​</a></h2><p>The board is equipped with (two through pass) I²C connectors for connecting to PX4 and has a 3-pin connector that can be used to connect to various sensors:</p><ul><li>TFRPM01 may be connected to any I²C port.</li><li>TFRPM01 has a 3pin pin-header connector (with pull-up equipped input) that can be connected to different probe types. <ul><li>The sensor/probe hardware needs a pulse signal. The signal input accepts +5V TTL logic or <a href="https://en.wikipedia.org/wiki/Open_collector" target="_blank" rel="noreferrer">open collector</a> outputs. The maximum pulse frequency is 20 kHz with a 50% duty cycle.</li><li>The probe connector provides a +5V power supply from the I²C bus, the maximum power which could be used is limited by RC filter (see schematics for details).</li></ul></li></ul><p>TFRPM01A electronics is equipped with signaling LED that can be used to check that the probe is connected properly. The LED lights up when the pulse input is grounded or exposed to logical 0, so you can check the probe is working correctly just by manually spinning a rotor.</p><h3 id="hall-effect-sensor-probe" tabindex="-1">Hall-Effect Sensor Probe <a class="header-anchor" href="#hall-effect-sensor-probe" aria-label="Permalink to &quot;Hall-Effect Sensor Probe&quot;">​</a></h3><p>Hall-Effect sensors (magnetically operated) are ideal for harsh environments, where dirt, dust, and water can contact the sensed rotor.</p><p>Many different hall effect sensors are commercially available. For example, a <a href="https://m.littelfuse.com/media?resourcetype=datasheets&amp;itemid=6d69d457-770e-46ba-9998-012c5e0aedd7&amp;filename=littelfuse-hall-effect-sensors-55100-datasheet" target="_blank" rel="noreferrer">55100 Miniature Flange Mounting Proximity Sensor</a> is a good choice.</p><p><img src="'+t+'" alt="Example of Hall effect probe"></p><h3 id="optical-sensor-probe" tabindex="-1">Optical Sensor Probe <a class="header-anchor" href="#optical-sensor-probe" aria-label="Permalink to &quot;Optical Sensor Probe&quot;">​</a></h3><p>An optical sensor can also be used (and may be a better fit, depending on the measurement requirements). Both transmissive and reflective sensor types may be used for pulse generation.</p><p><img src="'+a+'" alt="Example of optical transmissive probe"></p><h2 id="software-setup" tabindex="-1">Software Setup <a class="header-anchor" href="#software-setup" aria-label="Permalink to &quot;Software Setup&quot;">​</a></h2><h3 id="starting-driver" tabindex="-1">Starting driver <a class="header-anchor" href="#starting-driver" aria-label="Permalink to &quot;Starting driver&quot;">​</a></h3><p>The driver is not started automatically (in any airframe). You will need to start it manually, either using the <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/analyze_view/mavlink_console.html" target="_blank" rel="noreferrer">QGroundControl MAVLink Console</a> or by adding the driver to the <a href="./../concept/system_startup.html#customizing-the-system-startup">startup script</a> on an SD card.</p><h4 id="start-driver-from-console" tabindex="-1">Start driver from console <a class="header-anchor" href="#start-driver-from-console" aria-label="Permalink to &quot;Start driver from console&quot;">​</a></h4><p>Start the driver from the <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/analyze_view/mavlink_console.html" target="_blank" rel="noreferrer">console</a> using the command:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pcf8583</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> numbe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>where:</p><ul><li><code>-X</code> means that it is an external bus.</li><li><code>&lt;bus number&gt;</code> is the bus number to which the device is connected</li></ul><div class="info custom-block"><p class="custom-block-title">The bus number in code <code>-b &lt;bus number&gt;</code> may not match the bus labels on the autopilot. For example, when using CUAV V5+ or CUAV Nano:</p><table><thead><tr><th>Autopilot label</th><th>-b number</th></tr></thead><tbody><tr><td>I2C1</td><td>-X -b 4</td></tr><tr><td>I2C2</td><td>-X -b 2</td></tr><tr><td>I2C3</td><td>-X -b 1</td></tr></tbody></table><p>The <code>pcf8583 start</code> command outputs the corresponding autopilot bus name/label for each bus number.</p></div><h3 id="testing" tabindex="-1">Testing <a class="header-anchor" href="#testing" aria-label="Permalink to &quot;Testing&quot;">​</a></h3><p>You can verify the counter is working using several methods</p><h4 id="px4-nuttx-mavlink-console" tabindex="-1">PX4 (NuttX) MAVLink Console <a class="header-anchor" href="#px4-nuttx-mavlink-console" aria-label="Permalink to &quot;PX4 (NuttX) MAVLink Console&quot;">​</a></h4><p>The <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/analyze_view/mavlink_console.html" target="_blank" rel="noreferrer">QGroundControl MAVLink Console</a> can also be used to check that the driver is running and the UORB topics it is outputting.</p><p>To check the status of the TFRPM01 driver run the command:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pcf8583</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span></code></pre></div><p>If the driver is running, the I²C port will be printed along with other basic parameters of the running instance. If the driver is not running it can be started started using theprocedure described above.</p><p>The <a href="./../modules/modules_command.html#listener">listener</a> command allows you to monitor RPM UORB messages from the running driver.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listener</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm</span></span></code></pre></div><p>For periodic display, you can add <code>-n 50</code> parameter after the command, which prints the next 50 messages.</p><h4 id="qgroundcontrol-mavlink-inspector" tabindex="-1">QGroundControl MAVLink Inspector <a class="header-anchor" href="#qgroundcontrol-mavlink-inspector" aria-label="Permalink to &quot;QGroundControl MAVLink Inspector&quot;">​</a></h4><p>The QGroundControl <a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/analyze_view/mavlink_inspector.html" target="_blank" rel="noreferrer">Mavlink Inspector</a> can be used to observe MAVLink messages from PX4, including <a href="https://mavlink.io/en/messages/common.html#RAW_RPM" target="_blank" rel="noreferrer">RAW_RPM</a> emitted by the driver:</p><ol><li>Start the inspector from the QGC menu: <strong>Analyze tools &gt; Mavlink Inspector</strong></li><li>Check that <code>RAW_RPM</code> is present in the list of messages (if it is missing, check that the driver is running).</li></ol><h3 id="parameter-setup" tabindex="-1">Parameter Setup <a class="header-anchor" href="#parameter-setup" aria-label="Permalink to &quot;Parameter Setup&quot;">​</a></h3><p>Usually, sensors can be used without configuration, but the RPM values should correspond to multiples of real RPM. It is because the <code>PCF8583_MAGNET</code> parameter needs to correspond to the real number of pulses per single revolution of the sensed rotor. If needed, the following parameters should be tweaked:</p><ul><li><a href="./../advanced_config/parameter_reference.html#PCF8583_POOL">PCF8583_POOL</a> — pooling interval between readout the counted number</li><li><a href="./../advanced_config/parameter_reference.html#PCF8583_RESET">PCF8583_RESET</a> — Counter value where the counted number should be reset to zero.</li><li><a href="./../advanced_config/parameter_reference.html#PCF8583_MAGNET">PCF8583_MAGNET</a> — Number of pulses per revolution e.g. number of magnets at a rotor disc.</li></ul><div class="info custom-block"><p class="custom-block-title">The parameters above appear in QGC after the driver/PX4 are restarted.</p><p>If the configuration parameters are not available after restart then you should check that the driver has started. It may be that the <a href="./../peripherals/serial_configuration.html#configuration-parameter-missing-from-qgroundcontrol">driver is not present in the firmware</a>, in which case it must be added to the board configuration:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drivers/rpm/pcf8583</span></span></code></pre></div></div>',42),h=[l];function c(d,p,u,m,f,b){return s(),o("div",null,h)}const _=r(i,[["render",c]]);export{y as __pageData,_ as default};
