import{_ as s,c as i,o as a,ab as l}from"./chunks/framework.CUflZczI.js";const c=JSON.parse('{"title":"Початковий завантажувач STM32","description":"","frontmatter":{},"headers":[],"relativePath":"uk/software_update/stm32_bootloader.md","filePath":"uk/software_update/stm32_bootloader.md"}'),t={name:"uk/software_update/stm32_bootloader.md"},e=l(`<h1 id="початковии-завантажувач-stm32" tabindex="-1">Початковий завантажувач STM32 <a class="header-anchor" href="#початковии-завантажувач-stm32" aria-label="Permalink to &quot;Початковий завантажувач STM32&quot;">​</a></h1><p>Код для початкового завантажувача PX4 доступний на Github у репозиторії <a href="https://github.com/px4/bootloader" target="_blank" rel="noreferrer">Bootloader</a>.</p><h2 id="підтримувані-плати" tabindex="-1">Підтримувані плати <a class="header-anchor" href="#підтримувані-плати" aria-label="Permalink to &quot;Підтримувані плати&quot;">​</a></h2><ul><li>FMUv2 (Pixhawk 1, STM32F4)</li><li>FMUv3 (Pixhawk 2, STM32F4)</li><li>FMUv4 (Pixracer 3 і Pixhawk 3 Pro, STM32F4)</li><li>FMUv5 (Pixhawk 4, STM32F7)</li><li>TAPv1 (TBA, STM32F4)</li><li>ASCv1 (TBA, STM32F4)</li></ul><h2 id="збираємо-початковии-завантажувач" tabindex="-1">Збираємо початковий завантажувач <a class="header-anchor" href="#збираємо-початковии-завантажувач" aria-label="Permalink to &quot;Збираємо початковий завантажувач&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/PX4/Bootloader.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Bootloader</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> submodule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> submodule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span></code></pre></div><p>Після цього кроку, розмаїття elf-файлів для усіх підтримуваних плат будуть присутні в директорії Bootloader.</p><h2 id="прошиваємо-початковии-завантажувач" tabindex="-1">Прошиваємо початковий завантажувач <a class="header-anchor" href="#прошиваємо-початковии-завантажувач" aria-label="Permalink to &quot;Прошиваємо початковий завантажувач&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Правильна послідовність живлення є критичною для деяких плат, щоб потім дозволити доступ JTAG / SWD. Виконайте ці кроки точно так, як описано.</p></div><p>Інструкції нижче дійсні для Blackmagic / Dronecode адаптерів. Для інших JTAG адаптерів будуть потрібні інші, але подібні кроки. Розробники, які намагаються прошити завантажувач повинні мати необхідні знання. Якщо ви не знаєте, як це зробити, то ймовірно, слід переглянути, чи дійсно вам потрібно щось змінювати у початковому завантажувачі.</p><p>Послідовність наступна:</p><ol><li>Від&#39;єднати кабель JTAG</li><li>Під&#39;єднайте USB-кабель живлення</li><li>Під&#39;єднати кабель JTAG</li></ol><h3 id="black-magic-dronecode-адаптери" tabindex="-1">Black Magic / Dronecode адаптери <a class="header-anchor" href="#black-magic-dronecode-адаптери" aria-label="Permalink to &quot;Black Magic / Dronecode адаптери&quot;">​</a></h3><h4 id="використовуємо-правильнии-послідовнии-порт" tabindex="-1">Використовуємо правильний послідовний порт <a class="header-anchor" href="#використовуємо-правильнии-послідовнии-порт" aria-label="Permalink to &quot;Використовуємо правильний послідовний порт&quot;">​</a></h4><ul><li>На LINUX: <code>/dev/serial/by-id/usb-Black_Sphere_XXX-if00</code></li><li>На MAC OS: переконайтесь що використовуєте порт cu.xxx, а не порт tty.xxx: <code>tar ext /dev/tty.usbmodemDDEasdf</code></li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arm-none-eabi-gdb</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ext</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/serial/by-id/usb-Black_Sphere_XXX-if00</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swdp_scan</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attach</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> option</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> erase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> erase_mass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tapv1_bl.elf</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Transfer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KB/sec,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 828</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes/write.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kill</span></span></code></pre></div><h3 id="" tabindex="-1"><a class="header-anchor" href="#" aria-label="Permalink to &quot;&quot;">​</a></h3><p>Наступні інструкції стосуються <a href="https://www.segger.com/jlink-gdb-server.html" target="_blank" rel="noreferrer">J-Link GDB server</a>.</p><h4 id="попередня-підготовка" tabindex="-1">Попередня підготовка <a class="header-anchor" href="#попередня-підготовка" aria-label="Permalink to &quot;Попередня підготовка&quot;">​</a></h4><p><a href="https://www.segger.com/downloads/jlink" target="_blank" rel="noreferrer">Завантажте програмне забезпечення J-Link</a> з сайту Segger та встановіть його за їхніми інструкціями.</p><h4 id="запустити-jlink-gdb-сервер" tabindex="-1">Запустити JLink GDB сервер <a class="header-anchor" href="#запустити-jlink-gdb-сервер" aria-label="Permalink to &quot;Запустити JLink GDB сервер&quot;">​</a></h4><p>Команда використовується для запуску сервера для польотних контролерів що використовують STM32F427VI SoC:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">JLinkGDBServer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -select</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> USB=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -device</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> STM32F427VI</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SWD-DP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -speed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20000</span></span></code></pre></div><p><code>--device</code>/SoC є спільним для пристроїв:</p><ul><li><strong>FMUv2, FMUv3, FMUv4, aerofc-v1, mindpx-v2:</strong> STM32F427VI</li><li><strong>px4_fmu-v4pro:</strong> STM32F469II</li><li><strong>px4_fmu-v5:</strong> STM32F765II</li><li><strong>crazyflie:</strong> STM32F405RG</li></ul><h4 id="під-єднаитесь-до-gdb" tabindex="-1">Під&#39;єднайтесь до GDB <a class="header-anchor" href="#під-єднаитесь-до-gdb" aria-label="Permalink to &quot;Під&#39;єднайтесь до GDB&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arm-none-eabi-gdb</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ext</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :2331</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aerofcv1_bl.elf</span></span></code></pre></div><h3 id="усунення-несправностеи" tabindex="-1">Усунення несправностей <a class="header-anchor" href="#усунення-несправностеи" aria-label="Permalink to &quot;Усунення несправностей&quot;">​</a></h3><p>Якщо будь-який з наведених нижче команд не знайдено, ви або не використовуєте Blackmagic probe або його програмне забезпечення застаріло. Спершу оновіть прошивку адаптера.</p><p>Якщо Ви отримуєте наступне повідомлення про помилку:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>Error erasing flash with vFlashErase packet</span></span></code></pre></div><p>Відключити плату (лишивши JTAG підключеним) та запустіть</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tpwr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">swdp_scan</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attach</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tapv1_bl.elf</span></span></code></pre></div><p>Це вимкне живлення пристрою й уможливить наступний цикл прошивки.</p>`,34),n=[e];function h(p,k,r,d,o,F){return a(),i("div",null,n)}const y=s(t,[["render",h]]);export{c as __pageData,y as default};
