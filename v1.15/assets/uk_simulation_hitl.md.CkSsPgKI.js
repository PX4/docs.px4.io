import{_ as i,a as s,b as a,c as t}from"./chunks/qgc_hitl_autoconnect.CJljA_t2.js";import{_ as e,c as l,o,ab as r}from"./chunks/framework.CUflZczI.js";const f=JSON.parse('{"title":"Симуляція з апаратним забезпеченням в контурі (HITL)","description":"","frontmatter":{},"headers":[],"relativePath":"uk/simulation/hitl.md","filePath":"uk/simulation/hitl.md"}'),n={name:"uk/simulation/hitl.md"},p=r('<h1 id="симуляція-з-апаратним-забезпеченням-в-контурі-hitl" tabindex="-1">Симуляція з апаратним забезпеченням в контурі (HITL) <a class="header-anchor" href="#симуляція-з-апаратним-забезпеченням-в-контурі-hitl" aria-label="Permalink to &quot;Симуляція з апаратним забезпеченням в контурі (HITL)&quot;">​</a></h1><div class="warning custom-block"><p class="custom-block-title">HITL</p><p><a href="./../simulation/community_supported_simulators.html">підтримується та утримується спільнотою</a>. Це може працювати або не працювати з поточними версіями PX4.</p><p>Дивіться <a href="./../dev_setup/dev_env.html">Встановлення інструментарію</a> для інформації про середовища та інструменти, які підтримуються основною розробницькою командою.</p></div><p>Апаратне забезпечення в контурі (HITL або HIL) режим симуляції в якому звичайна прошивка PX4 виконується на реальному пристрої польотного контролера. Цей підхід має перевагу у вигляді можливості тестування більшості коду для польоту на реальному апаратному забезпеченні.</p><p>PX4 supports HITL for multicopters (using <a href="./../sim_jmavsim/">jMAVSim</a> or <a href="./../sim_gazebo_classic/">Gazebo Classic</a>) and VTOL (using Gazebo Classic).</p><p><a id="compatible_airframe"></a></p><h2 id="планери-сумісні-з-hitl" tabindex="-1">Планери сумісні з HITL <a class="header-anchor" href="#планери-сумісні-з-hitl" aria-label="Permalink to &quot;Планери сумісні з HITL&quot;">​</a></h2><p>The set of compatible airframes vs simulators is:</p><table><thead><tr><th>Планер</th><th><code>SYS_AUTOSTART</code></th><th>Gazebo Classic</th><th>jMAVSim</th></tr></thead><tbody><tr><td><a href="./../airframes/airframe_reference.html#copter_simulation_hil_quadcopter_x">HIL квадрокоптер у конфігурації X</a></td><td>1001</td><td>Y</td><td>Y</td></tr><tr><td><a href="./../airframes/airframe_reference.html#vtol_standard_vtol_hil_standard_vtol_quadplane">HIL ВЗІП квадроплан стандартний</a></td><td>1002</td><td>Y</td><td></td></tr><tr><td><a href="./../airframes/airframe_reference.html#copter_quadrotor_x_generic_quadcopter">Загальний квадрокоптер у конфігурації X</a></td><td>4001</td><td>Y</td><td>Y</td></tr></tbody></table><p><a id="simulation_environment"></a></p><h2 id="середовище-симуляціі-hitl" tabindex="-1">Середовище симуляції HITL <a class="header-anchor" href="#середовище-симуляціі-hitl" aria-label="Permalink to &quot;Середовище симуляції HITL&quot;">​</a></h2><p>У симуляції з апаратним забезпеченням у контурі (HITL) звичайна прошивка PX4 виконується на реальному обладнані. JMAVSim або Gazebo Classic (які працюють на комп&#39;ютері розробки) підключені до пристрою польотного контролера через USB/UART. Симулятор діє як шлюз для спільного використання даних MAVLink між PX4 та <em>QGroundControl</em>.</p><div class="info custom-block"><p class="custom-block-title">Симулятор також може бути підключений за допомогою UDP якщо політний контролер має підтримку мережі та використовує стабільне з&#39;єднання з низькою затримкою (наприклад дротове Ethernet підключення, WiFi підключення зазвичай недостатньо надійне). Наприклад, ця конфігурація була перевірена з PX4, що виконується на Raspberry Pi який підключений через Ethernet до комп&#39;ютера (налаштування запуску яке включає команди для запуску jMAVSim можна знайти <a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/posix-configs/rpi/px4_hil.config" target="_blank" rel="noreferrer">тут</a>).</p></div><p>Діаграма нижче показує середовище симуляції:</p><ul><li>Обрано конфігурацію HITL (у <em>QGroundControl</em>), яка не запускає ніяких реальних датчиків.</li><li><em>jMAVSim</em> або <em>Gazebo Classic</em> підключені до політного контролера через USB.</li><li>Симулятор підключено до <em>QGroundControl</em> через UDP і передає повідомлення MAVLink до PX4.</li><li><em>Gazebo Classic</em> та <em>jMAVSim</em> можуть також підключатися до зовнішнього API та передавати повідомлення MAVLink до PX4.</li><li>(Необов&#39;язково) Для підключення джойстика/геймпада через <em>QGroundControl</em> може бути використано послідовне з&#39;єднання.</li></ul><p><img src="'+i+'" alt="Налаштування HITL - jMAVSim та Gazebo Classic"></p><h2 id="hitl-у-порівнянні-з-sitl" tabindex="-1">HITL у порівнянні з SITL <a class="header-anchor" href="#hitl-у-порівнянні-з-sitl" aria-label="Permalink to &quot;HITL у порівнянні з SITL&quot;">​</a></h2><p>SITL працює на комп&#39;ютері розробки в модельованому середовищі та використовує прошивку спеціально створену для цього середовища. Крім драйверів симуляції для забезпечення підроблених даних середовища від симулятора система поводиться як зазвичай.</p><p>На противагу, HITL виконує звичайну прошивку PX4 в &quot;режимі HITL&quot; на звичайному обладнані. Дані симуляції потрапляють в систему в іншій точці ніж для SITL. Основні модулі на кшталт командного або датчиків мають режими HITL, що оминають частину звичайної функціональності при старті.</p><p>Підсумовуючи, HITL виконує PX4 на реальному обладнанні за допомогою стандартної прошивки, а SITL фактично більше виконує стандартний системний код.</p><h2 id="налаштування-hitl" tabindex="-1">Налаштування HITL <a class="header-anchor" href="#налаштування-hitl" aria-label="Permalink to &quot;Налаштування HITL&quot;">​</a></h2><h3 id="налаштування-px4" tabindex="-1">Налаштування PX4 <a class="header-anchor" href="#налаштування-px4" aria-label="Permalink to &quot;Налаштування PX4&quot;">​</a></h3><ol><li><p>З&#39;єднайте автопілот безпосередньо з <em>QGroundControl</em> за допомогою USB.</p></li><li><p>Увімкніть режим HITL</p><ol><li><p>Відкрийте розділ <strong>Налаштування &gt; Безпека</strong>.</p></li><li><p>Увімкніть режим HITL обравши <strong>Увімкнено</strong> в переліку <em>HITL увімкнено</em>:</p><p><img src="'+s+'" alt="Налаштування QGroundControl HITL"></p></li></ol></li><li><p>Оберіть планер</p><ol><li><p>Відкрийте <strong>Налаштування &gt; Планери</strong></p></li><li><p>Оберіть <a href="#compatible_airframe">сумісний планер</a> який потрібно перевірити. Потім натисніть <strong>Застосувати та перезапустити</strong> у верхній правій частині сторінки <em>Налаштування планера</em>.</p><p><img src="'+a+'" alt="Вибір планера"></p></li></ol></li><li><p>При необхідності відкалібруйте пульт РК або джойстик.</p></li><li><p>Налаштування UDP</p><ol><li><p>У вкладці <em>Загальне</em> меню налаштувань приберіть усі прапорці <em>AutoConnect</em> окрім <strong>UDP</strong>.</p><p><img src="'+t+`" alt="Параметри автоматичного підключення QGC для HITL"></p></li></ol></li><li><p>(Необов&#39;язково) Налаштуйте джойстик та запобіжник відмови. Встановіть наступні <a href="./../advanced_config/parameters.html">параметри</a> для того щоб використовувати джойстик замість передавача РК пульту:</p><ul><li><a href="./../advanced_config/parameter_reference.html#COM_RC_IN_MODE">COM_RC_IN_MODE</a> у &quot;Joystick/No RC Checks&quot;. Це дозволить керування джойстиком та відключить перевірки пульту РК.</li><li><a href="./../advanced_config/parameter_reference.html#NAV_RCL_ACT">NAV_RCL_ACT</a> у &quot;Вимкнено&quot;. Це гарантує, що ніякі дії запобігання відмові не будуть перешкоджати коли не виконується HITL з радіо керуванням.</li></ul></li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><em>Посібник користувача QGroundControl</em> має інструкції для налаштування <a href="https://docs.qgroundcontrol.com/master/en/SetupView/Joystick.html" target="_blank" rel="noreferrer">Джойстика</a> та <a href="https://docs.qgroundcontrol.com/master/en/SettingsView/VirtualJoystick.html" target="_blank" rel="noreferrer">Віртуального джойстика</a>.</p></div><p>Як тільки налаштування завершене, <strong>закрийте</strong> <em>QGroundControl</em> та від&#39;єднайте політний контролер від комп&#39;ютера.</p><h3 id="налаштування-відповідних-симуляторів" tabindex="-1">Налаштування відповідних симуляторів <a class="header-anchor" href="#налаштування-відповідних-симуляторів" aria-label="Permalink to &quot;Налаштування відповідних симуляторів&quot;">​</a></h3><p>Дотримуйтесь відповідних кроків для певного симулятора в наступних розділах.</p><h4 id="gazebo-classic" tabindex="-1">Gazebo Classic <a class="header-anchor" href="#gazebo-classic" aria-label="Permalink to &quot;Gazebo Classic&quot;">​</a></h4><div class="info custom-block"><p class="custom-block-title">Переконайтеся, що <em>QGroundControl</em> не запущено!</p></div><ol><li><p>Зберіть PX4 з <a href="./../sim_gazebo_classic/README.html">Gazebo Classic</a> (щоб зібрати плагіни Gazebo Classic).</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Firmware_clon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DONT_RUN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> px4_sitl_default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gazebo-classic</span></span></code></pre></div></li><li><p>Відкрийте sdf файл моделі рухомого засобу (наприклад <strong>Tools/simulation/gazebo-classic/sitl_gazebo-classic/models/iris_hitl/iris_hitl.sdf</strong>).</p></li><li><p>Якщо необхідно, замінить параметр <code>serialDevice</code> (<code>/dev/ttyACM0</code>).</p><div class="info custom-block"><p class="custom-block-title">Пристрій послідовного порту залежить від порту, що використано для під&#39;єднання засобу до комп&#39;ютера (зазвичай це <code>/dev/ttyACM0</code>). Простий спосіб перевірити це на Ubuntu - під&#39;єднати автопілот, відкрити термінал та ввести <code>dmesg | grep &quot;tty&quot;</code>. Останній показаний пристрій і буде тим що потрібно.</p></div></li></ol><p>:::</p><ol><li><p>Налаштуйте змінні середовища:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tools/simulation/gazebo-classic/setup_gazebo.bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)/build/px4_sitl_default</span></span></code></pre></div><p>та запустіть Gazebo Classic в режимі HITL:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gazebo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tools/simulation/gazebo-classic/sitl_gazebo-classic/worlds/hitl_iris.world</span></span></code></pre></div></li><li><p>Запустіть <em>QGroundControl</em>. Воно повинно автоматично підключитися до PX4 та Gazebo Classic.</p></li></ol><h4 id="jmavsim-тільки-квадрокоптер" tabindex="-1">jMAVSim (тільки квадрокоптер) <a class="header-anchor" href="#jmavsim-тільки-квадрокоптер" aria-label="Permalink to &quot;jMAVSim (тільки квадрокоптер)&quot;">​</a></h4><div class="info custom-block"><p class="custom-block-title">Переконайтеся, що <em>QGroundControl</em> не запущено!</p></div><ol><li><p>Під&#39;єднайте політний контролер до комп&#39;ютера та дочекайтесь коли він завантажиться.</p></li><li><p>Запустіть jMAVSim в режимі HITL:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./Tools/simulation/jmavsim/jmavsim_run.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/ttyACM0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 921600</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 250</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">Замінить ім&#39;я послідовного порту <code>/dev/ttyACM0</code> на відповідний. На macOS цей порт буде <code>/dev/tty.usbmodem1</code>. На Windows (включно з Cygwin) це буде COM1 або інший порт - перевірте з&#39;єднання в менеджері пристроїв Windows.</p></div></li></ol><p>:::</p><ol><li>Запустіть <em>QGroundControl</em>. Воно повинно автоматично підключитися до PX4 та jMAVSim.</li></ol><h2 id="політ-за-автономним-завданням-у-hitl" tabindex="-1">Політ за автономним завданням у HITL <a class="header-anchor" href="#політ-за-автономним-завданням-у-hitl" aria-label="Permalink to &quot;Політ за автономним завданням у HITL&quot;">​</a></h2><p>Ви повинні мати можливість використовувати <em>QGroundControl</em> для <a href="https://docs.qgroundcontrol.com/master/en/FlyView/FlyView.html#missions" target="_blank" rel="noreferrer">запуску політних завдань</a> та іншим чином керувати рухомим засобом.</p>`,38),h=[p];function d(c,m,k,u,g,_){return o(),l("div",null,h)}const F=e(n,[["render",d]]);export{f as __pageData,F as default};
