import{_ as t,a as o,b as r}from"./chunks/qgc_uavcan_settings.BocZ7bFc.js";import{_ as i,c as n,o as s,ab as a,m as e}from"./chunks/framework.CUflZczI.js";const w=JSON.parse('{"title":"Sapog ESC Firmware","description":"","frontmatter":{},"headers":[],"relativePath":"ko/dronecan/sapog.md","filePath":"ko/dronecan/sapog.md"}'),l={name:"ko/dronecan/sapog.md"},h=a('<h1 id="sapog-esc-firmware" tabindex="-1">Sapog ESC Firmware <a class="header-anchor" href="#sapog-esc-firmware" aria-label="Permalink to &quot;Sapog ESC Firmware&quot;">​</a></h1><p><a href="https://github.com/PX4/sapog#px4-sapog" target="_blank" rel="noreferrer">Sapog</a> firmware is an advanced open source sensorless PMSM/BLDC motor controller firmware designed for use in propulsion systems of electric unmanned vehicles.</p><p>While it can be controlled using traditional PWM input, it is designed to operate over CAN bus using <a href="./">DroneCAN</a>.</p><h2 id="where-to-buy" tabindex="-1">Where to Buy <a class="header-anchor" href="#where-to-buy" aria-label="Permalink to &quot;Where to Buy&quot;">​</a></h2><p>Multiple vendors sell ESC hardware that runs sapog firmware:</p><ul><li><a href="https://zubax.com/products/orel_20" target="_blank" rel="noreferrer">Zubax Orel 20</a></li><li><a href="https://holybro.com/products/kotleta20" target="_blank" rel="noreferrer">Holybro Kotleta20</a></li></ul><div id="image_container"><div class="image_column"><img src="'+t+'" alt="Orel20 - Top"><br><a href="https://zubax.com/products/orel_20">Zubax Orel 20</a></div><div class="image_column"><img src="'+o+`" alt="Holybro Kotleta20 top"><br><a href="https://holybro.com/products/kotleta20">Holybro Kotleta20</a></div></div><h2 id="hardware-setup" tabindex="-1">Hardware Setup <a class="header-anchor" href="#hardware-setup" aria-label="Permalink to &quot;Hardware Setup&quot;">​</a></h2><p>ESCs are connected to the CAN bus using a Pixhawk standard 4 pin JST GH cable. For more information, refer to the <a href="./../can/#wiring">CAN Wiring</a> instructions. ESC order does not matter.</p><h2 id="firmware-setup" tabindex="-1">Firmware Setup <a class="header-anchor" href="#firmware-setup" aria-label="Permalink to &quot;Firmware Setup&quot;">​</a></h2><p>ESCs come with an existing build of Sapog installed. If you want to update:</p><p>To build the firmware:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --recursive</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/PX4/sapog</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sapog/firmware</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> RELEASE=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div><p>This will create a file <code>*.application.bin</code>. in <code>build/</code>. This binary can be flashed through the autopilot over DroneCAN via the sapog bootloader. See <a href="./#firmware-update">DroneCAN Firmware Update</a>.</p><p>Refer to the <a href="https://github.com/PX4/sapog" target="_blank" rel="noreferrer">project page</a> to learn more, including how to flash without using the DroneCAN bootloader (i.e. on a not-yet-programmed device) or for development.</p><h2 id="flight-controller-setup" tabindex="-1">Flight Controller Setup <a class="header-anchor" href="#flight-controller-setup" aria-label="Permalink to &quot;Flight Controller Setup&quot;">​</a></h2><h3 id="enabling-dronecan" tabindex="-1">Enabling DroneCAN <a class="header-anchor" href="#enabling-dronecan" aria-label="Permalink to &quot;Enabling DroneCAN&quot;">​</a></h3><p>Connect the ESCs to the Pixhawk CAN bus. Power up the entire vehicle using a battery or power supply (not just the flight controller over USB) and enable the DroneCAN driver by setting the parameter <a href="./../advanced_config/parameter_reference.html#UAVCAN_ENABLE">UAVCAN_ENABLE</a> to &#39;3&#39; to enable both dynamic node ID allocation and DroneCAN ESC output.</p><h3 id="automatic-esc-enumeration-using-qgroundcontrol" tabindex="-1">Automatic ESC Enumeration using QGroundControl <a class="header-anchor" href="#automatic-esc-enumeration-using-qgroundcontrol" aria-label="Permalink to &quot;Automatic ESC Enumeration using QGroundControl&quot;">​</a></h3><p>This section shows how to enumerate any <a href="https://github.com/PX4/sapog#px4-sapog" target="_blank" rel="noreferrer">Sapog-based</a>-based ESCs &quot;automatically&quot; using <em>QGroundControl</em>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can skip this section if there is only one ESC in your setup, because the ESC index is already set to zero by default.</p></div><p>To enumerate the ESC:</p><ol><li><p>Power the vehicle with a battery and connect to <em>QGroundControl</em></p></li><li><p>Navigate to <strong>Vehicle Setup &gt; Power</strong> in QGC.</p></li><li><p>Start the process of ESC auto-enumeration by pressing the <strong>Start Assignment</strong> button, as shown on the screenshot below.</p><p><img src="`+r+'" alt="QGC - DroneCAN ESC auto-enumeration"></p><p>You will hear a sound indicating that the flight controller has entered the ESC enumeration mode.</p></li><li><p>Manually turn each motor in the correct direction of its rotation (as specified in the <a href="./../airframes/airframe_reference.html">Airframe Reference</a>), starting from the first motor and finishing with the last motor. Each time you turn a motor, you should hear a confirmation beep.</p><div class="info custom-block"><p class="custom-block-title">INFO</p></div></li></ol><p>Make sure to turn each of the motors in the correct direction, as the ESC will automatically learn and remember the direction (i.e. motors that spin clockwise during normal operation must also be turned clockwise during enumeration). :::</p><ol start="5"><li>After the last motor is enumerated, the confirmation sound should change to indicate that the enumeration procedure is complete.</li><li>Reboot PX4 and the Sapog ESCs to apply the new enumeration IDs.</li></ol><p>The following video demonstrates the process:</p>',26),p=e("p",null,[e("div",{class:"embed-responsive embed-responsive-16by9"},[e("iframe",{class:"embed-responsive-item youtube-player",type:"text/html",width:"640",height:"390",src:"https://www.youtube.com/embed/4nSa8tvpbgQ",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""})])],-1),u=a('<h3 id="manual-esc-enumeration-using-sapog" tabindex="-1">Manual ESC Enumeration using Sapog <a class="header-anchor" href="#manual-esc-enumeration-using-sapog" aria-label="Permalink to &quot;Manual ESC Enumeration using Sapog&quot;">​</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>We recommend automated <a href="#automatic-esc-enumeration-using-qgroundcontrol">Sapog ESC Enumeration using QGroundControl</a> shown above rather than manual enumeration (as it is easier and safer).</p></div><p>You can manually configure the ESC index and direction using the <a href="https://dronecan.github.io/GUI_Tool/Overview/" target="_blank" rel="noreferrer">DroneCAN GUI Tool</a>. This assigns the following Sapog configuration parameters for each enumerated ESC:</p><ul><li><code>esc_index</code></li><li><code>ctl_dir</code></li></ul><div class="info custom-block"><p class="custom-block-title">See <a href="https://files.zubax.com/products/io.px4.sapog/Sapog_v2_Reference_Manual.pdf" target="_blank" rel="noreferrer">Sapog reference manual</a> for more information about the parameters.</p></div><h3 id="px4-configuration" tabindex="-1">PX4 Configuration <a class="header-anchor" href="#px4-configuration" aria-label="Permalink to &quot;PX4 Configuration&quot;">​</a></h3><p>Assign motors to outputs using the <a href="./../config/actuators.html#actuator-testing">Acutator</a> configuration screen.</p><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><p>See <a href="./#troubleshooting">DroneCAN Troubleshooting</a></p><h2 id="further-information" tabindex="-1">Further Information <a class="header-anchor" href="#further-information" aria-label="Permalink to &quot;Further Information&quot;">​</a></h2><ul><li><a href="https://github.com/PX4/sapog#px4-sapog" target="_blank" rel="noreferrer">PX4/Sapog</a> (Github)</li><li><a href="https://files.zubax.com/products/io.px4.sapog/Sapog_v2_Reference_Manual.pdf" target="_blank" rel="noreferrer">Sapog v2 Reference Manual</a></li><li><a href="https://kb.zubax.com/display/MAINKB/Using+Sapog-based+ESC+with+PX4" target="_blank" rel="noreferrer">Using Sapog based ESC with PX4</a> (Zubax KB)</li></ul>',11),c=[h,p,u];function d(m,g,f,b,_,k){return s(),n("div",null,c)}const E=i(l,[["render",d]]);export{w as __pageData,E as default};
