import{_ as s,c as i,o as a,ab as n}from"./chunks/framework.CUflZczI.js";const c=JSON.parse('{"title":"Повідомлення uORB","description":"","frontmatter":{},"headers":[],"relativePath":"uk/middleware/uorb.md","filePath":"uk/middleware/uorb.md"}'),t={name:"uk/middleware/uorb.md"},h=n(`<h1 id="повідомлення-uorb" tabindex="-1">Повідомлення uORB <a class="header-anchor" href="#повідомлення-uorb" aria-label="Permalink to &quot;Повідомлення uORB&quot;">​</a></h1><h2 id="введення" tabindex="-1">Введення <a class="header-anchor" href="#введення" aria-label="Permalink to &quot;Введення&quot;">​</a></h2><p>uORB - це асинхронний <code>publish()</code> / <code>subscribe()</code> API для обміну повідомленнями, який використовується для міжпотокового / міжпроцесного зв&#39;язку.</p><p>Подивіться <a href="./../modules/hello_sky.html">посібник</a>, щоб дізнатися, як його використовувати в C++.</p><p>uORB автоматично запускається при завантаженні, оскільки багато програм залежать від нього. Запускається за допомогою <code>uorb start</code>. Модульні тести можна запустити за допомогою <code>uorb_tests</code>.</p><h2 id="додавання-новоі-теми" tabindex="-1">Додавання нової теми <a class="header-anchor" href="#додавання-новоі-теми" aria-label="Permalink to &quot;Додавання нової теми&quot;">​</a></h2><p>Нові теми uORB можуть бути додані або в основний репозиторій PX4/PX4-Autopilot, або до визначень повідомлень поза деревом. Для отримання інформації щодо додавання визначень повідомлень uORB поза деревом, див. <a href="./../advanced/out_of_tree_modules.html#out-of-tree-uorb-message-definitions">цей розділ</a>.</p><p>Щоб додати нову тему, вам потрібно створити новий файл <strong>.msg</strong> у каталозі <code>msg/</code> та додати назву файлу до списку <code>msg/CMakeLists.txt</code>. З цього автоматично генерується потрібний C/C++ код.</p><p>Подивіться на існуючі файли <code>msg</code> для визначення підтримуваних типів. Повідомлення також можна використовувати вкладеним в інші повідомлення.</p><p>До кожної згенерованої структури C/C++, буде додано поле <code>uint64_t timestamp</code>. Це використовується в логері, тому переконайтеся, що він заповнюється при публікації повідомлення.</p><p>Щоб використовувати тему у коді, додайте заголовок:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>#include &lt;uORB/topics/topic_name.h&gt;</span></span></code></pre></div><p>Додавши рядок, подібний наступному у файлі <code>.msg</code>, одне визначення повідомлення може бути використане для кількох незалежних тем:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># TOPICS mission offboard_mission onboard_mission</span></span></code></pre></div><p>Потім у коді використовуйте їх як ідентифікатор теми: <code>ORB_ID(offboard_mission)</code>.</p><h2 id="публікація" tabindex="-1">Публікація <a class="header-anchor" href="#публікація" aria-label="Permalink to &quot;Публікація&quot;">​</a></h2><p>Публікацію теми можна виконати з будь-якого місця в системі, включаючи контекст переривання (функції, які викликаються API <code>hrt_call</code>). Однак, перш ніж публікувати тему в контексті переривання, її потрібно оголосити і опублікувати поза контекстом переривання (принаймні, один раз).</p><h2 id="перелік-тем-та-іх-прослуховування" tabindex="-1">Перелік тем та їх прослуховування <a class="header-anchor" href="#перелік-тем-та-іх-прослуховування" aria-label="Permalink to &quot;Перелік тем та їх прослуховування&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">Команда <code>listener</code> доступна лише на Pixracer (FMUv4) та Linux / OS X.</p></div><p>Щоб перерахувати всі теми, перерахуйте файлові дескриптори:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /obj</span></span></code></pre></div><p>Щоб прослухати зміст однієї теми з 5 повідомлень, запустіть команду прослуховувач:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listener</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sensor_accel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span></code></pre></div><p>На виході виводиться n-кратний вміст теми:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TOPIC:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sensor_accel</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timestamp:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 84978861</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integral_dt:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4044</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error_count:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">y:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">z:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x_integral:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">y_integral:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">z_integral:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">temperature:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 46</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">range_m_s2:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 78</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scaling:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TOPIC:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sensor_accel</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timestamp:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 85010833</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integral_dt:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3980</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error_count:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">y:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">z:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">x_integral:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">y_integral:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">z_integral:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">temperature:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 46</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">range_m_s2:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 78</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scaling:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>На системах на основі NuttX (Pixhawk, Pixracer і т.д.) команду <code>listener</code> можна викликати з консолі MAVLink <em>QGroundControl</em> для перевірки значень датчиків та інших тем. Це потужний інструмент для відлагодження, оскільки його можна використовувати навіть тоді, коли QGC підключений через бездротове з&#39;єднання (наприклад, коли транспортний засіб летить). Для отримання додаткової інформації дивіться: <a href="./../debug/sensor_uorb_topic_debugging.html">Відлагодження сенсорів/тем</a>.</p></div><h3 id="команда-uorb-top" tabindex="-1">Команда uorb top <a class="header-anchor" href="#команда-uorb-top" aria-label="Permalink to &quot;Команда uorb top&quot;">​</a></h3><p>Команда <code>uorb top</code> показує частоту публікації кожної теми в реальному часі:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1s,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> num</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> topics:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 77</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TOPIC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        INST</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #SUB #MSG #LOST #QSIZE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">actuator_armed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">actuator_controls_0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                  0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  242</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1044</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">battery_status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  500</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  2694</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">commander_state</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   98</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    89</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control_state</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                        0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  242</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   433</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ekf2_innovations</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  242</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   223</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ekf2_timestamps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  242</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">estimator_status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  242</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   488</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mc_att_ctrl_status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  242</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sensor_accel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                         0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  242</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sensor_accel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                         1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  249</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    43</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sensor_baro</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                          0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   42</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sensor_combined</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  242</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   636</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span></code></pre></div><p>Колонки: назва теми, індекс, кількість підписників, частота публікації в Гц, кількість втрачених повідомлень за секунду (для всіх підписників разом) і розмір черги.</p><h2 id="багатоекземплярнии-режим" tabindex="-1">Багатоекземплярний режим <a class="header-anchor" href="#багатоекземплярнии-режим" aria-label="Permalink to &quot;Багатоекземплярний режим&quot;">​</a></h2><p>uORB надає механізм публікації декількох незалежних екземплярів однієї теми за допомогою <code>orb_advertise_multi</code>. Він поверне публікувачу індекс екземпляра. Після цього підписник має вибрати, на який екземпляр підписатися за допомогою <code>orb_subscribe_multi</code> (<code>orb_subscribe</code> підписує на перший екземпляр). Наявність декількох екземплярів корисна, наприклад, якщо система має кілька сенсорів одного типу.</p><p>Переконайтеся, що ви не змішуєте <code>orb_advertise_multi</code> і <code>orb_advertise</code> для однієї теми.</p><p>Повний API задокументовано в <a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/platforms/common/uORB/uORBManager.hpp" target="_blank" rel="noreferrer">platforms/common/uORB/uORBManager.hpp</a>.</p><p><a id="deprecation"></a></p><h2 id="застаріле-повідомлення-поле" tabindex="-1">Застаріле повідомлення/поле <a class="header-anchor" href="#застаріле-повідомлення-поле" aria-label="Permalink to &quot;Застаріле повідомлення/поле&quot;">​</a></h2><p>Оскільки існують зовнішні інструменти, що використовують повідомлення uORB з файлів журналів, такі як <a href="https://github.com/PX4/flight_review" target="_blank" rel="noreferrer">Flight Review</a>, при оновленні існуючих повідомлень необхідно враховувати певні аспекти:</p><ul><li>Зміна існуючих полів або повідомлень, на які покладаються зовнішні інструменти, зазвичай є прийнятною, якщо для оновлення є вагомі причини. Зокрема, для внесення змін до <em>Flight Review</em>, <em>Flight Review</em> має бути оновлено до того, як код буде об&#39;єднано з <code>master</code>.</li><li>Для того, щоб зовнішні інструменти могли надійно розрізняти дві версії повідомлень, необхідно виконати наступні кроки: <ul><li>Вилучені або перейменовані повідомлення слід додати до списку <code>deprecated_msgs</code> у <a href="https://github.com/PX4/PX4-Autopilot/blob/c5a6a60903455c3600f47e3c45ecaa48614559c8/msg/CMakeLists.txt#L189" target="_blank" rel="noreferrer">msg/CMakeLists.txt</a>, а файл <strong>.msg</strong> слід видалити.</li><li>Видалені або перейменовані поля повинні бути закоментовані та позначені як застарілі. Наприклад, <code>uint8 quat_reset_counter</code> стане <code># DEPRECATED: uint8 quat_reset_counter</code>. Це робиться для того, щоб гарантувати, що видалені поля (або повідомлення) не будуть додані повторно в майбутньому.</li><li>У разі семантичної зміни (наприклад, одиниця виміру змінюється з градусів на радіани), поле також має бути перейменоване, а попереднє позначене як застаріле, як зазначено вище.</li></ul></li></ul>`,38),l=[h];function e(p,k,r,d,F,C){return a(),i("div",null,l)}const g=s(t,[["render",e]]);export{c as __pageData,g as default};
