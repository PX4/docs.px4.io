import{_ as e,c as a,o,ab as l}from"./chunks/framework.CUflZczI.js";const E=JSON.parse('{"title":"Інтерфейс планування маршруту","description":"","frontmatter":{},"headers":[],"relativePath":"uk/computer_vision/path_planning_interface.md","filePath":"uk/computer_vision/path_planning_interface.md"}'),i={name:"uk/computer_vision/path_planning_interface.md"},c=l('<h1 id="інтерфеис-планування-маршруту" tabindex="-1">Інтерфейс планування маршруту <a class="header-anchor" href="#інтерфеис-планування-маршруту" aria-label="Permalink to &quot;Інтерфейс планування маршруту&quot;">​</a></h1><p>PX4 використовує кілька інтерфейсів MAVLink для інтеграції служб планування маршруту з компаньйонним комп&#39;ютером (включаючи уникнення перешкод у місіях, <a href="./../computer_vision/safe_landing.html">безпечну посадку</a> та майбутні служби):</p><ul><li>Існують два інтерфейси <a href="https://mavlink.io/en/services/trajectory.html" target="_blank" rel="noreferrer">протоколу планування маршруту MAVLink</a>: <ul><li><a href="https://mavlink.io/en/messages/common.html#TRAJECTORY_REPRESENTATION_WAYPOINTS" target="_blank" rel="noreferrer">TRAJECTORY_REPRESENTATION_WAYPOINTS</a>: Використовується PX4 для надсилання <em>бажаного маршруту</em>. Може бути використаний програмним забезпеченням планування маршруту для надсилання PX4 потоку установок для <em>запланованого маршруту</em>.</li><li><a href="https://mavlink.io/en/messages/common.html#TRAJECTORY_REPRESENTATION_BEZIER" target="_blank" rel="noreferrer">TRAJECTORY_REPRESENTATION_BEZIER</a>, може (в альтернативу) використовуватися програмним забезпеченням планування маршруту для надсилання PX4 <em>запланованого маршруту</em> у вигляді кривої Безьє. Крива вказує (рухоме) цільове значення положення транспортного засобу протягом певного періоду часу.</li></ul></li><li><a href="https://mavlink.io/en/services/heartbeat.html" target="_blank" rel="noreferrer">Протокол з&#39;єднання HEARTBEAT</a> використовується для виявлення &quot;підтвердження життєздатності&quot;.</li><li><a href="https://mavlink.io/en/messages/common.html#LOCAL_POSITION_NED" target="_blank" rel="noreferrer">LOCAL_POSITION_NED</a> і <a href="https://mavlink.io/en/messages/common.html#ALTITUDE" target="_blank" rel="noreferrer">ALTITUDE</a> надсилають місцеве положення транспортного засобу та висоту відповідно.</li></ul><p>Планування маршруту увімкнено на PX4 у автоматичних режимах (посадка, зльот, утримання, місія, повернення), якщо <a href="./../advanced_config/parameter_reference.html#COM_OBS_AVOID">COM_OBS_AVOID=1</a>. У цих режимах від планувального програмного забезпечення очікується надання установок PX4; якщо програмне забезпечення не може підтримувати певний режим польоту, воно повинно дублювати установки з транспортного засобу.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Повідомлення переходять від тем PX4 UORB через MAVLink до ROS і назад, усе задокументовано в <a href="https://github.com/PX4/PX4-Avoidance#message-flows" target="_blank" rel="noreferrer">PX4/PX4-Avoidance &gt; Потоки повідомлень</a>.</p></div><p>Всі служби, що використовують цей інтерфейс, надсилають та отримують повідомлення одного й того ж типу/формату. Розробники можуть використовувати цей інтерфейс для створення власних нових сервісів планування маршруту на компаньйонному комп&#39;ютері або покращення існуючого програмного забезпечення планувальника.</p><div class="info custom-block"><p class="custom-block-title"><a href="./../complete_vehicles_mc/px4_vision_kit.html">PX4 Vision Autonomy Development Kit</a> рекомендується для розробки програмного забезпечення планування маршруту. Він поставляється з встановленим програмним забезпеченням <a href="https://github.com/PX4/PX4-Avoidance" target="_blank" rel="noreferrer">уникнення PX4</a> і може бути використаний як база для ваших власних алгоритмів.</p></div><h2 id="налаштування-px4" tabindex="-1">Налаштування PX4 <a class="header-anchor" href="#налаштування-px4" aria-label="Permalink to &quot;Налаштування PX4&quot;">​</a></h2><p>Шляхове планування активується в PX4, встановивши <a href="./../advanced_config/parameters.html">setting</a> значення <a href="./../advanced_config/parameter_reference.html#COM_OBS_AVOID">COM_OBS_AVOID</a> на 1.</p><h2 id="налаштування-компаньионного-комп-ютера" tabindex="-1">Налаштування Компаньйонного Комп&#39;ютера <a class="header-anchor" href="#налаштування-компаньионного-комп-ютера" aria-label="Permalink to &quot;Налаштування Компаньйонного Комп&#39;ютера&quot;">​</a></h2><p>Налаштування апаратного забезпечення та конфігурація апаратного та програмного забезпечення на стороні компаньйонного комп&#39;ютера надаються в репозиторії <a href="https://github.com/PX4/PX4-Avoidance" target="_blank" rel="noreferrer">PX4/PX4-Avoidance</a> на Github.</p><p>Реальні налаштування/конфігурація, необхідні для роботи, залежать від планувальника, який використовується.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Завжди може працювати лише один планувальник на компаньйонному комп&#39;ютері одночасно (на момент написання цього тексту). Це означає, що функції оффборд, які використовують різні планувальники, не можуть бути ввімкнені одночасно на одному транспортному засобі (наприклад, транспортний засіб може підтримувати уникнення перешкод та запобігання зіткненням, але не може підтримувати безпечну посадку - або навпаки).</p></div><p><a id="waypoint_interface"></a></p><h2 id="інтерфеис-траєкторіі" tabindex="-1">Інтерфейс траєкторії <a class="header-anchor" href="#інтерфеис-траєкторіі" aria-label="Permalink to &quot;Інтерфейс траєкторії&quot;">​</a></h2><p>PX4 надсилає інформацію про <em>бажаний маршрут</em> на компаньйонний комп&#39;ютер (коли <code>COM_OBS_AVOID=1</code>, у режимах <em>автоматичного польоту</em>), і отримує назад потік установок для <em>запланованого маршруту</em> від програмного забезпечення планування маршруту.</p><p>Інформація про бажаний маршрут надсилається PX4 за допомогою повідомлень <a href="https://mavlink.io/en/messages/common.html#TRAJECTORY_REPRESENTATION_WAYPOINTS" target="_blank" rel="noreferrer">TRAJECTORY_REPRESENTATION_WAYPOINTS</a>, як описано нижче в <a href="#px4_waypoint_interface">Інтерфейсі Точок Маршруту PX4</a>.</p><p>Програмне забезпечення <em>планування маршруту</em> надсилає назад установки для запланованого маршруту за допомогою <code>TRAJECTORY_REPRESENTATION_WAYPOINTS</code> (див. <a href="#companion_waypoint_interface">Інтерфейс Точок Маршруту на Компаньйонному Комп&#39;ютері</a>) або <a href="https://mavlink.io/en/messages/common.html#TRAJECTORY_REPRESENTATION_BEZIER" target="_blank" rel="noreferrer">TRAJECTORY_REPRESENTATION_BEZIER</a> (див. Інтерфейс Кривої Безьє на <a href="#bezier_interface">Компаньйонному Комп&#39;ютері</a>). Різниця полягає в тому, що точка маршруту просто вказує наступне цільове положення установки, тоді як траєкторія Безьє описує точне рух транспортного засобу (тобто установку, яка переміщується у часі).</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Планувальне програмне забезпечення не повинно змішувати ці інтерфейси під час виконання завдання (PX4 буде використовувати останнє отримане повідомлення будь-якого з типів).</p></div><p><a id="px4_waypoint_interface"></a></p><h3 id="інтерфеис-точки-маршруту-px4" tabindex="-1">Інтерфейс точки маршруту PX4 <a class="header-anchor" href="#інтерфеис-точки-маршруту-px4" aria-label="Permalink to &quot;Інтерфейс точки маршруту PX4&quot;">​</a></h3><p>PX4 надсилає бажаний шлях у повідомленнях <a href="https://mavlink.io/en/messages/common.html#TRAJECTORY_REPRESENTATION_WAYPOINTS" target="_blank" rel="noreferrer">TRAJECTORY_REPRESENTATION_WAYPOINTS</a> на частоті 5 Гц.</p><p>Поля, встановлені PX4, як показано:</p><ul><li><code>time_usec</code>: UNIX Epoch time.</li><li><code>valid_points</code>: 3</li><li>Точка 0 - Поточний тип мітки, <em>адаптований</em> за допомогою FlightTaskAutoMapper (див. <a href="#type_adapted">примітки нижче</a>): <ul><li><code>pos_x[0]</code>, <code>pos_y[0]</code>, <code>pos_z[0]</code>: тип адаптованого x-y-z локального положення NED <em>поточного</em> точка місії.</li><li><code>vel_x[0]</code>, <code>vel_y[0]</code>, <code>vel_z[0]</code>: Тип адаптованої локальної швидкості NED x-y-z <em>течії</em> точка місії.</li><li><code>acc_x[0]</code>, <code>acc_y[0]</code>, <code>acc_z[0]</code>: NaN</li><li><code>pos_yaw[0]</code>: поточний кут повороту</li><li><code>vel_yaw[0]</code>: NaN</li><li><code>command[0]</code>: <a href="https://mavlink.io/en/messages/common.html#mav_commands" target="_blank" rel="noreferrer">Команда MAVLink</a> для поточної маршрутної точки.</li></ul></li><li>Пункт 1 - Поточна маршрутна точка (Незмінена/не адаптована до типу)): <ul><li><code>pos_x[1]</code>, <code>pos_y[1]</code>, <code>pos_z[1]</code>: локальна позиція x-y-z NED <em>поточної</em> місії шляхова точка</li><li><code>vel_x[1]</code>, <code>vel_y[1]</code>, <code>vel_z[1]</code>: NaN</li><li><code>acc_x[1]</code>, <code>acc_y[1]</code>, <code>acc_z[1]</code>: NaN</li><li><code>pos_yaw[1]</code>: Поточний кут курсу</li><li><code>vel_yaw[1]</code>: Швидкість заданої кутової мітки</li><li><code>command[1]</code>: The <a href="https://mavlink.io/en/messages/common.html#mav_commands" target="_blank" rel="noreferrer">MAVLink Command</a> для поточної мітки.</li></ul></li><li>Точка 2 - Наступна мітка у локальних координатах (незмінена/не адаптована за типом): <ul><li><code>pos_x[2]</code>, <code>pos_y[2]</code>, <code>pos_z[2]</code>: локальна позиція x-y-z NED <em>наступної</em> місії шляхова точка</li><li><code>vel_x[2]</code>, <code>vel_y[2]</code>, <code>vel_z[2]</code>: NaN</li><li><code>acc_x[2]</code>, <code>acc_y[2]</code>, <code>acc_z[2]</code>: NaN</li><li><code>pos_yaw[2]</code>: Задана кутова мітка</li><li><code>vel_yaw[2]</code>: Швидкість заданої кутової мітки</li><li><code>command[2]</code>: <a href="https://mavlink.io/en/messages/common.html#mav_commands" target="_blank" rel="noreferrer">MAVLink-команда</a> для наступної мітки.</li></ul></li><li>Усі інші індекси/поля встановлені як NaN.</li></ul><p><a id="type_adapted"></a></p><p>Примітки:</p><ul><li>Точка 0 - це поточна точка маршруту/ціль, змінена в залежності від типу цілі. Наприклад, у випадку посадки має сенс вказати цільові координати x, y та швидкість спуску. Для досягнення цього <code>FlightTaskAutoMapper</code> модифікує посадкові точки в Точці 0, щоб встановити компонент z позиції як NAN та z-швидкість на певне значення.</li><li>Точки 1 та 2 не використовуються планувальником безпечної посадки.</li><li>Точка 1 використовується місцевим та глобальним планувальниками.</li></ul><p><a id="companion-failure-handling"></a></p><h4 id="обробка-відмови-компаньионного-комп-ютера" tabindex="-1">Обробка Відмови Компаньйонного Комп&#39;ютера <a class="header-anchor" href="#обробка-відмови-компаньионного-комп-ютера" aria-label="Permalink to &quot;Обробка Відмови Компаньйонного Комп&#39;ютера&quot;">​</a></h4><p>PX4 безпечно обробляє випадок, коли повідомлення не надходять від системи автономного управління:</p><ul><li>Якщо жоден планувальник не запущений і <code>COM_OBS_AVOID</code> увімкнено під час/із завантаження: <ul><li>передпольотні перевірки будуть невдалими (незалежно від режиму транспортного засобу), і він не злетить, поки <code>COM_OBS_AVOID</code> не буде встановлено в 0.</li></ul></li><li>Якщо після завантаження не запущено жодного планувальника, а <code>COM_OBS_AVOID</code> увімкнено: <ul><li>транспортний засіб буде працювати нормально вручних режимах.</li><li>якщо ви перемикаєтеся в автономний режим (наприклад, режим посадки), він одразу перейде в <a href="./../flight_modes_mc/hold.html">режим утримання</a>.</li></ul></li><li>Коли зовнішнє планування шляху увімкнено: <ul><li>якщо втрачений <code>HEARTBEAT</code>, PX4 видасть повідомлення про статус (яке відображається в <em>QGroundControl</em>) зі словами &quot;Система уникнення втрачена&quot; або &quot;Тайм-аут системи уникнення&quot; (залежно від стану транспортного засобу). Це незалежно від поточного режиму польоту. Це незалежно від поточного режиму польоту.</li><li>якщо траєкторне повідомлення не отримано протягом більш ніж 0,5 секунди, і транспортний засіб знаходиться в автономному режимі (Повернення, Місія, Зльот, Посадка), він перейде в <a href="./../flight_modes_mc/hold.html">режим утримання</a>. ::: info Планувальник завжди повинен надавати точки протягом цього часу.</li><li>Планувальник буде відображати назад установки, які він отримує, коли транспортний засіб перебуває в режимі/стані, для якого він не надає планування маршруту. (тобто транспортний засіб буде слідувати за бажаним маршрутом з невеликим затримкою). :::</li><li>Якщо термін виконання останнього наданого траєкторного маршруту закінчується під час планування маршруту (коли використовується <a href="#bezier_interface">Інтерфейс траєкторії Безьє</a>), це розглядається так само, як і не отримання нового повідомлення протягом 0,5 секунди (тобто транспортний засіб переходить в <a href="./../flight_modes_mc/hold.html">режим утримання</a>).</li></ul></li></ul><p><a id="companion_waypoint_interface"></a></p><h2 id="інтерфеис-точок-маркерів-компаньиону" tabindex="-1">Інтерфейс точок-маркерів компаньйону <a class="header-anchor" href="#інтерфеис-точок-маркерів-компаньиону" aria-label="Permalink to &quot;Інтерфейс точок-маркерів компаньйону&quot;">​</a></h2><p>Програмне забезпечення планування маршруту (яке працює на компаньйонному комп&#39;ютері) <em>може</em> відправляти запланований шлях до PX4 у вигляді потоку повідомлень <a href="https://mavlink.io/en/messages/common.html#TRAJECTORY_REPRESENTATION_WAYPOINTS" target="_blank" rel="noreferrer">TRAJECTORY_REPRESENTATION_WAYPOINTS</a> зі точкою в Point 0.</p><p>Поля для повідомлень від компаньйонного комп&#39;ютера встановлені як показано:</p><ul><li><code>time_usec</code>: час UNIX Epoch.</li><li><code>valid_points</code>: 1</li><li>Актуальна інформація про пристрій: <ul><li><code>pos_x[0]</code>, <code>pos_y[0]</code>, <code>pos_z[0]</code>: задане локальне положення автомобіля x-y-z NED</li><li><code>vel_x[0]</code>, <code>vel_y[0]</code>, <code>vel_z[0]</code>: задане значення швидкості x-y-z NED</li><li><code>acc_x[0]</code>, <code>acc_y[0]</code>, <code>acc_z[0]</code>: NaN</li><li><code>pos_yaw[0]</code>: задане значення кута повороту</li><li><code>vel_yaw[0]</code>: задане значення швидкості повороту</li><li><code>command[0]</code>: NaN.</li></ul></li><li>Усі інші індекси/поля встановлені як NaN.</li></ul><p>Interface для планувальника, який реалізує цей інтерфейс, повинна:</p><ul><li>Видавати цільові значення з частотою більше 2 Гц при отриманні повідомлень від PX4. PX4 увімкне режим <a href="./../flight_modes_mc/hold.html">Hold mode</a>, якщо не отримує повідомлення протягом більше ніж 0,5 секунд.</li><li>Дублювати отримані цільові значення, коли вона не підтримує планування для поточного стану транспортного засобу (наприклад, локальний планувальник буде дублювати повідомлення, відправлені під час безпечної посадки, оскільки він не підтримує режим посадки).</li></ul><p><a id="bezier_interface"></a></p><h2 id="супутніи-інтерфеис-траєкторіі-безьє" tabindex="-1">Супутній інтерфейс траєкторії Безьє <a class="header-anchor" href="#супутніи-інтерфеис-траєкторіі-безьє" aria-label="Permalink to &quot;Супутній інтерфейс траєкторії Безьє&quot;">​</a></h2><p>Програмне забезпечення для планування маршруту (що працює на комп&#39;ютері-супутнику) <em>може</em> надсилати запланований шлях до PX4 у вигляді потоку повідомлень <a href="https://mavlink.io/en/messages/common.html#TRAJECTORY_REPRESENTATION_BEZIER" target="_blank" rel="noreferrer">TRAJECTORY_REPRESENTATION_BEZIER</a>.</p><p>Повідомлення визначає шлях, який повинен пройти транспортний засіб у вигляді кривої (визначеної контрольними точками), починаючи з моменту часу повідомлення <code>timestamp</code> і досягаючи кінцевої точки після часового інтервалу <code>delta</code>. PX4 обчислює своє нове цільове значення (очікуване поточне положення/швидкість/прискорення вздовж кривої), використовуючи час надсилання повідомлення, поточний час та загальний час для кривої (delta).</p><div class="info custom-block"><p class="custom-block-title">Наприклад, якщо повідомлення було надіслане 0,1 секунду тому, а <code>delta</code> (тривалість кривої) становить 0,3 секунди. PX4 може обчислити своє цільове значення на позиції 0,1 секунди на кривій.</p></div><p>Детальніше, повідомлення <code>TRAJECTORY_REPRESENTATION_BEZIER</code> розбирається наступним чином:</p><ul><li>Кількість контрольних точок Bezier визначає ступінь кривої Bezier. Наприклад, 3 точки створюють квадратичну криву Bezier з постійним прискоренням.</li><li>Крива Bezier повинна мати однаковий ступінь у напрямках x, y, z та yaw, з усіма контрольними точками Bezier обмеженими</li><li>Масив <code>delta</code> повинен мати значення, що відповідає останній контрольній точці Bezier, щоб показати тривалість, яку займає виконання шляхової точки для виконання кривої до цієї точки, від початку до кінця. Інші значення у масиві <code>delta</code> ігноруються.</li><li>Мітка часу MAVLink-повідомлення повинна відповідати часу початку кривої, а затримка та розбіжність годинника будуть компенсовані на літаковому контролері за допомогою механізму синхронізації часу.</li><li>Всі контрольні точки повинні бути вказані в локальних координатах (<a href="https://mavlink.io/en/messages/common.html#MAV_FRAME_LOCAL_NED" target="_blank" rel="noreferrer">MAV_FRAME_LOCAL_NED</a>).</li><li>Криві Bezier втрачають свою актуальність після досягнення часу виконання кривої Bezier. Переконайтеся, що нові повідомлення надсилаються з достатньою частотою та з довгою тривалістю виконання. Якщо цього не відбувається, транспортний засіб перейде в режим утримання.</li></ul><h2 id="підтримуване-обладнання" tabindex="-1">Підтримуване обладнання <a class="header-anchor" href="#підтримуване-обладнання" aria-label="Permalink to &quot;Підтримуване обладнання&quot;">​</a></h2><p>Перевірені супутні комп’ютери та камери перераховані в <a href="https://github.com/PX4/PX4-Avoidance#run-on-hardware" target="_blank" rel="noreferrer">PX4/PX4-Avoidance</a>.</p>',47),t=[c];function r(d,n,_,m,s,p){return o(),a("div",null,t)}const f=e(i,[["render",r]]);export{E as __pageData,f as default};
