import{_ as e,c as a,o as r,ab as t}from"./chunks/framework.CUflZczI.js";const _=JSON.parse('{"title":"MAVLink 相机(Camera Protocol v2)","description":"","frontmatter":{},"headers":[],"relativePath":"zh/camera/mavlink_v2_camera.md","filePath":"zh/camera/mavlink_v2_camera.md"}'),o={name:"zh/camera/mavlink_v2_camera.md"},n=t('<h1 id="mavlink-相机-camera-protocol-v2" tabindex="-1">MAVLink 相机(Camera Protocol v2) <a class="header-anchor" href="#mavlink-相机-camera-protocol-v2" aria-label="Permalink to &quot;MAVLink 相机(Camera Protocol v2)&quot;">​</a></h1><p>本节说明了如何使用 PX4 的 MAVLink <a href="./../camera/">相机</a> 实现了 <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">MAVLink Camera Protocol v2</a> 的 PX4 和地面站。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>这是与 PX4 集成相机的推荐方式！</p></div><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>The <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">MAVLink Camera Protocol v2</a> allows querying of what features are supported by a camera, and provides commands to control image and video capture, stream video, set zoom and focus, select between infrared and visible light feeds, set where captured data is saved, and so on.</p><p>A camera may implement the protocol natively, but most MAVLink camera setups involve PX4 communicating with a <a href="#camera-managers">camera manager</a> running on a companion computer, which then interfaces between MAVLink and the camera&#39;s native protocol.</p><p>Generally speaking PX4&#39;s &quot;integration&quot; with a camera is to re-emit camera commands found in missions using the command protocol. Otherwise it may act as a bridge, forwarding commands between a ground station and the camera if there is no direct MAVLink channel.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>PX4 does not support using <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">MAVLink Camera Protocol v2</a> commands to control cameras that are attached to flight controller outputs. While this is technically possible, it would require PX4 to implement a camera manager interface.</p></div><h2 id="控制相机" tabindex="-1">控制相机 <a class="header-anchor" href="#控制相机" aria-label="Permalink to &quot;控制相机&quot;">​</a></h2><h3 id="mavlink-命令和消息" tabindex="-1">MAVLink 命令和消息 <a class="header-anchor" href="#mavlink-命令和消息" aria-label="Permalink to &quot;MAVLink 命令和消息&quot;">​</a></h3><p>Cameras are discovered using the MAVLink <a href="https://mavlink.io/en/services/heartbeat.html" target="_blank" rel="noreferrer">connection protocol</a>, based on their <a href="https://mavlink.io/en/messages/common.html#HEARTBEAT" target="_blank" rel="noreferrer">HEARTBEAT.type</a> being set to <a href="https://mavlink.io/en/messages/common.html#MAV_TYPE_CAMERA" target="_blank" rel="noreferrer">MAV_TYPE_CAMERA</a>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Cameras should also use a component ID in the recommended range, such as <a href="https://mavlink.io/en/messages/common.html#MAV_COMP_ID_CAMERA" target="_blank" rel="noreferrer">MAV_COMP_ID_CAMERA</a>, but generally this cannot be relied on to verify that a MAVLink component is a camera.</p></div><p>Once a camera is discovered its properties and capabilities can be queried by using <a href="https://mavlink.io/en/messages/common.html#MAV_CMD_REQUEST_MESSAGE" target="_blank" rel="noreferrer">MAV_CMD_REQUEST_MESSAGE</a> to request the <a href="https://mavlink.io/en/messages/common.html#CAMERA_INFORMATION" target="_blank" rel="noreferrer">CAMERA_INFORMATION</a> message, and then inspecting the <code>flags</code> field to determine what standard features in <a href="https://mavlink.io/en/messages/common.html#CAMERA_CAP_FLAGS" target="_blank" rel="noreferrer">CAMERA_CAP_FLAGS</a> are supported.</p><p>Based on the flags, you can determine what other commands and messages are supported by the camera. The full set of messages, commands, and enums are <a href="https://mavlink.io/en/services/camera.html#messagecommandenum-summary" target="_blank" rel="noreferrer">summarised here</a>.</p><p>Additional parameters of a camera <em>may</em> be exposed in a <a href="https://mavlink.io/en/services/camera_def.html" target="_blank" rel="noreferrer">camera definition file</a> that is linked from <code>CAMERA_INFORMATION.cam_definition_uri</code>. A GCS or SDK can expose these settings though a generic UI, without having to understand any context. These parameters cannot directly be set in missions and have no specific setter commands.</p><p><a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">MAVLink Camera Protocol v2</a> describes all the interactions in more detail.</p><h3 id="地面站和-mavlink-sdk" tabindex="-1">地面站和 MAVLink SDK <a class="header-anchor" href="#地面站和-mavlink-sdk" aria-label="Permalink to &quot;地面站和 MAVLink SDK&quot;">​</a></h3><p>地面站和 MAVLink SDK 会像前一节所述那样发现相机及其功能。</p><p>A ground station can use any feature exposed by the camera. PX4 has no role in this interaction other than forwarding MAVLink traffic between the camera and ground station or SDK, if needed.</p><h3 id="任务中的相机命令" tabindex="-1">任务中的相机命令 <a class="header-anchor" href="#任务中的相机命令" aria-label="Permalink to &quot;任务中的相机命令&quot;">​</a></h3><p>PX4 allows the following subset of <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">Camera Protocol v2</a> commands in missions:</p><ul><li><a href="https://mavlink.io/en/messages/common.html#MAV_CMD_IMAGE_START_CAPTURE" target="_blank" rel="noreferrer">MAV_CMD_IMAGE_START_CAPTURE</a></li><li><a href="https://mavlink.io/en/messages/common.html#MMAV_CMD_IMAGE_STOP_CAPTURE" target="_blank" rel="noreferrer">MAV_CMD_IMAGE_STOP_CAPTURE</a></li><li><a href="https://mavlink.io/en/messages/common.html#MAV_CMD_VIDEO_START_CAPTURE" target="_blank" rel="noreferrer">MAV_CMD_VIDEO_START_CAPTURE</a></li><li><a href="https://mavlink.io/en/messages/common.html#MAV_CMD_VIDEO_STOP_CAPTURE" target="_blank" rel="noreferrer">MAV_CMD_VIDEO_STOP_CAPTURE</a></li><li><a href="https://mavlink.io/en/messages/common.html#MAV_CMD_SET_CAMERA_MODE" target="_blank" rel="noreferrer">MAV_CMD_SET_CAMERA_MODE</a></li><li><a href="https://mavlink.io/en/messages/common.html#MAV_CMD_CMD_SET_CAMERA_ZOOM" target="_blank" rel="noreferrer">MAV_CMD_CMD_SET_CAMERA_ZOOM</a></li><li><a href="https://mavlink.io/en/messages/common.html#MAV_CMD_SET_CAMERA_FOCUS" target="_blank" rel="noreferrer">MAV_CMD_SET_CAMERA_FOCUS</a></li></ul><p>PX4 re-emits the camera commands found in missions as MAVLink commands. The system id of the emitted commands is the same as the ID of the autopilot. The component id of the commands can vary. The first four commands are addressed to <a href="https://mavlink.io/en/messages/common.html#MAV_COMP_ID_CAMERA" target="_blank" rel="noreferrer">MAV_COMP_ID_CAMERA (100)</a> (if a camera has this component ID, it will execute the indicated command). The camera mode, zoom, and focus, commands are sent to a component with id of <a href="https://mavlink.io/en/messages/common.html#MAV_COMP_ID_ALL" target="_blank" rel="noreferrer">MAV_COMP_ID_ALL</a>.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>PX4 currently ignores the target camera <code>id</code> in <a href="https://mavlink.io/en/messages/common.html#MAV_CMD_IMAGE_START_CAPTURE" target="_blank" rel="noreferrer">MAV_CMD_IMAGE_START_CAPTURE</a> and other camera messages. See <a href="https://github.com/PX4/PX4-Autopilot/issues/23083" target="_blank" rel="noreferrer">PX4-Autopilot#23083</a>.</p></div><h3 id="手动控制器" tabindex="-1">手动控制器 <a class="header-anchor" href="#手动控制器" aria-label="Permalink to &quot;手动控制器&quot;">​</a></h3><p>Joystick buttons can be configured to trigger image capture or toggle video capture.</p><p>PX4 emits <a href="https://mavlink.io/en/services/camera.html" target="_blank" rel="noreferrer">MAVLink Camera Protocol v2</a> commands such as <code>MAV_CMD_IMAGE_START_CAPTURE</code> when the associated Joystick button is pressed. This feature only works for this kind of camera and joystick - there is no support for RC Controllers.</p><h2 id="px4-配置" tabindex="-1">PX4 配置 <a class="header-anchor" href="#px4-配置" aria-label="Permalink to &quot;PX4 配置&quot;">​</a></h2><h3 id="mavlink-端口和转发" tabindex="-1">MAVLink 端口和转发 <a class="header-anchor" href="#mavlink-端口和转发" aria-label="Permalink to &quot;MAVLink 端口和转发&quot;">​</a></h3><p>You will need to provide a MAVLink channel to any connected cameras so that PX4 can emit any camera commands found in missions. If your MAVLink network is such that PX4 is &quot;between&quot; your camera and your ground station, you will also need to forward communications so that they can communicate.</p><p>First attach the camera to an unused serial port on your flight controller, such as <code>TELEM2</code> (you might also use an Ethernet port if present on both your flight controller and the camera). Then configure the selected port as a <a href="./../peripherals/mavlink_peripherals.html">MAVLink Peripheral</a>.</p><p>The linked document explains how, but in summary:</p><ol><li>Modify an unused <code>MAV_n_CONFIG</code> parameter, such as <a href="./../advanced_config/parameter_reference.html#MAV_2_CONFIG">MAV_2_CONFIG</a>, so that it is assigned to port to which you connected the camera/companion computer.</li><li>Set the corresponding <a href="./../advanced_config/parameter_reference.html#MAV_2_MODE">MAV_2_MODE</a> to <code>2</code> (Onboard). This ensures that the right set of MAVLink messages are emitted for a companion computer (or camera).</li><li>Set <a href="./../advanced_config/parameter_reference.html#MAV_2_FORWARD">MAV_2_FORWARD</a> to enable forwarding of communications from the port to other ports, such as the one that is connected to the ground station.</li><li>You may need to set some of the other parameters, depending on your connection type and any particular requirements of the camera on the expected baud rate, and so on.</li></ol><h3 id="手动控制" tabindex="-1">手动控制 <a class="header-anchor" href="#手动控制" aria-label="Permalink to &quot;手动控制&quot;">​</a></h3><p>Joystick buttons can be mapped to capture images, and to toggle video capture on and off.</p><ul><li><a href="./../config/joystick.html#enabling-px4-joystick-support">Joystick</a> explains how to enable Joysticks on PX4.</li><li><a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/setup_view/joystick.html" target="_blank" rel="noreferrer">QGroundControl &gt; Joystick Setup</a> explains how to map buttons to flight stack functions</li></ul><h2 id="相机管理器" tabindex="-1">相机管理器 <a class="header-anchor" href="#相机管理器" aria-label="Permalink to &quot;相机管理器&quot;">​</a></h2><p>If you want to use a camera that does not natively support the MAVLink camera protocol you will need a MAVLink camera manager. The camera manager runs on a companion computer and bridges between the MAVLink camera protocol interface and the camera&#39;s native interface.</p><p>There are &quot;extensible&quot; camera managers that can be used with many different cameras, camera managers designed to work with a specific camera, and you can also write your own (for example, using MAVSDK server plugins).</p><p>Generic/extensible camera managers:</p><ul><li><a href="https://github.com/mavlink/mavlink-camera-manager" target="_blank" rel="noreferrer">MAVLink Camera Manager</a> - Extensible cross-platform MAVLink Camera Server built on top of GStreamer and Rust-MAVLink.</li><li><a href="https://camera-manager.dronecode.org/en/" target="_blank" rel="noreferrer">Dronecode Camera Manager</a> - Adds Camera Protocol interface for cameras connected to Linux computer.</li></ul><p>Camera-specfic camera managers:</p><ul><li><p><a href="https://github.com/julianoes/siyi-a8-mini-camera-manager" target="_blank" rel="noreferrer">SIYI A8 mini camera manager</a> - MAVSDK-plugin based camera manager for the <a href="https://shop.siyi.biz/products/siyi-a8-mini" target="_blank" rel="noreferrer">SIYI A8 mini</a> (includes tutorial).</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This is a good example of how MAVSDK can be used to create a MAVLink camera protocol interface for a particular camera.</p></div></li></ul><p>:::</p><p>When using a camera manager you connect the companion computer to the flight controller (rather than directly to the camera), and you&#39;ll need additional software on the computer to route MAVLink traffic to the camera manager on the companion computer, such as <a href="https://github.com/mavlink-router/mavlink-router" target="_blank" rel="noreferrer">mavlink-router</a>.</p><p>More information about camera manager and companion computer setups can be found in:</p><ul><li><a href="https://github.com/julianoes/siyi-a8-mini-camera-manager" target="_blank" rel="noreferrer">SIYI A8 mini camera manager</a> - Tutorial for integrating with the <a href="https://shop.siyi.biz/products/siyi-a8-mini" target="_blank" rel="noreferrer">SIYI A8 mini</a> using a MAVSDK-based camera manager running on a Raspberry Pi companion computer.</li><li><a href="./../companion_computer/pixhawk_companion.html">Using a Companion Computer with Pixhawk Controllers</a></li><li><a href="./../companion_computer/#companion-computer-software">Companion Computers &gt; Companion Computer Software</a>: In particular note <a href="https://github.com/mavlink-router/mavlink-router" target="_blank" rel="noreferrer">MAVLink-Router</a>, which you can setup to route MAVLink traffic between a serial port and an IP link (or other camera manager interface).</li></ul>',47),i=[n];function s(m,c,l,h,p,d){return r(),a("div",null,i)}const f=e(o,[["render",s]]);export{_ as __pageData,f as default};
