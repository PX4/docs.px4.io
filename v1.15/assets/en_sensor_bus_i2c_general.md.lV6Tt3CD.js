import{_ as e}from"./chunks/i2c_jst-gh_cable.Cv-rGul4.js";import{_ as a}from"./chunks/tfi2cext01a_bottom.Cx6Nvi4Y.js";import{_ as s,c as i,o as r,ab as t}from"./chunks/framework.CUflZczI.js";const w=JSON.parse('{"title":"I2C Bus Peripherals","description":"","frontmatter":{},"headers":[],"relativePath":"en/sensor_bus/i2c_general.md","filePath":"en/sensor_bus/i2c_general.md"}'),o={name:"en/sensor_bus/i2c_general.md"},n=t('<h1 id="i2c-bus-peripherals" tabindex="-1">I2C Bus Peripherals <a class="header-anchor" href="#i2c-bus-peripherals" aria-label="Permalink to &quot;I2C Bus Peripherals&quot;">​</a></h1><p><a href="https://en.wikipedia.org/wiki/I2C" target="_blank" rel="noreferrer">I2C</a> is a serial communication protocol that is commonly used (at least on smaller drones), for connecting peripheral components like rangefinders, LEDs, Compass, etc.</p><p>It is recommended for:</p><ul><li>Connecting offboard components that require low bandwidth and low latency communication, e.g. <a href="./../sensor/rangefinders.html">rangefinders</a>, <a href="./../gps_compass/magnetometer.html">magnetometers</a>, <a href="./../sensor/airspeed.html">airspeed sensors</a> and <a href="./../sensor/tachometers.html">tachometers</a> .</li><li>Compatibility with peripheral devices that only support I2C.</li><li>Allowing multiple devices to attach to a single bus, which is useful for conserving ports.</li></ul><p>I2C allows multiple master devices to connect to multiple slave devices using only 2 wires per connection (SDA, SCL). in theory a bus can support 128 devices, each accessed via its unique address.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>UAVCAN would normally be preferred where higher data rates are required, and on larger vehicles where sensors are be mounted further from the flight controller.</p></div><h2 id="wiring" tabindex="-1">Wiring <a class="header-anchor" href="#wiring" aria-label="Permalink to &quot;Wiring&quot;">​</a></h2><p>I2C uses a pair of wires: SDA (serial data) and SCL (serial clock). The bus is of open-drain type, meaning that devices ground the data line. It uses a pullup resistor to push it to <code>log.1</code> (idle state) - every wire has it usually located on the bus terminating devices. One bus can connect to multiple I2C devices. The individual devices are connected without any crossing.</p><p>For connection (according to dronecode standard) 4-wire cables equipped with JST-GH connectors are used. To ensure reliable communication and to reduce crosstalk it is advised to apply recommendations concerning <a href="./../assembly/cable_wiring.html#i2c-cables">cable twisting</a> and pullup resistors placement.</p><p><img src="'+e+'" alt="Cable twisting"></p><h2 id="checking-the-bus-and-device-status" tabindex="-1">Checking the Bus and Device Status <a class="header-anchor" href="#checking-the-bus-and-device-status" aria-label="Permalink to &quot;Checking the Bus and Device Status&quot;">​</a></h2><p>A useful tool for bus analysis is <a href="./../modules/modules_command.html#i2cdetect">i2cdetect</a>. This lists available I2C devices by their addresses. It can be used to find out if a device on the bus is available and if the autopilot can communicate with it.</p><p>The tool can be run in the PX4 terminal with the following command:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>i2cdetect -b 1</span></span></code></pre></div><p>where the bus number is specified after <code>-b</code> parameter</p><h2 id="common-problems" tabindex="-1">Common problems <a class="header-anchor" href="#common-problems" aria-label="Permalink to &quot;Common problems&quot;">​</a></h2><h3 id="address-clashes" tabindex="-1">Address Clashes <a class="header-anchor" href="#address-clashes" aria-label="Permalink to &quot;Address Clashes&quot;">​</a></h3><p>If two I2C devices on a bus have the same ID there will be a clash, and neither device will not work properly (or at all). This usually occurs because a user needs to attach two sensors of the same type to the bus, but may also happen if devices use duplicate addresses by default.</p><p>Particular I2C devices may allow you to select a new address for one of the devices to avoid the clash. Some devices do not support this option, or do not have broad options for the addresses that can be used (i.e. cannot be used to avoid a clash).</p><p>If you can&#39;t change the addresses, one option is to use an <a href="#i2c-address-translators">I2C Address Translator</a>.</p><h3 id="insufficient-transfer-capacity" tabindex="-1">Insufficient Transfer Capacity <a class="header-anchor" href="#insufficient-transfer-capacity" aria-label="Permalink to &quot;Insufficient Transfer Capacity&quot;">​</a></h3><p>The bandwidth available for each individual device generally decreases as more devices are added. The exact decrease depends on the bandwidth used by each individual device. Therefore it is possible to connect many low bandwidth devices, like <a href="./../sensor/tachometers.html">tachometers</a>. If too many devices are added, it can cause transmission errors and network unreliability.</p><p>There are several ways to reduce the problem:</p><ul><li>Dividing the devices into groups, each with approximately the same number of devices and connecting each group to one autopilot port</li><li>Increase bus speed limit (usually set to 100kHz for external I2C bus)</li></ul><h3 id="excessive-wiring-capacitance" tabindex="-1">Excessive Wiring Capacitance <a class="header-anchor" href="#excessive-wiring-capacitance" aria-label="Permalink to &quot;Excessive Wiring Capacitance&quot;">​</a></h3><p>The electrical capacity of bus wiring increases as more devices/wires are added. The exact decrease depends on total length of bus wiring and wiring specific capacitance. The problem can be analyzed using an oscilloscope, where we see that the edges of SDA/SCL signals are no longer sharp.</p><p>There are several ways to reduce the problem:</p><ul><li>Dividing the devices into groups, each with approximately the same number of devices and connecting each group to one autopilot port</li><li>Using the shortest and the highest quality I2C cables possible</li><li>Separating the devices with a weak open-drain driver to smaller bus with lower capacitance</li><li><a href="#i2c-bus-accelerators">I2C Bus Accelerators</a></li></ul><h2 id="i2c-bus-accelerators" tabindex="-1">I2C Bus Accelerators <a class="header-anchor" href="#i2c-bus-accelerators" aria-label="Permalink to &quot;I2C Bus Accelerators&quot;">​</a></h2><p>I2C bus accelerators are separate circuits that can be used to support longer wiring length on an I2C bus. They work by physically dividing an I2C network into 2 parts and using their own transistors to amplify I2C signals.</p><p>Available accelerators include:</p><ul><li><a href="https://github.com/ThunderFly-aerospace/TFI2CEXT01" target="_blank" rel="noreferrer">Thunderfly TFI2CEXT01</a>: <img src="'+a+'" alt="I2C bus extender"><ul><li>This has Dronecode connectors and is hence very easy to add to a Pixhawk I2C setup.</li><li>The module has no settings (it works out of the box).</li></ul></li></ul><h2 id="i2c-address-translators" tabindex="-1">I2C Address Translators <a class="header-anchor" href="#i2c-address-translators" aria-label="Permalink to &quot;I2C Address Translators&quot;">​</a></h2><p>I2C Address Translators can be used to prevent I2C address clashes in systems where there is no other way to assign unique addresses. The work by listening for I2C communication and transforming the address when a slave device is called (according to a preset algorithm).</p><p>Supported I2C Address Translators include:</p><ul><li><a href="./../sensor_bus/translator_tfi2cadt.html">Thunderfly TFI2CADT01</a></li></ul><h2 id="i2c-development" tabindex="-1">I2C Development <a class="header-anchor" href="#i2c-development" aria-label="Permalink to &quot;I2C Development&quot;">​</a></h2><p>Software development for I2C devices is described in <a href="./../sensor_bus/i2c_development.html">I2C Bus (Development Overview)</a>.</p><h2 id="further-information" tabindex="-1">Further Information <a class="header-anchor" href="#further-information" aria-label="Permalink to &quot;Further Information&quot;">​</a></h2><ul><li><a href="https://en.wikipedia.org/wiki/I%C2%B2C" target="_blank" rel="noreferrer">I2C</a> (Wikipedia)</li><li><a href="https://learn.sparkfun.com/tutorials/i2c" target="_blank" rel="noreferrer">I2C Comparative Overview</a> (learn.sparkfun.com)</li><li><a href="./../middleware/drivers.html">Driver Framework</a></li></ul>',40),l=[n];function c(d,h,p,u,m,b){return r(),i("div",null,l)}const C=s(o,[["render",c]]);export{w as __pageData,C as default};
