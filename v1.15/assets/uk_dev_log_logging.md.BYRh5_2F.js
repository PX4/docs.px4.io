import{_ as s}from"./chunks/qgc-log-streaming.DWyyikx0.js";import{_ as a,c as t,o as i,ab as e}from"./chunks/framework.CUflZczI.js";const m=JSON.parse('{"title":"Журналювання","description":"","frontmatter":{},"headers":[],"relativePath":"uk/dev_log/logging.md","filePath":"uk/dev_log/logging.md"}'),n={name:"uk/dev_log/logging.md"},l=e(`<h1 id="журналювання" tabindex="-1">Журналювання <a class="header-anchor" href="#журналювання" aria-label="Permalink to &quot;Журналювання&quot;">​</a></h1><p>Системний <a href="./../modules/modules_system.html#logger">журналізатор</a> може реєструвати будь-яку тему ORB з усіма включеними полями. Все необхідне генерується з файлу <code>.msg</code>, тому потрібно вказати лише назву теми. Необов&#39;язковий параметр інтервалу визначає максимальну швидкість ведення журналу певної теми. Усі існуючі екземпляри теми реєструються.</p><p>Формат виведення журналу - <a href="./../dev_log/ulog_file_format.html">ULog</a>.</p><h2 id="використання" tabindex="-1">Використання <a class="header-anchor" href="#використання" aria-label="Permalink to &quot;Використання&quot;">​</a></h2><p>За замовчуванням, реєстрація автоматично починається при взбиранні на охорону, і зупиняється при знятті з охорони. Для кожної сесії готовності на SD-картці створюється новий файл журналу. Для відображення поточного стану використовуйте <code>logger status</code> на консолі. Якщо ви хочете почати реєструвати негайно, використовуйте <code>logger on</code>. Це скасовує стан готовності, якщо система була увімкнена. <code>вимкнути логування</code> скасовує це.</p><p>Якщо реєстрація припиниться через помилку запису або досягнення <a href="#file-size-limitations">максимального розміру файлу</a>, PX4 автоматично перезапустить реєстрацію в новому файлі.</p><p>Для отримання списку всіх підтримуваних команд та параметрів реєстратора використовуйте:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>logger help</span></span></code></pre></div><h2 id="налаштування" tabindex="-1">Налаштування <a class="header-anchor" href="#налаштування" aria-label="Permalink to &quot;Налаштування&quot;">​</a></h2><p>За замовчуванням систему логування налаштовано на збір значущих записів для <a href="./../getting_started/flight_reporting.html">звітування про польоти</a> з <a href="http://logs.px4.io" target="_blank" rel="noreferrer">Flight Review</a>.</p><p>Логування може бути подальшо налаштоване за допомогою параметрів <a href="./../advanced_config/parameter_reference.html#sd-logging">SD Logging</a>. Параметри, які ви найімовірніше зміните, перераховані нижче.</p><table><thead><tr><th>Параметр</th><th>Опис</th></tr></thead><tbody><tr><td><a href="./../advanced_config/parameter_reference.html#SDLOG_MODE">РЕЖИМ SDLOG</a></td><td>Журналювання. Визначає, коли починається та закінчується ведення журналу.<br>- <code>-1</code>: Ведення журналу вимкнено.<br>- <code>0</code>: Записувати від увімкнення до вимкнення (типово).<br>- <code>1</code>: Записувати з моменту завантаження до вимкнення.<br>- <code>2</code>: Записувати з моменту завантаження до вимкнення живлення.<br>- <code>3</code>: Записувати на основі каналу дистанційного керування AUX1.<br>- <code>4</code>: Записувати з першого увімкнення до вимкнення живлення.</td></tr><tr><td><a href="./../advanced_config/parameter_reference.html#SDLOG_PROFILE">SDLOG_PROFILE</a></td><td>Профіль ведення журналу. Використовуйте це для увімкнення менш поширеного ведення журналу/аналізу (наприклад, для відтворення EKF2, ведення журналу високої швидкості для налаштування PID та фільтрів, калібрування температури термічної калібрування).</td></tr><tr><td><a href="./../advanced_config/parameter_reference.html#SDLOG_MISSION">SDLOG_MISSION</a></td><td>Створіть дуже малий додатковий &quot;Журнал місії&quot;.<br>Цей журнал <em>не</em> може бути використаний з <a href="./../log/flight_log_analysis.html#flight-review-online-tool">Flight Review</a>, але корисний, коли вам потрібен невеликий журнал для геотегування або дотримання регулятивних вимог.</td></tr></tbody></table><p>Корисні налаштування для конкретних випадків:</p><ul><li>Сирові дані датчика для порівняння: <a href="./../advanced_config/parameter_reference.html#SDLOG_MODE">SDLOG_MODE=1</a> та <a href="./../advanced_config/parameter_reference.html#SDLOG_PROFILE">SDLOG_PROFILE=64</a>.</li><li>Вимкнення ведення журналу повністю: <a href="./../advanced_config/parameter_reference.html#SDLOG_MODE">SDLOG_MODE=<code>-1</code></a></li></ul><h3 id="модуль-реєстраціі" tabindex="-1">Модуль реєстрації <a class="header-anchor" href="#модуль-реєстраціі" aria-label="Permalink to &quot;Модуль реєстрації&quot;">​</a></h3><p><em>Розробники</em> можуть додатково налаштувати, яка інформація реєструється за допомогою модуля <a href="./../modules/modules_system.html#logger">реєстратора</a>. Це дозволяє, наприклад, реєструвати ваші власні теми uORB.</p><h3 id="конфігурація-sd-карти" tabindex="-1">Конфігурація SD-карти <a class="header-anchor" href="#конфігурація-sd-карти" aria-label="Permalink to &quot;Конфігурація SD-карти&quot;">​</a></h3><p>Окремо, список зареєстрованих тем також може бути налаштований за допомогою файлу на картці SD. Створіть файл <code>etc/logging/logger_topics.txt</code> на картці зі списком тем (для SITL це <code>build/px4_sitl_default/rootfs/fs/microsd/etc/logging/logger_topics.txt</code>):</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span></span></span></code></pre></div><p><code>&lt;interval&gt;</code> є необов&#39;язковим, і якщо вказано, визначає мінімальний інтервал у мс між двома зареєстрованими повідомленнями цієї теми. Якщо не вказано, тема реєструється з повною швидкістю.</p><p><code>&lt;instance&gt;</code> є необов&#39;язковим, і якщо вказано, визначає екземпляр для журналювання. Якщо не вказано, всі екземпляри теми реєструються. Для вказівки <code>&lt;instance&gt;</code>, необхідно вказати <code>&lt;interval&gt;</code> . Може бути встановлено на 0 для реєстрації з повною швидкістю</p><p>Теми в цьому файлі замінюють всі теми за замовчуванням, які були зареєстровані.</p><p>Приклади :</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sensor_accel 0 0</span></span>
<span class="line"><span>sensor_accel 100 1</span></span>
<span class="line"><span>sensor_gyro 200</span></span>
<span class="line"><span>sensor_mag 200 1</span></span></code></pre></div><p>Ця конфігурація буде реєструвати sensor_accel 0 з повною швидкістю, sensor_accel 1 з частотою 10 Гц, всі екземпляри sensor_gyro з частотою 5 Гц та sensor_mag 1 з частотою 5 Гц.</p><h2 id="скрипти" tabindex="-1">Скрипти <a class="header-anchor" href="#скрипти" aria-label="Permalink to &quot;Скрипти&quot;">​</a></h2><p>Є кілька сценаріїв для аналізу та конвертації файлів журналювання в репозиторії <a href="https://github.com/PX4/pyulog" target="_blank" rel="noreferrer">pyulog</a>.</p><h2 id="обмеження-розміру-фаилу" tabindex="-1">Обмеження розміру файлу <a class="header-anchor" href="#обмеження-розміру-фаилу" aria-label="Permalink to &quot;Обмеження розміру файлу&quot;">​</a></h2><p>Максимальний розмір файлу залежить від файлової системи та ОС. Розмір обмеження на NuttX наразі становить близько 2 ГБ.</p><h2 id="відключення" tabindex="-1">Відключення <a class="header-anchor" href="#відключення" aria-label="Permalink to &quot;Відключення&quot;">​</a></h2><p>Втрати логування небажані, і є кілька факторів, що впливають на кількість втрат:</p><ul><li>Більшість SD-карт, які ми тестували, проявляють кілька пауз кожну хвилину. Це проявляється як кілька 100 мс затримка під час команди запису. Це призводить до відключення, якщо буфер запису заповнюється протягом цього часу. Цей ефект залежить від SD-карти (див. нижче).</li><li>Форматування SD-карти може допомогти у запобіганні викидань.</li><li>Збільшення буфера журналу допомагає.</li><li>Зменшіть частоту реєстрації обраних тем або видаліть непотрібні теми з реєстрації (<code>info.py &lt;file&gt;</code> корисний для цього).</li></ul><h2 id="sd-карти" tabindex="-1">SD-карти <a class="header-anchor" href="#sd-карти" aria-label="Permalink to &quot;SD-карти&quot;">​</a></h2><p>Максимальний підтримуваний розмір SD-карти для NuttX - 32 ГБ (Специфікація карт пам’яті SD, версія 2.0). <strong>SanDisk Extreme U3 32GB</strong> та <strong>Samsung EVO Plus 32</strong> відомі як надійні карти (не проявляють піков запису часу, тому практично відсутні відмови).</p><p>Таблиця нижче показує <strong>середню послідовну швидкість запису [KB/s]</strong> / <strong>максимальний час запису на блок (середній) [мс]</strong> для контролерів польоту на основі F4- (Pixracer), F7- та H7-.</p><table><thead><tr><th>SD-карта</th><th>F4</th><th>F7</th><th>H7</th></tr></thead><tbody><tr><td>SanDisk Extreme U3 32GB</td><td>1500 / <strong>15</strong></td><td>1800/10</td><td>2900/8</td></tr><tr><td>Samsung EVO Plus 32GB</td><td>1700/10-60</td><td>1800/10-60</td><td>1900/9-60</td></tr><tr><td>Sandisk Ultra Class 10 8GB</td><td>348 / 40</td><td>?/?</td><td>?/?</td></tr><tr><td>Sandisk Class 4 8GB</td><td>212 / 60</td><td>?/?</td><td>?/?</td></tr><tr><td>SanDisk Class 10 32 GB (High Endurance Video Monitoring Card)</td><td>331 / 220</td><td>?/?</td><td>?/?</td></tr><tr><td>Lexar U1 (Class 10), 16GB High-Performance</td><td>209 / 150</td><td>?/?</td><td>?/?</td></tr><tr><td>Sandisk Ultra PLUS Class 10 16GB</td><td>196 /500</td><td>?/?</td><td>?/?</td></tr><tr><td>Sandisk Pixtor Class 10 16GB</td><td>334 / 250</td><td>?/?</td><td>?/?</td></tr><tr><td>Sandisk Extreme PLUS Class 10 32GB</td><td>332 / 150</td><td>?/?</td><td>?/?</td></tr></tbody></table><p>Запис пропускної здатності зі стандартними темами становить близько 50 КБ/с, що задовольняє майже всі SD-карти у термінах їх середньої послідовної швидкості запису.</p><p>Важливішим, ніж середня швидкість запису, є піки (або взагалі високі значення) максимального часу запису на блок (4 КБ) або часи <code>fsync</code>, оскільки довгий час запису означає, що потрібен більший буфер журналу, щоб уникнути втрат даних.</p><p>PX4 використовує більші буфери на F7/H7 та кешування читання, що достатньо компенсує піки на багатьох поганих картках. З цим сказано, якщо ваша картка має <code>fsync</code> або тривалість запису декілька 100 мс, вона не повинна бути вибрана для використання з PX4. Ви можете перевірити значення, запустивши <a href="./../modules/modules_command.html#sd-bench">sd_bench</a> слід запустити з більшою кількістю ітерацій (близько 100 має вистачити).</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sd_bench</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span></code></pre></div><p>Це визначає мінімальний розмір буфера: чим більше це максимальне значення, тим більше потрібно мати розмір буфера журналу, щоб уникнути втрат даних. PX4 використовує більші буфери на F7/H7 та кешування читання, щоб компенсувати деякі з цих проблем.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Якщо у вас є питання щодо певної картки, ви можете запустити вищезазначений тест та повідомити результати за посиланням <a href="https://github.com/PX4/PX4-Autopilot/issues/4634" target="_blank" rel="noreferrer">https://github.com/PX4/PX4-Autopilot/issues/4634</a>.</p></div><h2 id="потокове-ведення-журналу" tabindex="-1">Потокове ведення журналу <a class="header-anchor" href="#потокове-ведення-журналу" aria-label="Permalink to &quot;Потокове ведення журналу&quot;">​</a></h2><p>Традиційний і все ще повністю підтримуваний спосіб ведення журналу - використання SD-карти на FMU. Однак є альтернатива, потокове ведення журналу, яке надсилає ті ж дані журналювання через MAVLink. Цей метод може бути використаний, наприклад, у випадках, коли FMU не має слоту для SD-карти (наприклад, Intel® Aero Ready to Fly Drone) або просто для уникнення проблем з SD-картами. Обидва методи можуть бути використані незалежно один від одного і одночасно.</p><p>Вимога полягає в тому, що посилання забезпечує принаймні ~50KB/s, наприклад, WiFi-посилання. І тільки один клієнт може запитати потік журналування одночасно. Підключення не потребує надійності, протокол розроблений для обробки втрат.</p><p>Існують різні клієнти, які підтримують потокову передачу ulog:</p><ul><li><code>mavlink_ulog_streaming.py</code> скрипт PX4-Autopilot/Tools.</li><li>QGroundControl: <img src="`+s+`" alt="Стрічка журналу QGC"></li><li><a href="https://github.com/ecmnet/MAVGCL" target="_blank" rel="noreferrer">MAVGCL</a></li></ul><h3 id="діагностика" tabindex="-1">Діагностика <a class="header-anchor" href="#діагностика" aria-label="Permalink to &quot;Діагностика&quot;">​</a></h3><ul><li><p>Якщо потік журналування не починається, переконайтеся, що <code>logger</code> працює (див. вище), та перевірте вивід консолі під час запуску.</p></li><li><p>Якщо це все ще не працює, переконайтеся, що використовується MAVLink 2. Застосуйте це, встановивши <code>MAV_PROTO_VER</code> на 2.</p></li><li><p>Потік реєстрації використовує максимум 70% налаштованої швидкості MAVLink (<code>-r</code> параметр). Якщо потрібно більше, повідомлення видаляються. Поточний використаний відсоток можна перевірити за допомогою <code>mavlink status</code> (у цьому прикладі використано 1,8%):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">instance</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #0:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        GCS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> heartbeat:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  160955</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> us</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ago</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        mavlink</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chan:</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:           </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GENERIC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LINK</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> RADIO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        flow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> control:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   OFF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        rates:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        tx:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 95.781</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kB/s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        txerr:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kB/s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        rx:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.021</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kB/s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mult:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ULog</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1.8%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 70.0%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        accepting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commands:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> YES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        MAVLink</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        transport</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UDP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (14556)</span></span></code></pre></div><p>Також переконайтеся, що <code>txerr</code> залишається на 0. Якщо це піде вгору, або буфер відправлення NuttX занадто малий, або фізичний зв&#39;язок насичений, або апаратне забезпечення занадто повільне для обробки даних.</p></li></ul>`,49),d=[l];function h(r,p,o,c,k,g){return i(),t("div",null,d)}const _=a(n,[["render",h]]);export{m as __pageData,_ as default};
