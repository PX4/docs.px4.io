import{_ as e,a as t,b as i,c as a,d as s,e as o,f as n}from"./chunks/linkselection.DZg_8gfH.js";import{_ as l,c as r,o as h,ab as c}from"./chunks/framework.CUflZczI.js";const w=JSON.parse('{"title":"Iridium/RockBlock Satellite Communication System","description":"","frontmatter":{},"headers":[],"relativePath":"en/advanced_features/satcom_roadblock.md","filePath":"en/advanced_features/satcom_roadblock.md"}'),p={name:"en/advanced_features/satcom_roadblock.md"},d=c('<h1 id="iridium-rockblock-satellite-communication-system" tabindex="-1">Iridium/RockBlock Satellite Communication System <a class="header-anchor" href="#iridium-rockblock-satellite-communication-system" aria-label="Permalink to &quot;Iridium/RockBlock Satellite Communication System&quot;">​</a></h1><p>A satellite communication system can be used to provide long range high latency link between a ground station and a vehicle.</p><p>This topic describes how to set up a system that uses RockBlock as the service provider for the Iridium SBD Satellite Communication System. Given good signal quality, users can expect a latency between 10 to 15 seconds.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The following components are needed for the satellite communication link:</p><ul><li>A <a href="https://www.iridium.com/products/rock-seven-rockblock-9603/" target="_blank" rel="noreferrer">RockBlock 9603 Iridium Satellite Modem</a> module connected to a Pixhawk flashed with the PX4 Autopilot.</li><li>A message relay server running Ubuntu Linux.</li><li>A ground station computer running <em>QGroundControl</em> on Ubuntu Linux</li></ul><p>The full system architecture is shown below:</p><p><img src="'+e+'" alt="Architecture"></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The setup was tested with the current release of <em>QGroundControl</em> running on Ubuntu 14.04 and 16.04.</p><ul><li>It may be possible to run the system on other ground stations and operating systems, but this has not been tested (and is not guaranteed to work).</li><li>The <a href="https://www.groundcontrol.com/us/product/rockblock-9602-satellite-modem/" target="_blank" rel="noreferrer">RockBlock MK2</a> module can also be used. The RockBlock 9603 module is recommended because it is smaller and lighter, while providing the same functionality.</li></ul></div><h2 id="costs" tabindex="-1">Costs <a class="header-anchor" href="#costs" aria-label="Permalink to &quot;Costs&quot;">​</a></h2><p>The UK link running cost consists of a line rental and per message cost:</p><ul><li>Each module needs to be activated which costs £10.00 per month</li><li>Each message transmitted over the system costs one <em>credit</em> per 50 bytes. Bundles of credits can be bought from RockBlock for £0.04-£0.11 per credit, depending on the bundle size.</li></ul><p>Refer to the <a href="https://docs.rockblock.rock7.com/docs" target="_blank" rel="noreferrer">RockBlock Documentation</a> for a detailed explanation of the modules, running costs and <em>RockBlock</em> in general.</p><h2 id="vehicle-setup" tabindex="-1">Vehicle Setup <a class="header-anchor" href="#vehicle-setup" aria-label="Permalink to &quot;Vehicle Setup&quot;">​</a></h2><h3 id="wiring" tabindex="-1">Wiring <a class="header-anchor" href="#wiring" aria-label="Permalink to &quot;Wiring&quot;">​</a></h3><p>Connect the RockBlock module to a serial port of the Pixhawk. Due to the power requirements of the module it can only be powered over a high-power serial port as a maximum of 0.5 A at 5 V are required. If none is available/free then another power source which has the same ground level as the Pixhawk and can provide required power has to be setup. The details of the <a href="https://docs.rockblock.rock7.com/docs/connectors" target="_blank" rel="noreferrer">connectors</a> and the <a href="https://docs.rockblock.rock7.com/docs/power-supply" target="_blank" rel="noreferrer">power requirements</a> can be found in the RockBlock documentation.</p><h3 id="module" tabindex="-1">Module <a class="header-anchor" href="#module" aria-label="Permalink to &quot;Module&quot;">​</a></h3><p>The module can either use the internal antenna or an external one connected to the SMA connector. To <a href="https://docs.rockblock.rock7.com/docs/switching-rockblock-9603-antenna-mode" target="_blank" rel="noreferrer">switch between the two antennas modes</a> the position of a small RF link cable needs to changed. If an external antenna is used always make sure that the antenna is connected to the module before powering it up to avoid damage to the module.</p><p>The default baud rate of the module is 19200. However, the PX4 <em>iridiumsbd</em> driver requires a baud rate of 115200 so it needs to be changed using the <a href="https://www.groundcontrol.com/en/wp-content/uploads/2022/02/IRDM_ISU_ATCommandReferenceMAN0009_Rev2.0_ATCOMM_Oct2012.pdf" target="_blank" rel="noreferrer">AT commands</a>.</p><ol><li><p>Connect to the module with using a 19200/8-N-1 setting and check if the communication is working using the command: <code>AT</code>. The response should be: <code>OK</code>.</p></li><li><p>Change the baud rate:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>AT+IPR=9</span></span></code></pre></div></li><li><p>Reconnect to the model now with a 115200/8-N-1 setting and save the configuration using:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>AT&amp;W0</span></span></code></pre></div></li></ol><p>The module is now ready to be used with PX4.</p><h3 id="software" tabindex="-1">Software <a class="header-anchor" href="#software" aria-label="Permalink to &quot;Software&quot;">​</a></h3><p><a href="./../peripherals/serial_configuration.html">Configure the serial port</a> on which the RockBlock module will run using <a href="./../advanced_config/parameter_reference.html#ISBD_CONFIG">ISBD_CONFIG</a>. There is no need to set the baud rate for the port, as this is configured by the driver.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>If the configuration parameter is not available in <em>QGroundControl</em> then you may need to <a href="./../peripherals/serial_configuration.html#parameter_not_in_firmware">add the driver to the firmware</a>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>drivers/telemetry/iridiumsbd</span></span></code></pre></div></div><h2 id="rockblock-setup" tabindex="-1">RockBlock Setup <a class="header-anchor" href="#rockblock-setup" aria-label="Permalink to &quot;RockBlock Setup&quot;">​</a></h2><p>When buying the first module on RockBlock an user account needs to be created in a first step.</p><p>Log in to the <a href="https://rockblock.rock7.com/Operations" target="_blank" rel="noreferrer">account</a> and register the RockBlock module under the <code>My RockBLOCKs</code>. Activate the line rental for the module and make sure that enough credits for the expected flight duration are available on the account. When using the default settings one message per minute is sent from the vehicle to the ground station.</p><p>Set up a delivery group for the message relay server and add the module to that delivery group:</p><p><img src="'+t+`" alt="Delivery Groups"></p><h2 id="relay-server-setup" tabindex="-1">Relay Server Setup <a class="header-anchor" href="#relay-server-setup" aria-label="Permalink to &quot;Relay Server Setup&quot;">​</a></h2><p>The relay server should be run on either Ubuntu 16.04 or 14.04 OS.</p><ol><li><p>The server working as a message relay should have a static IP address and two publicly accessible, open, TCP ports:</p><ul><li><code>5672</code> for the <em>RabbitMQ</em> message broker (can be changed in the <em>rabbitmq</em> settings)</li><li><code>45679</code> for the HTTP POST interface (can be changed in the <strong>relay.cfg</strong> file)</li></ul></li><li><p>Install the required python modules:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pika</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tornado</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> future</span></span></code></pre></div></li><li><p>Install the <code>rabbitmq</code> message broker:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rabbitmq-server</span></span></code></pre></div></li><li><p>Configure the broker&#39;s credentials (change PWD to your preferred password):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rabbitmqctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iridiumsbd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PWD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rabbitmqctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set_permissions</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iridiumsbd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.*&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.*&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.*&quot;</span></span></code></pre></div></li><li><p>Clone the <a href="https://github.com/acfloria/SatComInfrastructure.git" target="_blank" rel="noreferrer">SatComInfrastructure</a> repository:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/acfloria/SatComInfrastructure.git</span></span></code></pre></div></li><li><p>Go to the location of the <em>SatComInfrastructure</em> repo and configure the broker&#39;s queues:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./setup_rabbit.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iridiumsbd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PWD</span></span></code></pre></div></li><li><p>Verify the setup:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rabbitmqctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list_queues</span></span></code></pre></div><p>This should give you a list of 4 queues: <code>MO</code>, <code>MO_LOG</code>, <code>MT</code>, <code>MT_LOG</code></p></li><li><p>Edit the <code>relay.cfg</code> configuration file to reflect your settings.</p></li><li><p>Start the relay script in the detached mode:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">screen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;cd SatcomInfrastructure/; ./relay.py</span></span></code></pre></div></li></ol><p>Other instructions include:</p><ul><li><p>Detach from the screen:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ctrl+a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> d</span></span></code></pre></div></li><li><p>Kill execution of the script:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ctrl+a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :quit</span></span></code></pre></div></li><li><p>Reattach to the screen:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">screen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dr</span></span></code></pre></div></li></ul><h2 id="ground-station-computer" tabindex="-1">Ground Station Computer <a class="header-anchor" href="#ground-station-computer" aria-label="Permalink to &quot;Ground Station Computer&quot;">​</a></h2><p>To setup the ground station:</p><ol><li><p>Install the required python modules:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pika</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tornado</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> future</span></span></code></pre></div></li><li><p>Clone the SatComInfrastructure repository:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/acfloria/SatComInfrastructure.git</span></span></code></pre></div></li><li><p>Edit the <strong>udp2rabbit.cfg</strong> configuration file to reflect your settings.</p></li><li><p><a href="https://docs.qgroundcontrol.com/master/en/qgc-user-guide/getting_started/download_and_install.html" target="_blank" rel="noreferrer">Install <em>QGroundControl</em></a> (daily build).</p></li><li><p>Add a UDP connection in QGC with the parameters:</p><ul><li>Listening port: 10000</li><li>Target hosts: 127.0.0.1:10001</li><li>High Latency: checked</li></ul><p><img src="`+i+'" alt="High Latency Link Settings"></p></li></ol><h3 id="verification" tabindex="-1">Verification <a class="header-anchor" href="#verification" aria-label="Permalink to &quot;Verification&quot;">​</a></h3><ol><li><p>Open a terminal on the ground station computer and change to the location of the <em>SatComInfrastructure</em> repository. Then start the <strong>udp2rabbit.py</strong> script:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./udp2rabbit.py</span></span></code></pre></div></li><li><p>Send a test message from <a href="https://rockblock.rock7.com/Operations" target="_blank" rel="noreferrer">RockBlock Account</a> to the created delivery group in the <code>Test Delivery Groups</code> tab.</p></li></ol><p>If in the terminal where the <code>udp2rabbit.py</code> script is running within a couple of seconds the acknowledge for a message can be observed, then the RockBlock delivery group, the relay server and the udp2rabbit script are set up correctly:</p><p><img src="'+a+'" alt="udp2rabbit message acknowledge"></p><h2 id="running-the-system" tabindex="-1">Running the System <a class="header-anchor" href="#running-the-system" aria-label="Permalink to &quot;Running the System&quot;">​</a></h2><ol><li><p>Start <em>QGroundControl</em>. Manually connect the high latency link first, then the regular telemetry link:</p><p><img src="'+s+'" alt="Connect the High Latency link"></p></li><li><p>Open a terminal on the ground station computer and change to the location of the <em>SatComInfrastructure</em> repository. Then start the <strong>udp2rabbit.py</strong> script:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./udp2rabbit.py</span></span></code></pre></div></li><li><p>Power up the vehicle.</p></li><li><p>Wait until the first <code>HIGH_LATENCY2</code> message is received on QGC. This can be checked either using the <em>MAVLink Inspector</em> widget or on the toolbar with the <em>LinkIndicator</em>. If more than one link is connected to the active vehicle the <em>LinkIndicator</em> shows all of them by clicking on the name of the shown link:</p><p><img src="'+o+'" alt="Link Toolbar"></p><p>The link indicator always shows the name of the priority link.</p></li><li><p>The satellite communication system is now ready to use. The priority link, which is the link over which commands are send, is determined the following ways:</p><ul><li><p>If no link is commanded by the user a regular radio telemetry link is preferred over the high latency link.</p></li><li><p>The autopilot and QGC will fall back from the regular radio telemetry to the high latency link if the vehicle is armed and the radio telemetry link is lost (no MAVLink messages received for a certain time). As soon as the radio telemetry link is regained QGC and the autopilot will switch back to it.</p></li><li><p>The user can select a priority link over the <code>LinkIndicator</code> on the toolbar. This link is kept as the priority link as long as this link is active or the user selects another priority link:</p><p><img src="'+n+'" alt="Prioritylink Selection"></p></li></ul></li></ol><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><ul><li><p>Satellite communication messages from the airplane are received but no commands can be transmitted (the vehicle does not react)</p><ul><li>Check the settings of the relay server and make sure that they are correct, especially the IMEI.</li></ul></li><li><p>No satellite communication messages from the airplane arrive on the ground station:</p><ul><li><p>Check using the system console if the <em>iridiumsbd</em> driver started and if it did that a signal from any satellite is received by the module:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iridiumsbd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span></code></pre></div></li><li><p>Make sure using the verification steps from above that the relay server, the delivery group and the <code>udp2rabbit.py</code> script are set up correctly.</p></li><li><p>Check if the link is connected and that its settings are correct.</p></li></ul></li><li><p>The IridiumSBD driver does not start:</p><ul><li>Reboot the vehicle. If that helps increase the sleep time in the <code>extras.txt</code> before the driver is started. If that does not help make sure that the Pixhawk and the module have the same ground level. Confirm also that the baudrate of the module is set to 115200.</li></ul></li><li><p>A first message is received on the ground but as soon as the vehicle is flying no message can be transmitted or the latency is significantly larger (in the order of minutes)</p><ul><li>Check the signal quality after the flight. If it is decreasing during the flight and you are using the internal antenna consider using an external antenna. If you are already using the external antenna try moving the antenna as far away as possible from any electronics or anything which might disturb the signal. Also make sure that the antenna is not damaged.</li></ul></li></ul>',45),u=[d];function k(g,m,b,y,f,v){return h(),r("div",null,u)}const _=l(p,[["render",k]]);export{w as __pageData,_ as default};
