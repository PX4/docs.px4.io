import{_ as p}from"./chunks/architecture_xrce-dds_ros2.5IQPlBJ0.js";import{_ as k}from"./chunks/ref_frames.C52lwBbQ.js";import{_ as r,E as e,c as d,m as s,J as a,w as t,ab as n,a as i,o}from"./chunks/framework.CUflZczI.js";const as=JSON.parse('{"title":"ROS 2 Посібник користувача","description":"","frontmatter":{},"headers":[],"relativePath":"uk/ros2/user_guide.md","filePath":"uk/ros2/user_guide.md"}'),c={name:"uk/ros2/user_guide.md"},g=n('<h1 id="ros-2-посібник-користувача" tabindex="-1">ROS 2 Посібник користувача <a class="header-anchor" href="#ros-2-посібник-користувача" aria-label="Permalink to &quot;ROS 2 Посібник користувача&quot;">​</a></h1><p>Архітектура ROS 2-PX4 забезпечує глибоку інтеграцію між ROS 2 і PX4, дозволяючи підписникам ROS 2 або вузлам видавців безпосередньо взаємодіяти з темами uORB PX4.</p><p>Ця тема містить огляд архітектури та пайплайну додатків, а також пояснює, як налаштувати та використовувати ROS 2 з PX4.</p><div class="info custom-block"><p class="custom-block-title">Починаючи з PX4 v1.14, ROS 2 використовує проміжне програмне забезпечення <a href="./../middleware/uxrce_dds.html">uXRCE-DDS</a>, яке замінило проміжне програмне забезпечення <em>FastRTPS</em>, що використовувалося у версії 1.13 (версія 1.13 не підтримує uXRCE-DDS).</p><p>У <a href="./../middleware/uxrce_dds.html#fast-rtps-to-uxrce-dds-migration-guidelines">посібнику з міграції</a> пояснюється, що потрібно зробити, щоб перенести програми ROS 2 з PX4 v1.13 на PX4 v1.14.</p><p>Якщо ви досі працюєте на PX4 v1.13, дотримуйтесь інструкцій в <a href="https://docs.px4.io/v1.13/en/ros/ros2_comm.html" target="_blank" rel="noreferrer">PX4 v1.13 Docs</a>.</p></div><h2 id="загальнии-огляд" tabindex="-1">Загальний огляд <a class="header-anchor" href="#загальнии-огляд" aria-label="Permalink to &quot;Загальний огляд&quot;">​</a></h2><p>Пайплайн додатків для ROS 2 дуже простий завдяки використанню комунікаційного проміжного програмного забезпечення <a href="./../middleware/uxrce_dds.html">uXRCE-DDS</a>.</p><p><img src="'+p+`" alt="Architecture uXRCE-DDS with ROS 2"></p><p>Проміжне програмне забезпечення uXRCE-DDS складається з клієнта, що працює на PX4, і агента, що працює на комп&#39;ютері-компаньйоні, з двостороннім обміном даними між ними по послідовному, UDP, TCP або користувацькому каналу зв&#39;язку. Агент діє як проксі для клієнта з метою публікації та підписки на теми в глобальному просторі даних DDS.</p><p>PX4 <a href="./../modules/modules_system.html#uxrce-dds-client">клієнт uxrce_dds</a> генерується під час збірки та за замовчуванням включений у прошивку PX4. Він включає як код клієнта &quot;загального&quot; мікро XRCE-DDS, так і код перекладу, специфічний для PX4, який він використовує для публікації/передачі даних з/у теми uORB. Підмножина повідомлень uORB, які генеруються в клієнті, перелічені в <a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/uxrce_dds_client/dds_topics.yaml" target="_blank" rel="noreferrer">PX4-Autopilot/src/modules/uxrce_dds_client/dds_topics.yaml</a>. Генератор використовує визначення повідомлень uORB у дереві джерела: <a href="https://github.com/PX4/PX4-Autopilot/tree/release/1.15/msg" target="_blank" rel="noreferrer">PX4-Autopilot/msg</a>, щоб створити код для відправлення повідомлень ROS 2.</p><p>Програми ROS 2 потрібно створювати в робочій області, яка має <em>ті самі</em> визначення повідомлень, які використовувалися для створення клієнтського модуля uXRCE-DDS у мікропрограмі PX4. Ви можете включити їх, клонуючи інтерфейсний пакет <a href="https://github.com/PX4/px4_msgs" target="_blank" rel="noreferrer">PX4/px4_msgs</a> у своє робоче середовище ROS 2 (гілки у репозиторії відповідають повідомленням для різних випусків PX4).</p><p>Зверніть увагу, що сам по собі <em>агент</em> micro XRCE-DDS &lt;0&gt;не має залежності&lt;/0&gt; від клієнтського коду. Це може бути побудовано з <a href="https://github.com/eProsima/Micro-XRCE-DDS-Agent" target="_blank" rel="noreferrer">вихідний код</a> або як самостійний елемент, або як частина збірки ROS, або встановлено як snap.</p><p>Зазвичай вам потрібно запустити як клієнт, так і агента при використанні ROS 2. Зверніть увагу, що клієнт uXRCE-DDS вбудований в прошивку за замовчуванням, але не запускається автоматично, за винятком збірок симулятора.</p><div class="info custom-block"><p class="custom-block-title">У PX4v1.13 та раніше, ROS 2 був залежний від визначень у <a href="https://github.com/PX4/px4_ros_com" target="_blank" rel="noreferrer">px4_ros_com</a>. Цей репозиторій більше не потрібен, але містить корисні приклади.</p></div><h2 id="встановлення-та-налаштування" tabindex="-1">Встановлення та налаштування <a class="header-anchor" href="#встановлення-та-налаштування" aria-label="Permalink to &quot;Встановлення та налаштування&quot;">​</a></h2><p>Підтримувані платформи ROS 2 для розробки PX4 - ROS 2 &quot;Humble&quot; на Ubuntu 22.04 та ROS 2 &quot;Foxy&quot; на Ubuntu 20.04.</p><p>ROS 2 &quot;Humble&quot; рекомендується, оскільки це поточний розподіл ROS 2 LTS. ROS 2 &quot;Foxy&quot; досягла кінця свого життя в травні 2023 року, але все ще стабільна і працює з PX4.</p><div class="info custom-block"><p class="custom-block-title">PX4 не так добре протестований на Ubuntu 22.04, як на Ubuntu 20.04 (на момент написання), і Ubuntu 20.04 потрібний, якщо ви хочете використовувати <a href="./../sim_gazebo_classic/">Gazebo Classic</a>.</p></div><p>Для налаштування ROS 2 для використання з PX4:</p><ul><li><a href="#install-px4">Встановити PX4</a> (для використання симулятора PX4)</li><li><a href="#install-ros-2">Встановіть ROS 2</a></li><li><a href="#setup-micro-xrce-dds-agent-client">Налаштування агента та клієнта Micro XRCE-DDS</a></li><li><a href="#build-ros-2-workspace">Створіть та запустіть робоче середовище ROS 2</a></li></ul><p>Інші залежності архітектури, які встановлюються автоматично, такі як <em>Fast DDS</em>, не враховуються.</p><h3 id="встановлення-px4" tabindex="-1">Встановлення PX4 <a class="header-anchor" href="#встановлення-px4" aria-label="Permalink to &quot;Встановлення PX4&quot;">​</a></h3><p>Вам потрібно встановити інструментальний набір розробки PX4, щоб використовувати симулятор.</p><div class="info custom-block"><p class="custom-block-title">Єдиним залежністю ROS 2 від PX4 є набір визначень повідомлень, який він отримує з <a href="https://github.com/PX4/px4_msgs" target="_blank" rel="noreferrer">px4_msgs</a>. Вам потрібно встановити PX4 лише в разі, якщо вам потрібен симулятор (як у цьому посібнику), або якщо ви створюєте збірку, яка публікує власні теми uORB.</p></div><p>Налаштуйте середовище розробки PX4 на Ubuntu звичайним шляхом:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/PX4/PX4-Autopilot.git</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --recursive</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./PX4-Autopilot/Tools/setup/ubuntu.sh</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PX4-Autopilot/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> px4_sitl</span></span></code></pre></div><p>Зверніть увагу, що вищезазначені команди встановлять рекомендований симулятор для вашої версії Ubuntu. Якщо ви хочете встановити PX4, але зберегти вашу існуючу установку симулятора, запустіть <code>ubuntu.sh</code> вище з прапорцем <code>--no-sim-tools</code>.</p><p>Для отримання додаткової інформації та усунення неполадок див. <a href="./../dev_setup/dev_env_linux_ubuntu.html">Середовище розробки Ubuntu</a> та <a href="./../dev_setup/building_px4.html">Завантажити вихідний код PX4</a>.</p><h3 id="встановлення-ros-2" tabindex="-1">Встановлення ROS 2 <a class="header-anchor" href="#встановлення-ros-2" aria-label="Permalink to &quot;Встановлення ROS 2&quot;">​</a></h3><p>Щоб встановити ROS 2 і його залежності:</p>`,29),F=s("p",null,"Встановлення ROS 2.",-1),E=s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," locales")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," locale-gen"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," en_US"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," en_US.UTF-8")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update-locale"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," LC_ALL=en_US.UTF-8"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," LANG=en_US.UTF-8")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"export"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," LANG"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"en_US.UTF-8")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," software-properties-common")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," add-apt-repository"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," universe")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," curl"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -y")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," curl"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -sSL"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," https://raw.githubusercontent.com/ros/rosdistro/master/ros.key"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /usr/share/keyrings/ros-archive-keyring.gpg")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"echo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "deb [arch=$('),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dpkg"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --print-architecture"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},") signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu $("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"."),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/os-release && "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"echo"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $UBUNTU_CODENAME"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},') main"'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," tee"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/sources.list.d/ros2.list"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /dev/null")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," upgrade"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -y")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ros-humble-desktop")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ros-dev-tools")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"source"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/ros/humble/setup.bash"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"echo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "source /opt/ros/humble/setup.bash"'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," .bashrc")])])])],-1),y=s("p",null,[i("Інструкції вище відтворено з офіційного посібника з установки: "),s("a",{href:"https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html",target:"_blank",rel:"noreferrer"},"Встановлення ROS 2 Humble"),i(". Ви можете встановити "),s("em",null,"або"),i(" робочий стіл ("),s("code",null,"ros-humble-desktop"),i(") "),s("em",null,"або"),i(" мінімалістичні версії ("),s("code",null,"ros-humble-ros-base"),i("), "),s("em",null,"і"),i(" засоби розробки ("),s("code",null,"ros-dev-tools"),i(").")],-1),u=s("p",null,":::",-1),C=s("ul",null,[s("li",null,[i("Дотримуйтесь офіційного посібника з встановлення: "),s("a",{href:"https://index.ros.org/doc/ros2/Installation/Foxy/Linux-Install-Debians/",target:"_blank",rel:"noreferrer"},"Встановіть ROS 2 Foxy"),i(".")])],-1),m=s("p",null,[i("Ви можете встановити "),s("em",null,"або"),i(" робочий стіл ("),s("code",null,"ros-foxy-desktop"),i(") "),s("em",null,"або"),i(" мінімалістичні версії ("),s("code",null,"ros-foxy-ros-base"),i("), "),s("em",null,"і"),i(" засоби розробки ("),s("code",null,"ros-dev-tools"),i(").")],-1),_=n(`<p>::::</p><ol><li><p>Деякі Python залежності також мають бути встановленні (використовуючи <strong><code>pip</code></strong> або <strong><code>apt</code></strong>):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -U</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> empy==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.3.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pyros-genmsg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> setuptools</span></span></code></pre></div></li></ol><h3 id="налаштування-агента-та-клієнта-micro-xrce-dds" tabindex="-1">Налаштування агента та клієнта Micro XRCE-DDS <a class="header-anchor" href="#налаштування-агента-та-клієнта-micro-xrce-dds" aria-label="Permalink to &quot;Налаштування агента та клієнта Micro XRCE-DDS&quot;">​</a></h3><p>Для того щоб ROS 2 міг спілкуватися з PX4, <a href="./../modules/modules_system.html#uxrce-dds-client">клієнт uXRCE-DDS</a> повинен працювати на PX4, підключений до агента micro XRCE-DDS, який працює на компаньйоновому комп&#39;ютері.</p><h4 id="налаштувати-агента" tabindex="-1">Налаштувати агента <a class="header-anchor" href="#налаштувати-агента" aria-label="Permalink to &quot;Налаштувати агента&quot;">​</a></h4><p>Агент може бути встановлений на компаньйоновий комп&#39;ютер <a href="./../middleware/uxrce_dds.html#micro-xrce-dds-agent-installation">різними способами</a>. Нижче ми покажемо, як побудувати агента &quot;standalone&quot; з вихідних кодів та підключитися до клієнта, який працює на симуляторі PX4.</p><p>Для налаштування та запуску агента:</p><ol><li><p>Відкрийте термінал.</p></li><li><p>Введіть наступні команди для витягування та побудови агента з вихідного коду:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/eProsima/Micro-XRCE-DDS-Agent.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Micro-XRCE-DDS-Agent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cmake</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ..</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ldconfig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/lib/</span></span></code></pre></div></li><li><p>Запустіть агента з налаштуваннями для підключення до клієнта uXRCE-DDS, який працює на симуляторі:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MicroXRCEAgent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> udp4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8888</span></span></code></pre></div></li></ol><p>Агент зараз працює, але ви не побачите багато, поки ми не почнемо PX4 (у наступному кроці).</p><p>::: інформація Ви можете залишити агента, що працює в цьому терміналі! Зверніть увагу, що дозволено лише одного агента на підключений канал зв&#39;язку. :::</p><h4 id="запустіть-клієнта" tabindex="-1">Запустіть клієнта <a class="header-anchor" href="#запустіть-клієнта" aria-label="Permalink to &quot;Запустіть клієнта&quot;">​</a></h4><p>Симулятор PX4 автоматично запускає клієнт uXRCE-DDS, підключаючись до порту UDP 8888 на локальному хості.</p><p>Для запуску симулятора (і клієнта):</p>`,13),b=s("p",null,[i("Відкрийте новий термінал в корені репозиторію "),s("strong",null,"PX4 Autopilot"),i(", який був встановлений вище.")],-1),B=s("ul",null,[s("li",null,[s("p",null,[i("Розпочніть симуляцію PX4 у "),s("a",{href:"./../sim_gazebo_gz/"},"Gazebo"),i(" за допомогою:")]),s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"make"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," px4_sitl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," gz_x500")])])])])])],-1),v=s("p",null,":::",-1),f=s("ul",null,[s("li",null,[s("p",null,[i("Почніть симуляцію PX4 "),s("a",{href:"./../sim_gazebo_classic/"},"Симуляція Gazebo Classic"),i(" за допомогою:")]),s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"make"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," px4_sitl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," gazebo-classic")])])])])])],-1),D=n(`<p>::::</p><p>Агент та клієнт зараз працюють, вони повинні підключитися.</p><p>Термінал PX4 відображає вивід <a href="./../debug/system_console.html">NuttShell/PX4 Системна Консоль</a> під час завантаження та роботи PX4. Як тільки агент підключає вихід, вивід повинен містити повідомлення <code>INFO</code>, що показують створення записувачів даних:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>...</span></span>
<span class="line"><span>INFO  [uxrce_dds_client] synchronized with time offset 1675929429203524us</span></span>
<span class="line"><span>INFO  [uxrce_dds_client] successfully created rt/fmu/out/failsafe_flags data writer, topic id: 83</span></span>
<span class="line"><span>INFO  [uxrce_dds_client] successfully created rt/fmu/out/sensor_combined data writer, topic id: 168</span></span>
<span class="line"><span>INFO  [uxrce_dds_client] successfully created rt/fmu/out/timesync_status data writer, topic id: 188</span></span>
<span class="line"><span>...</span></span></code></pre></div><p>Термінал агента micro XRCE-DDS також повинен почати показувати вивід, оскільки в мережі DDS створюються еквівалентні теми:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>...</span></span>
<span class="line"><span>[1675929445.268957] info     | ProxyClient.cpp    | create_publisher         | publisher created      | client_key: 0x00000001, publisher_id: 0x0DA(3), participant_id: 0x001(1)</span></span>
<span class="line"><span>[1675929445.269521] info     | ProxyClient.cpp    | create_datawriter        | datawriter created     | client_key: 0x00000001, datawriter_id: 0x0DA(5), publisher_id: 0x0DA(3)</span></span>
<span class="line"><span>[1675929445.270412] info     | ProxyClient.cpp    | create_topic             | topic created          | client_key: 0x00000001, topic_id: 0x0DF(2), participant_id: 0x001(1)</span></span>
<span class="line"><span>...</span></span></code></pre></div><h3 id="створення-робочого-простору-ros-2" tabindex="-1">Створення робочого простору ROS 2 <a class="header-anchor" href="#створення-робочого-простору-ros-2" aria-label="Permalink to &quot;Створення робочого простору ROS 2&quot;">​</a></h3><p>Цей розділ показує, як створити робоче середовище ROS 2, розміщене в вашій домашній директорії (змініть команди за необхідності, щоб розмістити вихідний код в іншому місці).</p><p>Пакети <a href="https://github.com/PX4/px4_ros_com" target="_blank" rel="noreferrer">px4_ros_com</a> та <a href="https://github.com/PX4/px4_msgs" target="_blank" rel="noreferrer">px4_msgs</a> клонуються до папки робочого простору, а потім використовується інструмент <code>colcon</code> для збірки робочого простору. Приклад виконується за допомогою <code>ros2 launch</code>.</p><div class="info custom-block"><p class="custom-block-title">Приклад будує <a href="#ros-2-listener">Приклад застосунку ROS 2 Listener</a>, розташований в <a href="https://github.com/PX4/px4_ros_com" target="_blank" rel="noreferrer">px4_ros_com</a>. <a href="https://github.com/PX4/px4_msgs" target="_blank" rel="noreferrer">px4_msgs</a> також потрібний, щоб приклад міг інтерпретувати теми PX4 ROS 2.</p></div><h4 id="створення-робочого-простору" tabindex="-1">Створення робочого простору <a class="header-anchor" href="#створення-робочого-простору" aria-label="Permalink to &quot;Створення робочого простору&quot;">​</a></h4><p>Створити та побудувати робочий простір:</p><ol><li><p>Відкрийте новий термінал.</p></li><li><p>Створіть новий каталог робочого простору та перейдіть до нього за допомогою:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/ws_sensor_combined/src/</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/ws_sensor_combined/src/</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p></div></li></ol><p>Узгодження імен для папок робочого простору може полегшити керування робочим простором. :::</p>`,14),S=n(`<li><p>Скопіюйте репозиторій прикладів і <a href="https://github.com/PX4/px4_msgs" target="_blank" rel="noreferrer">px4_msgs</a> до каталогу <code>/src</code> (за замовчуванням клоновано гілку <code>main</code>, яка відповідає версії PX4, яку ми запускаємо):</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/PX4/px4_msgs.git</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/PX4/px4_ros_com.git</span></span></code></pre></div></li>`,1),P=s("p",null,[i("Створіть середовище розробки ROS 2 у поточному терміналі і скомпілюйте робочу область за допомогою "),s("code",null,"colcon"),i(":")],-1),R=s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ..")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"source"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/ros/humble/setup.bash")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"colcon"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," build")])])])],-1),A=s("p",null,":::",-1),x=s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ..")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"source"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/ros/foxy/setup.bash")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"colcon"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," build")])])])],-1),X=n('<p>::::</p><p>У результаті буде зібрано усі каталоги у <code>/src</code> за допомогою вихідного набору інструментів.</p><h4 id="запуск-прикладу" tabindex="-1">Запуск прикладу <a class="header-anchor" href="#запуск-прикладу" aria-label="Permalink to &quot;Запуск прикладу&quot;">​</a></h4><p>Щоб запустити виконувані файли, які ви щойно побудували, вам потрібно джерело <code>local_setup.bash</code>. Це надає доступ до &quot;гаків середовища&quot; для поточного робочого простору. Іншими словами, воно робить виконувані файли, що були тільки що побудовані, доступними в поточному терміналі.</p><div class="info custom-block"><p class="custom-block-title">У <a href="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html#source-the-overlay" target="_blank" rel="noreferrer">початкових навчальних посібниках ROS2</a> рекомендується <em>відкрити новий термінал</em> для запуску ваших виконавчих файлів.</p></div><p>В новому терміналі:</p>',6),O=s("p",null,'Перейдіть на верхній рівень каталогу вашого робочого простору та джерело середовища ROS 2 (у цьому випадку "Humble"):',-1),q=s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ~/ws_sensor_combined/")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"source"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/ros/humble/setup.bash")])])])],-1),T=s("p",null,":::",-1),w=s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ~/ws_sensor_combined/")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"source"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/ros/foxy/setup.bash")])])])],-1),z=n(`<p>::::</p><ol><li><p>Джерело <code>local_setup.bash</code>.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install/local_setup.bash</span></span></code></pre></div></li><li><p>Тепер запустіть приклад. Зверніть увагу, що тут ми використовуємо <code>ros2 launch</code>, який описано нижче.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>ros2 launch px4_ros_com sensor_combined_listener.launch.py</span></span></code></pre></div></li></ol><p>Якщо це працює, ви повинні бачити дані, які друкуються на терміналі / консолі, де ви запустили слухача ROS:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RECEIVED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DATA</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SENSOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMBINED</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ts:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 870938190</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gyro_rad[0]:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.00341645</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gyro_rad[1]:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.00626475</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gyro_rad[2]:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -0.000515705</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gyro_integral_dt:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4739</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">accelerometer_timestamp_relative:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">accelerometer_m_s2[0]:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -0.273381</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">accelerometer_m_s2[1]:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0949186</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">accelerometer_m_s2[2]:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -9.76044</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">accelerometer_integral_dt:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4739</span></span></code></pre></div><h2 id="керування-транспортним-засобом" tabindex="-1">Керування Транспортним Засобом <a class="header-anchor" href="#керування-транспортним-засобом" aria-label="Permalink to &quot;Керування Транспортним Засобом&quot;">​</a></h2><p>Для контролю за додатками, додатки ROS 2:</p><ul><li>підписатися на (слухати) тематичні теми, опубліковані PX4</li><li>опублікувати у темах, які спонукають PX4 виконати певну дію.</li></ul><p>Теми, які ви можете використовувати, визначені в <a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/uxrce_dds_client/dds_topics.yaml" target="_blank" rel="noreferrer">dds_topics.yaml</a>, і ви можете отримати більше інформації про їх дані в <a href="./../msg_docs/">Посилання на повідомлення uORB</a>. Наприклад, <a href="./../msg_docs/VehicleGlobalPosition.html">VehicleGlobalPosition</a> може бути використано для отримання глобального положення транспортного засобу, тоді як <a href="./../msg_docs/VehicleCommand.html">VehicleCommand</a> може бути використано для виконання дій, таких як зльот та посадка.</p><p><a href="#ros-2-example-applications">Приклади застосувань ROS 2</a>, наведені нижче, надають конкретні приклади того, як використовувати ці теми.</p><h2 id="проблеми-сумісності" tabindex="-1">Проблеми сумісності <a class="header-anchor" href="#проблеми-сумісності" aria-label="Permalink to &quot;Проблеми сумісності&quot;">​</a></h2><p>Цей розділ містить інформацію, яка може вплинути на те, як ви пишете свій код ROS.</p><h3 id="налаштування-qos-підписника-ros-2" tabindex="-1">Налаштування QoS підписника ROS 2 <a class="header-anchor" href="#налаштування-qos-підписника-ros-2" aria-label="Permalink to &quot;Налаштування QoS підписника ROS 2&quot;">​</a></h3><p>Код ROS 2, який підписується на теми, опубліковані PX4, <em>повинен</em> вказати відповідну (сумісну) настройку QoS, щоб слухати теми. Зокрема, вузли повинні підписатися, використовуючи попередньо визначену якість обслуговування даних сенсорів ROS 2 (з <a href="#ros-2-listener">прикладу вихідного коду слухача</a>):</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rmw_qos_profile_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qos_profile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rmw_qos_profile_sensor_data;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">QoS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">QoSInitialization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(qos_profile.history, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), qos_profile);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subscription_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-&gt;create_subscription</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">px4_msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::SensorCombined</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/fmu/out/sensor_combined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, qos,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span></code></pre></div><p>Це потрібно, оскільки типові налаштування <a href="https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html#qos-profiles" target="_blank" rel="noreferrer">Якості обслуговування (QoS)</a> ROS 2 відрізняються від налаштувань, що використовуються PX4. Не всі комбінації налаштувань якості обслуговування відправник-підписник <a href="https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html#qos-compatibilities" target="_blank" rel="noreferrer">Qos можливі</a>, і виявляється, що типові налаштування ROS 2 для підписки не є такими! Зверніть увагу, що код ROS не повинен встановлювати налаштування QoS при публікації (налаштування PX4 сумісні з типовими налаштуваннями ROS у цьому випадку).</p><h3 id="узгодження-систем-координат-ros-2-px4" tabindex="-1">Узгодження систем координат ROS 2 &amp; PX4 <a class="header-anchor" href="#узгодження-систем-координат-ros-2-px4" aria-label="Permalink to &quot;Узгодження систем координат ROS 2 &amp; PX4&quot;">​</a></h3><p>Локальна/світова та тілові системи координат, що використовуються в ROS та PX4, відрізняються.</p><table><thead><tr><th>Frame</th><th>PX4</th><th>ROS</th></tr></thead><tbody><tr><td>Body</td><td>FRD (X <strong>F</strong>orward, Y <strong>R</strong>ight, Z <strong>D</strong>own)</td><td>FLU (X <strong>F</strong>orward, Y <strong>L</strong>eft, Z <strong>U</strong>p)</td></tr><tr><td>World</td><td>FRD or NED (X <strong>N</strong>orth, Y <strong>E</strong>ast, Z <strong>D</strong>own)</td><td>FLU or ENU (X <strong>E</strong>ast, Y <strong>N</strong>orth, Z <strong>U</strong>p)</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Дивіться <a href="http://www.ros.org/reps/rep-0105.html" target="_blank" rel="noreferrer">REP105: Системи координат для мобільних платформ</a> для отримання додаткової інформації про системи координат ROS.</p></div><p>Обидві системи координат показані на зображенні нижче (FRD зліва / FLU справа).</p><p><img src="`+k+`" alt="Reference frames"></p><p>Конвенції FRD (NED) приймаються на <strong>всі</strong> теми PX4, якщо явно не вказано в відповідному визначенні повідомлення. Отже, вузли ROS 2, які хочуть співпрацювати з PX4, повинні дбати про конвенції кадрів.</p><ul><li><p>Для повороту вектора з ENU на NED потрібно виконати дві основні обертання:</p><ul><li>спочатку обертання на кут pi/2 навколо вісі <code>Z</code> (вгору),</li><li>потім обертання на кут пі навколо вісі <code>X</code> (старий схід/новий північ).</li></ul></li><li><p>Для повороту вектора з NED на ENU потрібно виконати дві основні обертання:</p></li><li><ul><li>спочатку обертання на кут pi/2 навколо вісі <code>Z</code> (вниз),</li><li>потім обертання на кут пі навколо вісі <code>X</code> (старий північ/новий схід). Зверніть увагу, що дві отримані операції математично еквівалентні.</li></ul></li><li><p>Для обертання вектора з FLU на FRD достатньо обертання навколо вісі <code>X</code> (передньої) на пі.</p></li><li><p>Для обертання вектора з FRD на FLU достатньо обертання на пі радіан навколо вісі <code>X</code> (передній).</p></li></ul><p>Приклади векторів, які потребують обертання:</p><ul><li>усі поля в повідомленні <a href="./../msg_docs/TrajectorySetpoint.html">TrajectorySetpoint</a>; конвертація ENU в NED необхідна перед їхнім відправленням.</li><li>всі поля в повідомленні <a href="./../msg_docs/VehicleThrustSetpoint.html">VehicleThrustSetpoint</a>; потрібно виконати конвертацію з FLU в FRD перед їх відправленням.</li></ul><p>Подібно до векторів, також кватерніони, що представляють відношення транспортного засобу (тіло) відносно. світова рамка потребує конвертації.</p><p><a href="https://github.com/PX4/px4_ros_com" target="_blank" rel="noreferrer">PX4/px4_ros_com</a> надає спільну бібліотеку <a href="https://github.com/PX4/px4_ros_com/blob/main/include/px4_ros_com/frame_transforms.h" target="_blank" rel="noreferrer">frame_transforms</a> для легкого виконання таких перетворень.</p><h3 id="синхронізація-часу-ros-gazebo-та-px4" tabindex="-1">Синхронізація часу ROS, Gazebo та PX4 <a class="header-anchor" href="#синхронізація-часу-ros-gazebo-та-px4" aria-label="Permalink to &quot;Синхронізація часу ROS, Gazebo та PX4&quot;">​</a></h3><p>За замовчуванням синхронізація часу між ROS 2 та PX4 автоматично керується проміжним ПЗ <a href="https://micro-xrce-dds.docs.eprosima.com/en/latest/time_sync.html" target="_blank" rel="noreferrer">uXRCE-DDS</a>, а статистика синхронізації часу доступна при прослуховуванні мостової теми <code>/fmu/out/timesync_status</code>. Коли клієнт uXRCE-DDS працює на контролері польоту, а агент працює на супутниковому комп&#39;ютері, це є бажана поведінка, оскільки зміщення часу, дрейф часу та затримка у комунікації обчислюються та автоматично компенсуються.</p><p>Для симуляцій Gazebo PX4 використовує тему Gazebo <code>/clock</code> як <a href="./../sim_gazebo_gz/#px4-gazebo-time-synchronization">джерело часу</a> замість. Цей годинник завжди трохи не синхронізований відносно. годинник операційної системи (фактор реального часу ніколи не є точно один) і він може навіть працювати набагато швидше або повільніше залежно від [переваг користувача](<a href="http://sdformat" target="_blank" rel="noreferrer">http://sdformat</a>. org/spec? elem=physics&amp;ver=1.9). Зверніть увагу, що це відрізняється від процедури <a href="./../simulation/#lockstep-simulation">симуляційного блокування</a>, яка була прийнята з Gazebo Classic.</p><p>Користувачі ROS2 мають дві можливості щодо <a href="https://design.ros2.org/articles/clock_and_time.html" target="_blank" rel="noreferrer">джерела часу</a> їх вузлів.</p><h4 id="вузли-ros2-використовують-годинник-ос-як-джерело-часу" tabindex="-1">Вузли ROS2 використовують годинник ОС як джерело часу <a class="header-anchor" href="#вузли-ros2-використовують-годинник-ос-як-джерело-часу" aria-label="Permalink to &quot;Вузли ROS2 використовують годинник ОС як джерело часу&quot;">​</a></h4><p>Цей сценарій, який розглядається на цій сторінці та в керівництві <a href="./offboard_control.html">offboard_control</a>, також є стандартною поведінкою вузлів ROS2. Годинник ОС діє як джерело часу, тому його можна використовувати лише тоді, коли фактор реального часу симуляції дуже близький до одиниці. Часовий синхронізатор клієнта uXRCE-DDS потім з&#39;єднує годинник ОС на стороні ROS2 з годинником Gazebo на стороні PX4. Користувачеві не потрібно вживати жодних подальших заходів.</p><h4 id="вузли-ros2-використовують-годинник-gazebo-як-джерело-часу" tabindex="-1">Вузли ROS2 використовують годинник Gazebo як джерело часу <a class="header-anchor" href="#вузли-ros2-використовують-годинник-gazebo-як-джерело-часу" aria-label="Permalink to &quot;Вузли ROS2 використовують годинник Gazebo як джерело часу&quot;">​</a></h4><p>У цьому сценарії ROS2 також використовує тему Gazebo <code>/clock</code> як джерело часу. Цей підхід має сенс, якщо симуляція Gazebo працює з коефіцієнтом реального часу, відмінним від одиниці, або якщо ROS2 потрібно безпосередньо взаємодіяти з Gazebo. На стороні ROS2 пряме взаємодія з Gazebo досягається за допомогою пакету <a href="https://github.com/gazebosim/ros_gz" target="_blank" rel="noreferrer">ros_gz_bridge</a> з репозиторію <a href="https://github.com/gazebosim/ros_gz" target="_blank" rel="noreferrer">ros_gz</a>. Прочитайте <a href="https://github.com/gazebosim/ros_gz#readme" target="_blank" rel="noreferrer">repo</a> та <a href="https://github.com/gazebosim/ros_gz/tree/ros2/ros_gz_bridge#readme" target="_blank" rel="noreferrer">package</a> READMEs, щоб дізнатися правильну версію, яка повинна бути встановлена в залежності від вашої версії ROS2 та Gazebo.</p><p>Якщо пакет встановлено та джерело підключено, вузол <code>parameter_bridge</code> надає можливості мостування і може бути використаний для створення одностороннього моста <code>/clock</code>:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ros2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ros_gz_bridge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parameter_bridge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /clock@rosgraph_msgs/msg/Clock[gz.msgs.Clock</span></span></code></pre></div><p>На цьому етапі кожному вузлу ROS2 необхідно бути інструкцією використовувати новостворену тему <code>/clock</code> як джерело часу замість ОС, це робиться шляхом встановлення параметра <code>use_sim_time</code> (кожного вузла) на <code>true</code> (див. <a href="https://design.ros2.org/articles/clock_and_time.html" target="_blank" rel="noreferrer">ROS clock and Time design</a>).</p><p>Це завершує внесені зміни, необхідні на стороні ROS2. На стороні PX4 вам потрібно лише зупинити синхронізацію часу uXRCE-DDS, встановивши параметр <a href="./../advanced_config/parameter_reference.html#UXRCE_DDS_SYNCT">UXRCE_DDS_SYNCT</a> на <code>false</code>. Таким чином, Gazebo буде діяти як основний і єдиний джерело часу як для ROS2, так і для PX4.</p><h2 id="приклади-програм-ros-2" tabindex="-1">Приклади програм ROS 2 <a class="header-anchor" href="#приклади-програм-ros-2" aria-label="Permalink to &quot;Приклади програм ROS 2&quot;">​</a></h2><h3 id="слухач-ros-2" tabindex="-1">Слухач ROS 2 <a class="header-anchor" href="#слухач-ros-2" aria-label="Permalink to &quot;Слухач ROS 2&quot;">​</a></h3><p>Приклади слухачів ROS 2 <a href="https://github.com/PX4/px4_ros_com/tree/main/src/examples/listeners" target="_blank" rel="noreferrer">у репозиторії px4_ros_com</a> демонструють, як писати вузли ROS для прослуховування тем, що публікуються PX4.</p><p>Тут ми розглядаємо вузол <a href="https://github.com/PX4/px4_ros_com/blob/main/src/examples/listeners/sensor_combined_listener.cpp" target="_blank" rel="noreferrer">sensor_combined_listener.cpp</a> у папці <code>px4_ros_com/src/examples/listeners</code>, який підписується на повідомлення <a href="./../msg_docs/SensorCombined.html">SensorCombined</a>.</p><div class="info custom-block"><p class="custom-block-title"><a href="#build-ros-2-workspace">Побудуйте робоче середовище ROS 2</a> показує, як побудувати та запустити цей приклад.</p></div><p>Спочатку код імпортує бібліотеки C++, необхідні для взаємодії з проміжним програмним забезпеченням ROS 2 та файл заголовка для повідомлення <code>SensorCombined</code>, на яке підписується вузол:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;rclcpp/rclcpp.hpp&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;px4_msgs/msg/sensor_combined.hpp&gt;</span></span></code></pre></div><p>Потім він створює клас <code>SensorCombinedListener</code>, який успадковує загальний базовий клас <code>rclcpp::Node</code>.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@brief</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Sensor Combined uORB topic data callback</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SensorCombinedListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Node</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span></code></pre></div><p>Це створює функцію зворотного виклику для отримання повідомлень uORB <code>SensorCombined</code> (тепер як повідомлення micro XRCE-DDS) та виводить вміст полів повідомлення кожного разу, коли повідомлення отримано.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    explicit</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SensorCombinedListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sensor_combined_listener&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        rmw_qos_profile_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qos_profile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rmw_qos_profile_sensor_data;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">QoS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">QoSInitialization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(qos_profile.history, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), qos_profile);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        subscription_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-&gt;create_subscription</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">px4_msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::SensorCombined</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/fmu/out/sensor_combined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, qos,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">](</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> px4_msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SensorCombined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UniquePtr</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;RECEIVED SENSOR COMBINED DATA&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;=============================&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ts: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;timestamp    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gyro_rad[0]: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;gyro_rad[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gyro_rad[1]: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;gyro_rad[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gyro_rad[2]: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;gyro_rad[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gyro_integral_dt: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;gyro_integral_dt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;accelerometer_timestamp_relative: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;accelerometer_timestamp_relative </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;accelerometer_m_s2[0]: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;accelerometer_m_s2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;accelerometer_m_s2[1]: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;accelerometer_m_s2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;accelerometer_m_s2[2]: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;accelerometer_m_s2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;accelerometer_integral_dt: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg-&gt;accelerometer_integral_dt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">Підписка встановлює профіль QoS на основі <code>rmw_qos_profile_sensor_data</code>. Це потрібно, оскільки типовий профіль якості обслуговування ROS 2 для підписників несумісний з профілем PX4 для видавців. Для отримання додаткової інформації див. : <a href="#ros-2-subscriber-qos-settings">ROS 2 Налаштування QoS для підписника</a>,</p></div><p>Рядки нижче створюють виробника для теми uORB <code>SensorCombined</code>, яка може бути зіставлена з одним або кількома сумісними підписниками ROS 2 для теми ROS 2 <code>fmu/sensor_combined/out</code>.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Subscription</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">px4_msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SensorCombined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;::SharedPtr subscription_;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>Інстанціювання класу <code>SensorCombinedListener</code> як вузла ROS виконується у функції <code>main</code>.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Starting sensor_combined listener node...&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setvbuf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(stdout, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, _IONBF, BUFSIZ);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(argc, argv);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make_shared</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SensorCombinedListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Цей конкретний приклад має пов&#39;язаний файл запуску за посиланням <a href="https://github.com/PX4/px4_ros_com/blob/main/launch/sensor_combined_listener.launch.py" target="_blank" rel="noreferrer">launch/sensor_combined_listener.launch.py</a>. Це дозволяє запускати його за допомогою команди <a href="#ros2-launch"><code>ros2 launch</code></a>.</p><h3 id="ros-2-advertiser" tabindex="-1">ROS 2 Advertiser <a class="header-anchor" href="#ros-2-advertiser" aria-label="Permalink to &quot;ROS 2 Advertiser&quot;">​</a></h3><p>Вузол відправника ROS 2 публікує дані в мережу DDS/RTPS (і, отже, в автопілот PX4).</p><p>Беручи як приклад <code>debug_vect_advertiser.cpp</code> під <code>px4_ros_com/src/advertisers</code>, спочатку ми імпортуємо необхідні заголовки, включаючи заголовок повідомлення <code>debug_vect</code>.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;chrono&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;rclcpp/rclcpp.hpp&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;px4_msgs/msg/debug_vect.hpp&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chrono_literals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Потім код створює клас <code>DebugVectAdvertiser</code>, який успадковує загальний базовий клас <code>rclcpp::Node</code>.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DebugVectAdvertiser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Node</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span></code></pre></div><p>Код нижче створює функцію для відправлення повідомлень. Повідомлення надсилаються на основі виклику за часом, який надсилає два повідомлення на секунду за таймером.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    DebugVectAdvertiser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;debug_vect_advertiser&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        publisher_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-&gt;create_publisher</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">px4_msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::DebugVect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fmu/debug_vect/in&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timer_callback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]()-&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> debug_vect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> px4_msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DebugVect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            debug_vect.timestamp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chrono</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">time_point_cast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chrono</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microseconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chrono</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">steady_clock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">time_since_epoch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::string name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">begin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), name.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), debug_vect.name.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">begin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            debug_vect.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            debug_vect.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            debug_vect.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            RCLCPP_INFO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get_logger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\033</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[97m Publishing debug_vect: time: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%llu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> y: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> z: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\033</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[0m&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                debug_vect.timestamp, debug_vect.x, debug_vect.y, debug_vect.z);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-&gt;publisher_-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(debug_vect);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        timer_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create_wall_timer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, timer_callback);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TimerBase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::SharedPtr timer_;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Publisher</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">px4_msgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DebugVect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;::SharedPtr publisher_;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>Інстанціювання класу <code>DebugVectAdvertiser</code> як вузла ROS виконується у функції <code>main</code>.</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::cout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Starting debug_vect advertiser node...&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::endl;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setvbuf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(stdout, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, _IONBF, BUFSIZ);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(argc, argv);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make_shared</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DebugVectAdvertiser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rclcpp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="offboard-control" tabindex="-1">Offboard Control <a class="header-anchor" href="#offboard-control" aria-label="Permalink to &quot;Offboard Control&quot;">​</a></h3><p>For a complete reference example on how to use Offboard control with PX4, see: <a href="./../ros2/offboard_control.html">ROS 2 Offboard control example</a>.</p><h2 id="використання-апаратноі-плати-керування-польотом" tabindex="-1">Використання апаратної плати керування польотом <a class="header-anchor" href="#використання-апаратноі-плати-керування-польотом" aria-label="Permalink to &quot;Використання апаратної плати керування польотом&quot;">​</a></h2><p>ROS 2 з PX4, що працює на пульті керування польотом, майже те саме, що й працювати з PX4 на симуляторі. Єдине відмінність полягає в тому, що потрібно запустити як агента, так і клієнта, з параметрами, відповідними для каналу зв&#39;язку.</p><p>Для отримання додаткової інформації дивіться <a href="./../middleware/uxrce_dds.html#starting-agent-and-client">Початок uXRCE-DDS</a>.</p><h2 id="користувацькі-теми-uorb" tabindex="-1">Користувацькі теми uORB <a class="header-anchor" href="#користувацькі-теми-uorb" aria-label="Permalink to &quot;Користувацькі теми uORB&quot;">​</a></h2><p>ROS 2 потребує мати ті <em>самі</em> визначення повідомлень, які використовувалися для створення модуля клієнта uXRCE-DDS в прошивці PX4, щоб інтерпретувати повідомлення. Визначення зберігаються в пакеті інтерфейсу ROS 2 <a href="https://github.com/PX4/px4_msgs" target="_blank" rel="noreferrer">PX4/px4_msgs</a> і автоматично синхронізуються CI на гілках <code>main</code> та release. Зверніть увагу, що всі повідомлення з вихідного коду PX4 присутні в репозиторії, але лише ті, які перелічені в <code>dds_topics.yaml</code>, будуть доступні як теми ROS 2. Тому</p><ul><li><p>Якщо ви використовуєте основну або випускову версію PX4, ви можете отримати визначення повідомлень, клонуючи пакунок інтерфейсу <a href="https://github.com/PX4/px4_msgs" target="_blank" rel="noreferrer">PX4/px4_msgs</a> у вашу робочу область.</p></li><li><p>Якщо ви створюєте або змінюєте повідомлення uORB, вам потрібно вручну оновити повідомлення у вашому робочому просторі з дерева джерела PX4. Загалом це означає, що ви мали б оновити <a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/uxrce_dds_client/dds_topics.yaml" target="_blank" rel="noreferrer">dds_topics.yaml</a>, клонувати пакет інтерфейсу, а потім вручну синхронізувати його, копіюючи нові/змінені визначення повідомлень з <a href="https://github.com/PX4/PX4-Autopilot/tree/release/1.15/msg" target="_blank" rel="noreferrer">PX4-Autopilot/msg</a> до його папок <code>msg</code>. Припускаючи, що PX4-Autopilot знаходиться у вашій домашній директорії <code>~</code>, тоді як <code>px4_msgs</code> знаходиться у <code>~/px4_ros_com/src/</code>, то команда може бути:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/px4_ros_com/src/px4_msgs/msg/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.msg</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/PX4-Autopilot/mgs/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.msg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/px4_ros_com/src/px4_msgs/msg/</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">Технічно, <a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/uxrce_dds_client/dds_topics.yaml" target="_blank" rel="noreferrer">dds_topics.yaml</a> повністю визначає відношення між темами PX4 uORB та повідомленнями ROS 2. Для отримання додаткової інформації див. <a href="./../middleware/uxrce_dds.html#dds-topics-yaml">uXRCE-DDS &gt; DDS Topics YAML</a>.</p></div></li></ul><p>:::</p><h2 id="налаштування-простору-назв-теми" tabindex="-1">Налаштування простору назв теми <a class="header-anchor" href="#налаштування-простору-назв-теми" aria-label="Permalink to &quot;Налаштування простору назв теми&quot;">​</a></h2><p>Спеціальні простори імен тем можуть бути застосовані на етапі збірки (зміна <a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/uxrce_dds_client/dds_topics.yaml" target="_blank" rel="noreferrer">dds_topics.yaml</a>) або під час виконання (корисно для операцій з кількома транспортними засобами):</p><ul><li>Одним із варіантів є використання опції <code>-n</code> при запуску <a href="./../modules/modules_system.html#uxrce-dds-client">uxrce_dds_client</a> з командного рядка. Ця техніка може бути використана як у симуляційних, так і в реальних транспортних засобах.</li><li>Спеціальний простір імен може бути наданий для симуляцій (тільки) за допомогою встановлення змінної середовища <code>PX4_UXRCE_DDS_NS</code> перед запуском симуляції.</li></ul><div class="info custom-block"><p class="custom-block-title">Зміна простору імен під час виконання додасть потрібний простір імен як префікс до всіх полів <code>topic</code> в <a href="https://github.com/PX4/PX4-Autopilot/blob/release/1.15/src/modules/uxrce_dds_client/dds_topics.yaml" target="_blank" rel="noreferrer">dds_topics.yaml</a>. Отже, команди, подібні до:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uxrce_dds_client</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uav_1</span></span></code></pre></div><p>або</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PX4_UXRCE_DDS_NS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">uav_1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> px4_sitl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gz_x500</span></span></code></pre></div><p>згенерує теми під просторами імен:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/uav_1/fmu/in/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # for subscribers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/uav_1/fmu/out/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # for publishers</span></span></code></pre></div></div><h2 id="ros2-cli" tabindex="-1">ros2 CLI <a class="header-anchor" href="#ros2-cli" aria-label="Permalink to &quot;ros2 CLI&quot;">​</a></h2><p><a href="https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools.html" target="_blank" rel="noreferrer">ros2 CLI</a> - це корисний інструмент для роботи з ROS. Ви можете використовувати його, наприклад, щоб швидко перевірити, чи публікуються теми, а також докладно їх перевірити, якщо у вас є <code>px4_msg</code> у робочому просторі. Команда також дозволяє вам запускати більш складні системи ROS за допомогою файлу запуску. Декілька можливостей демонструються нижче.</p><h3 id="ros2-topic-list" tabindex="-1">ros2 topic list <a class="header-anchor" href="#ros2-topic-list" aria-label="Permalink to &quot;ros2 topic list&quot;">​</a></h3><p>Використовуйте <code>ros2 topic list</code>, щоб переглянути список тем, доступних для ROS 2:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ros2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> topic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span></code></pre></div><p>Якщо PX4 підключений до агента, результатом буде список типів теми:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/fmu/in/obstacle_distance</span></span>
<span class="line"><span>/fmu/in/offboard_control_mode</span></span>
<span class="line"><span>/fmu/in/onboard_computer_status</span></span>
<span class="line"><span>...</span></span></code></pre></div><p>Зверніть увагу, що робочому простору не потрібно будувати з <code>px4_msgs</code> для успішного виконання; інформація про тип теми є частиною навантаження повідомлення.</p><h3 id="ros2-topic-echo" tabindex="-1">ros2 topic echo <a class="header-anchor" href="#ros2-topic-echo" aria-label="Permalink to &quot;ros2 topic echo&quot;">​</a></h3><p>Використовуйте <code>ros2 topic echo</code>, щоб показати деталі певної теми.</p><p>На відміну від <code>ros2 topic list</code>, для цієї роботи вам потрібно знаходитися в робочому просторі, який побудував <code>px4_msgs</code> та джерело <code>local_setup.bash</code>, щоб ROS міг інтерпретувати повідомлення.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ros2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> topic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /fmu/out/vehicle_status</span></span></code></pre></div><p>Команда виведе деталі теми під час оновлення.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>---</span></span>
<span class="line"><span>timestamp: 1675931593364359</span></span>
<span class="line"><span>armed_time: 0</span></span>
<span class="line"><span>takeoff_time: 0</span></span>
<span class="line"><span>arming_state: 1</span></span>
<span class="line"><span>latest_arming_reason: 0</span></span>
<span class="line"><span>latest_disarming_reason: 0</span></span>
<span class="line"><span>nav_state_timestamp: 3296000</span></span>
<span class="line"><span>nav_state_user_intention: 4</span></span>
<span class="line"><span>nav_state: 4</span></span>
<span class="line"><span>failure_detector_status: 0</span></span>
<span class="line"><span>hil_state: 0</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>---</span></span></code></pre></div><h3 id="ros2-topic-hz" tabindex="-1">ros2 topic hz <a class="header-anchor" href="#ros2-topic-hz" aria-label="Permalink to &quot;ros2 topic hz&quot;">​</a></h3><p>Ви можете отримати статистику про швидкість повідомлень, використовуючи <code>ros2 topic hz</code>. Наприклад, щоб отримати ставки для <code>SensorCombined</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>ros2 topic hz /fmu/out/sensor_combined</span></span></code></pre></div><p>Вихід буде виглядати приблизно так:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">average</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 248.187</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  min:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.000s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.012s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> std</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.00147s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> window:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2724</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">average</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 248.006</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  min:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.000s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.012s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> std</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.00147s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> window:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2972</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">average</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 247.330</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  min:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.000s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.012s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> std</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.00148s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> window:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3212</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">average</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 247.497</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  min:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.000s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.012s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> std</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.00149s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> window:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3464</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">average</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 247.458</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  min:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.000s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.012s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> std</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.00149s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> window:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3712</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">average</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 247.485</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  min:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.000s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> max:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.012s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> std</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0.00148s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> window:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3960</span></span></code></pre></div><h3 id="ros2-launch" tabindex="-1">ros2 launch <a class="header-anchor" href="#ros2-launch" aria-label="Permalink to &quot;ros2 launch&quot;">​</a></h3><p>Команда <code>ros2 launch</code> використовується для запуску файлу запуску ROS 2. Наприклад, вище ми використовували <code>ros2 launch px4_ros_com sensor_combined_listener.launch.py</code> для запуску прикладу слухача.</p><p>Вам не потрібно мати файл запуску, але вони дуже корисні, якщо у вас складна система ROS 2, яка потребує запуску кількох компонентів.</p><p>Для отримання інформації про файли запуску див. <a href="https://docs.ros.org/en/humble/Tutorials/Intermediate/Launch/Creating-Launch-Files.html" target="_blank" rel="noreferrer">Посібники ROS 2 &gt; Створення файлів запуску</a></p><h2 id="відстеження-проблем" tabindex="-1">Відстеження проблем <a class="header-anchor" href="#відстеження-проблем" aria-label="Permalink to &quot;Відстеження проблем&quot;">​</a></h2><h3 id="відсутні-залежності" tabindex="-1">Відсутні залежності <a class="header-anchor" href="#відсутні-залежності" aria-label="Permalink to &quot;Відсутні залежності&quot;">​</a></h3><p>Стандартна установка повинна включати всі необхідні інструменти для ROS 2.</p><p>Якщо щось відсутнє, його можна додати окремо:</p>`,106),N=n('<li><p>Інструменти збірки <strong><code>colcon</code></strong> повинні бути в інструментах розробки. Можна встановити за допомогою:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python3-colcon-common-extensions</span></span></code></pre></div></li>',1),U=s("p",null,"Бібліотеку Eigen3, яку використовує бібліотека трансформацій, повинно бути в обох пакунків: desktop та base. Воно повинно бути встановлено, як показано:",-1),I=s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ros-humble-eigen3-cmake-module")])])])],-1),L=s("p",null,":::",-1),V=s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ros-foxy-eigen3-cmake-module")])])])],-1),G=s("p",null,"::::",-1),Q=s("h2",{id:"додаткова-інформація",tabindex:"-1"},[i("Додаткова інформація "),s("a",{class:"header-anchor",href:"#додаткова-інформація","aria-label":'Permalink to "Додаткова інформація"'},"​")],-1),M=s("ul",null,[s("li",null,[s("a",{href:"https://www.youtube.com/watch?v=F5oelooT67E",target:"_blank",rel:"noreferrer"},"ROS 2 у PX4: Технічні деталі безперервного переходу до XRCE-DDS"),i(" - Пабло Гаррідо та Нуно Маркес (youtube)")]),s("li",null,[s("a",{href:"https://github.com/ros2/ros2/wiki/DDS-and-ROS-middleware-implementations",target:"_blank",rel:"noreferrer"},"Реалізації проміжного ПЗ DDS та ROS")])],-1);function Z($,Y,H,W,j,J){const l=e("tab"),h=e("tabs");return o(),d("div",null,[g,s("ol",null,[s("li",null,[F,a(h,null,{default:t(()=>[a(l,{name:"humble To install ROS 2 Humble on Ubuntu 22.04:"},{default:t(()=>[E,y]),_:1})]),_:1})])]),u,a(l,{name:"foxy Щоб встановити ROS 2 Foxy на Ubuntu 20.04:"},{default:t(()=>[C,m]),_:1}),_,s("ol",null,[s("li",null,[b,a(h,null,{default:t(()=>[a(l,{name:"humble"},{default:t(()=>[B]),_:1})]),_:1})])]),v,a(l,{name:"foxy"},{default:t(()=>[f]),_:1}),D,s("ol",null,[S,s("li",null,[P,a(h,null,{default:t(()=>[a(l,{name:"humble"},{default:t(()=>[R]),_:1})]),_:1})])]),A,a(l,{name:"foxy"},{default:t(()=>[x]),_:1}),X,s("ol",null,[s("li",null,[O,a(h,null,{default:t(()=>[a(l,{name:"humble"},{default:t(()=>[q]),_:1})]),_:1})])]),T,a(l,{name:"foxy"},{default:t(()=>[w]),_:1}),z,s("ul",null,[N,s("li",null,[U,a(h,null,{default:t(()=>[a(l,{name:"humble"},{default:t(()=>[I]),_:1})]),_:1})])]),L,a(l,{name:"foxy"},{default:t(()=>[V]),_:1}),G,Q,M])}const ts=r(c,[["render",Z]]);export{as as __pageData,ts as default};
