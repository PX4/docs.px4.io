import{_ as e}from"./chunks/sf45_obstacle_map.DdQG1Lby.js";import{_ as a,c as r,o as t,ab as o}from"./chunks/framework.CUflZczI.js";const u=JSON.parse('{"title":"Запобігання зіткненням (Collision Prevention)","description":"","frontmatter":{},"headers":[],"relativePath":"uk/computer_vision/collision_prevention.md","filePath":"uk/computer_vision/collision_prevention.md"}'),i={name:"uk/computer_vision/collision_prevention.md"},l=o('<h1 id="запобігання-зіткненням-collision-prevention" tabindex="-1">Запобігання зіткненням (Collision Prevention) <a class="header-anchor" href="#запобігання-зіткненням-collision-prevention" aria-label="Permalink to &quot;Запобігання зіткненням (Collision Prevention)&quot;">​</a></h1><p><em>Collision Prevention</em> може бути використано для автоматичного сповільнення і зупинки транспортного засобу, перш ніж він потрапить в перешкоду.</p><p>Він може бути увімкнений для мультикоптерів у режимі <a href="./../flight_modes_mc/position.html">Position mode</a> і може використовувати дані датчиків з бортового комп&#39;ютера-компаньйона, бортових далекомірів через MAVLink, далекоміра, приєднаного до польотного контролера, або будь-якої комбінації вищезазначених пристроїв.</p><p>Запобігання зіткненням може обмежити максимальну швидкість автомобіля, якщо радіус дії датчика недостатньо великий! Він також запобігає руху в тих напрямках, де немає даних з датчиків (тобто, якщо у вас немає даних з заднього датчика, ви не зможете летіти назад).</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Якщо висока швидкість польоту є критично важливою, вимкніть функцію запобігання зіткненням, коли вона не потрібна.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Переконайтеся, що у вас є датчики/дані датчиків у всіх напрямках, в яких ви хочете летіти (коли увімкнено запобігання зіткненням).</p></div><h2 id="загальнии-огляд" tabindex="-1">Загальний огляд <a class="header-anchor" href="#загальнии-огляд" aria-label="Permalink to &quot;Загальний огляд&quot;">​</a></h2><p><em>Collision Prevention</em> увімкнено на PX4 шляхом встановлення параметра мінімально допустимої відстані зближення (<a href="#CP_DIST">CP_DIST</a>).</p><p>Ця функція вимагає інформації про перешкоди від зовнішньої системи (надсилається за допомогою повідомлення MAVLink <a href="https://mavlink.io/en/messages/common.html#OBSTACLE_DISTANCE" target="_blank" rel="noreferrer">OBSTACLE_DISTANCE</a>) та/або <a href="./../sensor/rangefinders.html">датчика відстані</a>, підключеного до польотного контролера.</p><p>:::note Для отримання інформації про об&#39;єкти <em>навколо</em> транспортного засобу та запобігання зіткненням з ними можна використовувати декілька датчиків. Якщо кілька джерел надають дані для <em>однакової</em> орієнтації, система використовує дані, які повідомляють про найменшу відстань до об&#39;єкта. :::</p><p>Транспортний засіб обмежує максимальну швидкість, щоб сповільнитися, коли він наближається до перешкод, і припиняє рух, коли досягає мінімально допустимої дистанції. Для того, щоб відійти від перешкоди (або паралельно їй), користувач повинен наказати транспортному засобу рухатися до заданої точки, яка не наближає транспортний засіб до перешкоди. Алгоритм внесе незначні корективи в напрямок заданого значення, якщо буде визначено, що &quot;краще&quot; значення існує в межах фіксованого запасу по обидва боки від запитуваного заданого значення.</p><p>Користувачі отримують сповіщення через <em>QGroundControl</em>, а <em>Collision Prevention</em> активно контролює задані значення швидкості.</p><p>Налаштування програмного забезпечення PX4 оглянуто в наступному розділі. Якщо ви використовуєте датчик відстані, підключений до вашого польотного контролера для запобігання зіткненням, його потрібно підключити та налаштувати, як описано в розділі <a href="#rangefinder">Датчик відстані PX4</a>. Якщо ви використовуєте комп&#39;ютер-компаньйон для надання інформації про перешкоди, див. <a href="#companion">Налаштування компаньйона</a>.</p><h2 id="px4-налаштування-програмного-забезпечення" tabindex="-1">PX4 Налаштування (програмного забезпечення) <a class="header-anchor" href="#px4-налаштування-програмного-забезпечення" aria-label="Permalink to &quot;PX4 Налаштування (програмного забезпечення)&quot;">​</a></h2><p>Налаштуйте запобігання зіткненням, встановивши <a href="./../advanced_config/parameters.html">такі параметри</a> у <em>QGroundControl</em>:</p><table><thead><tr><th>Parameter</th><th>Опис</th></tr></thead><tbody><tr><td><a id="CP_DIST"></a><a href="./../advanced_config/parameter_reference.html#CP_DIST">CP_DIST</a></td><td>Встановіть мінімально допустиму відстань (найближчу відстань, на яку транспортний засіб може наблизитися до перешкоди). Встановіть від&#39;ємний значення, щоб вимкнути <em>collision prevention</em>. <br>&gt; <strong>Warning</strong> Це значення є відстанню до датчиків, а не до зовнішньої сторони вашого транспортного засобу або гвинтів. Не забудьте залишити безпечний запас!</td></tr><tr><td><a id="CP_DELAY"></a><a href="./../advanced_config/parameter_reference.html#CP_DELAY">CP_DELAY</a></td><td>Встановіть затримку датчика та відстеження швидкості. Дивіться <a href="#delay_tuning">Налаштування затримки</a> нижче.</td></tr><tr><td><a id="CP_GUIDE_ANG"></a><a href="./../advanced_config/parameter_reference.html#CP_GUIDE_ANG">CP_GUIDE_ANG</a></td><td>Встановіть кут (в обидві сторони від заданого напрямку), в межах якого транспортний засіб може відхилитися, якщо знайде менше перешкод у цьому напрямку. Дивіться <a href="#angle_change_tuning">Налаштування навігації</a> нижче.</td></tr><tr><td><a id="CP_GO_NO_DATA"></a><a href="./../advanced_config/parameter_reference.html#CP_GO_NO_DATA">CP_GO_NO_DATA</a></td><td>Встановіть значення 1, щоб дозволити транспортному засобу рухатися в напрямках, де немає покриття датчика (за замовчуванням 0/<code>False</code>).</td></tr><tr><td><a id="MPC_POS_MODE"></a><a href="./../advanced_config/parameter_reference.html#MPC_POS_MODE">MPC_POS_MODE</a></td><td>Встановіть значення 0 або 3, щоб увімкнути запобігання зіткненням у режимі позиціонування (за замовчуванням - 4).</td></tr></tbody></table><p><a id="algorithm"></a></p><h2 id="опис-алгоритму" tabindex="-1">Опис алгоритму <a class="header-anchor" href="#опис-алгоритму" aria-label="Permalink to &quot;Опис алгоритму&quot;">​</a></h2><p>Дані з усіх датчиків об&#39;єднуються у внутрішнє представлення 36 секторів навколо транспортного засобу, кожен з яких містить або дані датчика та інформацію про час останнього спостереження, або вказівку на те, що дані для сектора відсутні. Коли транспортний засіб отримує команду рухатися в певному напрямку, перевіряються всі сектори в півкулі цього напрямку, щоб побачити, чи не наблизить цей рух транспортний засіб до будь-яких перешкод. Якщо так, то швидкість транспортного засобу буде обмежена.</p><p>Це обмеження швидкості враховує як внутрішній контур швидкості, налаштований за допомогою <a href="./../advanced_config/parameter_reference.html#MPC_XY_P">MPC_XY_P</a>, так і <a href="./../config_mc/mc_jerk_limited_type_trajectory.html">контролер оптимальної швидкості ривка</a> за допомогою <a href="./../advanced_config/parameter_reference.html#MPC_JERK_MAX">MPC_JERK_MAX</a> та <a href="./../advanced_config/parameter_reference.html#MPC_ACC_HOR">MPC_ACC_HOR</a>. Швидкість обмежується таким чином, щоб транспортний засіб зупинився вчасно, щоб зберегти відстань, вказану в <a href="#CP_DIST">CP_DIST</a>. Також враховується дальність дії датчиків для кожного сектора, що обмежує швидкість за тим же механізмом.</p><p>:::note Якщо в певному напрямку немає даних від датчика, швидкість у цьому напрямку обмежується до 0 (щоб запобігти зіткненню з невидимими об&#39;єктами). Якщо ви хочете вільно рухатися у напрямках без покриття датчиків, це можна увімкнути, встановивши <a href="#CP_GO_NO_DATA">CP_GO_NO_DATA</a> на 1. :::</p><p>Затримка, як у заданих значеннях швидкості відстеження транспортного засобу, так і в отриманні даних датчиків від зовнішніх джерел, орієнтовано оцінюється через параметр <a href="#CP_DELAY">CP_DELAY</a>. Вона має бути <a href="#delay_tuning">налаштована</a> на конкретний транспортний засіб.</p><p>Якщо сектори, що прилягають до керованих секторів, є &quot;кращими&quot; зі значним відривом, напрямок запитуваного входу може бути змінено на кут, вказаний у <a href="#CP_GUIDE_ANG">CP_GUIDE_ANG</a>. Це допомагає точно налаштувати вхідні дані користувача, щоб &quot;вести&quot; транспортний засіб навколо перешкод, а не застрявати на них.</p><p><a id="data_loss"></a></p><h3 id="втрата-даних-про-дальність" tabindex="-1">Втрата даних про дальність <a class="header-anchor" href="#втрата-даних-про-дальність" aria-label="Permalink to &quot;Втрата даних про дальність&quot;">​</a></h3><p>Якщо автопілот не отримує дані про дальність від будь-якого датчика довше, ніж 0,5 секунди, він видасть попередження <em>No range data received, no movement allowed</em>. Це змусить встановити швидкість у ху до нуля. Через 5 секунд без отримання даних транспортний засіб перейде в режим <a href="./../flight_modes_mc/hold.html">HOLD</a>. Якщо ви хочете, щоб транспортний засіб знову міг рухатися, вам потрібно вимкнути запобігання зіткненням, або встановивши параметр <a href="#CP_DIST">CP_DIST</a> на від&#39;ємне значення, або переключившись у режим, відмінний від <a href="./../flight_modes_mc/position.html">Position mode</a> (наприклад, у <em>Altitude mode</em> або <em>Stabilized mode</em>).</p><p>Якщо у вас підключено кілька датчиків і ви втратили зв&#39;язок з одним з них, ви все одно зможете літати в полі зору (FOV) датчиків, що звітують. Дані несправного датчика втратять чинність, а область, що покривається цим датчиком, буде вважатися непокритою, тобто ви не зможете там пересуватися.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Будьте обережні, увімкнувши <a href="#CP_GO_NO_DATA">CP_GO_NO_DATA=1</a>, що дозволяє апарату вилітати за межі зони покриття датчиків. Якщо ви втратите зв&#39;язок з одним з декількох датчиків, зона, яку охоплює несправний датчик, також буде вважатися відкритою, і ви зможете пересуватися там без обмежень.</p></div><p><a id="delay_tuning"></a></p><h3 id="cp-delay-налаштування-затримки" tabindex="-1">CP_DELAY Налаштування затримки <a class="header-anchor" href="#cp-delay-налаштування-затримки" aria-label="Permalink to &quot;CP_DELAY Налаштування затримки&quot;">​</a></h3><p>Існує два основних джерела затримки, які слід враховувати: <em>затримка датчика</em> та <em>затримка відстеження заданої швидкості транспортного засобу</em>. Обидва джерела затримки налаштовуються за допомогою параметра <a href="#CP_DELAY">CP_DELAY</a>.</p><p>Затримку _ датчика_ для датчиків відстані, підключених безпосередньо до польотного контролера, можна вважати рівною 0. Для зовнішніх систем на основі зору затримка датчика може досягати 0,2 с.</p><p>Затримка <em>відстеження заданої швидкості</em> транспортного засобу може бути виміряна шляхом польоту з максимальною швидкістю в <a href="./../flight_modes_mc/position.html">режимі Позиції</a>, а потім виконання команди зупинки. Затримка між фактичною швидкістю та заданою швидкістю може бути виміряна з лог-файлів. Зазвичай затримка відстеження становить від 0,1 до 0,5 секунди, в залежності від розміру транспортного засобу та налаштувань.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Якщо швидкість транспортного засобу коливається під час наближення до перешкоди (тобто вона сповільнюється, прискорюється, сповільнюється), затримка встановлена занадто великою.</p></div><p><a id="angle_change_tuning"></a></p><h3 id="cp-guide-ang-налаштування-навігаціі" tabindex="-1">CP_GUIDE_ANG Налаштування навігації <a class="header-anchor" href="#cp-guide-ang-налаштування-навігаціі" aria-label="Permalink to &quot;CP_GUIDE_ANG Налаштування навігації&quot;">​</a></h3><p>Залежно від транспортного засобу, типу середовища та навичок пілота можуть бути вимоги щодо різних рівнів керування. Встановлення параметра <a href="#CP_GUIDE_ANG">CP_GUIDE_ANG</a> на значення 0 вимикає керування, внаслідок чого транспортний засіб рухається тільки в точних напрямках, які задані. Збільшення цього параметра дозволить транспортному засобу вибирати оптимальні напрямки для уникнення перешкод, що полегшує прохід через вузькі проміжки і точне збереження мінімальної відстані при об&#39;єзді об&#39;єктів.</p><p>Якщо цей параметр занадто малий, транспортний засіб може відчуватися &quot;застряглим&quot; біля перешкод, оскільки дозволено тільки рух від перешкод на мінімальній відстані. Якщо параметр занадто великий, транспортний засіб може відчуватися, як &quot;слайд&quot;, віддаляючись від перешкод в напрямках, які не задані оператором. Згідно з тестуванням, 30 градусів - це хороший баланс, хоча різні транспортні засоби можуть мати різні вимоги.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Функція керування ніколи не направить транспортний засіб в напрямок без даних з датчика. Якщо транспортний засіб відчуває &quot;застряглим&quot; з одним лише датчиком відстані, що спрямованим вперед, це, ймовірно, через те, що керування не може безпечно адаптувати напрямок через відсутність інформації.</p></div><p><a id="rangefinder"></a></p><h2 id="датчик-відстані-px4" tabindex="-1">Датчик відстані PX4 <a class="header-anchor" href="#датчик-відстані-px4" aria-label="Permalink to &quot;Датчик відстані PX4&quot;">​</a></h2><h3 id="lanbao-psk-cm8jl65-cc5" tabindex="-1">Lanbao PSK-CM8JL65-CC5 <a class="header-anchor" href="#lanbao-psk-cm8jl65-cc5" aria-label="Permalink to &quot;Lanbao PSK-CM8JL65-CC5&quot;">​</a></h3><p>На момент написання PX4 дозволяє використовувати датчик відстані ІК <a href="./../sensor/cm8jl65_ir_distance_sensor.html">Lanbao PSK-CM8JL65-CC5</a> для запобігання зіткнень &quot;з коробки&quot;, з мінімальною додатковою конфігурацією:</p><ul><li>Спочатку підключіть і <a href="./../sensor/cm8jl65_ir_distance_sensor.html">налаштуйте датчик</a>, та включіть запобігання зіткнень (як описано вище, використовуючи <a href="#CP_DIST">CP_DIST</a>).</li><li>Встановіть орієнтацію датчика, використовуючи <a href="./../advanced_config/parameter_reference.html#SENS_CM8JL65_R_0">SENS_CM8JL65_R_0</a>.</li></ul><h3 id="lightware-lidar-sf45-поворотнии-лідар" tabindex="-1">LightWare LiDAR SF45 Поворотний лідар <a class="header-anchor" href="#lightware-lidar-sf45-поворотнии-лідар" aria-label="Permalink to &quot;LightWare LiDAR SF45 Поворотний лідар&quot;">​</a></h3><p>PX4 v1.14 (і пізніші версії) підтримує поворотний лідар <a href="https://www.lightwarelidar.com/shop/sf45-b-50-m/" target="_blank" rel="noreferrer">LightWare LiDAR SF45</a>, який забезпечує сканування на 320 градусів.</p><p>SF45 повинен бути підключений через порт UART/серійний порт та налаштований, як описано нижче (на додачу до <a href="#px4-software-setup">налаштування запобігання зіткнень</a>).</p><p>Конфігурація в програмі <a href="https://www.lightwarelidar.com/resources-software" target="_blank" rel="noreferrer">LightWare Studio</a>:</p><ul><li>У програмі LightWare Studio активуйте сканування, встановіть кут сканування та змініть швидкість передачі даних на <code>921600</code> бод.</li></ul><p>Налаштування PX4:</p><ul><li>Додайте драйвер <a href="./../modules/modules_driver_distance_sensor.html#lightware-sf45-serial">lightware_sf45_serial</a> у <a href="./../hardware/porting_guide_config.html#px4-menuconfig-setup">меню конфігурації</a>: <ul><li>У розділі <strong>драйвери &gt; Датчики відстані</strong> виберіть <code>lightware_sf45_serial</code>.</li><li>Перекомпілюйте та завантажте на контролер польоту.</li></ul></li><li><a href="./../advanced_config/parameters.html">Встановіть наступні параметри</a> через QGC: <ul><li><a href="./../advanced_config/parameter_reference.html#SENS_EN_SF45_CFG">SENS_EN_SF45_CFG</a>: Встановіть для серійного порту, до якого ви підключили датчик. Переконайтеся, що GPS або телеметрія не активовані на цьому порті.</li><li><a href="./../advanced_config/parameter_reference.html#SF45_ORIENT_CFG">SF45_ORIENT_CFG</a>: Встановіть орієнтацію датчика (вгору чи вниз)</li><li><a href="./../advanced_config/parameter_reference.html#SF45_UPDATE_CFG">SF45_UPDATE_CFG</a>: Встановіть частоту оновлення</li><li><a href="./../advanced_config/parameter_reference.html#SF45_YAW_CFG">SF45_YAW_CFG</a>: Встановіть орієнтацію руху</li></ul></li></ul><p>У QGroundControl ви повинні бачити повідомлення <a href="https://mavlink.io/en/messages/common.html#OBSTACLE_DISTANCE" target="_blank" rel="noreferrer">OBSTACLE_DISTANCE</a> в <a href="./../debug/mavlink_shell.html#qgroundcontrol-mavlink-console">консолі MAVLink</a>, якщо запобігання зіткнень налаштовано правильно та активовано.</p><p>Налаштування перешкод в QGC буде виглядати так:</p><p><img src="'+e+'" alt="sf45"></p><h3 id="підтримка-далекоміра" tabindex="-1">Підтримка далекоміра <a class="header-anchor" href="#підтримка-далекоміра" aria-label="Permalink to &quot;Підтримка далекоміра&quot;">​</a></h3><p>Інші датчики можуть бути активовані, але це вимагає модифікації коду драйвера для встановлення орієнтації датчика та поля зору.</p><ul><li>Підключіть і налаштуйте датчик відстані на певному порту (див. документацію для конкретного датчика <a href="./../sensor/rangefinders.html">sensor-specific docs</a>) та активуйте запобігання зіткнень, використовуючи параметр <a href="#CP_DIST">CP_DIST</a>.</li><li>Модифікуйте драйвер для встановлення орієнтації. Це слід робити, наслідуючи параметр <code>SENS_CM8JL65_R_0</code> (хоча ви також можете захардкодити орієнтацію у файлі <em>module.yaml</em> датчика на щось подібне до <code>sf0x start -d ${SERIAL_DEV} -R 25</code> - де 25 відповідає <code>ROTATION_DOWNWARD_FACING</code>).</li><li>Модифікуйте драйвер для встановлення <em>поля зору</em> в темі UORB для датчика відстані (<code>distance_sensor_s.h_fov</code>).</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Ви можете побачити необхідні модифікації з PR функції. Будь ласка, внесіть свої зміни назад <a href="https://github.com/PX4/PX4-Autopilot/pull/12179" target="_blank" rel="noreferrer">feature PR</a>. Будь ласка, внесіть свої зміни!</p></div><p><a id="companion"></a></p><h2 id="налаштування-комп-ютера-компаньиона" tabindex="-1">Налаштування комп&#39;ютера компаньйона <a class="header-anchor" href="#налаштування-комп-ютера-компаньиона" aria-label="Permalink to &quot;Налаштування комп&#39;ютера компаньйона&quot;">​</a></h2><p>Якщо використовується компаньйонний комп&#39;ютер або зовнішній датчик, він повинен постачати потік повідомлень <a href="https://mavlink.io/en/messages/common.html#OBSTACLE_DISTANCE" target="_blank" rel="noreferrer">OBSTACLE_DISTANCE</a>, які повинні відображати час і місце виявлення перешкод.</p><p>Мінімальна частота, з якою <em>повинні</em> надсилатися повідомлення, залежить від швидкості руху транспортного засобу - при вищих частотах транспортному засобу буде довше часу на реакцію на виявлені перешкоди.</p><div class="info custom-block"><p class="custom-block-title">Початкове тестування системи використовувало транспортний засіб, який рухався зі швидкістю 4 м/с, і повідомлення <code>OBSTACLE_DISTANCE</code> надсилалися з частотою 10 Гц (максимальна частота, підтримувана системою комп&#39;ютерного зору). Система може добре працювати при значно вищих швидкостях і менших частотах оновлення відстані.</p></div><p>Протестоване компаньйонне програмне забезпечення - це <em>локальний планувальник</em> з репозиторію <a href="https://github.com/PX4/PX4-Avoidance" target="_blank" rel="noreferrer">PX4/PX4-Avoidance</a>. Для отримання додаткової інформації щодо налаштування апаратного та програмного забезпечення дивіться: <a href="https://github.com/PX4/PX4-Avoidance#run-on-hardware" target="_blank" rel="noreferrer">PX4/PX4-Avoidance &gt; Запуск на апаратному забезпеченні</a>.</p><p>Апаратне та програмне забезпечення повинно бути налаштоване згідно з інструкціями у репозиторії <a href="https://github.com/PX4/PX4-Avoidance" target="_blank" rel="noreferrer">PX4/PX4-Avoidance</a>. Щоб надсилати повідомлення <code>OBSTACLE_DISTANCE</code>, вам потрібно використовувати інструмент rqt_reconfigure та встановити параметр <code>send_obstacles_fcu</code> на true.</p><h2 id="встановлення-gazebo" tabindex="-1">Встановлення Gazebo <a class="header-anchor" href="#встановлення-gazebo" aria-label="Permalink to &quot;Встановлення Gazebo&quot;">​</a></h2><p><em>Запобігання зіткненням</em> також можна протестувати за допомогою Gazebo. Інструкції з налаштування див. у розділі <a href="https://github.com/PX4/PX4-Avoidance" target="_blank" rel="noreferrer">PX4/PX4-Avoidance</a>.</p>',67),n=[l];function _(c,d,h,s,p,m){return t(),r("div",null,n)}const C=a(i,[["render",_]]);export{u as __pageData,C as default};
